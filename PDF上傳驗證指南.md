# PDF é‡æ–°ä¸Šå‚³å®Œæ•´é©—è­‰æŒ‡å—

## å‰ç½®æº–å‚™

1. **é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…·**
   - æŒ‰ F12 æˆ–å³éµé¸æ“‡ã€Œæª¢æŸ¥ã€
   - åˆ‡æ›åˆ°ã€ŒConsoleã€æ¨™ç±¤é 
   - ä¿æŒé–‹ç™¼è€…å·¥å…·é–‹å•Ÿç‹€æ…‹

2. **æº–å‚™æ¸¬è©¦è³‡æ–™**
   - ä¸€å€‹å·²å­˜åœ¨çš„ä½œæ¥­ï¼ˆæœ‰å­¸ç”Ÿæäº¤è¨˜éŒ„ï¼‰
   - ä¸€ä»½æ–°çš„ PDF æª”æ¡ˆï¼ˆç”¨æ–¼é‡æ–°ä¸Šå‚³ï¼‰

---

## é©—è­‰æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šä¸Šå‚³æ–° PDF æª”

**æ“ä½œ**ï¼š
1. å‰å¾€ã€ŒPDF åŒ¯å…¥ã€é é¢
2. é¸æ“‡ä¸€å€‹å·²æœ‰ä½œæ¥­çš„ç­ç´š
3. ä¸Šå‚³æ–°çš„ PDF æª”æ¡ˆ
4. åŒ¹é…ç›¸åŒçš„å­¸ç”Ÿï¼ˆé‡æ–°ä¸Šå‚³ï¼‰

**é æœŸ Console æ—¥èªŒ**ï¼š

```
ğŸ—‘ï¸ [PDFåŒ¯å…¥] ç™¼ç¾èˆŠä½œæ¥­ï¼Œæº–å‚™åˆªé™¤: {
  studentId: "xxx",
  count: 1,
  oldIds: ["old-submission-id"]
}

ğŸ—‘ï¸ [PDFåŒ¯å…¥] åˆªé™¤æœ¬åœ°èˆŠä½œæ¥­: {
  id: "old-submission-id",
  hadGradingData: true,  // å¦‚æœä¹‹å‰æœ‰æ‰¹æ”¹é
  score: 85,             // èˆŠçš„åˆ†æ•¸
  feedback: "...",       // èˆŠçš„æ‰¹æ”¹å›é¥‹
  hasGradingResult: true // æ˜¯å¦æœ‰å®Œæ•´æ‰¹æ”¹çµæœ
}

âœ… [PDFåŒ¯å…¥] èˆŠä½œæ¥­å·²æ¸…é™¤ï¼Œæ‰¹æ”¹è³‡æ–™å·²æ¸…ç©º

ğŸ“ [PDFåŒ¯å…¥] å»ºç«‹æ–°ä½œæ¥­: {
  id: "new-submission-id",
  assignmentId: "xxx",
  studentId: "xxx",
  status: "scanned",
  imageSize: "123.45 KB",
  hasBlob: true
}

âœ… [PDFåŒ¯å…¥] æ–°ä½œæ¥­å·²åŠ å…¥æœ¬åœ°è³‡æ–™åº«
```

**âœ… é©—è­‰é» 1.1**ï¼šç¢ºèªçœ‹åˆ°ã€Œç™¼ç¾èˆŠä½œæ¥­ã€å’Œã€Œåˆªé™¤æœ¬åœ°èˆŠä½œæ¥­ã€æ—¥èªŒ
**âœ… é©—è­‰é» 1.2**ï¼šç¢ºèª `hadGradingData: true`ï¼ˆå¦‚æœä¹‹å‰æœ‰æ‰¹æ”¹éï¼‰
**âœ… é©—è­‰é» 1.3**ï¼šç¢ºèªçœ‹åˆ°ã€Œå»ºç«‹æ–°ä½œæ¥­ã€æ—¥èªŒï¼Œä¸” ID èˆ‡èˆŠçš„ä¸åŒ

---

### æ­¥é©Ÿ 2ï¼šé›²ç«¯åŒæ­¥ - ä¸Šå‚³æ–°æª”æ¡ˆ

**æ“ä½œ**ï¼š
- ç­‰å¾…è‡ªå‹•åŒæ­¥ï¼Œæˆ–é»æ“ŠåŒæ­¥æŒ‰éˆ•

**é æœŸ Console æ—¥èªŒï¼ˆå¾Œç«¯ APIï¼‰**ï¼š

æŸ¥çœ‹**çµ‚ç«¯æ©Ÿ**ï¼ˆé‹è¡Œ `npm run dev` çš„åœ°æ–¹ï¼‰ï¼š

```
ğŸ“¤ [ä¸Šå‚³] é–‹å§‹ä¸Šå‚³æª”æ¡ˆ: {
  submissionId: "new-submission-id",
  assignmentId: "xxx",
  studentId: "xxx",
  filePath: "submissions/new-submission-id.webp",
  fileSize: "123.45 KB"
}

âœ… [ä¸Šå‚³] æª”æ¡ˆä¸Šå‚³æˆåŠŸ: submissions/new-submission-id.webp

ğŸ—‘ï¸ [è¦†è“‹] ç™¼ç¾èˆŠä½œæ¥­ï¼Œæº–å‚™åˆªé™¤: {
  oldId: "old-submission-id",
  newId: "new-submission-id",
  assignmentId: "xxx",
  studentId: "xxx"
}

âœ… [è¦†è“‹] å·²åˆªé™¤èˆŠä½œæ¥­è³‡æ–™åº«è¨˜éŒ„: old-submission-id
âœ… [è¦†è“‹] å·²åˆªé™¤èˆŠä½œæ¥­é›²ç«¯æª”æ¡ˆ: submissions/old-submission-id.webp

ğŸ’¾ [è³‡æ–™åº«] é–‹å§‹æ’å…¥æ–° submission: {
  id: "new-submission-id",
  assignmentId: "xxx",
  studentId: "xxx",
  imageUrl: "submissions/new-submission-id.webp",
  status: "synced"
}

âœ… [è³‡æ–™åº«] æ–° submission å¯«å…¥æˆåŠŸ
ğŸ‰ [å®Œæˆ] PDF ä¸Šå‚³æµç¨‹å®Œæˆ: {
  submissionId: "new-submission-id",
  imageUrl: "submissions/new-submission-id.webp",
  status: "synced"
}
```

**âœ… é©—è­‰é» 2.1**ï¼šç¢ºèªçœ‹åˆ°ã€Œæª”æ¡ˆä¸Šå‚³æˆåŠŸã€
**âœ… é©—è­‰é» 2.2**ï¼šç¢ºèªçœ‹åˆ°ã€Œç™¼ç¾èˆŠä½œæ¥­ï¼Œæº–å‚™åˆªé™¤ã€ï¼ˆèˆŠ ID èˆ‡æ–° ID ä¸åŒï¼‰
**âœ… é©—è­‰é» 2.3**ï¼šç¢ºèªçœ‹åˆ°ã€Œå·²åˆªé™¤èˆŠä½œæ¥­é›²ç«¯æª”æ¡ˆã€
**âœ… é©—è­‰é» 2.4**ï¼šç¢ºèªçœ‹åˆ°ã€Œæ–° submission å¯«å…¥æˆåŠŸã€
**âœ… é©—è­‰é» 2.5**ï¼šç¢ºèª imageUrl æ˜¯æ–°çš„è·¯å¾‘

---

### æ­¥é©Ÿ 3ï¼šæª¢æŸ¥ Supabase è³‡æ–™åº«

**æ“ä½œ**ï¼š
1. å‰å¾€ Supabase Dashboard
2. é–‹å•Ÿã€ŒTable Editorã€
3. æŸ¥çœ‹ `submissions` è¡¨

**é æœŸçµæœ**ï¼š

```sql
-- æ‡‰è©²åªæœ‰æ–°çš„è¨˜éŒ„
SELECT id, assignment_id, student_id, image_url, status, created_at
FROM submissions
WHERE assignment_id = 'xxx' AND student_id = 'xxx'
```

**âœ… é©—è­‰é» 3.1**ï¼šåªæœ‰ä¸€ç­†è¨˜éŒ„ï¼ˆæ–°çš„ submissionï¼‰
**âœ… é©—è­‰é» 3.2**ï¼š`id` æ˜¯æ–°çš„ IDï¼ˆèˆ‡æ—¥èªŒä¸­çš„ `new-submission-id` ç›¸åŒï¼‰
**âœ… é©—è­‰é» 3.3**ï¼š`image_url` æ˜¯ `submissions/new-submission-id.webp`
**âœ… é©—è­‰é» 3.4**ï¼š`status` æ˜¯ `synced`
**âœ… é©—è­‰é» 3.5**ï¼šæ²’æœ‰æ‰¹æ”¹ç›¸é—œæ¬„ä½è³‡æ–™ï¼ˆ`score`ã€`feedback`ã€`grading_result` çš†ç‚ºç©ºï¼‰

---

### æ­¥é©Ÿ 4ï¼šæª¢æŸ¥ Supabase Storage

**æ“ä½œ**ï¼š
1. å‰å¾€ Supabase Dashboard
2. é–‹å•Ÿã€ŒStorageã€
3. é€²å…¥ `homework-images` bucket
4. æŸ¥çœ‹ `submissions/` è³‡æ–™å¤¾

**é æœŸçµæœ**ï¼š

**âœ… é©—è­‰é» 4.1**ï¼šå­˜åœ¨æª”æ¡ˆ `new-submission-id.webp`ï¼ˆæ–°æª”æ¡ˆï¼‰
**âœ… é©—è­‰é» 4.2**ï¼šä¸å­˜åœ¨æª”æ¡ˆ `old-submission-id.webp`ï¼ˆèˆŠæª”æ¡ˆå·²åˆªé™¤ï¼‰

---

### æ­¥é©Ÿ 5ï¼šå®¢æˆ¶ç«¯åŒæ­¥ - æ›´æ–°æœ¬åœ°ç‹€æ…‹

**æ“ä½œ**ï¼š
- ç¹¼çºŒè§€å¯Ÿç€è¦½å™¨ Console

**é æœŸ Console æ—¥èªŒï¼ˆå®¢æˆ¶ç«¯ï¼‰**ï¼š

```
ğŸ”„ [åŒæ­¥] æ›´æ–°æœ¬åœ° submission ç‹€æ…‹: {
  submissionId: "new-submission-id",
  oldImageUrl: undefined,
  newImageUrl: "submissions/new-submission-id.webp",
  oldStatus: "scanned",
  newStatus: "synced"
}

âœ… [åŒæ­¥] æœ¬åœ° submission æ›´æ–°å®Œæˆ: {
  submissionId: "new-submission-id",
  imageUrl: "submissions/new-submission-id.webp",
  status: "synced"
}
```

**âœ… é©—è­‰é» 5.1**ï¼šç¢ºèªçœ‹åˆ°ã€Œæ›´æ–°æœ¬åœ° submission ç‹€æ…‹ã€
**âœ… é©—è­‰é» 5.2**ï¼šç¢ºèª `oldStatus` å¾ `scanned` è®Šæˆ `synced`
**âœ… é©—è­‰é» 5.3**ï¼šç¢ºèª `newImageUrl` æ­£ç¢ºè¨­å®š

---

### æ­¥é©Ÿ 6ï¼šAI æ‰¹æ”¹é é¢é©—è­‰

**æ“ä½œ**ï¼š
1. å‰å¾€ã€ŒAI æ‰¹æ”¹ã€é é¢
2. é¸æ“‡å‰›å‰›ä¸Šå‚³çš„ä½œæ¥­
3. æŸ¥çœ‹å­¸ç”Ÿä½œæ¥­

**é æœŸçµæœ**ï¼š

**âœ… é©—è­‰é» 6.1**ï¼šé¡¯ç¤ºæ–°çš„ PDF åœ–ç‰‡ï¼ˆä¸æ˜¯èˆŠçš„ï¼‰
**âœ… é©—è­‰é» 6.2**ï¼šæ²’æœ‰æ‰¹æ”¹è³‡æ–™ï¼ˆæœªè¢«æ‰¹æ”¹éçš„ç‹€æ…‹ï¼‰
**âœ… é©—è­‰é» 6.3**ï¼šå¯ä»¥æ­£å¸¸é€²è¡Œ AI æ‰¹æ”¹

---

## å®Œæ•´é©—è­‰æ¸…å–®

### å®¢æˆ¶ç«¯ï¼ˆç€è¦½å™¨ Consoleï¼‰
- [ ] çœ‹åˆ°ã€Œç™¼ç¾èˆŠä½œæ¥­ï¼Œæº–å‚™åˆªé™¤ã€
- [ ] çœ‹åˆ°ã€Œåˆªé™¤æœ¬åœ°èˆŠä½œæ¥­ã€ï¼Œä¸” `hadGradingData: true`
- [ ] çœ‹åˆ°ã€Œå»ºç«‹æ–°ä½œæ¥­ã€ï¼Œæ–° ID èˆ‡èˆŠ ID ä¸åŒ
- [ ] çœ‹åˆ°ã€Œæ–°ä½œæ¥­å·²åŠ å…¥æœ¬åœ°è³‡æ–™åº«ã€
- [ ] çœ‹åˆ°ã€Œæ›´æ–°æœ¬åœ° submission ç‹€æ…‹ã€
- [ ] çœ‹åˆ°ã€Œæœ¬åœ° submission æ›´æ–°å®Œæˆã€

### ä¼ºæœå™¨ç«¯ï¼ˆçµ‚ç«¯æ©Ÿï¼‰
- [ ] çœ‹åˆ°ã€Œé–‹å§‹ä¸Šå‚³æª”æ¡ˆã€
- [ ] çœ‹åˆ°ã€Œæª”æ¡ˆä¸Šå‚³æˆåŠŸã€
- [ ] çœ‹åˆ°ã€Œç™¼ç¾èˆŠä½œæ¥­ï¼Œæº–å‚™åˆªé™¤ã€
- [ ] çœ‹åˆ°ã€Œå·²åˆªé™¤èˆŠä½œæ¥­è³‡æ–™åº«è¨˜éŒ„ã€
- [ ] çœ‹åˆ°ã€Œå·²åˆªé™¤èˆŠä½œæ¥­é›²ç«¯æª”æ¡ˆã€
- [ ] çœ‹åˆ°ã€Œé–‹å§‹æ’å…¥æ–° submissionã€
- [ ] çœ‹åˆ°ã€Œæ–° submission å¯«å…¥æˆåŠŸã€
- [ ] çœ‹åˆ°ã€ŒPDF ä¸Šå‚³æµç¨‹å®Œæˆã€

### Supabase è³‡æ–™åº«
- [ ] `submissions` è¡¨åªæœ‰æ–°è¨˜éŒ„
- [ ] `image_url` æ˜¯æ–°çš„è·¯å¾‘
- [ ] æ²’æœ‰æ‰¹æ”¹è³‡æ–™ï¼ˆ`ai_correction` ç‚ºç©ºï¼‰
- [ ] `status` æ˜¯ `synced`

### Supabase Storage
- [ ] æ–°æª”æ¡ˆå­˜åœ¨ (`new-submission-id.webp`)
- [ ] èˆŠæª”æ¡ˆå·²åˆªé™¤ (`old-submission-id.webp` ä¸å­˜åœ¨)

### AI æ‰¹æ”¹é é¢
- [ ] é¡¯ç¤ºæ–°åœ–ç‰‡
- [ ] æœªæ‰¹æ”¹ç‹€æ…‹
- [ ] å¯æ­£å¸¸æ‰¹æ”¹

---

## å¸¸è¦‹å•é¡Œæ’æŸ¥

### 1. å¦‚æœçœ‹ä¸åˆ°æ–°åœ–ç‰‡ï¼Ÿ

**æª¢æŸ¥**ï¼š
- ç€è¦½å™¨ Console æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯
- ç¢ºèª `imageUrl` æ˜¯å¦æ­£ç¢ºè¨­å®š
- æª¢æŸ¥ Supabase Storage æ˜¯å¦æœ‰æª”æ¡ˆ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```javascript
// åœ¨ç€è¦½å™¨ Console åŸ·è¡Œ
const db = await import('./lib/db').then(m => m.db)
const submission = await db.submissions.get('submission-id')
console.log('ç•¶å‰ submission:', submission)
```

### 2. å¦‚æœèˆŠæ‰¹æ”¹è³‡æ–™æ²’æ¸…ç©ºï¼Ÿ

**æª¢æŸ¥**ï¼š
- ç¢ºèªã€Œåˆªé™¤æœ¬åœ°èˆŠä½œæ¥­ã€æ—¥èªŒä¸­ `hadGradingData: true`
- ç¢ºèª Supabase è³‡æ–™åº«ä¸­æ²’æœ‰ `ai_correction` è³‡æ–™

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥æ˜¯å¦çœŸçš„é‡æ–°ä¸Šå‚³ï¼ˆæ–°èˆŠ ID ä¸åŒï¼‰
- æŸ¥çœ‹å¾Œç«¯æ—¥èªŒç¢ºèªåˆªé™¤æµç¨‹

### 3. å¦‚æœèˆŠæª”æ¡ˆæ²’åˆªé™¤ï¼Ÿ

**æª¢æŸ¥**ï¼š
- ç¢ºèªå¾Œç«¯æ—¥èªŒæœ‰ã€Œå·²åˆªé™¤èˆŠä½œæ¥­é›²ç«¯æª”æ¡ˆã€
- æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥ Supabase Storage RLS æ”¿ç­–
- æ‰‹å‹•å¾ Storage Dashboard åˆªé™¤å­¤å…’æª”æ¡ˆ

---

## æ¸¬è©¦è…³æœ¬ï¼ˆå¯é¸ï¼‰

å¦‚æœæƒ³è‡ªå‹•é©—è­‰ï¼Œå¯ä»¥åœ¨ç€è¦½å™¨ Console åŸ·è¡Œï¼š

```javascript
// æª¢æŸ¥æœ¬åœ°è³‡æ–™åº«ç‹€æ…‹
async function checkLocalSubmission(submissionId) {
  const { db } = await import('./lib/db')
  const submission = await db.submissions.get(submissionId)

  console.log('ğŸ“Š æœ¬åœ° Submission ç‹€æ…‹:', {
    id: submission.id,
    status: submission.status,
    imageUrl: submission.imageUrl,
    hasBlob: !!submission.imageBlob,
    hasBase64: !!submission.imageBase64,
    hasAiCorrection: !!submission.ai_correction,
    hasTeacherCorrection: !!submission.teacher_correction
  })

  return submission
}

// ä½¿ç”¨æ–¹å¼
await checkLocalSubmission('your-submission-id')
```

---

## é æœŸå®Œæ•´æµç¨‹æ™‚é–“è»¸

1. **0:00** - ä½¿ç”¨è€…ä¸Šå‚³ PDF
2. **0:01** - åˆªé™¤æœ¬åœ°èˆŠä½œæ¥­ï¼ˆå«æ‰¹æ”¹è³‡æ–™ï¼‰
3. **0:02** - å»ºç«‹æ–°ä½œæ¥­åˆ°æœ¬åœ°è³‡æ–™åº«
4. **0:03** - è§¸ç™¼é›²ç«¯åŒæ­¥
5. **0:05** - ä¸Šå‚³æ–°æª”æ¡ˆåˆ° Storage
6. **0:06** - åˆªé™¤é›²ç«¯èˆŠä½œæ¥­è¨˜éŒ„å’Œæª”æ¡ˆ
7. **0:07** - æ’å…¥æ–°ä½œæ¥­åˆ°é›²ç«¯è³‡æ–™åº«
8. **0:08** - æ›´æ–°æœ¬åœ°ç‹€æ…‹ç‚º `synced`
9. **0:10** - å®Œæˆï¼å¯åœ¨ AI æ‰¹æ”¹é é¢çœ‹åˆ°æ–°åœ–ç‰‡

---

## æˆåŠŸç¯„ä¾‹

å®Œæ•´çš„æˆåŠŸæ—¥èªŒæ‡‰è©²å¦‚ä¸‹ï¼š

```
[ç€è¦½å™¨ Console]
ğŸ—‘ï¸ [PDFåŒ¯å…¥] ç™¼ç¾èˆŠä½œæ¥­ï¼Œæº–å‚™åˆªé™¤
ğŸ—‘ï¸ [PDFåŒ¯å…¥] åˆªé™¤æœ¬åœ°èˆŠä½œæ¥­ (hadGradingData: true)
âœ… [PDFåŒ¯å…¥] èˆŠä½œæ¥­å·²æ¸…é™¤
ğŸ“ [PDFåŒ¯å…¥] å»ºç«‹æ–°ä½œæ¥­
âœ… [PDFåŒ¯å…¥] æ–°ä½œæ¥­å·²åŠ å…¥æœ¬åœ°è³‡æ–™åº«

[çµ‚ç«¯æ©Ÿ]
ğŸ“¤ [ä¸Šå‚³] é–‹å§‹ä¸Šå‚³æª”æ¡ˆ
âœ… [ä¸Šå‚³] æª”æ¡ˆä¸Šå‚³æˆåŠŸ
ğŸ—‘ï¸ [è¦†è“‹] ç™¼ç¾èˆŠä½œæ¥­ï¼Œæº–å‚™åˆªé™¤
âœ… [è¦†è“‹] å·²åˆªé™¤èˆŠä½œæ¥­è³‡æ–™åº«è¨˜éŒ„
âœ… [è¦†è“‹] å·²åˆªé™¤èˆŠä½œæ¥­é›²ç«¯æª”æ¡ˆ
ğŸ’¾ [è³‡æ–™åº«] é–‹å§‹æ’å…¥æ–° submission
âœ… [è³‡æ–™åº«] æ–° submission å¯«å…¥æˆåŠŸ
ğŸ‰ [å®Œæˆ] PDF ä¸Šå‚³æµç¨‹å®Œæˆ

[ç€è¦½å™¨ Console]
ğŸ”„ [åŒæ­¥] æ›´æ–°æœ¬åœ° submission ç‹€æ…‹
âœ… [åŒæ­¥] æœ¬åœ° submission æ›´æ–°å®Œæˆ
```

å¦‚æœæ‚¨çœ‹åˆ°ä»¥ä¸Šæ‰€æœ‰æ—¥èªŒï¼Œæ­å–œï¼PDF é‡æ–°ä¸Šå‚³åŠŸèƒ½é‹ä½œæ­£å¸¸ï¼
