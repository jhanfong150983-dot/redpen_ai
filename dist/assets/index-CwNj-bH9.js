var KI=Object.defineProperty;var mk=a=>{throw TypeError(a)};var XI=(a,e,t)=>e in a?KI(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var Re=(a,e,t)=>XI(a,typeof e!="symbol"?e+"":e,t),D_=(a,e,t)=>e.has(a)||mk("Cannot "+t);var c=(a,e,t)=>(D_(a,e,"read from private field"),t?t.call(a):e.get(a)),R=(a,e,t)=>e.has(a)?mk("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),k=(a,e,t,n)=>(D_(a,e,"write to private field"),n?n.call(a,t):e.set(a,t),t),O=(a,e,t)=>(D_(a,e,"access private method"),t);var er=(a,e,t,n)=>({set _(r){k(a,e,r,t)},get _(){return c(a,e,n)}});function YI(a,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in a)){const s=Object.getOwnPropertyDescriptor(n,r);s&&Object.defineProperty(a,r,s.get?s:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var JI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tA(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function F0(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var e=a.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(a).forEach(function(n){var r=Object.getOwnPropertyDescriptor(a,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return a[n]}})}),t}var L_={exports:{}},nm={},F_={exports:{}},Rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yk;function QI(){if(yk)return Rt;yk=1;var a=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.iterator;function v(z){return z===null||typeof z!="object"?null:(z=y&&z[y]||z["@@iterator"],typeof z=="function"?z:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,E={};function T(z,K,Se){this.props=z,this.context=K,this.refs=E,this.updater=Se||x}T.prototype.isReactComponent={},T.prototype.setState=function(z,K){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,K,"setState")},T.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function N(){}N.prototype=T.prototype;function L(z,K,Se){this.props=z,this.context=K,this.refs=E,this.updater=Se||x}var j=L.prototype=new N;j.constructor=L,S(j,T.prototype),j.isPureReactComponent=!0;var F=Array.isArray,B=Object.prototype.hasOwnProperty,$={current:null},H={key:!0,ref:!0,__self:!0,__source:!0};function W(z,K,Se){var Pe,Ve={},We=null,be=null;if(K!=null)for(Pe in K.ref!==void 0&&(be=K.ref),K.key!==void 0&&(We=""+K.key),K)B.call(K,Pe)&&!H.hasOwnProperty(Pe)&&(Ve[Pe]=K[Pe]);var Te=arguments.length-2;if(Te===1)Ve.children=Se;else if(1<Te){for(var Ee=Array(Te),at=0;at<Te;at++)Ee[at]=arguments[at+2];Ve.children=Ee}if(z&&z.defaultProps)for(Pe in Te=z.defaultProps,Te)Ve[Pe]===void 0&&(Ve[Pe]=Te[Pe]);return{$$typeof:a,type:z,key:We,ref:be,props:Ve,_owner:$.current}}function ae(z,K){return{$$typeof:a,type:z.type,key:K,ref:z.ref,props:z.props,_owner:z._owner}}function me(z){return typeof z=="object"&&z!==null&&z.$$typeof===a}function ne(z){var K={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(Se){return K[Se]})}var re=/\/+/g;function xe(z,K){return typeof z=="object"&&z!==null&&z.key!=null?ne(""+z.key):K.toString(36)}function ve(z,K,Se,Pe,Ve){var We=typeof z;(We==="undefined"||We==="boolean")&&(z=null);var be=!1;if(z===null)be=!0;else switch(We){case"string":case"number":be=!0;break;case"object":switch(z.$$typeof){case a:case e:be=!0}}if(be)return be=z,Ve=Ve(be),z=Pe===""?"."+xe(be,0):Pe,F(Ve)?(Se="",z!=null&&(Se=z.replace(re,"$&/")+"/"),ve(Ve,K,Se,"",function(at){return at})):Ve!=null&&(me(Ve)&&(Ve=ae(Ve,Se+(!Ve.key||be&&be.key===Ve.key?"":(""+Ve.key).replace(re,"$&/")+"/")+z)),K.push(Ve)),1;if(be=0,Pe=Pe===""?".":Pe+":",F(z))for(var Te=0;Te<z.length;Te++){We=z[Te];var Ee=Pe+xe(We,Te);be+=ve(We,K,Se,Ee,Ve)}else if(Ee=v(z),typeof Ee=="function")for(z=Ee.call(z),Te=0;!(We=z.next()).done;)We=We.value,Ee=Pe+xe(We,Te++),be+=ve(We,K,Se,Ee,Ve);else if(We==="object")throw K=String(z),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.");return be}function _e(z,K,Se){if(z==null)return z;var Pe=[],Ve=0;return ve(z,Pe,"","",function(We){return K.call(Se,We,Ve++)}),Pe}function pe(z){if(z._status===-1){var K=z._result;K=K(),K.then(function(Se){(z._status===0||z._status===-1)&&(z._status=1,z._result=Se)},function(Se){(z._status===0||z._status===-1)&&(z._status=2,z._result=Se)}),z._status===-1&&(z._status=0,z._result=K)}if(z._status===1)return z._result.default;throw z._result}var fe={current:null},Z={transition:null},ke={ReactCurrentDispatcher:fe,ReactCurrentBatchConfig:Z,ReactCurrentOwner:$};function Q(){throw Error("act(...) is not supported in production builds of React.")}return Rt.Children={map:_e,forEach:function(z,K,Se){_e(z,function(){K.apply(this,arguments)},Se)},count:function(z){var K=0;return _e(z,function(){K++}),K},toArray:function(z){return _e(z,function(K){return K})||[]},only:function(z){if(!me(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},Rt.Component=T,Rt.Fragment=t,Rt.Profiler=r,Rt.PureComponent=L,Rt.StrictMode=n,Rt.Suspense=d,Rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ke,Rt.act=Q,Rt.cloneElement=function(z,K,Se){if(z==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+z+".");var Pe=S({},z.props),Ve=z.key,We=z.ref,be=z._owner;if(K!=null){if(K.ref!==void 0&&(We=K.ref,be=$.current),K.key!==void 0&&(Ve=""+K.key),z.type&&z.type.defaultProps)var Te=z.type.defaultProps;for(Ee in K)B.call(K,Ee)&&!H.hasOwnProperty(Ee)&&(Pe[Ee]=K[Ee]===void 0&&Te!==void 0?Te[Ee]:K[Ee])}var Ee=arguments.length-2;if(Ee===1)Pe.children=Se;else if(1<Ee){Te=Array(Ee);for(var at=0;at<Ee;at++)Te[at]=arguments[at+2];Pe.children=Te}return{$$typeof:a,type:z.type,key:Ve,ref:We,props:Pe,_owner:be}},Rt.createContext=function(z){return z={$$typeof:o,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},z.Provider={$$typeof:s,_context:z},z.Consumer=z},Rt.createElement=W,Rt.createFactory=function(z){var K=W.bind(null,z);return K.type=z,K},Rt.createRef=function(){return{current:null}},Rt.forwardRef=function(z){return{$$typeof:u,render:z}},Rt.isValidElement=me,Rt.lazy=function(z){return{$$typeof:p,_payload:{_status:-1,_result:z},_init:pe}},Rt.memo=function(z,K){return{$$typeof:f,type:z,compare:K===void 0?null:K}},Rt.startTransition=function(z){var K=Z.transition;Z.transition={};try{z()}finally{Z.transition=K}},Rt.unstable_act=Q,Rt.useCallback=function(z,K){return fe.current.useCallback(z,K)},Rt.useContext=function(z){return fe.current.useContext(z)},Rt.useDebugValue=function(){},Rt.useDeferredValue=function(z){return fe.current.useDeferredValue(z)},Rt.useEffect=function(z,K){return fe.current.useEffect(z,K)},Rt.useId=function(){return fe.current.useId()},Rt.useImperativeHandle=function(z,K,Se){return fe.current.useImperativeHandle(z,K,Se)},Rt.useInsertionEffect=function(z,K){return fe.current.useInsertionEffect(z,K)},Rt.useLayoutEffect=function(z,K){return fe.current.useLayoutEffect(z,K)},Rt.useMemo=function(z,K){return fe.current.useMemo(z,K)},Rt.useReducer=function(z,K,Se){return fe.current.useReducer(z,K,Se)},Rt.useRef=function(z){return fe.current.useRef(z)},Rt.useState=function(z){return fe.current.useState(z)},Rt.useSyncExternalStore=function(z,K,Se){return fe.current.useSyncExternalStore(z,K,Se)},Rt.useTransition=function(){return fe.current.useTransition()},Rt.version="18.3.1",Rt}var vk;function ax(){return vk||(vk=1,F_.exports=QI()),F_.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bk;function ZI(){if(bk)return nm;bk=1;var a=ax(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(u,d,f){var p,y={},v=null,x=null;f!==void 0&&(v=""+f),d.key!==void 0&&(v=""+d.key),d.ref!==void 0&&(x=d.ref);for(p in d)n.call(d,p)&&!s.hasOwnProperty(p)&&(y[p]=d[p]);if(u&&u.defaultProps)for(p in d=u.defaultProps,d)y[p]===void 0&&(y[p]=d[p]);return{$$typeof:e,type:u,key:v,ref:x,props:y,_owner:r.current}}return nm.Fragment=t,nm.jsx=o,nm.jsxs=o,nm}var wk;function e2(){return wk||(wk=1,L_.exports=ZI()),L_.exports}var w=e2(),ue=ax(),ab={},B_={exports:{}},ms={},$_={exports:{}},U_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xk;function t2(){return xk||(xk=1,(function(a){function e(Z,ke){var Q=Z.length;Z.push(ke);e:for(;0<Q;){var z=Q-1>>>1,K=Z[z];if(0<r(K,ke))Z[z]=ke,Z[Q]=K,Q=z;else break e}}function t(Z){return Z.length===0?null:Z[0]}function n(Z){if(Z.length===0)return null;var ke=Z[0],Q=Z.pop();if(Q!==ke){Z[0]=Q;e:for(var z=0,K=Z.length,Se=K>>>1;z<Se;){var Pe=2*(z+1)-1,Ve=Z[Pe],We=Pe+1,be=Z[We];if(0>r(Ve,Q))We<K&&0>r(be,Ve)?(Z[z]=be,Z[We]=Q,z=We):(Z[z]=Ve,Z[Pe]=Q,z=Pe);else if(We<K&&0>r(be,Q))Z[z]=be,Z[We]=Q,z=We;else break e}}return ke}function r(Z,ke){var Q=Z.sortIndex-ke.sortIndex;return Q!==0?Q:Z.id-ke.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;a.unstable_now=function(){return s.now()}}else{var o=Date,u=o.now();a.unstable_now=function(){return o.now()-u}}var d=[],f=[],p=1,y=null,v=3,x=!1,S=!1,E=!1,T=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function j(Z){for(var ke=t(f);ke!==null;){if(ke.callback===null)n(f);else if(ke.startTime<=Z)n(f),ke.sortIndex=ke.expirationTime,e(d,ke);else break;ke=t(f)}}function F(Z){if(E=!1,j(Z),!S)if(t(d)!==null)S=!0,pe(B);else{var ke=t(f);ke!==null&&fe(F,ke.startTime-Z)}}function B(Z,ke){S=!1,E&&(E=!1,N(W),W=-1),x=!0;var Q=v;try{for(j(ke),y=t(d);y!==null&&(!(y.expirationTime>ke)||Z&&!ne());){var z=y.callback;if(typeof z=="function"){y.callback=null,v=y.priorityLevel;var K=z(y.expirationTime<=ke);ke=a.unstable_now(),typeof K=="function"?y.callback=K:y===t(d)&&n(d),j(ke)}else n(d);y=t(d)}if(y!==null)var Se=!0;else{var Pe=t(f);Pe!==null&&fe(F,Pe.startTime-ke),Se=!1}return Se}finally{y=null,v=Q,x=!1}}var $=!1,H=null,W=-1,ae=5,me=-1;function ne(){return!(a.unstable_now()-me<ae)}function re(){if(H!==null){var Z=a.unstable_now();me=Z;var ke=!0;try{ke=H(!0,Z)}finally{ke?xe():($=!1,H=null)}}else $=!1}var xe;if(typeof L=="function")xe=function(){L(re)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,_e=ve.port2;ve.port1.onmessage=re,xe=function(){_e.postMessage(null)}}else xe=function(){T(re,0)};function pe(Z){H=Z,$||($=!0,xe())}function fe(Z,ke){W=T(function(){Z(a.unstable_now())},ke)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(Z){Z.callback=null},a.unstable_continueExecution=function(){S||x||(S=!0,pe(B))},a.unstable_forceFrameRate=function(Z){0>Z||125<Z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<Z?Math.floor(1e3/Z):5},a.unstable_getCurrentPriorityLevel=function(){return v},a.unstable_getFirstCallbackNode=function(){return t(d)},a.unstable_next=function(Z){switch(v){case 1:case 2:case 3:var ke=3;break;default:ke=v}var Q=v;v=ke;try{return Z()}finally{v=Q}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(Z,ke){switch(Z){case 1:case 2:case 3:case 4:case 5:break;default:Z=3}var Q=v;v=Z;try{return ke()}finally{v=Q}},a.unstable_scheduleCallback=function(Z,ke,Q){var z=a.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?z+Q:z):Q=z,Z){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=Q+K,Z={id:p++,callback:ke,priorityLevel:Z,startTime:Q,expirationTime:K,sortIndex:-1},Q>z?(Z.sortIndex=Q,e(f,Z),t(d)===null&&Z===t(f)&&(E?(N(W),W=-1):E=!0,fe(F,Q-z))):(Z.sortIndex=K,e(d,Z),S||x||(S=!0,pe(B))),Z},a.unstable_shouldYield=ne,a.unstable_wrapCallback=function(Z){var ke=v;return function(){var Q=v;v=ke;try{return Z.apply(this,arguments)}finally{v=Q}}}})(U_)),U_}var _k;function n2(){return _k||(_k=1,$_.exports=t2()),$_.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sk;function r2(){if(Sk)return ms;Sk=1;var a=ax(),e=n2();function t(i){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,r={};function s(i,l){o(i,l),o(i+"Capture",l)}function o(i,l){for(r[i]=l,i=0;i<l.length;i++)n.add(l[i])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},y={};function v(i){return d.call(y,i)?!0:d.call(p,i)?!1:f.test(i)?y[i]=!0:(p[i]=!0,!1)}function x(i,l,h,m){if(h!==null&&h.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return m?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function S(i,l,h,m){if(l===null||typeof l>"u"||x(i,l,h,m))return!0;if(m)return!1;if(h!==null)switch(h.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function E(i,l,h,m,_,C,D){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=m,this.attributeNamespace=_,this.mustUseProperty=h,this.propertyName=i,this.type=l,this.sanitizeURL=C,this.removeEmptyString=D}var T={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){T[i]=new E(i,0,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var l=i[0];T[l]=new E(l,1,!1,i[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){T[i]=new E(i,2,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){T[i]=new E(i,2,!1,i,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){T[i]=new E(i,3,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){T[i]=new E(i,3,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){T[i]=new E(i,4,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){T[i]=new E(i,6,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){T[i]=new E(i,5,!1,i.toLowerCase(),null,!1,!1)});var N=/[\-:]([a-z])/g;function L(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var l=i.replace(N,L);T[l]=new E(l,1,!1,i,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var l=i.replace(N,L);T[l]=new E(l,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var l=i.replace(N,L);T[l]=new E(l,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){T[i]=new E(i,1,!1,i.toLowerCase(),null,!1,!1)}),T.xlinkHref=new E("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){T[i]=new E(i,1,!1,i.toLowerCase(),null,!0,!0)});function j(i,l,h,m){var _=T.hasOwnProperty(l)?T[l]:null;(_!==null?_.type!==0:m||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(S(l,h,_,m)&&(h=null),m||_===null?v(l)&&(h===null?i.removeAttribute(l):i.setAttribute(l,""+h)):_.mustUseProperty?i[_.propertyName]=h===null?_.type===3?!1:"":h:(l=_.attributeName,m=_.attributeNamespace,h===null?i.removeAttribute(l):(_=_.type,h=_===3||_===4&&h===!0?"":""+h,m?i.setAttributeNS(m,l,h):i.setAttribute(l,h))))}var F=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,B=Symbol.for("react.element"),$=Symbol.for("react.portal"),H=Symbol.for("react.fragment"),W=Symbol.for("react.strict_mode"),ae=Symbol.for("react.profiler"),me=Symbol.for("react.provider"),ne=Symbol.for("react.context"),re=Symbol.for("react.forward_ref"),xe=Symbol.for("react.suspense"),ve=Symbol.for("react.suspense_list"),_e=Symbol.for("react.memo"),pe=Symbol.for("react.lazy"),fe=Symbol.for("react.offscreen"),Z=Symbol.iterator;function ke(i){return i===null||typeof i!="object"?null:(i=Z&&i[Z]||i["@@iterator"],typeof i=="function"?i:null)}var Q=Object.assign,z;function K(i){if(z===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);z=l&&l[1]||""}return`
`+z+i}var Se=!1;function Pe(i,l){if(!i||Se)return"";Se=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(we){var m=we}Reflect.construct(i,[],l)}else{try{l.call()}catch(we){m=we}i.call(l.prototype)}else{try{throw Error()}catch(we){m=we}i()}}catch(we){if(we&&m&&typeof we.stack=="string"){for(var _=we.stack.split(`
`),C=m.stack.split(`
`),D=_.length-1,q=C.length-1;1<=D&&0<=q&&_[D]!==C[q];)q--;for(;1<=D&&0<=q;D--,q--)if(_[D]!==C[q]){if(D!==1||q!==1)do if(D--,q--,0>q||_[D]!==C[q]){var Y=`
`+_[D].replace(" at new "," at ");return i.displayName&&Y.includes("<anonymous>")&&(Y=Y.replace("<anonymous>",i.displayName)),Y}while(1<=D&&0<=q);break}}}finally{Se=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?K(i):""}function Ve(i){switch(i.tag){case 5:return K(i.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 2:case 15:return i=Pe(i.type,!1),i;case 11:return i=Pe(i.type.render,!1),i;case 1:return i=Pe(i.type,!0),i;default:return""}}function We(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case H:return"Fragment";case $:return"Portal";case ae:return"Profiler";case W:return"StrictMode";case xe:return"Suspense";case ve:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case ne:return(i.displayName||"Context")+".Consumer";case me:return(i._context.displayName||"Context")+".Provider";case re:var l=i.render;return i=i.displayName,i||(i=l.displayName||l.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case _e:return l=i.displayName||null,l!==null?l:We(i.type)||"Memo";case pe:l=i._payload,i=i._init;try{return We(i(l))}catch{}}return null}function be(i){var l=i.type;switch(i.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=l.render,i=i.displayName||i.name||"",l.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return We(l);case 8:return l===W?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function Te(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Ee(i){var l=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function at(i){var l=Ee(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,l),m=""+i[l];if(!i.hasOwnProperty(l)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var _=h.get,C=h.set;return Object.defineProperty(i,l,{configurable:!0,get:function(){return _.call(this)},set:function(D){m=""+D,C.call(this,D)}}),Object.defineProperty(i,l,{enumerable:h.enumerable}),{getValue:function(){return m},setValue:function(D){m=""+D},stopTracking:function(){i._valueTracker=null,delete i[l]}}}}function bt(i){i._valueTracker||(i._valueTracker=at(i))}function tt(i){if(!i)return!1;var l=i._valueTracker;if(!l)return!0;var h=l.getValue(),m="";return i&&(m=Ee(i)?i.checked?"true":"false":i.value),i=m,i!==h?(l.setValue(i),!0):!1}function Ht(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Le(i,l){var h=l.checked;return Q({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??i._wrapperState.initialChecked})}function Ke(i,l){var h=l.defaultValue==null?"":l.defaultValue,m=l.checked!=null?l.checked:l.defaultChecked;h=Te(l.value!=null?l.value:h),i._wrapperState={initialChecked:m,initialValue:h,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function Mt(i,l){l=l.checked,l!=null&&j(i,"checked",l,!1)}function Nt(i,l){Mt(i,l);var h=Te(l.value),m=l.type;if(h!=null)m==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(m==="submit"||m==="reset"){i.removeAttribute("value");return}l.hasOwnProperty("value")?ra(i,l.type,h):l.hasOwnProperty("defaultValue")&&ra(i,l.type,Te(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(i.defaultChecked=!!l.defaultChecked)}function Tl(i,l,h){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var m=l.type;if(!(m!=="submit"&&m!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+i._wrapperState.initialValue,h||l===i.value||(i.value=l),i.defaultValue=l}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function ra(i,l,h){(l!=="number"||Ht(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var sa=Array.isArray;function br(i,l,h,m){if(i=i.options,l){l={};for(var _=0;_<h.length;_++)l["$"+h[_]]=!0;for(h=0;h<i.length;h++)_=l.hasOwnProperty("$"+i[h].value),i[h].selected!==_&&(i[h].selected=_),_&&m&&(i[h].defaultSelected=!0)}else{for(h=""+Te(h),l=null,_=0;_<i.length;_++){if(i[_].value===h){i[_].selected=!0,m&&(i[_].defaultSelected=!0);return}l!==null||i[_].disabled||(l=i[_])}l!==null&&(l.selected=!0)}}function Sh(i,l){if(l.dangerouslySetInnerHTML!=null)throw Error(t(91));return Q({},l,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Nl(i,l){var h=l.value;if(h==null){if(h=l.children,l=l.defaultValue,h!=null){if(l!=null)throw Error(t(92));if(sa(h)){if(1<h.length)throw Error(t(93));h=h[0]}l=h}l==null&&(l=""),h=l}i._wrapperState={initialValue:Te(h)}}function gg(i,l){var h=Te(l.value),m=Te(l.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),l.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),m!=null&&(i.defaultValue=""+m)}function Pl(i){var l=i.textContent;l===i._wrapperState.initialValue&&l!==""&&l!==null&&(i.value=l)}function lo(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ni(i,l){return i==null||i==="http://www.w3.org/1999/xhtml"?lo(l):i==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Rl,Il=(function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,h,m,_){MSApp.execUnsafeLocalFunction(function(){return i(l,h,m,_)})}:i})(function(i,l){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=l;else{for(Rl=Rl||document.createElement("div"),Rl.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=Rl.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;l.firstChild;)i.appendChild(l.firstChild)}});function ia(i,l){if(l){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=l;return}}i.textContent=l}var co={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},oa=["Webkit","ms","Moz","O"];Object.keys(co).forEach(function(i){oa.forEach(function(l){l=l+i.charAt(0).toUpperCase()+i.substring(1),co[l]=co[i]})});function hu(i,l,h){return l==null||typeof l=="boolean"||l===""?"":h||typeof l!="number"||l===0||co.hasOwnProperty(i)&&co[i]?(""+l).trim():l+"px"}function Eh(i,l){i=i.style;for(var h in l)if(l.hasOwnProperty(h)){var m=h.indexOf("--")===0,_=hu(h,l[h],m);h==="float"&&(h="cssFloat"),m?i.setProperty(h,_):i[h]=_}}var uo=Q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function it(i,l){if(l){if(uo[i]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(t(137,i));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(t(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(t(61))}if(l.style!=null&&typeof l.style!="object")throw Error(t(62))}}function aa(i,l){if(i.indexOf("-")===-1)return typeof l.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pi=null;function Ol(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var He=null,ho=null,la=null;function Ah(i){if(i=Ug(i)){if(typeof He!="function")throw Error(t(280));var l=i.stateNode;l&&(l=_v(l),He(i.stateNode,i.type,l))}}function mg(i){ho?la?la.push(i):la=[i]:ho=i}function kh(){if(ho){var i=ho,l=la;if(la=ho=null,Ah(i),l)for(i=0;i<l.length;i++)Ah(l[i])}}function X0(i,l){return i(l)}function Y0(){}var fo=!1;function ca(i,l,h){if(fo)return i(l,h);fo=!0;try{return X0(i,l,h)}finally{fo=!1,(ho!==null||la!==null)&&(Y0(),kh())}}function ua(i,l){var h=i.stateNode;if(h===null)return null;var m=_v(h);if(m===null)return null;h=m[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(i=i.type,m=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!m;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(t(231,l,typeof h));return h}var jl=!1;if(u)try{var Gt={};Object.defineProperty(Gt,"passive",{get:function(){jl=!0}}),window.addEventListener("test",Gt,Gt),window.removeEventListener("test",Gt,Gt)}catch{jl=!1}function Un(i,l,h,m,_,C,D,q,Y){var we=Array.prototype.slice.call(arguments,3);try{l.apply(h,we)}catch(Ie){this.onError(Ie)}}var fu=!1,da=null,ha=!1,Ml=null,bx={onError:function(i){fu=!0,da=i}};function po(i,l,h,m,_,C,D,q,Y){fu=!1,da=null,Un.apply(bx,arguments)}function Dl(i,l,h,m,_,C,D,q,Y){if(po.apply(this,arguments),fu){if(fu){var we=da;fu=!1,da=null}else throw Error(t(198));ha||(ha=!0,Ml=we)}}function Dr(i){var l=i,h=i;if(i.alternate)for(;l.return;)l=l.return;else{i=l;do l=i,(l.flags&4098)!==0&&(h=l.return),i=l.return;while(i)}return l.tag===3?h:null}function pu(i){if(i.tag===13){var l=i.memoizedState;if(l===null&&(i=i.alternate,i!==null&&(l=i.memoizedState)),l!==null)return l.dehydrated}return null}function J0(i){if(Dr(i)!==i)throw Error(t(188))}function go(i){var l=i.alternate;if(!l){if(l=Dr(i),l===null)throw Error(t(188));return l!==i?null:i}for(var h=i,m=l;;){var _=h.return;if(_===null)break;var C=_.alternate;if(C===null){if(m=_.return,m!==null){h=m;continue}break}if(_.child===C.child){for(C=_.child;C;){if(C===h)return J0(_),i;if(C===m)return J0(_),l;C=C.sibling}throw Error(t(188))}if(h.return!==m.return)h=_,m=C;else{for(var D=!1,q=_.child;q;){if(q===h){D=!0,h=_,m=C;break}if(q===m){D=!0,m=_,h=C;break}q=q.sibling}if(!D){for(q=C.child;q;){if(q===h){D=!0,h=C,m=_;break}if(q===m){D=!0,m=C,h=_;break}q=q.sibling}if(!D)throw Error(t(189))}}if(h.alternate!==m)throw Error(t(190))}if(h.tag!==3)throw Error(t(188));return h.stateNode.current===h?i:l}function yg(i){return i=go(i),i!==null?mo(i):null}function mo(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var l=mo(i);if(l!==null)return l;i=i.sibling}return null}var vg=e.unstable_scheduleCallback,Ch=e.unstable_cancelCallback,En=e.unstable_shouldYield,fa=e.unstable_requestPaint,qt=e.unstable_now,Q0=e.unstable_getCurrentPriorityLevel,yo=e.unstable_ImmediatePriority,gu=e.unstable_UserBlockingPriority,Ll=e.unstable_NormalPriority,bg=e.unstable_LowPriority,vo=e.unstable_IdlePriority,mu=null,Jr=null;function Z0(i){if(Jr&&typeof Jr.onCommitFiberRoot=="function")try{Jr.onCommitFiberRoot(mu,i,void 0,(i.current.flags&128)===128)}catch{}}var gt=Math.clz32?Math.clz32:Th,ev=Math.log,tv=Math.LN2;function Th(i){return i>>>=0,i===0?32:31-(ev(i)/tv|0)|0}var bo=64,yu=4194304;function Fl(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function vu(i,l){var h=i.pendingLanes;if(h===0)return 0;var m=0,_=i.suspendedLanes,C=i.pingedLanes,D=h&268435455;if(D!==0){var q=D&~_;q!==0?m=Fl(q):(C&=D,C!==0&&(m=Fl(C)))}else D=h&~_,D!==0?m=Fl(D):C!==0&&(m=Fl(C));if(m===0)return 0;if(l!==0&&l!==m&&(l&_)===0&&(_=m&-m,C=l&-l,_>=C||_===16&&(C&4194240)!==0))return l;if((m&4)!==0&&(m|=h&16),l=i.entangledLanes,l!==0)for(i=i.entanglements,l&=m;0<l;)h=31-gt(l),_=1<<h,m|=i[h],l&=~_;return m}function Jt(i,l){switch(i){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bu(i,l){for(var h=i.suspendedLanes,m=i.pingedLanes,_=i.expirationTimes,C=i.pendingLanes;0<C;){var D=31-gt(C),q=1<<D,Y=_[D];Y===-1?((q&h)===0||(q&m)!==0)&&(_[D]=Jt(q,l)):Y<=l&&(i.expiredLanes|=q),C&=~q}}function pa(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function ga(){var i=bo;return bo<<=1,(bo&4194240)===0&&(bo=64),i}function wu(i){for(var l=[],h=0;31>h;h++)l.push(i);return l}function ma(i,l,h){i.pendingLanes|=l,l!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,l=31-gt(l),i[l]=h}function Nh(i,l){var h=i.pendingLanes&~l;i.pendingLanes=l,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=l,i.mutableReadLanes&=l,i.entangledLanes&=l,l=i.entanglements;var m=i.eventTimes;for(i=i.expirationTimes;0<h;){var _=31-gt(h),C=1<<_;l[_]=0,m[_]=-1,i[_]=-1,h&=~C}}function Ph(i,l){var h=i.entangledLanes|=l;for(i=i.entanglements;h;){var m=31-gt(h),_=1<<m;_&l|i[m]&l&&(i[m]|=l),h&=~_}}var Ft=0;function wg(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var nv,Ot,xg,rv,sv,wr=!1,Ri=[],Ns=null,xr=null,Ii=null,Bl=new Map,vn=new Map,Xn=[],xu="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $l(i,l){switch(i){case"focusin":case"focusout":Ns=null;break;case"dragenter":case"dragleave":xr=null;break;case"mouseover":case"mouseout":Ii=null;break;case"pointerover":case"pointerout":Bl.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":vn.delete(l.pointerId)}}function ya(i,l,h,m,_,C){return i===null||i.nativeEvent!==C?(i={blockedOn:l,domEventName:h,eventSystemFlags:m,nativeEvent:C,targetContainers:[_]},l!==null&&(l=Ug(l),l!==null&&Ot(l)),i):(i.eventSystemFlags|=m,l=i.targetContainers,_!==null&&l.indexOf(_)===-1&&l.push(_),i)}function wo(i,l,h,m,_){switch(l){case"focusin":return Ns=ya(Ns,i,l,h,m,_),!0;case"dragenter":return xr=ya(xr,i,l,h,m,_),!0;case"mouseover":return Ii=ya(Ii,i,l,h,m,_),!0;case"pointerover":var C=_.pointerId;return Bl.set(C,ya(Bl.get(C)||null,i,l,h,m,_)),!0;case"gotpointercapture":return C=_.pointerId,vn.set(C,ya(vn.get(C)||null,i,l,h,m,_)),!0}return!1}function iv(i){var l=Tu(i.target);if(l!==null){var h=Dr(l);if(h!==null){if(l=h.tag,l===13){if(l=pu(h),l!==null){i.blockedOn=l,sv(i.priority,function(){xg(h)});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Qr(i){if(i.blockedOn!==null)return!1;for(var l=i.targetContainers;0<l.length;){var h=Ul(i.domEventName,i.eventSystemFlags,l[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var m=new h.constructor(h.type,h);Pi=m,h.target.dispatchEvent(m),Pi=null}else return l=Ug(h),l!==null&&Ot(l),i.blockedOn=h,!1;l.shift()}return!0}function Rh(i,l,h){Qr(i)&&h.delete(l)}function ov(){wr=!1,Ns!==null&&Qr(Ns)&&(Ns=null),xr!==null&&Qr(xr)&&(xr=null),Ii!==null&&Qr(Ii)&&(Ii=null),Bl.forEach(Rh),vn.forEach(Rh)}function va(i,l){i.blockedOn===l&&(i.blockedOn=null,wr||(wr=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,ov)))}function Oi(i){function l(_){return va(_,i)}if(0<Ri.length){va(Ri[0],i);for(var h=1;h<Ri.length;h++){var m=Ri[h];m.blockedOn===i&&(m.blockedOn=null)}}for(Ns!==null&&va(Ns,i),xr!==null&&va(xr,i),Ii!==null&&va(Ii,i),Bl.forEach(l),vn.forEach(l),h=0;h<Xn.length;h++)m=Xn[h],m.blockedOn===i&&(m.blockedOn=null);for(;0<Xn.length&&(h=Xn[0],h.blockedOn===null);)iv(h),h.blockedOn===null&&Xn.shift()}var xo=F.ReactCurrentBatchConfig,_u=!0;function wx(i,l,h,m){var _=Ft,C=xo.transition;xo.transition=null;try{Ft=1,_g(i,l,h,m)}finally{Ft=_,xo.transition=C}}function Su(i,l,h,m){var _=Ft,C=xo.transition;xo.transition=null;try{Ft=4,_g(i,l,h,m)}finally{Ft=_,xo.transition=C}}function _g(i,l,h,m){if(_u){var _=Ul(i,l,h,m);if(_===null)kx(i,l,m,Ih,h),$l(i,m);else if(wo(_,i,l,h,m))m.stopPropagation();else if($l(i,m),l&4&&-1<xu.indexOf(i)){for(;_!==null;){var C=Ug(_);if(C!==null&&nv(C),C=Ul(i,l,h,m),C===null&&kx(i,l,m,Ih,h),C===_)break;_=C}_!==null&&m.stopPropagation()}else kx(i,l,m,null,h)}}var Ih=null;function Ul(i,l,h,m){if(Ih=null,i=Ol(m),i=Tu(i),i!==null)if(l=Dr(i),l===null)i=null;else if(h=l.tag,h===13){if(i=pu(l),i!==null)return i;i=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;i=null}else l!==i&&(i=null);return Ih=i,null}function Eu(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Q0()){case yo:return 1;case gu:return 4;case Ll:case bg:return 16;case vo:return 536870912;default:return 16}default:return 16}}var si=null,Sg=null,Oh=null;function av(){if(Oh)return Oh;var i,l=Sg,h=l.length,m,_="value"in si?si.value:si.textContent,C=_.length;for(i=0;i<h&&l[i]===_[i];i++);var D=h-i;for(m=1;m<=D&&l[h-m]===_[C-m];m++);return Oh=_.slice(i,1<m?1-m:void 0)}function zl(i){var l=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&l===13&&(i=13)):i=l,i===10&&(i=13),32<=i||i===13?i:0}function Hl(){return!0}function Eg(){return!1}function ar(i){function l(h,m,_,C,D){this._reactName=h,this._targetInst=_,this.type=m,this.nativeEvent=C,this.target=D,this.currentTarget=null;for(var q in i)i.hasOwnProperty(q)&&(h=i[q],this[q]=h?h(C):C[q]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?Hl:Eg,this.isPropagationStopped=Eg,this}return Q(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Hl)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Hl)},persist:function(){},isPersistent:Hl}),l}var ji={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ql=ar(ji),Vl=Q({},ji,{view:0,detail:0}),xx=ar(Vl),_o,Au,ba,Wl=Q({},Vl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bh,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==ba&&(ba&&i.type==="mousemove"?(_o=i.screenX-ba.screenX,Au=i.screenY-ba.screenY):Au=_o=0,ba=i),_o)},movementY:function(i){return"movementY"in i?i.movementY:Au}}),jh=ar(Wl),lr=Q({},Wl,{dataTransfer:0}),ku=ar(lr),Cu=Q({},Vl,{relatedTarget:0}),Mh=ar(Cu),Dh=Q({},ji,{animationName:0,elapsedTime:0,pseudoElement:0}),lv=ar(Dh),cv=Q({},ji,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Lh=ar(cv),Ag=Q({},ji,{data:0}),So=ar(Ag),kg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tg(i){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(i):(i=Fh[i])?!!l[i]:!1}function Bh(){return Tg}var _x=Q({},Vl,{key:function(i){if(i.key){var l=kg[i.key]||i.key;if(l!=="Unidentified")return l}return i.type==="keypress"?(i=zl(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Cg[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bh,charCode:function(i){return i.type==="keypress"?zl(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?zl(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Ng=ar(_x),$h=Q({},Wl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uv=ar($h),Pg=Q({},Vl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bh}),Rg=ar(Pg),Sx=Q({},ji,{propertyName:0,elapsedTime:0,pseudoElement:0}),dv=ar(Sx),Ex=Q({},Wl,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),hv=ar(Ex),fv=[9,13,27,32],Ig=u&&"CompositionEvent"in window,Gl=null;u&&"documentMode"in document&&(Gl=document.documentMode);var Og=u&&"TextEvent"in window&&!Gl,jg=u&&(!Ig||Gl&&8<Gl&&11>=Gl),Mg=" ",pv=!1;function gv(i,l){switch(i){case"keyup":return fv.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mv(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Mi=!1;function Di(i,l){switch(i){case"compositionend":return mv(l);case"keypress":return l.which!==32?null:(pv=!0,Mg);case"textInput":return i=l.data,i===Mg&&pv?null:i;default:return null}}function An(i,l){if(Mi)return i==="compositionend"||!Ig&&gv(i,l)?(i=av(),Oh=Sg=si=null,Mi=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return jg&&l.locale!=="ko"?null:l.data;default:return null}}var Uh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zr(i){var l=i&&i.nodeName&&i.nodeName.toLowerCase();return l==="input"?!!Uh[i.type]:l==="textarea"}function yv(i,l,h,m){mg(m),l=bv(l,"onChange"),0<l.length&&(h=new ql("onChange","change",null,h,m),i.push({event:h,listeners:l}))}var wa=null,Kl=null;function xa(i){IA(i,0)}function Xl(i){var l=Vh(i);if(tt(l))return i}function Yl(i,l){if(i==="change")return l}var Li=!1;if(u){var zh;if(u){var g="oninput"in document;if(!g){var b=document.createElement("div");b.setAttribute("oninput","return;"),g=typeof b.oninput=="function"}zh=g}else zh=!1;Li=zh&&(!document.documentMode||9<document.documentMode)}function A(){wa&&(wa.detachEvent("onpropertychange",P),Kl=wa=null)}function P(i){if(i.propertyName==="value"&&Xl(Kl)){var l=[];yv(l,Kl,i,Ol(i)),ca(xa,l)}}function I(i,l,h){i==="focusin"?(A(),wa=l,Kl=h,wa.attachEvent("onpropertychange",P)):i==="focusout"&&A()}function M(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Xl(Kl)}function U(i,l){if(i==="click")return Xl(l)}function V(i,l){if(i==="input"||i==="change")return Xl(l)}function J(i,l){return i===l&&(i!==0||1/i===1/l)||i!==i&&l!==l}var X=typeof Object.is=="function"?Object.is:J;function oe(i,l){if(X(i,l))return!0;if(typeof i!="object"||i===null||typeof l!="object"||l===null)return!1;var h=Object.keys(i),m=Object.keys(l);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var _=h[m];if(!d.call(l,_)||!X(i[_],l[_]))return!1}return!0}function G(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function ce(i,l){var h=G(i);i=0;for(var m;h;){if(h.nodeType===3){if(m=i+h.textContent.length,i<=l&&m>=l)return{node:h,offset:l-i};i=m}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=G(h)}}function ee(i,l){return i&&l?i===l?!0:i&&i.nodeType===3?!1:l&&l.nodeType===3?ee(i,l.parentNode):"contains"in i?i.contains(l):i.compareDocumentPosition?!!(i.compareDocumentPosition(l)&16):!1:!1}function ie(){for(var i=window,l=Ht();l instanceof i.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)i=l.contentWindow;else break;l=Ht(i.document)}return l}function se(i){var l=i&&i.nodeName&&i.nodeName.toLowerCase();return l&&(l==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||l==="textarea"||i.contentEditable==="true")}function le(i){var l=ie(),h=i.focusedElem,m=i.selectionRange;if(l!==h&&h&&h.ownerDocument&&ee(h.ownerDocument.documentElement,h)){if(m!==null&&se(h)){if(l=m.start,i=m.end,i===void 0&&(i=l),"selectionStart"in h)h.selectionStart=l,h.selectionEnd=Math.min(i,h.value.length);else if(i=(l=h.ownerDocument||document)&&l.defaultView||window,i.getSelection){i=i.getSelection();var _=h.textContent.length,C=Math.min(m.start,_);m=m.end===void 0?C:Math.min(m.end,_),!i.extend&&C>m&&(_=m,m=C,C=_),_=ce(h,C);var D=ce(h,m);_&&D&&(i.rangeCount!==1||i.anchorNode!==_.node||i.anchorOffset!==_.offset||i.focusNode!==D.node||i.focusOffset!==D.offset)&&(l=l.createRange(),l.setStart(_.node,_.offset),i.removeAllRanges(),C>m?(i.addRange(l),i.extend(D.node,D.offset)):(l.setEnd(D.node,D.offset),i.addRange(l)))}}for(l=[],i=h;i=i.parentNode;)i.nodeType===1&&l.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<l.length;h++)i=l[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var de=u&&"documentMode"in document&&11>=document.documentMode,ge=null,Ae=null,Ce=null,Me=!1;function $e(i,l,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Me||ge==null||ge!==Ht(m)||(m=ge,"selectionStart"in m&&se(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Ce&&oe(Ce,m)||(Ce=m,m=bv(Ae,"onSelect"),0<m.length&&(l=new ql("onSelect","select",null,l,h),i.push({event:l,listeners:m}),l.target=ge)))}function Oe(i,l){var h={};return h[i.toLowerCase()]=l.toLowerCase(),h["Webkit"+i]="webkit"+l,h["Moz"+i]="moz"+l,h}var De={animationend:Oe("Animation","AnimationEnd"),animationiteration:Oe("Animation","AnimationIteration"),animationstart:Oe("Animation","AnimationStart"),transitionend:Oe("Transition","TransitionEnd")},Ue={},Be={};u&&(Be=document.createElement("div").style,"AnimationEvent"in window||(delete De.animationend.animation,delete De.animationiteration.animation,delete De.animationstart.animation),"TransitionEvent"in window||delete De.transitionend.transition);function Ge(i){if(Ue[i])return Ue[i];if(!De[i])return i;var l=De[i],h;for(h in l)if(l.hasOwnProperty(h)&&h in Be)return Ue[i]=l[h];return i}var vt=Ge("animationend"),_t=Ge("animationiteration"),kt=Ge("animationstart"),Lr=Ge("transitionend"),yt=new Map,Yn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function pn(i,l){yt.set(i,l),s(l,[i])}for(var Jl=0;Jl<Yn.length;Jl++){var Jn=Yn[Jl],_a=Jn.toLowerCase(),Dg=Jn[0].toUpperCase()+Jn.slice(1);pn(_a,"on"+Dg)}pn(vt,"onAnimationEnd"),pn(_t,"onAnimationIteration"),pn(kt,"onAnimationStart"),pn("dblclick","onDoubleClick"),pn("focusin","onFocus"),pn("focusout","onBlur"),pn(Lr,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),iI=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lg));function RA(i,l,h){var m=i.type||"unknown-event";i.currentTarget=h,Dl(m,l,void 0,i),i.currentTarget=null}function IA(i,l){l=(l&4)!==0;for(var h=0;h<i.length;h++){var m=i[h],_=m.event;m=m.listeners;e:{var C=void 0;if(l)for(var D=m.length-1;0<=D;D--){var q=m[D],Y=q.instance,we=q.currentTarget;if(q=q.listener,Y!==C&&_.isPropagationStopped())break e;RA(_,q,we),C=Y}else for(D=0;D<m.length;D++){if(q=m[D],Y=q.instance,we=q.currentTarget,q=q.listener,Y!==C&&_.isPropagationStopped())break e;RA(_,q,we),C=Y}}}if(ha)throw i=Ml,ha=!1,Ml=null,i}function gn(i,l){var h=l[Ix];h===void 0&&(h=l[Ix]=new Set);var m=i+"__bubble";h.has(m)||(OA(l,i,2,!1),h.add(m))}function Ax(i,l,h){var m=0;l&&(m|=4),OA(h,i,m,l)}var vv="_reactListening"+Math.random().toString(36).slice(2);function Fg(i){if(!i[vv]){i[vv]=!0,n.forEach(function(h){h!=="selectionchange"&&(iI.has(h)||Ax(h,!1,i),Ax(h,!0,i))});var l=i.nodeType===9?i:i.ownerDocument;l===null||l[vv]||(l[vv]=!0,Ax("selectionchange",!1,l))}}function OA(i,l,h,m){switch(Eu(l)){case 1:var _=wx;break;case 4:_=Su;break;default:_=_g}h=_.bind(null,l,h,i),_=void 0,!jl||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(_=!0),m?_!==void 0?i.addEventListener(l,h,{capture:!0,passive:_}):i.addEventListener(l,h,!0):_!==void 0?i.addEventListener(l,h,{passive:_}):i.addEventListener(l,h,!1)}function kx(i,l,h,m,_){var C=m;if((l&1)===0&&(l&2)===0&&m!==null)e:for(;;){if(m===null)return;var D=m.tag;if(D===3||D===4){var q=m.stateNode.containerInfo;if(q===_||q.nodeType===8&&q.parentNode===_)break;if(D===4)for(D=m.return;D!==null;){var Y=D.tag;if((Y===3||Y===4)&&(Y=D.stateNode.containerInfo,Y===_||Y.nodeType===8&&Y.parentNode===_))return;D=D.return}for(;q!==null;){if(D=Tu(q),D===null)return;if(Y=D.tag,Y===5||Y===6){m=C=D;continue e}q=q.parentNode}}m=m.return}ca(function(){var we=C,Ie=Ol(h),je=[];e:{var Ne=yt.get(i);if(Ne!==void 0){var Xe=ql,nt=i;switch(i){case"keypress":if(zl(h)===0)break e;case"keydown":case"keyup":Xe=Ng;break;case"focusin":nt="focus",Xe=Mh;break;case"focusout":nt="blur",Xe=Mh;break;case"beforeblur":case"afterblur":Xe=Mh;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Xe=jh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Xe=ku;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Xe=Rg;break;case vt:case _t:case kt:Xe=lv;break;case Lr:Xe=dv;break;case"scroll":Xe=xx;break;case"wheel":Xe=hv;break;case"copy":case"cut":case"paste":Xe=Lh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Xe=uv}var ot=(l&4)!==0,Fn=!ot&&i==="scroll",he=ot?Ne!==null?Ne+"Capture":null:Ne;ot=[];for(var te=we,ye;te!==null;){ye=te;var Fe=ye.stateNode;if(ye.tag===5&&Fe!==null&&(ye=Fe,he!==null&&(Fe=ua(te,he),Fe!=null&&ot.push(Bg(te,Fe,ye)))),Fn)break;te=te.return}0<ot.length&&(Ne=new Xe(Ne,nt,null,h,Ie),je.push({event:Ne,listeners:ot}))}}if((l&7)===0){e:{if(Ne=i==="mouseover"||i==="pointerover",Xe=i==="mouseout"||i==="pointerout",Ne&&h!==Pi&&(nt=h.relatedTarget||h.fromElement)&&(Tu(nt)||nt[Sa]))break e;if((Xe||Ne)&&(Ne=Ie.window===Ie?Ie:(Ne=Ie.ownerDocument)?Ne.defaultView||Ne.parentWindow:window,Xe?(nt=h.relatedTarget||h.toElement,Xe=we,nt=nt?Tu(nt):null,nt!==null&&(Fn=Dr(nt),nt!==Fn||nt.tag!==5&&nt.tag!==6)&&(nt=null)):(Xe=null,nt=we),Xe!==nt)){if(ot=jh,Fe="onMouseLeave",he="onMouseEnter",te="mouse",(i==="pointerout"||i==="pointerover")&&(ot=uv,Fe="onPointerLeave",he="onPointerEnter",te="pointer"),Fn=Xe==null?Ne:Vh(Xe),ye=nt==null?Ne:Vh(nt),Ne=new ot(Fe,te+"leave",Xe,h,Ie),Ne.target=Fn,Ne.relatedTarget=ye,Fe=null,Tu(Ie)===we&&(ot=new ot(he,te+"enter",nt,h,Ie),ot.target=ye,ot.relatedTarget=Fn,Fe=ot),Fn=Fe,Xe&&nt)t:{for(ot=Xe,he=nt,te=0,ye=ot;ye;ye=Hh(ye))te++;for(ye=0,Fe=he;Fe;Fe=Hh(Fe))ye++;for(;0<te-ye;)ot=Hh(ot),te--;for(;0<ye-te;)he=Hh(he),ye--;for(;te--;){if(ot===he||he!==null&&ot===he.alternate)break t;ot=Hh(ot),he=Hh(he)}ot=null}else ot=null;Xe!==null&&jA(je,Ne,Xe,ot,!1),nt!==null&&Fn!==null&&jA(je,Fn,nt,ot,!0)}}e:{if(Ne=we?Vh(we):window,Xe=Ne.nodeName&&Ne.nodeName.toLowerCase(),Xe==="select"||Xe==="input"&&Ne.type==="file")var ct=Yl;else if(Zr(Ne))if(Li)ct=V;else{ct=M;var dt=I}else(Xe=Ne.nodeName)&&Xe.toLowerCase()==="input"&&(Ne.type==="checkbox"||Ne.type==="radio")&&(ct=U);if(ct&&(ct=ct(i,we))){yv(je,ct,h,Ie);break e}dt&&dt(i,Ne,we),i==="focusout"&&(dt=Ne._wrapperState)&&dt.controlled&&Ne.type==="number"&&ra(Ne,"number",Ne.value)}switch(dt=we?Vh(we):window,i){case"focusin":(Zr(dt)||dt.contentEditable==="true")&&(ge=dt,Ae=we,Ce=null);break;case"focusout":Ce=Ae=ge=null;break;case"mousedown":Me=!0;break;case"contextmenu":case"mouseup":case"dragend":Me=!1,$e(je,h,Ie);break;case"selectionchange":if(de)break;case"keydown":case"keyup":$e(je,h,Ie)}var ht;if(Ig)e:{switch(i){case"compositionstart":var mt="onCompositionStart";break e;case"compositionend":mt="onCompositionEnd";break e;case"compositionupdate":mt="onCompositionUpdate";break e}mt=void 0}else Mi?gv(i,h)&&(mt="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(mt="onCompositionStart");mt&&(jg&&h.locale!=="ko"&&(Mi||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&Mi&&(ht=av()):(si=Ie,Sg="value"in si?si.value:si.textContent,Mi=!0)),dt=bv(we,mt),0<dt.length&&(mt=new So(mt,i,null,h,Ie),je.push({event:mt,listeners:dt}),ht?mt.data=ht:(ht=mv(h),ht!==null&&(mt.data=ht)))),(ht=Og?Di(i,h):An(i,h))&&(we=bv(we,"onBeforeInput"),0<we.length&&(Ie=new So("onBeforeInput","beforeinput",null,h,Ie),je.push({event:Ie,listeners:we}),Ie.data=ht))}IA(je,l)})}function Bg(i,l,h){return{instance:i,listener:l,currentTarget:h}}function bv(i,l){for(var h=l+"Capture",m=[];i!==null;){var _=i,C=_.stateNode;_.tag===5&&C!==null&&(_=C,C=ua(i,h),C!=null&&m.unshift(Bg(i,C,_)),C=ua(i,l),C!=null&&m.push(Bg(i,C,_))),i=i.return}return m}function Hh(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function jA(i,l,h,m,_){for(var C=l._reactName,D=[];h!==null&&h!==m;){var q=h,Y=q.alternate,we=q.stateNode;if(Y!==null&&Y===m)break;q.tag===5&&we!==null&&(q=we,_?(Y=ua(h,C),Y!=null&&D.unshift(Bg(h,Y,q))):_||(Y=ua(h,C),Y!=null&&D.push(Bg(h,Y,q)))),h=h.return}D.length!==0&&i.push({event:l,listeners:D})}var oI=/\r\n?/g,aI=/\u0000|\uFFFD/g;function MA(i){return(typeof i=="string"?i:""+i).replace(oI,`
`).replace(aI,"")}function wv(i,l,h){if(l=MA(l),MA(i)!==l&&h)throw Error(t(425))}function xv(){}var Cx=null,Tx=null;function Nx(i,l){return i==="textarea"||i==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Px=typeof setTimeout=="function"?setTimeout:void 0,lI=typeof clearTimeout=="function"?clearTimeout:void 0,DA=typeof Promise=="function"?Promise:void 0,cI=typeof queueMicrotask=="function"?queueMicrotask:typeof DA<"u"?function(i){return DA.resolve(null).then(i).catch(uI)}:Px;function uI(i){setTimeout(function(){throw i})}function Rx(i,l){var h=l,m=0;do{var _=h.nextSibling;if(i.removeChild(h),_&&_.nodeType===8)if(h=_.data,h==="/$"){if(m===0){i.removeChild(_),Oi(l);return}m--}else h!=="$"&&h!=="$?"&&h!=="$!"||m++;h=_}while(h);Oi(l)}function Ql(i){for(;i!=null;i=i.nextSibling){var l=i.nodeType;if(l===1||l===3)break;if(l===8){if(l=i.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return i}function LA(i){i=i.previousSibling;for(var l=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(l===0)return i;l--}else h==="/$"&&l++}i=i.previousSibling}return null}var qh=Math.random().toString(36).slice(2),Eo="__reactFiber$"+qh,$g="__reactProps$"+qh,Sa="__reactContainer$"+qh,Ix="__reactEvents$"+qh,dI="__reactListeners$"+qh,hI="__reactHandles$"+qh;function Tu(i){var l=i[Eo];if(l)return l;for(var h=i.parentNode;h;){if(l=h[Sa]||h[Eo]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(i=LA(i);i!==null;){if(h=i[Eo])return h;i=LA(i)}return l}i=h,h=i.parentNode}return null}function Ug(i){return i=i[Eo]||i[Sa],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Vh(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(t(33))}function _v(i){return i[$g]||null}var Ox=[],Wh=-1;function Zl(i){return{current:i}}function mn(i){0>Wh||(i.current=Ox[Wh],Ox[Wh]=null,Wh--)}function cn(i,l){Wh++,Ox[Wh]=i.current,i.current=l}var ec={},Fr=Zl(ec),ds=Zl(!1),Nu=ec;function Gh(i,l){var h=i.type.contextTypes;if(!h)return ec;var m=i.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===l)return m.__reactInternalMemoizedMaskedChildContext;var _={},C;for(C in h)_[C]=l[C];return m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=l,i.__reactInternalMemoizedMaskedChildContext=_),_}function hs(i){return i=i.childContextTypes,i!=null}function Sv(){mn(ds),mn(Fr)}function FA(i,l,h){if(Fr.current!==ec)throw Error(t(168));cn(Fr,l),cn(ds,h)}function BA(i,l,h){var m=i.stateNode;if(l=l.childContextTypes,typeof m.getChildContext!="function")return h;m=m.getChildContext();for(var _ in m)if(!(_ in l))throw Error(t(108,be(i)||"Unknown",_));return Q({},h,m)}function Ev(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||ec,Nu=Fr.current,cn(Fr,i),cn(ds,ds.current),!0}function $A(i,l,h){var m=i.stateNode;if(!m)throw Error(t(169));h?(i=BA(i,l,Nu),m.__reactInternalMemoizedMergedChildContext=i,mn(ds),mn(Fr),cn(Fr,i)):mn(ds),cn(ds,h)}var Ea=null,Av=!1,jx=!1;function UA(i){Ea===null?Ea=[i]:Ea.push(i)}function fI(i){Av=!0,UA(i)}function tc(){if(!jx&&Ea!==null){jx=!0;var i=0,l=Ft;try{var h=Ea;for(Ft=1;i<h.length;i++){var m=h[i];do m=m(!0);while(m!==null)}Ea=null,Av=!1}catch(_){throw Ea!==null&&(Ea=Ea.slice(i+1)),vg(yo,tc),_}finally{Ft=l,jx=!1}}return null}var Kh=[],Xh=0,kv=null,Cv=0,ii=[],oi=0,Pu=null,Aa=1,ka="";function Ru(i,l){Kh[Xh++]=Cv,Kh[Xh++]=kv,kv=i,Cv=l}function zA(i,l,h){ii[oi++]=Aa,ii[oi++]=ka,ii[oi++]=Pu,Pu=i;var m=Aa;i=ka;var _=32-gt(m)-1;m&=~(1<<_),h+=1;var C=32-gt(l)+_;if(30<C){var D=_-_%5;C=(m&(1<<D)-1).toString(32),m>>=D,_-=D,Aa=1<<32-gt(l)+_|h<<_|m,ka=C+i}else Aa=1<<C|h<<_|m,ka=i}function Mx(i){i.return!==null&&(Ru(i,1),zA(i,1,0))}function Dx(i){for(;i===kv;)kv=Kh[--Xh],Kh[Xh]=null,Cv=Kh[--Xh],Kh[Xh]=null;for(;i===Pu;)Pu=ii[--oi],ii[oi]=null,ka=ii[--oi],ii[oi]=null,Aa=ii[--oi],ii[oi]=null}var Ps=null,Rs=null,bn=!1,Fi=null;function HA(i,l){var h=ui(5,null,null,0);h.elementType="DELETED",h.stateNode=l,h.return=i,l=i.deletions,l===null?(i.deletions=[h],i.flags|=16):l.push(h)}function qA(i,l){switch(i.tag){case 5:var h=i.type;return l=l.nodeType!==1||h.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(i.stateNode=l,Ps=i,Rs=Ql(l.firstChild),!0):!1;case 6:return l=i.pendingProps===""||l.nodeType!==3?null:l,l!==null?(i.stateNode=l,Ps=i,Rs=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(h=Pu!==null?{id:Aa,overflow:ka}:null,i.memoizedState={dehydrated:l,treeContext:h,retryLane:1073741824},h=ui(18,null,null,0),h.stateNode=l,h.return=i,i.child=h,Ps=i,Rs=null,!0):!1;default:return!1}}function Lx(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Fx(i){if(bn){var l=Rs;if(l){var h=l;if(!qA(i,l)){if(Lx(i))throw Error(t(418));l=Ql(h.nextSibling);var m=Ps;l&&qA(i,l)?HA(m,h):(i.flags=i.flags&-4097|2,bn=!1,Ps=i)}}else{if(Lx(i))throw Error(t(418));i.flags=i.flags&-4097|2,bn=!1,Ps=i}}}function VA(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Ps=i}function Tv(i){if(i!==Ps)return!1;if(!bn)return VA(i),bn=!0,!1;var l;if((l=i.tag!==3)&&!(l=i.tag!==5)&&(l=i.type,l=l!=="head"&&l!=="body"&&!Nx(i.type,i.memoizedProps)),l&&(l=Rs)){if(Lx(i))throw WA(),Error(t(418));for(;l;)HA(i,l),l=Ql(l.nextSibling)}if(VA(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(t(317));e:{for(i=i.nextSibling,l=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(l===0){Rs=Ql(i.nextSibling);break e}l--}else h!=="$"&&h!=="$!"&&h!=="$?"||l++}i=i.nextSibling}Rs=null}}else Rs=Ps?Ql(i.stateNode.nextSibling):null;return!0}function WA(){for(var i=Rs;i;)i=Ql(i.nextSibling)}function Yh(){Rs=Ps=null,bn=!1}function Bx(i){Fi===null?Fi=[i]:Fi.push(i)}var pI=F.ReactCurrentBatchConfig;function zg(i,l,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(t(309));var m=h.stateNode}if(!m)throw Error(t(147,i));var _=m,C=""+i;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===C?l.ref:(l=function(D){var q=_.refs;D===null?delete q[C]:q[C]=D},l._stringRef=C,l)}if(typeof i!="string")throw Error(t(284));if(!h._owner)throw Error(t(290,i))}return i}function Nv(i,l){throw i=Object.prototype.toString.call(l),Error(t(31,i==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":i))}function GA(i){var l=i._init;return l(i._payload)}function KA(i){function l(he,te){if(i){var ye=he.deletions;ye===null?(he.deletions=[te],he.flags|=16):ye.push(te)}}function h(he,te){if(!i)return null;for(;te!==null;)l(he,te),te=te.sibling;return null}function m(he,te){for(he=new Map;te!==null;)te.key!==null?he.set(te.key,te):he.set(te.index,te),te=te.sibling;return he}function _(he,te){return he=cc(he,te),he.index=0,he.sibling=null,he}function C(he,te,ye){return he.index=ye,i?(ye=he.alternate,ye!==null?(ye=ye.index,ye<te?(he.flags|=2,te):ye):(he.flags|=2,te)):(he.flags|=1048576,te)}function D(he){return i&&he.alternate===null&&(he.flags|=2),he}function q(he,te,ye,Fe){return te===null||te.tag!==6?(te=P_(ye,he.mode,Fe),te.return=he,te):(te=_(te,ye),te.return=he,te)}function Y(he,te,ye,Fe){var ct=ye.type;return ct===H?Ie(he,te,ye.props.children,Fe,ye.key):te!==null&&(te.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===pe&&GA(ct)===te.type)?(Fe=_(te,ye.props),Fe.ref=zg(he,te,ye),Fe.return=he,Fe):(Fe=Zv(ye.type,ye.key,ye.props,null,he.mode,Fe),Fe.ref=zg(he,te,ye),Fe.return=he,Fe)}function we(he,te,ye,Fe){return te===null||te.tag!==4||te.stateNode.containerInfo!==ye.containerInfo||te.stateNode.implementation!==ye.implementation?(te=R_(ye,he.mode,Fe),te.return=he,te):(te=_(te,ye.children||[]),te.return=he,te)}function Ie(he,te,ye,Fe,ct){return te===null||te.tag!==7?(te=Bu(ye,he.mode,Fe,ct),te.return=he,te):(te=_(te,ye),te.return=he,te)}function je(he,te,ye){if(typeof te=="string"&&te!==""||typeof te=="number")return te=P_(""+te,he.mode,ye),te.return=he,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case B:return ye=Zv(te.type,te.key,te.props,null,he.mode,ye),ye.ref=zg(he,null,te),ye.return=he,ye;case $:return te=R_(te,he.mode,ye),te.return=he,te;case pe:var Fe=te._init;return je(he,Fe(te._payload),ye)}if(sa(te)||ke(te))return te=Bu(te,he.mode,ye,null),te.return=he,te;Nv(he,te)}return null}function Ne(he,te,ye,Fe){var ct=te!==null?te.key:null;if(typeof ye=="string"&&ye!==""||typeof ye=="number")return ct!==null?null:q(he,te,""+ye,Fe);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case B:return ye.key===ct?Y(he,te,ye,Fe):null;case $:return ye.key===ct?we(he,te,ye,Fe):null;case pe:return ct=ye._init,Ne(he,te,ct(ye._payload),Fe)}if(sa(ye)||ke(ye))return ct!==null?null:Ie(he,te,ye,Fe,null);Nv(he,ye)}return null}function Xe(he,te,ye,Fe,ct){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return he=he.get(ye)||null,q(te,he,""+Fe,ct);if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case B:return he=he.get(Fe.key===null?ye:Fe.key)||null,Y(te,he,Fe,ct);case $:return he=he.get(Fe.key===null?ye:Fe.key)||null,we(te,he,Fe,ct);case pe:var dt=Fe._init;return Xe(he,te,ye,dt(Fe._payload),ct)}if(sa(Fe)||ke(Fe))return he=he.get(ye)||null,Ie(te,he,Fe,ct,null);Nv(te,Fe)}return null}function nt(he,te,ye,Fe){for(var ct=null,dt=null,ht=te,mt=te=0,dr=null;ht!==null&&mt<ye.length;mt++){ht.index>mt?(dr=ht,ht=null):dr=ht.sibling;var zt=Ne(he,ht,ye[mt],Fe);if(zt===null){ht===null&&(ht=dr);break}i&&ht&&zt.alternate===null&&l(he,ht),te=C(zt,te,mt),dt===null?ct=zt:dt.sibling=zt,dt=zt,ht=dr}if(mt===ye.length)return h(he,ht),bn&&Ru(he,mt),ct;if(ht===null){for(;mt<ye.length;mt++)ht=je(he,ye[mt],Fe),ht!==null&&(te=C(ht,te,mt),dt===null?ct=ht:dt.sibling=ht,dt=ht);return bn&&Ru(he,mt),ct}for(ht=m(he,ht);mt<ye.length;mt++)dr=Xe(ht,he,mt,ye[mt],Fe),dr!==null&&(i&&dr.alternate!==null&&ht.delete(dr.key===null?mt:dr.key),te=C(dr,te,mt),dt===null?ct=dr:dt.sibling=dr,dt=dr);return i&&ht.forEach(function(uc){return l(he,uc)}),bn&&Ru(he,mt),ct}function ot(he,te,ye,Fe){var ct=ke(ye);if(typeof ct!="function")throw Error(t(150));if(ye=ct.call(ye),ye==null)throw Error(t(151));for(var dt=ct=null,ht=te,mt=te=0,dr=null,zt=ye.next();ht!==null&&!zt.done;mt++,zt=ye.next()){ht.index>mt?(dr=ht,ht=null):dr=ht.sibling;var uc=Ne(he,ht,zt.value,Fe);if(uc===null){ht===null&&(ht=dr);break}i&&ht&&uc.alternate===null&&l(he,ht),te=C(uc,te,mt),dt===null?ct=uc:dt.sibling=uc,dt=uc,ht=dr}if(zt.done)return h(he,ht),bn&&Ru(he,mt),ct;if(ht===null){for(;!zt.done;mt++,zt=ye.next())zt=je(he,zt.value,Fe),zt!==null&&(te=C(zt,te,mt),dt===null?ct=zt:dt.sibling=zt,dt=zt);return bn&&Ru(he,mt),ct}for(ht=m(he,ht);!zt.done;mt++,zt=ye.next())zt=Xe(ht,he,mt,zt.value,Fe),zt!==null&&(i&&zt.alternate!==null&&ht.delete(zt.key===null?mt:zt.key),te=C(zt,te,mt),dt===null?ct=zt:dt.sibling=zt,dt=zt);return i&&ht.forEach(function(GI){return l(he,GI)}),bn&&Ru(he,mt),ct}function Fn(he,te,ye,Fe){if(typeof ye=="object"&&ye!==null&&ye.type===H&&ye.key===null&&(ye=ye.props.children),typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case B:e:{for(var ct=ye.key,dt=te;dt!==null;){if(dt.key===ct){if(ct=ye.type,ct===H){if(dt.tag===7){h(he,dt.sibling),te=_(dt,ye.props.children),te.return=he,he=te;break e}}else if(dt.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===pe&&GA(ct)===dt.type){h(he,dt.sibling),te=_(dt,ye.props),te.ref=zg(he,dt,ye),te.return=he,he=te;break e}h(he,dt);break}else l(he,dt);dt=dt.sibling}ye.type===H?(te=Bu(ye.props.children,he.mode,Fe,ye.key),te.return=he,he=te):(Fe=Zv(ye.type,ye.key,ye.props,null,he.mode,Fe),Fe.ref=zg(he,te,ye),Fe.return=he,he=Fe)}return D(he);case $:e:{for(dt=ye.key;te!==null;){if(te.key===dt)if(te.tag===4&&te.stateNode.containerInfo===ye.containerInfo&&te.stateNode.implementation===ye.implementation){h(he,te.sibling),te=_(te,ye.children||[]),te.return=he,he=te;break e}else{h(he,te);break}else l(he,te);te=te.sibling}te=R_(ye,he.mode,Fe),te.return=he,he=te}return D(he);case pe:return dt=ye._init,Fn(he,te,dt(ye._payload),Fe)}if(sa(ye))return nt(he,te,ye,Fe);if(ke(ye))return ot(he,te,ye,Fe);Nv(he,ye)}return typeof ye=="string"&&ye!==""||typeof ye=="number"?(ye=""+ye,te!==null&&te.tag===6?(h(he,te.sibling),te=_(te,ye),te.return=he,he=te):(h(he,te),te=P_(ye,he.mode,Fe),te.return=he,he=te),D(he)):h(he,te)}return Fn}var Jh=KA(!0),XA=KA(!1),Pv=Zl(null),Rv=null,Qh=null,$x=null;function Ux(){$x=Qh=Rv=null}function zx(i){var l=Pv.current;mn(Pv),i._currentValue=l}function Hx(i,l,h){for(;i!==null;){var m=i.alternate;if((i.childLanes&l)!==l?(i.childLanes|=l,m!==null&&(m.childLanes|=l)):m!==null&&(m.childLanes&l)!==l&&(m.childLanes|=l),i===h)break;i=i.return}}function Zh(i,l){Rv=i,$x=Qh=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&l)!==0&&(fs=!0),i.firstContext=null)}function ai(i){var l=i._currentValue;if($x!==i)if(i={context:i,memoizedValue:l,next:null},Qh===null){if(Rv===null)throw Error(t(308));Qh=i,Rv.dependencies={lanes:0,firstContext:i}}else Qh=Qh.next=i;return l}var Iu=null;function qx(i){Iu===null?Iu=[i]:Iu.push(i)}function YA(i,l,h,m){var _=l.interleaved;return _===null?(h.next=h,qx(l)):(h.next=_.next,_.next=h),l.interleaved=h,Ca(i,m)}function Ca(i,l){i.lanes|=l;var h=i.alternate;for(h!==null&&(h.lanes|=l),h=i,i=i.return;i!==null;)i.childLanes|=l,h=i.alternate,h!==null&&(h.childLanes|=l),h=i,i=i.return;return h.tag===3?h.stateNode:null}var nc=!1;function Vx(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function JA(i,l){i=i.updateQueue,l.updateQueue===i&&(l.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Ta(i,l){return{eventTime:i,lane:l,tag:0,payload:null,callback:null,next:null}}function rc(i,l,h){var m=i.updateQueue;if(m===null)return null;if(m=m.shared,(Bt&2)!==0){var _=m.pending;return _===null?l.next=l:(l.next=_.next,_.next=l),m.pending=l,Ca(i,h)}return _=m.interleaved,_===null?(l.next=l,qx(m)):(l.next=_.next,_.next=l),m.interleaved=l,Ca(i,h)}function Iv(i,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194240)!==0)){var m=l.lanes;m&=i.pendingLanes,h|=m,l.lanes=h,Ph(i,h)}}function QA(i,l){var h=i.updateQueue,m=i.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var _=null,C=null;if(h=h.firstBaseUpdate,h!==null){do{var D={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};C===null?_=C=D:C=C.next=D,h=h.next}while(h!==null);C===null?_=C=l:C=C.next=l}else _=C=l;h={baseState:m.baseState,firstBaseUpdate:_,lastBaseUpdate:C,shared:m.shared,effects:m.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=l:i.next=l,h.lastBaseUpdate=l}function Ov(i,l,h,m){var _=i.updateQueue;nc=!1;var C=_.firstBaseUpdate,D=_.lastBaseUpdate,q=_.shared.pending;if(q!==null){_.shared.pending=null;var Y=q,we=Y.next;Y.next=null,D===null?C=we:D.next=we,D=Y;var Ie=i.alternate;Ie!==null&&(Ie=Ie.updateQueue,q=Ie.lastBaseUpdate,q!==D&&(q===null?Ie.firstBaseUpdate=we:q.next=we,Ie.lastBaseUpdate=Y))}if(C!==null){var je=_.baseState;D=0,Ie=we=Y=null,q=C;do{var Ne=q.lane,Xe=q.eventTime;if((m&Ne)===Ne){Ie!==null&&(Ie=Ie.next={eventTime:Xe,lane:0,tag:q.tag,payload:q.payload,callback:q.callback,next:null});e:{var nt=i,ot=q;switch(Ne=l,Xe=h,ot.tag){case 1:if(nt=ot.payload,typeof nt=="function"){je=nt.call(Xe,je,Ne);break e}je=nt;break e;case 3:nt.flags=nt.flags&-65537|128;case 0:if(nt=ot.payload,Ne=typeof nt=="function"?nt.call(Xe,je,Ne):nt,Ne==null)break e;je=Q({},je,Ne);break e;case 2:nc=!0}}q.callback!==null&&q.lane!==0&&(i.flags|=64,Ne=_.effects,Ne===null?_.effects=[q]:Ne.push(q))}else Xe={eventTime:Xe,lane:Ne,tag:q.tag,payload:q.payload,callback:q.callback,next:null},Ie===null?(we=Ie=Xe,Y=je):Ie=Ie.next=Xe,D|=Ne;if(q=q.next,q===null){if(q=_.shared.pending,q===null)break;Ne=q,q=Ne.next,Ne.next=null,_.lastBaseUpdate=Ne,_.shared.pending=null}}while(!0);if(Ie===null&&(Y=je),_.baseState=Y,_.firstBaseUpdate=we,_.lastBaseUpdate=Ie,l=_.shared.interleaved,l!==null){_=l;do D|=_.lane,_=_.next;while(_!==l)}else C===null&&(_.shared.lanes=0);Mu|=D,i.lanes=D,i.memoizedState=je}}function ZA(i,l,h){if(i=l.effects,l.effects=null,i!==null)for(l=0;l<i.length;l++){var m=i[l],_=m.callback;if(_!==null){if(m.callback=null,m=h,typeof _!="function")throw Error(t(191,_));_.call(m)}}}var Hg={},Ao=Zl(Hg),qg=Zl(Hg),Vg=Zl(Hg);function Ou(i){if(i===Hg)throw Error(t(174));return i}function Wx(i,l){switch(cn(Vg,l),cn(qg,i),cn(Ao,Hg),i=l.nodeType,i){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:Ni(null,"");break;default:i=i===8?l.parentNode:l,l=i.namespaceURI||null,i=i.tagName,l=Ni(l,i)}mn(Ao),cn(Ao,l)}function ef(){mn(Ao),mn(qg),mn(Vg)}function e1(i){Ou(Vg.current);var l=Ou(Ao.current),h=Ni(l,i.type);l!==h&&(cn(qg,i),cn(Ao,h))}function Gx(i){qg.current===i&&(mn(Ao),mn(qg))}var kn=Zl(0);function jv(i){for(var l=i;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===i)break;for(;l.sibling===null;){if(l.return===null||l.return===i)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Kx=[];function Xx(){for(var i=0;i<Kx.length;i++)Kx[i]._workInProgressVersionPrimary=null;Kx.length=0}var Mv=F.ReactCurrentDispatcher,Yx=F.ReactCurrentBatchConfig,ju=0,Cn=null,Qn=null,cr=null,Dv=!1,Wg=!1,Gg=0,gI=0;function Br(){throw Error(t(321))}function Jx(i,l){if(l===null)return!1;for(var h=0;h<l.length&&h<i.length;h++)if(!X(i[h],l[h]))return!1;return!0}function Qx(i,l,h,m,_,C){if(ju=C,Cn=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,Mv.current=i===null||i.memoizedState===null?bI:wI,i=h(m,_),Wg){C=0;do{if(Wg=!1,Gg=0,25<=C)throw Error(t(301));C+=1,cr=Qn=null,l.updateQueue=null,Mv.current=xI,i=h(m,_)}while(Wg)}if(Mv.current=Bv,l=Qn!==null&&Qn.next!==null,ju=0,cr=Qn=Cn=null,Dv=!1,l)throw Error(t(300));return i}function Zx(){var i=Gg!==0;return Gg=0,i}function ko(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cr===null?Cn.memoizedState=cr=i:cr=cr.next=i,cr}function li(){if(Qn===null){var i=Cn.alternate;i=i!==null?i.memoizedState:null}else i=Qn.next;var l=cr===null?Cn.memoizedState:cr.next;if(l!==null)cr=l,Qn=i;else{if(i===null)throw Error(t(310));Qn=i,i={memoizedState:Qn.memoizedState,baseState:Qn.baseState,baseQueue:Qn.baseQueue,queue:Qn.queue,next:null},cr===null?Cn.memoizedState=cr=i:cr=cr.next=i}return cr}function Kg(i,l){return typeof l=="function"?l(i):l}function e_(i){var l=li(),h=l.queue;if(h===null)throw Error(t(311));h.lastRenderedReducer=i;var m=Qn,_=m.baseQueue,C=h.pending;if(C!==null){if(_!==null){var D=_.next;_.next=C.next,C.next=D}m.baseQueue=_=C,h.pending=null}if(_!==null){C=_.next,m=m.baseState;var q=D=null,Y=null,we=C;do{var Ie=we.lane;if((ju&Ie)===Ie)Y!==null&&(Y=Y.next={lane:0,action:we.action,hasEagerState:we.hasEagerState,eagerState:we.eagerState,next:null}),m=we.hasEagerState?we.eagerState:i(m,we.action);else{var je={lane:Ie,action:we.action,hasEagerState:we.hasEagerState,eagerState:we.eagerState,next:null};Y===null?(q=Y=je,D=m):Y=Y.next=je,Cn.lanes|=Ie,Mu|=Ie}we=we.next}while(we!==null&&we!==C);Y===null?D=m:Y.next=q,X(m,l.memoizedState)||(fs=!0),l.memoizedState=m,l.baseState=D,l.baseQueue=Y,h.lastRenderedState=m}if(i=h.interleaved,i!==null){_=i;do C=_.lane,Cn.lanes|=C,Mu|=C,_=_.next;while(_!==i)}else _===null&&(h.lanes=0);return[l.memoizedState,h.dispatch]}function t_(i){var l=li(),h=l.queue;if(h===null)throw Error(t(311));h.lastRenderedReducer=i;var m=h.dispatch,_=h.pending,C=l.memoizedState;if(_!==null){h.pending=null;var D=_=_.next;do C=i(C,D.action),D=D.next;while(D!==_);X(C,l.memoizedState)||(fs=!0),l.memoizedState=C,l.baseQueue===null&&(l.baseState=C),h.lastRenderedState=C}return[C,m]}function t1(){}function n1(i,l){var h=Cn,m=li(),_=l(),C=!X(m.memoizedState,_);if(C&&(m.memoizedState=_,fs=!0),m=m.queue,n_(i1.bind(null,h,m,i),[i]),m.getSnapshot!==l||C||cr!==null&&cr.memoizedState.tag&1){if(h.flags|=2048,Xg(9,s1.bind(null,h,m,_,l),void 0,null),ur===null)throw Error(t(349));(ju&30)!==0||r1(h,l,_)}return _}function r1(i,l,h){i.flags|=16384,i={getSnapshot:l,value:h},l=Cn.updateQueue,l===null?(l={lastEffect:null,stores:null},Cn.updateQueue=l,l.stores=[i]):(h=l.stores,h===null?l.stores=[i]:h.push(i))}function s1(i,l,h,m){l.value=h,l.getSnapshot=m,o1(l)&&a1(i)}function i1(i,l,h){return h(function(){o1(l)&&a1(i)})}function o1(i){var l=i.getSnapshot;i=i.value;try{var h=l();return!X(i,h)}catch{return!0}}function a1(i){var l=Ca(i,1);l!==null&&zi(l,i,1,-1)}function l1(i){var l=ko();return typeof i=="function"&&(i=i()),l.memoizedState=l.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Kg,lastRenderedState:i},l.queue=i,i=i.dispatch=vI.bind(null,Cn,i),[l.memoizedState,i]}function Xg(i,l,h,m){return i={tag:i,create:l,destroy:h,deps:m,next:null},l=Cn.updateQueue,l===null?(l={lastEffect:null,stores:null},Cn.updateQueue=l,l.lastEffect=i.next=i):(h=l.lastEffect,h===null?l.lastEffect=i.next=i:(m=h.next,h.next=i,i.next=m,l.lastEffect=i)),i}function c1(){return li().memoizedState}function Lv(i,l,h,m){var _=ko();Cn.flags|=i,_.memoizedState=Xg(1|l,h,void 0,m===void 0?null:m)}function Fv(i,l,h,m){var _=li();m=m===void 0?null:m;var C=void 0;if(Qn!==null){var D=Qn.memoizedState;if(C=D.destroy,m!==null&&Jx(m,D.deps)){_.memoizedState=Xg(l,h,C,m);return}}Cn.flags|=i,_.memoizedState=Xg(1|l,h,C,m)}function u1(i,l){return Lv(8390656,8,i,l)}function n_(i,l){return Fv(2048,8,i,l)}function d1(i,l){return Fv(4,2,i,l)}function h1(i,l){return Fv(4,4,i,l)}function f1(i,l){if(typeof l=="function")return i=i(),l(i),function(){l(null)};if(l!=null)return i=i(),l.current=i,function(){l.current=null}}function p1(i,l,h){return h=h!=null?h.concat([i]):null,Fv(4,4,f1.bind(null,l,i),h)}function r_(){}function g1(i,l){var h=li();l=l===void 0?null:l;var m=h.memoizedState;return m!==null&&l!==null&&Jx(l,m[1])?m[0]:(h.memoizedState=[i,l],i)}function m1(i,l){var h=li();l=l===void 0?null:l;var m=h.memoizedState;return m!==null&&l!==null&&Jx(l,m[1])?m[0]:(i=i(),h.memoizedState=[i,l],i)}function y1(i,l,h){return(ju&21)===0?(i.baseState&&(i.baseState=!1,fs=!0),i.memoizedState=h):(X(h,l)||(h=ga(),Cn.lanes|=h,Mu|=h,i.baseState=!0),l)}function mI(i,l){var h=Ft;Ft=h!==0&&4>h?h:4,i(!0);var m=Yx.transition;Yx.transition={};try{i(!1),l()}finally{Ft=h,Yx.transition=m}}function v1(){return li().memoizedState}function yI(i,l,h){var m=ac(i);if(h={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null},b1(i))w1(l,h);else if(h=YA(i,l,h,m),h!==null){var _=ts();zi(h,i,m,_),x1(h,l,m)}}function vI(i,l,h){var m=ac(i),_={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null};if(b1(i))w1(l,_);else{var C=i.alternate;if(i.lanes===0&&(C===null||C.lanes===0)&&(C=l.lastRenderedReducer,C!==null))try{var D=l.lastRenderedState,q=C(D,h);if(_.hasEagerState=!0,_.eagerState=q,X(q,D)){var Y=l.interleaved;Y===null?(_.next=_,qx(l)):(_.next=Y.next,Y.next=_),l.interleaved=_;return}}catch{}finally{}h=YA(i,l,_,m),h!==null&&(_=ts(),zi(h,i,m,_),x1(h,l,m))}}function b1(i){var l=i.alternate;return i===Cn||l!==null&&l===Cn}function w1(i,l){Wg=Dv=!0;var h=i.pending;h===null?l.next=l:(l.next=h.next,h.next=l),i.pending=l}function x1(i,l,h){if((h&4194240)!==0){var m=l.lanes;m&=i.pendingLanes,h|=m,l.lanes=h,Ph(i,h)}}var Bv={readContext:ai,useCallback:Br,useContext:Br,useEffect:Br,useImperativeHandle:Br,useInsertionEffect:Br,useLayoutEffect:Br,useMemo:Br,useReducer:Br,useRef:Br,useState:Br,useDebugValue:Br,useDeferredValue:Br,useTransition:Br,useMutableSource:Br,useSyncExternalStore:Br,useId:Br,unstable_isNewReconciler:!1},bI={readContext:ai,useCallback:function(i,l){return ko().memoizedState=[i,l===void 0?null:l],i},useContext:ai,useEffect:u1,useImperativeHandle:function(i,l,h){return h=h!=null?h.concat([i]):null,Lv(4194308,4,f1.bind(null,l,i),h)},useLayoutEffect:function(i,l){return Lv(4194308,4,i,l)},useInsertionEffect:function(i,l){return Lv(4,2,i,l)},useMemo:function(i,l){var h=ko();return l=l===void 0?null:l,i=i(),h.memoizedState=[i,l],i},useReducer:function(i,l,h){var m=ko();return l=h!==void 0?h(l):l,m.memoizedState=m.baseState=l,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:l},m.queue=i,i=i.dispatch=yI.bind(null,Cn,i),[m.memoizedState,i]},useRef:function(i){var l=ko();return i={current:i},l.memoizedState=i},useState:l1,useDebugValue:r_,useDeferredValue:function(i){return ko().memoizedState=i},useTransition:function(){var i=l1(!1),l=i[0];return i=mI.bind(null,i[1]),ko().memoizedState=i,[l,i]},useMutableSource:function(){},useSyncExternalStore:function(i,l,h){var m=Cn,_=ko();if(bn){if(h===void 0)throw Error(t(407));h=h()}else{if(h=l(),ur===null)throw Error(t(349));(ju&30)!==0||r1(m,l,h)}_.memoizedState=h;var C={value:h,getSnapshot:l};return _.queue=C,u1(i1.bind(null,m,C,i),[i]),m.flags|=2048,Xg(9,s1.bind(null,m,C,h,l),void 0,null),h},useId:function(){var i=ko(),l=ur.identifierPrefix;if(bn){var h=ka,m=Aa;h=(m&~(1<<32-gt(m)-1)).toString(32)+h,l=":"+l+"R"+h,h=Gg++,0<h&&(l+="H"+h.toString(32)),l+=":"}else h=gI++,l=":"+l+"r"+h.toString(32)+":";return i.memoizedState=l},unstable_isNewReconciler:!1},wI={readContext:ai,useCallback:g1,useContext:ai,useEffect:n_,useImperativeHandle:p1,useInsertionEffect:d1,useLayoutEffect:h1,useMemo:m1,useReducer:e_,useRef:c1,useState:function(){return e_(Kg)},useDebugValue:r_,useDeferredValue:function(i){var l=li();return y1(l,Qn.memoizedState,i)},useTransition:function(){var i=e_(Kg)[0],l=li().memoizedState;return[i,l]},useMutableSource:t1,useSyncExternalStore:n1,useId:v1,unstable_isNewReconciler:!1},xI={readContext:ai,useCallback:g1,useContext:ai,useEffect:n_,useImperativeHandle:p1,useInsertionEffect:d1,useLayoutEffect:h1,useMemo:m1,useReducer:t_,useRef:c1,useState:function(){return t_(Kg)},useDebugValue:r_,useDeferredValue:function(i){var l=li();return Qn===null?l.memoizedState=i:y1(l,Qn.memoizedState,i)},useTransition:function(){var i=t_(Kg)[0],l=li().memoizedState;return[i,l]},useMutableSource:t1,useSyncExternalStore:n1,useId:v1,unstable_isNewReconciler:!1};function Bi(i,l){if(i&&i.defaultProps){l=Q({},l),i=i.defaultProps;for(var h in i)l[h]===void 0&&(l[h]=i[h]);return l}return l}function s_(i,l,h,m){l=i.memoizedState,h=h(m,l),h=h==null?l:Q({},l,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var $v={isMounted:function(i){return(i=i._reactInternals)?Dr(i)===i:!1},enqueueSetState:function(i,l,h){i=i._reactInternals;var m=ts(),_=ac(i),C=Ta(m,_);C.payload=l,h!=null&&(C.callback=h),l=rc(i,C,_),l!==null&&(zi(l,i,_,m),Iv(l,i,_))},enqueueReplaceState:function(i,l,h){i=i._reactInternals;var m=ts(),_=ac(i),C=Ta(m,_);C.tag=1,C.payload=l,h!=null&&(C.callback=h),l=rc(i,C,_),l!==null&&(zi(l,i,_,m),Iv(l,i,_))},enqueueForceUpdate:function(i,l){i=i._reactInternals;var h=ts(),m=ac(i),_=Ta(h,m);_.tag=2,l!=null&&(_.callback=l),l=rc(i,_,m),l!==null&&(zi(l,i,m,h),Iv(l,i,m))}};function _1(i,l,h,m,_,C,D){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(m,C,D):l.prototype&&l.prototype.isPureReactComponent?!oe(h,m)||!oe(_,C):!0}function S1(i,l,h){var m=!1,_=ec,C=l.contextType;return typeof C=="object"&&C!==null?C=ai(C):(_=hs(l)?Nu:Fr.current,m=l.contextTypes,C=(m=m!=null)?Gh(i,_):ec),l=new l(h,C),i.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=$v,i.stateNode=l,l._reactInternals=i,m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=_,i.__reactInternalMemoizedMaskedChildContext=C),l}function E1(i,l,h,m){i=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,m),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,m),l.state!==i&&$v.enqueueReplaceState(l,l.state,null)}function i_(i,l,h,m){var _=i.stateNode;_.props=h,_.state=i.memoizedState,_.refs={},Vx(i);var C=l.contextType;typeof C=="object"&&C!==null?_.context=ai(C):(C=hs(l)?Nu:Fr.current,_.context=Gh(i,C)),_.state=i.memoizedState,C=l.getDerivedStateFromProps,typeof C=="function"&&(s_(i,l,C,h),_.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(l=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),l!==_.state&&$v.enqueueReplaceState(_,_.state,null),Ov(i,h,_,m),_.state=i.memoizedState),typeof _.componentDidMount=="function"&&(i.flags|=4194308)}function tf(i,l){try{var h="",m=l;do h+=Ve(m),m=m.return;while(m);var _=h}catch(C){_=`
Error generating stack: `+C.message+`
`+C.stack}return{value:i,source:l,stack:_,digest:null}}function o_(i,l,h){return{value:i,source:null,stack:h??null,digest:l??null}}function a_(i,l){try{console.error(l.value)}catch(h){setTimeout(function(){throw h})}}var _I=typeof WeakMap=="function"?WeakMap:Map;function A1(i,l,h){h=Ta(-1,h),h.tag=3,h.payload={element:null};var m=l.value;return h.callback=function(){Gv||(Gv=!0,__=m),a_(i,l)},h}function k1(i,l,h){h=Ta(-1,h),h.tag=3;var m=i.type.getDerivedStateFromError;if(typeof m=="function"){var _=l.value;h.payload=function(){return m(_)},h.callback=function(){a_(i,l)}}var C=i.stateNode;return C!==null&&typeof C.componentDidCatch=="function"&&(h.callback=function(){a_(i,l),typeof m!="function"&&(ic===null?ic=new Set([this]):ic.add(this));var D=l.stack;this.componentDidCatch(l.value,{componentStack:D!==null?D:""})}),h}function C1(i,l,h){var m=i.pingCache;if(m===null){m=i.pingCache=new _I;var _=new Set;m.set(l,_)}else _=m.get(l),_===void 0&&(_=new Set,m.set(l,_));_.has(h)||(_.add(h),i=DI.bind(null,i,l,h),l.then(i,i))}function T1(i){do{var l;if((l=i.tag===13)&&(l=i.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return i;i=i.return}while(i!==null);return null}function N1(i,l,h,m,_){return(i.mode&1)===0?(i===l?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(l=Ta(-1,1),l.tag=2,rc(h,l,1))),h.lanes|=1),i):(i.flags|=65536,i.lanes=_,i)}var SI=F.ReactCurrentOwner,fs=!1;function es(i,l,h,m){l.child=i===null?XA(l,null,h,m):Jh(l,i.child,h,m)}function P1(i,l,h,m,_){h=h.render;var C=l.ref;return Zh(l,_),m=Qx(i,l,h,m,C,_),h=Zx(),i!==null&&!fs?(l.updateQueue=i.updateQueue,l.flags&=-2053,i.lanes&=~_,Na(i,l,_)):(bn&&h&&Mx(l),l.flags|=1,es(i,l,m,_),l.child)}function R1(i,l,h,m,_){if(i===null){var C=h.type;return typeof C=="function"&&!N_(C)&&C.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(l.tag=15,l.type=C,I1(i,l,C,m,_)):(i=Zv(h.type,null,m,l,l.mode,_),i.ref=l.ref,i.return=l,l.child=i)}if(C=i.child,(i.lanes&_)===0){var D=C.memoizedProps;if(h=h.compare,h=h!==null?h:oe,h(D,m)&&i.ref===l.ref)return Na(i,l,_)}return l.flags|=1,i=cc(C,m),i.ref=l.ref,i.return=l,l.child=i}function I1(i,l,h,m,_){if(i!==null){var C=i.memoizedProps;if(oe(C,m)&&i.ref===l.ref)if(fs=!1,l.pendingProps=m=C,(i.lanes&_)!==0)(i.flags&131072)!==0&&(fs=!0);else return l.lanes=i.lanes,Na(i,l,_)}return l_(i,l,h,m,_)}function O1(i,l,h){var m=l.pendingProps,_=m.children,C=i!==null?i.memoizedState:null;if(m.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},cn(rf,Is),Is|=h;else{if((h&1073741824)===0)return i=C!==null?C.baseLanes|h:h,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:i,cachePool:null,transitions:null},l.updateQueue=null,cn(rf,Is),Is|=i,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=C!==null?C.baseLanes:h,cn(rf,Is),Is|=m}else C!==null?(m=C.baseLanes|h,l.memoizedState=null):m=h,cn(rf,Is),Is|=m;return es(i,l,_,h),l.child}function j1(i,l){var h=l.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(l.flags|=512,l.flags|=2097152)}function l_(i,l,h,m,_){var C=hs(h)?Nu:Fr.current;return C=Gh(l,C),Zh(l,_),h=Qx(i,l,h,m,C,_),m=Zx(),i!==null&&!fs?(l.updateQueue=i.updateQueue,l.flags&=-2053,i.lanes&=~_,Na(i,l,_)):(bn&&m&&Mx(l),l.flags|=1,es(i,l,h,_),l.child)}function M1(i,l,h,m,_){if(hs(h)){var C=!0;Ev(l)}else C=!1;if(Zh(l,_),l.stateNode===null)zv(i,l),S1(l,h,m),i_(l,h,m,_),m=!0;else if(i===null){var D=l.stateNode,q=l.memoizedProps;D.props=q;var Y=D.context,we=h.contextType;typeof we=="object"&&we!==null?we=ai(we):(we=hs(h)?Nu:Fr.current,we=Gh(l,we));var Ie=h.getDerivedStateFromProps,je=typeof Ie=="function"||typeof D.getSnapshotBeforeUpdate=="function";je||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(q!==m||Y!==we)&&E1(l,D,m,we),nc=!1;var Ne=l.memoizedState;D.state=Ne,Ov(l,m,D,_),Y=l.memoizedState,q!==m||Ne!==Y||ds.current||nc?(typeof Ie=="function"&&(s_(l,h,Ie,m),Y=l.memoizedState),(q=nc||_1(l,h,q,m,Ne,Y,we))?(je||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(l.flags|=4194308)):(typeof D.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=m,l.memoizedState=Y),D.props=m,D.state=Y,D.context=we,m=q):(typeof D.componentDidMount=="function"&&(l.flags|=4194308),m=!1)}else{D=l.stateNode,JA(i,l),q=l.memoizedProps,we=l.type===l.elementType?q:Bi(l.type,q),D.props=we,je=l.pendingProps,Ne=D.context,Y=h.contextType,typeof Y=="object"&&Y!==null?Y=ai(Y):(Y=hs(h)?Nu:Fr.current,Y=Gh(l,Y));var Xe=h.getDerivedStateFromProps;(Ie=typeof Xe=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(q!==je||Ne!==Y)&&E1(l,D,m,Y),nc=!1,Ne=l.memoizedState,D.state=Ne,Ov(l,m,D,_);var nt=l.memoizedState;q!==je||Ne!==nt||ds.current||nc?(typeof Xe=="function"&&(s_(l,h,Xe,m),nt=l.memoizedState),(we=nc||_1(l,h,we,m,Ne,nt,Y)||!1)?(Ie||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(m,nt,Y),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(m,nt,Y)),typeof D.componentDidUpdate=="function"&&(l.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof D.componentDidUpdate!="function"||q===i.memoizedProps&&Ne===i.memoizedState||(l.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===i.memoizedProps&&Ne===i.memoizedState||(l.flags|=1024),l.memoizedProps=m,l.memoizedState=nt),D.props=m,D.state=nt,D.context=Y,m=we):(typeof D.componentDidUpdate!="function"||q===i.memoizedProps&&Ne===i.memoizedState||(l.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===i.memoizedProps&&Ne===i.memoizedState||(l.flags|=1024),m=!1)}return c_(i,l,h,m,C,_)}function c_(i,l,h,m,_,C){j1(i,l);var D=(l.flags&128)!==0;if(!m&&!D)return _&&$A(l,h,!1),Na(i,l,C);m=l.stateNode,SI.current=l;var q=D&&typeof h.getDerivedStateFromError!="function"?null:m.render();return l.flags|=1,i!==null&&D?(l.child=Jh(l,i.child,null,C),l.child=Jh(l,null,q,C)):es(i,l,q,C),l.memoizedState=m.state,_&&$A(l,h,!0),l.child}function D1(i){var l=i.stateNode;l.pendingContext?FA(i,l.pendingContext,l.pendingContext!==l.context):l.context&&FA(i,l.context,!1),Wx(i,l.containerInfo)}function L1(i,l,h,m,_){return Yh(),Bx(_),l.flags|=256,es(i,l,h,m),l.child}var u_={dehydrated:null,treeContext:null,retryLane:0};function d_(i){return{baseLanes:i,cachePool:null,transitions:null}}function F1(i,l,h){var m=l.pendingProps,_=kn.current,C=!1,D=(l.flags&128)!==0,q;if((q=D)||(q=i!==null&&i.memoizedState===null?!1:(_&2)!==0),q?(C=!0,l.flags&=-129):(i===null||i.memoizedState!==null)&&(_|=1),cn(kn,_&1),i===null)return Fx(l),i=l.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((l.mode&1)===0?l.lanes=1:i.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(D=m.children,i=m.fallback,C?(m=l.mode,C=l.child,D={mode:"hidden",children:D},(m&1)===0&&C!==null?(C.childLanes=0,C.pendingProps=D):C=eb(D,m,0,null),i=Bu(i,m,h,null),C.return=l,i.return=l,C.sibling=i,l.child=C,l.child.memoizedState=d_(h),l.memoizedState=u_,i):h_(l,D));if(_=i.memoizedState,_!==null&&(q=_.dehydrated,q!==null))return EI(i,l,D,m,q,_,h);if(C){C=m.fallback,D=l.mode,_=i.child,q=_.sibling;var Y={mode:"hidden",children:m.children};return(D&1)===0&&l.child!==_?(m=l.child,m.childLanes=0,m.pendingProps=Y,l.deletions=null):(m=cc(_,Y),m.subtreeFlags=_.subtreeFlags&14680064),q!==null?C=cc(q,C):(C=Bu(C,D,h,null),C.flags|=2),C.return=l,m.return=l,m.sibling=C,l.child=m,m=C,C=l.child,D=i.child.memoizedState,D=D===null?d_(h):{baseLanes:D.baseLanes|h,cachePool:null,transitions:D.transitions},C.memoizedState=D,C.childLanes=i.childLanes&~h,l.memoizedState=u_,m}return C=i.child,i=C.sibling,m=cc(C,{mode:"visible",children:m.children}),(l.mode&1)===0&&(m.lanes=h),m.return=l,m.sibling=null,i!==null&&(h=l.deletions,h===null?(l.deletions=[i],l.flags|=16):h.push(i)),l.child=m,l.memoizedState=null,m}function h_(i,l){return l=eb({mode:"visible",children:l},i.mode,0,null),l.return=i,i.child=l}function Uv(i,l,h,m){return m!==null&&Bx(m),Jh(l,i.child,null,h),i=h_(l,l.pendingProps.children),i.flags|=2,l.memoizedState=null,i}function EI(i,l,h,m,_,C,D){if(h)return l.flags&256?(l.flags&=-257,m=o_(Error(t(422))),Uv(i,l,D,m)):l.memoizedState!==null?(l.child=i.child,l.flags|=128,null):(C=m.fallback,_=l.mode,m=eb({mode:"visible",children:m.children},_,0,null),C=Bu(C,_,D,null),C.flags|=2,m.return=l,C.return=l,m.sibling=C,l.child=m,(l.mode&1)!==0&&Jh(l,i.child,null,D),l.child.memoizedState=d_(D),l.memoizedState=u_,C);if((l.mode&1)===0)return Uv(i,l,D,null);if(_.data==="$!"){if(m=_.nextSibling&&_.nextSibling.dataset,m)var q=m.dgst;return m=q,C=Error(t(419)),m=o_(C,m,void 0),Uv(i,l,D,m)}if(q=(D&i.childLanes)!==0,fs||q){if(m=ur,m!==null){switch(D&-D){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=(_&(m.suspendedLanes|D))!==0?0:_,_!==0&&_!==C.retryLane&&(C.retryLane=_,Ca(i,_),zi(m,i,_,-1))}return T_(),m=o_(Error(t(421))),Uv(i,l,D,m)}return _.data==="$?"?(l.flags|=128,l.child=i.child,l=LI.bind(null,i),_._reactRetry=l,null):(i=C.treeContext,Rs=Ql(_.nextSibling),Ps=l,bn=!0,Fi=null,i!==null&&(ii[oi++]=Aa,ii[oi++]=ka,ii[oi++]=Pu,Aa=i.id,ka=i.overflow,Pu=l),l=h_(l,m.children),l.flags|=4096,l)}function B1(i,l,h){i.lanes|=l;var m=i.alternate;m!==null&&(m.lanes|=l),Hx(i.return,l,h)}function f_(i,l,h,m,_){var C=i.memoizedState;C===null?i.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:_}:(C.isBackwards=l,C.rendering=null,C.renderingStartTime=0,C.last=m,C.tail=h,C.tailMode=_)}function $1(i,l,h){var m=l.pendingProps,_=m.revealOrder,C=m.tail;if(es(i,l,m.children,h),m=kn.current,(m&2)!==0)m=m&1|2,l.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=l.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&B1(i,h,l);else if(i.tag===19)B1(i,h,l);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===l)break e;for(;i.sibling===null;){if(i.return===null||i.return===l)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}m&=1}if(cn(kn,m),(l.mode&1)===0)l.memoizedState=null;else switch(_){case"forwards":for(h=l.child,_=null;h!==null;)i=h.alternate,i!==null&&jv(i)===null&&(_=h),h=h.sibling;h=_,h===null?(_=l.child,l.child=null):(_=h.sibling,h.sibling=null),f_(l,!1,_,h,C);break;case"backwards":for(h=null,_=l.child,l.child=null;_!==null;){if(i=_.alternate,i!==null&&jv(i)===null){l.child=_;break}i=_.sibling,_.sibling=h,h=_,_=i}f_(l,!0,h,null,C);break;case"together":f_(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function zv(i,l){(l.mode&1)===0&&i!==null&&(i.alternate=null,l.alternate=null,l.flags|=2)}function Na(i,l,h){if(i!==null&&(l.dependencies=i.dependencies),Mu|=l.lanes,(h&l.childLanes)===0)return null;if(i!==null&&l.child!==i.child)throw Error(t(153));if(l.child!==null){for(i=l.child,h=cc(i,i.pendingProps),l.child=h,h.return=l;i.sibling!==null;)i=i.sibling,h=h.sibling=cc(i,i.pendingProps),h.return=l;h.sibling=null}return l.child}function AI(i,l,h){switch(l.tag){case 3:D1(l),Yh();break;case 5:e1(l);break;case 1:hs(l.type)&&Ev(l);break;case 4:Wx(l,l.stateNode.containerInfo);break;case 10:var m=l.type._context,_=l.memoizedProps.value;cn(Pv,m._currentValue),m._currentValue=_;break;case 13:if(m=l.memoizedState,m!==null)return m.dehydrated!==null?(cn(kn,kn.current&1),l.flags|=128,null):(h&l.child.childLanes)!==0?F1(i,l,h):(cn(kn,kn.current&1),i=Na(i,l,h),i!==null?i.sibling:null);cn(kn,kn.current&1);break;case 19:if(m=(h&l.childLanes)!==0,(i.flags&128)!==0){if(m)return $1(i,l,h);l.flags|=128}if(_=l.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),cn(kn,kn.current),m)break;return null;case 22:case 23:return l.lanes=0,O1(i,l,h)}return Na(i,l,h)}var U1,p_,z1,H1;U1=function(i,l){for(var h=l.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return;h=h.return}h.sibling.return=h.return,h=h.sibling}},p_=function(){},z1=function(i,l,h,m){var _=i.memoizedProps;if(_!==m){i=l.stateNode,Ou(Ao.current);var C=null;switch(h){case"input":_=Le(i,_),m=Le(i,m),C=[];break;case"select":_=Q({},_,{value:void 0}),m=Q({},m,{value:void 0}),C=[];break;case"textarea":_=Sh(i,_),m=Sh(i,m),C=[];break;default:typeof _.onClick!="function"&&typeof m.onClick=="function"&&(i.onclick=xv)}it(h,m);var D;h=null;for(we in _)if(!m.hasOwnProperty(we)&&_.hasOwnProperty(we)&&_[we]!=null)if(we==="style"){var q=_[we];for(D in q)q.hasOwnProperty(D)&&(h||(h={}),h[D]="")}else we!=="dangerouslySetInnerHTML"&&we!=="children"&&we!=="suppressContentEditableWarning"&&we!=="suppressHydrationWarning"&&we!=="autoFocus"&&(r.hasOwnProperty(we)?C||(C=[]):(C=C||[]).push(we,null));for(we in m){var Y=m[we];if(q=_!=null?_[we]:void 0,m.hasOwnProperty(we)&&Y!==q&&(Y!=null||q!=null))if(we==="style")if(q){for(D in q)!q.hasOwnProperty(D)||Y&&Y.hasOwnProperty(D)||(h||(h={}),h[D]="");for(D in Y)Y.hasOwnProperty(D)&&q[D]!==Y[D]&&(h||(h={}),h[D]=Y[D])}else h||(C||(C=[]),C.push(we,h)),h=Y;else we==="dangerouslySetInnerHTML"?(Y=Y?Y.__html:void 0,q=q?q.__html:void 0,Y!=null&&q!==Y&&(C=C||[]).push(we,Y)):we==="children"?typeof Y!="string"&&typeof Y!="number"||(C=C||[]).push(we,""+Y):we!=="suppressContentEditableWarning"&&we!=="suppressHydrationWarning"&&(r.hasOwnProperty(we)?(Y!=null&&we==="onScroll"&&gn("scroll",i),C||q===Y||(C=[])):(C=C||[]).push(we,Y))}h&&(C=C||[]).push("style",h);var we=C;(l.updateQueue=we)&&(l.flags|=4)}},H1=function(i,l,h,m){h!==m&&(l.flags|=4)};function Yg(i,l){if(!bn)switch(i.tailMode){case"hidden":l=i.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?l||i.tail===null?i.tail=null:i.tail.sibling=null:m.sibling=null}}function $r(i){var l=i.alternate!==null&&i.alternate.child===i.child,h=0,m=0;if(l)for(var _=i.child;_!==null;)h|=_.lanes|_.childLanes,m|=_.subtreeFlags&14680064,m|=_.flags&14680064,_.return=i,_=_.sibling;else for(_=i.child;_!==null;)h|=_.lanes|_.childLanes,m|=_.subtreeFlags,m|=_.flags,_.return=i,_=_.sibling;return i.subtreeFlags|=m,i.childLanes=h,l}function kI(i,l,h){var m=l.pendingProps;switch(Dx(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $r(l),null;case 1:return hs(l.type)&&Sv(),$r(l),null;case 3:return m=l.stateNode,ef(),mn(ds),mn(Fr),Xx(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(i===null||i.child===null)&&(Tv(l)?l.flags|=4:i===null||i.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,Fi!==null&&(A_(Fi),Fi=null))),p_(i,l),$r(l),null;case 5:Gx(l);var _=Ou(Vg.current);if(h=l.type,i!==null&&l.stateNode!=null)z1(i,l,h,m,_),i.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!m){if(l.stateNode===null)throw Error(t(166));return $r(l),null}if(i=Ou(Ao.current),Tv(l)){m=l.stateNode,h=l.type;var C=l.memoizedProps;switch(m[Eo]=l,m[$g]=C,i=(l.mode&1)!==0,h){case"dialog":gn("cancel",m),gn("close",m);break;case"iframe":case"object":case"embed":gn("load",m);break;case"video":case"audio":for(_=0;_<Lg.length;_++)gn(Lg[_],m);break;case"source":gn("error",m);break;case"img":case"image":case"link":gn("error",m),gn("load",m);break;case"details":gn("toggle",m);break;case"input":Ke(m,C),gn("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!C.multiple},gn("invalid",m);break;case"textarea":Nl(m,C),gn("invalid",m)}it(h,C),_=null;for(var D in C)if(C.hasOwnProperty(D)){var q=C[D];D==="children"?typeof q=="string"?m.textContent!==q&&(C.suppressHydrationWarning!==!0&&wv(m.textContent,q,i),_=["children",q]):typeof q=="number"&&m.textContent!==""+q&&(C.suppressHydrationWarning!==!0&&wv(m.textContent,q,i),_=["children",""+q]):r.hasOwnProperty(D)&&q!=null&&D==="onScroll"&&gn("scroll",m)}switch(h){case"input":bt(m),Tl(m,C,!0);break;case"textarea":bt(m),Pl(m);break;case"select":case"option":break;default:typeof C.onClick=="function"&&(m.onclick=xv)}m=_,l.updateQueue=m,m!==null&&(l.flags|=4)}else{D=_.nodeType===9?_:_.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=lo(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=D.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof m.is=="string"?i=D.createElement(h,{is:m.is}):(i=D.createElement(h),h==="select"&&(D=i,m.multiple?D.multiple=!0:m.size&&(D.size=m.size))):i=D.createElementNS(i,h),i[Eo]=l,i[$g]=m,U1(i,l,!1,!1),l.stateNode=i;e:{switch(D=aa(h,m),h){case"dialog":gn("cancel",i),gn("close",i),_=m;break;case"iframe":case"object":case"embed":gn("load",i),_=m;break;case"video":case"audio":for(_=0;_<Lg.length;_++)gn(Lg[_],i);_=m;break;case"source":gn("error",i),_=m;break;case"img":case"image":case"link":gn("error",i),gn("load",i),_=m;break;case"details":gn("toggle",i),_=m;break;case"input":Ke(i,m),_=Le(i,m),gn("invalid",i);break;case"option":_=m;break;case"select":i._wrapperState={wasMultiple:!!m.multiple},_=Q({},m,{value:void 0}),gn("invalid",i);break;case"textarea":Nl(i,m),_=Sh(i,m),gn("invalid",i);break;default:_=m}it(h,_),q=_;for(C in q)if(q.hasOwnProperty(C)){var Y=q[C];C==="style"?Eh(i,Y):C==="dangerouslySetInnerHTML"?(Y=Y?Y.__html:void 0,Y!=null&&Il(i,Y)):C==="children"?typeof Y=="string"?(h!=="textarea"||Y!=="")&&ia(i,Y):typeof Y=="number"&&ia(i,""+Y):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(r.hasOwnProperty(C)?Y!=null&&C==="onScroll"&&gn("scroll",i):Y!=null&&j(i,C,Y,D))}switch(h){case"input":bt(i),Tl(i,m,!1);break;case"textarea":bt(i),Pl(i);break;case"option":m.value!=null&&i.setAttribute("value",""+Te(m.value));break;case"select":i.multiple=!!m.multiple,C=m.value,C!=null?br(i,!!m.multiple,C,!1):m.defaultValue!=null&&br(i,!!m.multiple,m.defaultValue,!0);break;default:typeof _.onClick=="function"&&(i.onclick=xv)}switch(h){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return $r(l),null;case 6:if(i&&l.stateNode!=null)H1(i,l,i.memoizedProps,m);else{if(typeof m!="string"&&l.stateNode===null)throw Error(t(166));if(h=Ou(Vg.current),Ou(Ao.current),Tv(l)){if(m=l.stateNode,h=l.memoizedProps,m[Eo]=l,(C=m.nodeValue!==h)&&(i=Ps,i!==null))switch(i.tag){case 3:wv(m.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&wv(m.nodeValue,h,(i.mode&1)!==0)}C&&(l.flags|=4)}else m=(h.nodeType===9?h:h.ownerDocument).createTextNode(m),m[Eo]=l,l.stateNode=m}return $r(l),null;case 13:if(mn(kn),m=l.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(bn&&Rs!==null&&(l.mode&1)!==0&&(l.flags&128)===0)WA(),Yh(),l.flags|=98560,C=!1;else if(C=Tv(l),m!==null&&m.dehydrated!==null){if(i===null){if(!C)throw Error(t(318));if(C=l.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(t(317));C[Eo]=l}else Yh(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;$r(l),C=!1}else Fi!==null&&(A_(Fi),Fi=null),C=!0;if(!C)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=h,l):(m=m!==null,m!==(i!==null&&i.memoizedState!==null)&&m&&(l.child.flags|=8192,(l.mode&1)!==0&&(i===null||(kn.current&1)!==0?Zn===0&&(Zn=3):T_())),l.updateQueue!==null&&(l.flags|=4),$r(l),null);case 4:return ef(),p_(i,l),i===null&&Fg(l.stateNode.containerInfo),$r(l),null;case 10:return zx(l.type._context),$r(l),null;case 17:return hs(l.type)&&Sv(),$r(l),null;case 19:if(mn(kn),C=l.memoizedState,C===null)return $r(l),null;if(m=(l.flags&128)!==0,D=C.rendering,D===null)if(m)Yg(C,!1);else{if(Zn!==0||i!==null&&(i.flags&128)!==0)for(i=l.child;i!==null;){if(D=jv(i),D!==null){for(l.flags|=128,Yg(C,!1),m=D.updateQueue,m!==null&&(l.updateQueue=m,l.flags|=4),l.subtreeFlags=0,m=h,h=l.child;h!==null;)C=h,i=m,C.flags&=14680066,D=C.alternate,D===null?(C.childLanes=0,C.lanes=i,C.child=null,C.subtreeFlags=0,C.memoizedProps=null,C.memoizedState=null,C.updateQueue=null,C.dependencies=null,C.stateNode=null):(C.childLanes=D.childLanes,C.lanes=D.lanes,C.child=D.child,C.subtreeFlags=0,C.deletions=null,C.memoizedProps=D.memoizedProps,C.memoizedState=D.memoizedState,C.updateQueue=D.updateQueue,C.type=D.type,i=D.dependencies,C.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return cn(kn,kn.current&1|2),l.child}i=i.sibling}C.tail!==null&&qt()>sf&&(l.flags|=128,m=!0,Yg(C,!1),l.lanes=4194304)}else{if(!m)if(i=jv(D),i!==null){if(l.flags|=128,m=!0,h=i.updateQueue,h!==null&&(l.updateQueue=h,l.flags|=4),Yg(C,!0),C.tail===null&&C.tailMode==="hidden"&&!D.alternate&&!bn)return $r(l),null}else 2*qt()-C.renderingStartTime>sf&&h!==1073741824&&(l.flags|=128,m=!0,Yg(C,!1),l.lanes=4194304);C.isBackwards?(D.sibling=l.child,l.child=D):(h=C.last,h!==null?h.sibling=D:l.child=D,C.last=D)}return C.tail!==null?(l=C.tail,C.rendering=l,C.tail=l.sibling,C.renderingStartTime=qt(),l.sibling=null,h=kn.current,cn(kn,m?h&1|2:h&1),l):($r(l),null);case 22:case 23:return C_(),m=l.memoizedState!==null,i!==null&&i.memoizedState!==null!==m&&(l.flags|=8192),m&&(l.mode&1)!==0?(Is&1073741824)!==0&&($r(l),l.subtreeFlags&6&&(l.flags|=8192)):$r(l),null;case 24:return null;case 25:return null}throw Error(t(156,l.tag))}function CI(i,l){switch(Dx(l),l.tag){case 1:return hs(l.type)&&Sv(),i=l.flags,i&65536?(l.flags=i&-65537|128,l):null;case 3:return ef(),mn(ds),mn(Fr),Xx(),i=l.flags,(i&65536)!==0&&(i&128)===0?(l.flags=i&-65537|128,l):null;case 5:return Gx(l),null;case 13:if(mn(kn),i=l.memoizedState,i!==null&&i.dehydrated!==null){if(l.alternate===null)throw Error(t(340));Yh()}return i=l.flags,i&65536?(l.flags=i&-65537|128,l):null;case 19:return mn(kn),null;case 4:return ef(),null;case 10:return zx(l.type._context),null;case 22:case 23:return C_(),null;case 24:return null;default:return null}}var Hv=!1,Ur=!1,TI=typeof WeakSet=="function"?WeakSet:Set,Qe=null;function nf(i,l){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(m){Rn(i,l,m)}else h.current=null}function g_(i,l,h){try{h()}catch(m){Rn(i,l,m)}}var q1=!1;function NI(i,l){if(Cx=_u,i=ie(),se(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var _=m.anchorOffset,C=m.focusNode;m=m.focusOffset;try{h.nodeType,C.nodeType}catch{h=null;break e}var D=0,q=-1,Y=-1,we=0,Ie=0,je=i,Ne=null;t:for(;;){for(var Xe;je!==h||_!==0&&je.nodeType!==3||(q=D+_),je!==C||m!==0&&je.nodeType!==3||(Y=D+m),je.nodeType===3&&(D+=je.nodeValue.length),(Xe=je.firstChild)!==null;)Ne=je,je=Xe;for(;;){if(je===i)break t;if(Ne===h&&++we===_&&(q=D),Ne===C&&++Ie===m&&(Y=D),(Xe=je.nextSibling)!==null)break;je=Ne,Ne=je.parentNode}je=Xe}h=q===-1||Y===-1?null:{start:q,end:Y}}else h=null}h=h||{start:0,end:0}}else h=null;for(Tx={focusedElem:i,selectionRange:h},_u=!1,Qe=l;Qe!==null;)if(l=Qe,i=l.child,(l.subtreeFlags&1028)!==0&&i!==null)i.return=l,Qe=i;else for(;Qe!==null;){l=Qe;try{var nt=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(nt!==null){var ot=nt.memoizedProps,Fn=nt.memoizedState,he=l.stateNode,te=he.getSnapshotBeforeUpdate(l.elementType===l.type?ot:Bi(l.type,ot),Fn);he.__reactInternalSnapshotBeforeUpdate=te}break;case 3:var ye=l.stateNode.containerInfo;ye.nodeType===1?ye.textContent="":ye.nodeType===9&&ye.documentElement&&ye.removeChild(ye.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Fe){Rn(l,l.return,Fe)}if(i=l.sibling,i!==null){i.return=l.return,Qe=i;break}Qe=l.return}return nt=q1,q1=!1,nt}function Jg(i,l,h){var m=l.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var _=m=m.next;do{if((_.tag&i)===i){var C=_.destroy;_.destroy=void 0,C!==void 0&&g_(l,h,C)}_=_.next}while(_!==m)}}function qv(i,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var h=l=l.next;do{if((h.tag&i)===i){var m=h.create;h.destroy=m()}h=h.next}while(h!==l)}}function m_(i){var l=i.ref;if(l!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof l=="function"?l(i):l.current=i}}function V1(i){var l=i.alternate;l!==null&&(i.alternate=null,V1(l)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(l=i.stateNode,l!==null&&(delete l[Eo],delete l[$g],delete l[Ix],delete l[dI],delete l[hI])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function W1(i){return i.tag===5||i.tag===3||i.tag===4}function G1(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||W1(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function y_(i,l,h){var m=i.tag;if(m===5||m===6)i=i.stateNode,l?h.nodeType===8?h.parentNode.insertBefore(i,l):h.insertBefore(i,l):(h.nodeType===8?(l=h.parentNode,l.insertBefore(i,h)):(l=h,l.appendChild(i)),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=xv));else if(m!==4&&(i=i.child,i!==null))for(y_(i,l,h),i=i.sibling;i!==null;)y_(i,l,h),i=i.sibling}function v_(i,l,h){var m=i.tag;if(m===5||m===6)i=i.stateNode,l?h.insertBefore(i,l):h.appendChild(i);else if(m!==4&&(i=i.child,i!==null))for(v_(i,l,h),i=i.sibling;i!==null;)v_(i,l,h),i=i.sibling}var _r=null,$i=!1;function sc(i,l,h){for(h=h.child;h!==null;)K1(i,l,h),h=h.sibling}function K1(i,l,h){if(Jr&&typeof Jr.onCommitFiberUnmount=="function")try{Jr.onCommitFiberUnmount(mu,h)}catch{}switch(h.tag){case 5:Ur||nf(h,l);case 6:var m=_r,_=$i;_r=null,sc(i,l,h),_r=m,$i=_,_r!==null&&($i?(i=_r,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):_r.removeChild(h.stateNode));break;case 18:_r!==null&&($i?(i=_r,h=h.stateNode,i.nodeType===8?Rx(i.parentNode,h):i.nodeType===1&&Rx(i,h),Oi(i)):Rx(_r,h.stateNode));break;case 4:m=_r,_=$i,_r=h.stateNode.containerInfo,$i=!0,sc(i,l,h),_r=m,$i=_;break;case 0:case 11:case 14:case 15:if(!Ur&&(m=h.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){_=m=m.next;do{var C=_,D=C.destroy;C=C.tag,D!==void 0&&((C&2)!==0||(C&4)!==0)&&g_(h,l,D),_=_.next}while(_!==m)}sc(i,l,h);break;case 1:if(!Ur&&(nf(h,l),m=h.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=h.memoizedProps,m.state=h.memoizedState,m.componentWillUnmount()}catch(q){Rn(h,l,q)}sc(i,l,h);break;case 21:sc(i,l,h);break;case 22:h.mode&1?(Ur=(m=Ur)||h.memoizedState!==null,sc(i,l,h),Ur=m):sc(i,l,h);break;default:sc(i,l,h)}}function X1(i){var l=i.updateQueue;if(l!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new TI),l.forEach(function(m){var _=FI.bind(null,i,m);h.has(m)||(h.add(m),m.then(_,_))})}}function Ui(i,l){var h=l.deletions;if(h!==null)for(var m=0;m<h.length;m++){var _=h[m];try{var C=i,D=l,q=D;e:for(;q!==null;){switch(q.tag){case 5:_r=q.stateNode,$i=!1;break e;case 3:_r=q.stateNode.containerInfo,$i=!0;break e;case 4:_r=q.stateNode.containerInfo,$i=!0;break e}q=q.return}if(_r===null)throw Error(t(160));K1(C,D,_),_r=null,$i=!1;var Y=_.alternate;Y!==null&&(Y.return=null),_.return=null}catch(we){Rn(_,l,we)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)Y1(l,i),l=l.sibling}function Y1(i,l){var h=i.alternate,m=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Ui(l,i),Co(i),m&4){try{Jg(3,i,i.return),qv(3,i)}catch(ot){Rn(i,i.return,ot)}try{Jg(5,i,i.return)}catch(ot){Rn(i,i.return,ot)}}break;case 1:Ui(l,i),Co(i),m&512&&h!==null&&nf(h,h.return);break;case 5:if(Ui(l,i),Co(i),m&512&&h!==null&&nf(h,h.return),i.flags&32){var _=i.stateNode;try{ia(_,"")}catch(ot){Rn(i,i.return,ot)}}if(m&4&&(_=i.stateNode,_!=null)){var C=i.memoizedProps,D=h!==null?h.memoizedProps:C,q=i.type,Y=i.updateQueue;if(i.updateQueue=null,Y!==null)try{q==="input"&&C.type==="radio"&&C.name!=null&&Mt(_,C),aa(q,D);var we=aa(q,C);for(D=0;D<Y.length;D+=2){var Ie=Y[D],je=Y[D+1];Ie==="style"?Eh(_,je):Ie==="dangerouslySetInnerHTML"?Il(_,je):Ie==="children"?ia(_,je):j(_,Ie,je,we)}switch(q){case"input":Nt(_,C);break;case"textarea":gg(_,C);break;case"select":var Ne=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!C.multiple;var Xe=C.value;Xe!=null?br(_,!!C.multiple,Xe,!1):Ne!==!!C.multiple&&(C.defaultValue!=null?br(_,!!C.multiple,C.defaultValue,!0):br(_,!!C.multiple,C.multiple?[]:"",!1))}_[$g]=C}catch(ot){Rn(i,i.return,ot)}}break;case 6:if(Ui(l,i),Co(i),m&4){if(i.stateNode===null)throw Error(t(162));_=i.stateNode,C=i.memoizedProps;try{_.nodeValue=C}catch(ot){Rn(i,i.return,ot)}}break;case 3:if(Ui(l,i),Co(i),m&4&&h!==null&&h.memoizedState.isDehydrated)try{Oi(l.containerInfo)}catch(ot){Rn(i,i.return,ot)}break;case 4:Ui(l,i),Co(i);break;case 13:Ui(l,i),Co(i),_=i.child,_.flags&8192&&(C=_.memoizedState!==null,_.stateNode.isHidden=C,!C||_.alternate!==null&&_.alternate.memoizedState!==null||(x_=qt())),m&4&&X1(i);break;case 22:if(Ie=h!==null&&h.memoizedState!==null,i.mode&1?(Ur=(we=Ur)||Ie,Ui(l,i),Ur=we):Ui(l,i),Co(i),m&8192){if(we=i.memoizedState!==null,(i.stateNode.isHidden=we)&&!Ie&&(i.mode&1)!==0)for(Qe=i,Ie=i.child;Ie!==null;){for(je=Qe=Ie;Qe!==null;){switch(Ne=Qe,Xe=Ne.child,Ne.tag){case 0:case 11:case 14:case 15:Jg(4,Ne,Ne.return);break;case 1:nf(Ne,Ne.return);var nt=Ne.stateNode;if(typeof nt.componentWillUnmount=="function"){m=Ne,h=Ne.return;try{l=m,nt.props=l.memoizedProps,nt.state=l.memoizedState,nt.componentWillUnmount()}catch(ot){Rn(m,h,ot)}}break;case 5:nf(Ne,Ne.return);break;case 22:if(Ne.memoizedState!==null){Z1(je);continue}}Xe!==null?(Xe.return=Ne,Qe=Xe):Z1(je)}Ie=Ie.sibling}e:for(Ie=null,je=i;;){if(je.tag===5){if(Ie===null){Ie=je;try{_=je.stateNode,we?(C=_.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none"):(q=je.stateNode,Y=je.memoizedProps.style,D=Y!=null&&Y.hasOwnProperty("display")?Y.display:null,q.style.display=hu("display",D))}catch(ot){Rn(i,i.return,ot)}}}else if(je.tag===6){if(Ie===null)try{je.stateNode.nodeValue=we?"":je.memoizedProps}catch(ot){Rn(i,i.return,ot)}}else if((je.tag!==22&&je.tag!==23||je.memoizedState===null||je===i)&&je.child!==null){je.child.return=je,je=je.child;continue}if(je===i)break e;for(;je.sibling===null;){if(je.return===null||je.return===i)break e;Ie===je&&(Ie=null),je=je.return}Ie===je&&(Ie=null),je.sibling.return=je.return,je=je.sibling}}break;case 19:Ui(l,i),Co(i),m&4&&X1(i);break;case 21:break;default:Ui(l,i),Co(i)}}function Co(i){var l=i.flags;if(l&2){try{e:{for(var h=i.return;h!==null;){if(W1(h)){var m=h;break e}h=h.return}throw Error(t(160))}switch(m.tag){case 5:var _=m.stateNode;m.flags&32&&(ia(_,""),m.flags&=-33);var C=G1(i);v_(i,C,_);break;case 3:case 4:var D=m.stateNode.containerInfo,q=G1(i);y_(i,q,D);break;default:throw Error(t(161))}}catch(Y){Rn(i,i.return,Y)}i.flags&=-3}l&4096&&(i.flags&=-4097)}function PI(i,l,h){Qe=i,J1(i)}function J1(i,l,h){for(var m=(i.mode&1)!==0;Qe!==null;){var _=Qe,C=_.child;if(_.tag===22&&m){var D=_.memoizedState!==null||Hv;if(!D){var q=_.alternate,Y=q!==null&&q.memoizedState!==null||Ur;q=Hv;var we=Ur;if(Hv=D,(Ur=Y)&&!we)for(Qe=_;Qe!==null;)D=Qe,Y=D.child,D.tag===22&&D.memoizedState!==null?ek(_):Y!==null?(Y.return=D,Qe=Y):ek(_);for(;C!==null;)Qe=C,J1(C),C=C.sibling;Qe=_,Hv=q,Ur=we}Q1(i)}else(_.subtreeFlags&8772)!==0&&C!==null?(C.return=_,Qe=C):Q1(i)}}function Q1(i){for(;Qe!==null;){var l=Qe;if((l.flags&8772)!==0){var h=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:Ur||qv(5,l);break;case 1:var m=l.stateNode;if(l.flags&4&&!Ur)if(h===null)m.componentDidMount();else{var _=l.elementType===l.type?h.memoizedProps:Bi(l.type,h.memoizedProps);m.componentDidUpdate(_,h.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var C=l.updateQueue;C!==null&&ZA(l,C,m);break;case 3:var D=l.updateQueue;if(D!==null){if(h=null,l.child!==null)switch(l.child.tag){case 5:h=l.child.stateNode;break;case 1:h=l.child.stateNode}ZA(l,D,h)}break;case 5:var q=l.stateNode;if(h===null&&l.flags&4){h=q;var Y=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":Y.autoFocus&&h.focus();break;case"img":Y.src&&(h.src=Y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var we=l.alternate;if(we!==null){var Ie=we.memoizedState;if(Ie!==null){var je=Ie.dehydrated;je!==null&&Oi(je)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Ur||l.flags&512&&m_(l)}catch(Ne){Rn(l,l.return,Ne)}}if(l===i){Qe=null;break}if(h=l.sibling,h!==null){h.return=l.return,Qe=h;break}Qe=l.return}}function Z1(i){for(;Qe!==null;){var l=Qe;if(l===i){Qe=null;break}var h=l.sibling;if(h!==null){h.return=l.return,Qe=h;break}Qe=l.return}}function ek(i){for(;Qe!==null;){var l=Qe;try{switch(l.tag){case 0:case 11:case 15:var h=l.return;try{qv(4,l)}catch(Y){Rn(l,h,Y)}break;case 1:var m=l.stateNode;if(typeof m.componentDidMount=="function"){var _=l.return;try{m.componentDidMount()}catch(Y){Rn(l,_,Y)}}var C=l.return;try{m_(l)}catch(Y){Rn(l,C,Y)}break;case 5:var D=l.return;try{m_(l)}catch(Y){Rn(l,D,Y)}}}catch(Y){Rn(l,l.return,Y)}if(l===i){Qe=null;break}var q=l.sibling;if(q!==null){q.return=l.return,Qe=q;break}Qe=l.return}}var RI=Math.ceil,Vv=F.ReactCurrentDispatcher,b_=F.ReactCurrentOwner,ci=F.ReactCurrentBatchConfig,Bt=0,ur=null,zn=null,Sr=0,Is=0,rf=Zl(0),Zn=0,Qg=null,Mu=0,Wv=0,w_=0,Zg=null,ps=null,x_=0,sf=1/0,Pa=null,Gv=!1,__=null,ic=null,Kv=!1,oc=null,Xv=0,em=0,S_=null,Yv=-1,Jv=0;function ts(){return(Bt&6)!==0?qt():Yv!==-1?Yv:Yv=qt()}function ac(i){return(i.mode&1)===0?1:(Bt&2)!==0&&Sr!==0?Sr&-Sr:pI.transition!==null?(Jv===0&&(Jv=ga()),Jv):(i=Ft,i!==0||(i=window.event,i=i===void 0?16:Eu(i.type)),i)}function zi(i,l,h,m){if(50<em)throw em=0,S_=null,Error(t(185));ma(i,h,m),((Bt&2)===0||i!==ur)&&(i===ur&&((Bt&2)===0&&(Wv|=h),Zn===4&&lc(i,Sr)),gs(i,m),h===1&&Bt===0&&(l.mode&1)===0&&(sf=qt()+500,Av&&tc()))}function gs(i,l){var h=i.callbackNode;bu(i,l);var m=vu(i,i===ur?Sr:0);if(m===0)h!==null&&Ch(h),i.callbackNode=null,i.callbackPriority=0;else if(l=m&-m,i.callbackPriority!==l){if(h!=null&&Ch(h),l===1)i.tag===0?fI(nk.bind(null,i)):UA(nk.bind(null,i)),cI(function(){(Bt&6)===0&&tc()}),h=null;else{switch(wg(m)){case 1:h=yo;break;case 4:h=gu;break;case 16:h=Ll;break;case 536870912:h=vo;break;default:h=Ll}h=uk(h,tk.bind(null,i))}i.callbackPriority=l,i.callbackNode=h}}function tk(i,l){if(Yv=-1,Jv=0,(Bt&6)!==0)throw Error(t(327));var h=i.callbackNode;if(of()&&i.callbackNode!==h)return null;var m=vu(i,i===ur?Sr:0);if(m===0)return null;if((m&30)!==0||(m&i.expiredLanes)!==0||l)l=Qv(i,m);else{l=m;var _=Bt;Bt|=2;var C=sk();(ur!==i||Sr!==l)&&(Pa=null,sf=qt()+500,Lu(i,l));do try{jI();break}catch(q){rk(i,q)}while(!0);Ux(),Vv.current=C,Bt=_,zn!==null?l=0:(ur=null,Sr=0,l=Zn)}if(l!==0){if(l===2&&(_=pa(i),_!==0&&(m=_,l=E_(i,_))),l===1)throw h=Qg,Lu(i,0),lc(i,m),gs(i,qt()),h;if(l===6)lc(i,m);else{if(_=i.current.alternate,(m&30)===0&&!II(_)&&(l=Qv(i,m),l===2&&(C=pa(i),C!==0&&(m=C,l=E_(i,C))),l===1))throw h=Qg,Lu(i,0),lc(i,m),gs(i,qt()),h;switch(i.finishedWork=_,i.finishedLanes=m,l){case 0:case 1:throw Error(t(345));case 2:Fu(i,ps,Pa);break;case 3:if(lc(i,m),(m&130023424)===m&&(l=x_+500-qt(),10<l)){if(vu(i,0)!==0)break;if(_=i.suspendedLanes,(_&m)!==m){ts(),i.pingedLanes|=i.suspendedLanes&_;break}i.timeoutHandle=Px(Fu.bind(null,i,ps,Pa),l);break}Fu(i,ps,Pa);break;case 4:if(lc(i,m),(m&4194240)===m)break;for(l=i.eventTimes,_=-1;0<m;){var D=31-gt(m);C=1<<D,D=l[D],D>_&&(_=D),m&=~C}if(m=_,m=qt()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*RI(m/1960))-m,10<m){i.timeoutHandle=Px(Fu.bind(null,i,ps,Pa),m);break}Fu(i,ps,Pa);break;case 5:Fu(i,ps,Pa);break;default:throw Error(t(329))}}}return gs(i,qt()),i.callbackNode===h?tk.bind(null,i):null}function E_(i,l){var h=Zg;return i.current.memoizedState.isDehydrated&&(Lu(i,l).flags|=256),i=Qv(i,l),i!==2&&(l=ps,ps=h,l!==null&&A_(l)),i}function A_(i){ps===null?ps=i:ps.push.apply(ps,i)}function II(i){for(var l=i;;){if(l.flags&16384){var h=l.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var m=0;m<h.length;m++){var _=h[m],C=_.getSnapshot;_=_.value;try{if(!X(C(),_))return!1}catch{return!1}}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===i)break;for(;l.sibling===null;){if(l.return===null||l.return===i)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function lc(i,l){for(l&=~w_,l&=~Wv,i.suspendedLanes|=l,i.pingedLanes&=~l,i=i.expirationTimes;0<l;){var h=31-gt(l),m=1<<h;i[h]=-1,l&=~m}}function nk(i){if((Bt&6)!==0)throw Error(t(327));of();var l=vu(i,0);if((l&1)===0)return gs(i,qt()),null;var h=Qv(i,l);if(i.tag!==0&&h===2){var m=pa(i);m!==0&&(l=m,h=E_(i,m))}if(h===1)throw h=Qg,Lu(i,0),lc(i,l),gs(i,qt()),h;if(h===6)throw Error(t(345));return i.finishedWork=i.current.alternate,i.finishedLanes=l,Fu(i,ps,Pa),gs(i,qt()),null}function k_(i,l){var h=Bt;Bt|=1;try{return i(l)}finally{Bt=h,Bt===0&&(sf=qt()+500,Av&&tc())}}function Du(i){oc!==null&&oc.tag===0&&(Bt&6)===0&&of();var l=Bt;Bt|=1;var h=ci.transition,m=Ft;try{if(ci.transition=null,Ft=1,i)return i()}finally{Ft=m,ci.transition=h,Bt=l,(Bt&6)===0&&tc()}}function C_(){Is=rf.current,mn(rf)}function Lu(i,l){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,lI(h)),zn!==null)for(h=zn.return;h!==null;){var m=h;switch(Dx(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&Sv();break;case 3:ef(),mn(ds),mn(Fr),Xx();break;case 5:Gx(m);break;case 4:ef();break;case 13:mn(kn);break;case 19:mn(kn);break;case 10:zx(m.type._context);break;case 22:case 23:C_()}h=h.return}if(ur=i,zn=i=cc(i.current,null),Sr=Is=l,Zn=0,Qg=null,w_=Wv=Mu=0,ps=Zg=null,Iu!==null){for(l=0;l<Iu.length;l++)if(h=Iu[l],m=h.interleaved,m!==null){h.interleaved=null;var _=m.next,C=h.pending;if(C!==null){var D=C.next;C.next=_,m.next=D}h.pending=m}Iu=null}return i}function rk(i,l){do{var h=zn;try{if(Ux(),Mv.current=Bv,Dv){for(var m=Cn.memoizedState;m!==null;){var _=m.queue;_!==null&&(_.pending=null),m=m.next}Dv=!1}if(ju=0,cr=Qn=Cn=null,Wg=!1,Gg=0,b_.current=null,h===null||h.return===null){Zn=1,Qg=l,zn=null;break}e:{var C=i,D=h.return,q=h,Y=l;if(l=Sr,q.flags|=32768,Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){var we=Y,Ie=q,je=Ie.tag;if((Ie.mode&1)===0&&(je===0||je===11||je===15)){var Ne=Ie.alternate;Ne?(Ie.updateQueue=Ne.updateQueue,Ie.memoizedState=Ne.memoizedState,Ie.lanes=Ne.lanes):(Ie.updateQueue=null,Ie.memoizedState=null)}var Xe=T1(D);if(Xe!==null){Xe.flags&=-257,N1(Xe,D,q,C,l),Xe.mode&1&&C1(C,we,l),l=Xe,Y=we;var nt=l.updateQueue;if(nt===null){var ot=new Set;ot.add(Y),l.updateQueue=ot}else nt.add(Y);break e}else{if((l&1)===0){C1(C,we,l),T_();break e}Y=Error(t(426))}}else if(bn&&q.mode&1){var Fn=T1(D);if(Fn!==null){(Fn.flags&65536)===0&&(Fn.flags|=256),N1(Fn,D,q,C,l),Bx(tf(Y,q));break e}}C=Y=tf(Y,q),Zn!==4&&(Zn=2),Zg===null?Zg=[C]:Zg.push(C),C=D;do{switch(C.tag){case 3:C.flags|=65536,l&=-l,C.lanes|=l;var he=A1(C,Y,l);QA(C,he);break e;case 1:q=Y;var te=C.type,ye=C.stateNode;if((C.flags&128)===0&&(typeof te.getDerivedStateFromError=="function"||ye!==null&&typeof ye.componentDidCatch=="function"&&(ic===null||!ic.has(ye)))){C.flags|=65536,l&=-l,C.lanes|=l;var Fe=k1(C,q,l);QA(C,Fe);break e}}C=C.return}while(C!==null)}ok(h)}catch(ct){l=ct,zn===h&&h!==null&&(zn=h=h.return);continue}break}while(!0)}function sk(){var i=Vv.current;return Vv.current=Bv,i===null?Bv:i}function T_(){(Zn===0||Zn===3||Zn===2)&&(Zn=4),ur===null||(Mu&268435455)===0&&(Wv&268435455)===0||lc(ur,Sr)}function Qv(i,l){var h=Bt;Bt|=2;var m=sk();(ur!==i||Sr!==l)&&(Pa=null,Lu(i,l));do try{OI();break}catch(_){rk(i,_)}while(!0);if(Ux(),Bt=h,Vv.current=m,zn!==null)throw Error(t(261));return ur=null,Sr=0,Zn}function OI(){for(;zn!==null;)ik(zn)}function jI(){for(;zn!==null&&!En();)ik(zn)}function ik(i){var l=ck(i.alternate,i,Is);i.memoizedProps=i.pendingProps,l===null?ok(i):zn=l,b_.current=null}function ok(i){var l=i;do{var h=l.alternate;if(i=l.return,(l.flags&32768)===0){if(h=kI(h,l,Is),h!==null){zn=h;return}}else{if(h=CI(h,l),h!==null){h.flags&=32767,zn=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Zn=6,zn=null;return}}if(l=l.sibling,l!==null){zn=l;return}zn=l=i}while(l!==null);Zn===0&&(Zn=5)}function Fu(i,l,h){var m=Ft,_=ci.transition;try{ci.transition=null,Ft=1,MI(i,l,h,m)}finally{ci.transition=_,Ft=m}return null}function MI(i,l,h,m){do of();while(oc!==null);if((Bt&6)!==0)throw Error(t(327));h=i.finishedWork;var _=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(t(177));i.callbackNode=null,i.callbackPriority=0;var C=h.lanes|h.childLanes;if(Nh(i,C),i===ur&&(zn=ur=null,Sr=0),(h.subtreeFlags&2064)===0&&(h.flags&2064)===0||Kv||(Kv=!0,uk(Ll,function(){return of(),null})),C=(h.flags&15990)!==0,(h.subtreeFlags&15990)!==0||C){C=ci.transition,ci.transition=null;var D=Ft;Ft=1;var q=Bt;Bt|=4,b_.current=null,NI(i,h),Y1(h,i),le(Tx),_u=!!Cx,Tx=Cx=null,i.current=h,PI(h),fa(),Bt=q,Ft=D,ci.transition=C}else i.current=h;if(Kv&&(Kv=!1,oc=i,Xv=_),C=i.pendingLanes,C===0&&(ic=null),Z0(h.stateNode),gs(i,qt()),l!==null)for(m=i.onRecoverableError,h=0;h<l.length;h++)_=l[h],m(_.value,{componentStack:_.stack,digest:_.digest});if(Gv)throw Gv=!1,i=__,__=null,i;return(Xv&1)!==0&&i.tag!==0&&of(),C=i.pendingLanes,(C&1)!==0?i===S_?em++:(em=0,S_=i):em=0,tc(),null}function of(){if(oc!==null){var i=wg(Xv),l=ci.transition,h=Ft;try{if(ci.transition=null,Ft=16>i?16:i,oc===null)var m=!1;else{if(i=oc,oc=null,Xv=0,(Bt&6)!==0)throw Error(t(331));var _=Bt;for(Bt|=4,Qe=i.current;Qe!==null;){var C=Qe,D=C.child;if((Qe.flags&16)!==0){var q=C.deletions;if(q!==null){for(var Y=0;Y<q.length;Y++){var we=q[Y];for(Qe=we;Qe!==null;){var Ie=Qe;switch(Ie.tag){case 0:case 11:case 15:Jg(8,Ie,C)}var je=Ie.child;if(je!==null)je.return=Ie,Qe=je;else for(;Qe!==null;){Ie=Qe;var Ne=Ie.sibling,Xe=Ie.return;if(V1(Ie),Ie===we){Qe=null;break}if(Ne!==null){Ne.return=Xe,Qe=Ne;break}Qe=Xe}}}var nt=C.alternate;if(nt!==null){var ot=nt.child;if(ot!==null){nt.child=null;do{var Fn=ot.sibling;ot.sibling=null,ot=Fn}while(ot!==null)}}Qe=C}}if((C.subtreeFlags&2064)!==0&&D!==null)D.return=C,Qe=D;else e:for(;Qe!==null;){if(C=Qe,(C.flags&2048)!==0)switch(C.tag){case 0:case 11:case 15:Jg(9,C,C.return)}var he=C.sibling;if(he!==null){he.return=C.return,Qe=he;break e}Qe=C.return}}var te=i.current;for(Qe=te;Qe!==null;){D=Qe;var ye=D.child;if((D.subtreeFlags&2064)!==0&&ye!==null)ye.return=D,Qe=ye;else e:for(D=te;Qe!==null;){if(q=Qe,(q.flags&2048)!==0)try{switch(q.tag){case 0:case 11:case 15:qv(9,q)}}catch(ct){Rn(q,q.return,ct)}if(q===D){Qe=null;break e}var Fe=q.sibling;if(Fe!==null){Fe.return=q.return,Qe=Fe;break e}Qe=q.return}}if(Bt=_,tc(),Jr&&typeof Jr.onPostCommitFiberRoot=="function")try{Jr.onPostCommitFiberRoot(mu,i)}catch{}m=!0}return m}finally{Ft=h,ci.transition=l}}return!1}function ak(i,l,h){l=tf(h,l),l=A1(i,l,1),i=rc(i,l,1),l=ts(),i!==null&&(ma(i,1,l),gs(i,l))}function Rn(i,l,h){if(i.tag===3)ak(i,i,h);else for(;l!==null;){if(l.tag===3){ak(l,i,h);break}else if(l.tag===1){var m=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ic===null||!ic.has(m))){i=tf(h,i),i=k1(l,i,1),l=rc(l,i,1),i=ts(),l!==null&&(ma(l,1,i),gs(l,i));break}}l=l.return}}function DI(i,l,h){var m=i.pingCache;m!==null&&m.delete(l),l=ts(),i.pingedLanes|=i.suspendedLanes&h,ur===i&&(Sr&h)===h&&(Zn===4||Zn===3&&(Sr&130023424)===Sr&&500>qt()-x_?Lu(i,0):w_|=h),gs(i,l)}function lk(i,l){l===0&&((i.mode&1)===0?l=1:(l=yu,yu<<=1,(yu&130023424)===0&&(yu=4194304)));var h=ts();i=Ca(i,l),i!==null&&(ma(i,l,h),gs(i,h))}function LI(i){var l=i.memoizedState,h=0;l!==null&&(h=l.retryLane),lk(i,h)}function FI(i,l){var h=0;switch(i.tag){case 13:var m=i.stateNode,_=i.memoizedState;_!==null&&(h=_.retryLane);break;case 19:m=i.stateNode;break;default:throw Error(t(314))}m!==null&&m.delete(l),lk(i,h)}var ck;ck=function(i,l,h){if(i!==null)if(i.memoizedProps!==l.pendingProps||ds.current)fs=!0;else{if((i.lanes&h)===0&&(l.flags&128)===0)return fs=!1,AI(i,l,h);fs=(i.flags&131072)!==0}else fs=!1,bn&&(l.flags&1048576)!==0&&zA(l,Cv,l.index);switch(l.lanes=0,l.tag){case 2:var m=l.type;zv(i,l),i=l.pendingProps;var _=Gh(l,Fr.current);Zh(l,h),_=Qx(null,l,m,i,_,h);var C=Zx();return l.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,hs(m)?(C=!0,Ev(l)):C=!1,l.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,Vx(l),_.updater=$v,l.stateNode=_,_._reactInternals=l,i_(l,m,i,h),l=c_(null,l,m,!0,C,h)):(l.tag=0,bn&&C&&Mx(l),es(null,l,_,h),l=l.child),l;case 16:m=l.elementType;e:{switch(zv(i,l),i=l.pendingProps,_=m._init,m=_(m._payload),l.type=m,_=l.tag=$I(m),i=Bi(m,i),_){case 0:l=l_(null,l,m,i,h);break e;case 1:l=M1(null,l,m,i,h);break e;case 11:l=P1(null,l,m,i,h);break e;case 14:l=R1(null,l,m,Bi(m.type,i),h);break e}throw Error(t(306,m,""))}return l;case 0:return m=l.type,_=l.pendingProps,_=l.elementType===m?_:Bi(m,_),l_(i,l,m,_,h);case 1:return m=l.type,_=l.pendingProps,_=l.elementType===m?_:Bi(m,_),M1(i,l,m,_,h);case 3:e:{if(D1(l),i===null)throw Error(t(387));m=l.pendingProps,C=l.memoizedState,_=C.element,JA(i,l),Ov(l,m,null,h);var D=l.memoizedState;if(m=D.element,C.isDehydrated)if(C={element:m,isDehydrated:!1,cache:D.cache,pendingSuspenseBoundaries:D.pendingSuspenseBoundaries,transitions:D.transitions},l.updateQueue.baseState=C,l.memoizedState=C,l.flags&256){_=tf(Error(t(423)),l),l=L1(i,l,m,h,_);break e}else if(m!==_){_=tf(Error(t(424)),l),l=L1(i,l,m,h,_);break e}else for(Rs=Ql(l.stateNode.containerInfo.firstChild),Ps=l,bn=!0,Fi=null,h=XA(l,null,m,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Yh(),m===_){l=Na(i,l,h);break e}es(i,l,m,h)}l=l.child}return l;case 5:return e1(l),i===null&&Fx(l),m=l.type,_=l.pendingProps,C=i!==null?i.memoizedProps:null,D=_.children,Nx(m,_)?D=null:C!==null&&Nx(m,C)&&(l.flags|=32),j1(i,l),es(i,l,D,h),l.child;case 6:return i===null&&Fx(l),null;case 13:return F1(i,l,h);case 4:return Wx(l,l.stateNode.containerInfo),m=l.pendingProps,i===null?l.child=Jh(l,null,m,h):es(i,l,m,h),l.child;case 11:return m=l.type,_=l.pendingProps,_=l.elementType===m?_:Bi(m,_),P1(i,l,m,_,h);case 7:return es(i,l,l.pendingProps,h),l.child;case 8:return es(i,l,l.pendingProps.children,h),l.child;case 12:return es(i,l,l.pendingProps.children,h),l.child;case 10:e:{if(m=l.type._context,_=l.pendingProps,C=l.memoizedProps,D=_.value,cn(Pv,m._currentValue),m._currentValue=D,C!==null)if(X(C.value,D)){if(C.children===_.children&&!ds.current){l=Na(i,l,h);break e}}else for(C=l.child,C!==null&&(C.return=l);C!==null;){var q=C.dependencies;if(q!==null){D=C.child;for(var Y=q.firstContext;Y!==null;){if(Y.context===m){if(C.tag===1){Y=Ta(-1,h&-h),Y.tag=2;var we=C.updateQueue;if(we!==null){we=we.shared;var Ie=we.pending;Ie===null?Y.next=Y:(Y.next=Ie.next,Ie.next=Y),we.pending=Y}}C.lanes|=h,Y=C.alternate,Y!==null&&(Y.lanes|=h),Hx(C.return,h,l),q.lanes|=h;break}Y=Y.next}}else if(C.tag===10)D=C.type===l.type?null:C.child;else if(C.tag===18){if(D=C.return,D===null)throw Error(t(341));D.lanes|=h,q=D.alternate,q!==null&&(q.lanes|=h),Hx(D,h,l),D=C.sibling}else D=C.child;if(D!==null)D.return=C;else for(D=C;D!==null;){if(D===l){D=null;break}if(C=D.sibling,C!==null){C.return=D.return,D=C;break}D=D.return}C=D}es(i,l,_.children,h),l=l.child}return l;case 9:return _=l.type,m=l.pendingProps.children,Zh(l,h),_=ai(_),m=m(_),l.flags|=1,es(i,l,m,h),l.child;case 14:return m=l.type,_=Bi(m,l.pendingProps),_=Bi(m.type,_),R1(i,l,m,_,h);case 15:return I1(i,l,l.type,l.pendingProps,h);case 17:return m=l.type,_=l.pendingProps,_=l.elementType===m?_:Bi(m,_),zv(i,l),l.tag=1,hs(m)?(i=!0,Ev(l)):i=!1,Zh(l,h),S1(l,m,_),i_(l,m,_,h),c_(null,l,m,!0,i,h);case 19:return $1(i,l,h);case 22:return O1(i,l,h)}throw Error(t(156,l.tag))};function uk(i,l){return vg(i,l)}function BI(i,l,h,m){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ui(i,l,h,m){return new BI(i,l,h,m)}function N_(i){return i=i.prototype,!(!i||!i.isReactComponent)}function $I(i){if(typeof i=="function")return N_(i)?1:0;if(i!=null){if(i=i.$$typeof,i===re)return 11;if(i===_e)return 14}return 2}function cc(i,l){var h=i.alternate;return h===null?(h=ui(i.tag,l,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=l,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,l=i.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function Zv(i,l,h,m,_,C){var D=2;if(m=i,typeof i=="function")N_(i)&&(D=1);else if(typeof i=="string")D=5;else e:switch(i){case H:return Bu(h.children,_,C,l);case W:D=8,_|=8;break;case ae:return i=ui(12,h,l,_|2),i.elementType=ae,i.lanes=C,i;case xe:return i=ui(13,h,l,_),i.elementType=xe,i.lanes=C,i;case ve:return i=ui(19,h,l,_),i.elementType=ve,i.lanes=C,i;case fe:return eb(h,_,C,l);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case me:D=10;break e;case ne:D=9;break e;case re:D=11;break e;case _e:D=14;break e;case pe:D=16,m=null;break e}throw Error(t(130,i==null?i:typeof i,""))}return l=ui(D,h,l,_),l.elementType=i,l.type=m,l.lanes=C,l}function Bu(i,l,h,m){return i=ui(7,i,m,l),i.lanes=h,i}function eb(i,l,h,m){return i=ui(22,i,m,l),i.elementType=fe,i.lanes=h,i.stateNode={isHidden:!1},i}function P_(i,l,h){return i=ui(6,i,null,l),i.lanes=h,i}function R_(i,l,h){return l=ui(4,i.children!==null?i.children:[],i.key,l),l.lanes=h,l.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},l}function UI(i,l,h,m,_){this.tag=l,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wu(0),this.expirationTimes=wu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wu(0),this.identifierPrefix=m,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function I_(i,l,h,m,_,C,D,q,Y){return i=new UI(i,l,h,q,Y),l===1?(l=1,C===!0&&(l|=8)):l=0,C=ui(3,null,null,l),i.current=C,C.stateNode=i,C.memoizedState={element:m,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},Vx(C),i}function zI(i,l,h){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$,key:m==null?null:""+m,children:i,containerInfo:l,implementation:h}}function dk(i){if(!i)return ec;i=i._reactInternals;e:{if(Dr(i)!==i||i.tag!==1)throw Error(t(170));var l=i;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(hs(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(t(171))}if(i.tag===1){var h=i.type;if(hs(h))return BA(i,h,l)}return l}function hk(i,l,h,m,_,C,D,q,Y){return i=I_(h,m,!0,i,_,C,D,q,Y),i.context=dk(null),h=i.current,m=ts(),_=ac(h),C=Ta(m,_),C.callback=l??null,rc(h,C,_),i.current.lanes=_,ma(i,_,m),gs(i,m),i}function tb(i,l,h,m){var _=l.current,C=ts(),D=ac(_);return h=dk(h),l.context===null?l.context=h:l.pendingContext=h,l=Ta(C,D),l.payload={element:i},m=m===void 0?null:m,m!==null&&(l.callback=m),i=rc(_,l,D),i!==null&&(zi(i,_,D,C),Iv(i,_,D)),D}function nb(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function fk(i,l){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<l?h:l}}function O_(i,l){fk(i,l),(i=i.alternate)&&fk(i,l)}function HI(){return null}var pk=typeof reportError=="function"?reportError:function(i){console.error(i)};function j_(i){this._internalRoot=i}rb.prototype.render=j_.prototype.render=function(i){var l=this._internalRoot;if(l===null)throw Error(t(409));tb(i,l,null,null)},rb.prototype.unmount=j_.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var l=i.containerInfo;Du(function(){tb(null,i,null,null)}),l[Sa]=null}};function rb(i){this._internalRoot=i}rb.prototype.unstable_scheduleHydration=function(i){if(i){var l=rv();i={blockedOn:null,target:i,priority:l};for(var h=0;h<Xn.length&&l!==0&&l<Xn[h].priority;h++);Xn.splice(h,0,i),h===0&&iv(i)}};function M_(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function sb(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function gk(){}function qI(i,l,h,m,_){if(_){if(typeof m=="function"){var C=m;m=function(){var we=nb(D);C.call(we)}}var D=hk(l,m,i,0,null,!1,!1,"",gk);return i._reactRootContainer=D,i[Sa]=D.current,Fg(i.nodeType===8?i.parentNode:i),Du(),D}for(;_=i.lastChild;)i.removeChild(_);if(typeof m=="function"){var q=m;m=function(){var we=nb(Y);q.call(we)}}var Y=I_(i,0,!1,null,null,!1,!1,"",gk);return i._reactRootContainer=Y,i[Sa]=Y.current,Fg(i.nodeType===8?i.parentNode:i),Du(function(){tb(l,Y,h,m)}),Y}function ib(i,l,h,m,_){var C=h._reactRootContainer;if(C){var D=C;if(typeof _=="function"){var q=_;_=function(){var Y=nb(D);q.call(Y)}}tb(l,D,i,_)}else D=qI(h,l,i,_,m);return nb(D)}nv=function(i){switch(i.tag){case 3:var l=i.stateNode;if(l.current.memoizedState.isDehydrated){var h=Fl(l.pendingLanes);h!==0&&(Ph(l,h|1),gs(l,qt()),(Bt&6)===0&&(sf=qt()+500,tc()))}break;case 13:Du(function(){var m=Ca(i,1);if(m!==null){var _=ts();zi(m,i,1,_)}}),O_(i,1)}},Ot=function(i){if(i.tag===13){var l=Ca(i,134217728);if(l!==null){var h=ts();zi(l,i,134217728,h)}O_(i,134217728)}},xg=function(i){if(i.tag===13){var l=ac(i),h=Ca(i,l);if(h!==null){var m=ts();zi(h,i,l,m)}O_(i,l)}},rv=function(){return Ft},sv=function(i,l){var h=Ft;try{return Ft=i,l()}finally{Ft=h}},He=function(i,l,h){switch(l){case"input":if(Nt(i,h),l=h.name,h.type==="radio"&&l!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<h.length;l++){var m=h[l];if(m!==i&&m.form===i.form){var _=_v(m);if(!_)throw Error(t(90));tt(m),Nt(m,_)}}}break;case"textarea":gg(i,h);break;case"select":l=h.value,l!=null&&br(i,!!h.multiple,l,!1)}},X0=k_,Y0=Du;var VI={usingClientEntryPoint:!1,Events:[Ug,Vh,_v,mg,kh,k_]},tm={findFiberByHostInstance:Tu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},WI={bundleType:tm.bundleType,version:tm.version,rendererPackageName:tm.rendererPackageName,rendererConfig:tm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:F.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=yg(i),i===null?null:i.stateNode},findFiberByHostInstance:tm.findFiberByHostInstance||HI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ob=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ob.isDisabled&&ob.supportsFiber)try{mu=ob.inject(WI),Jr=ob}catch{}}return ms.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VI,ms.createPortal=function(i,l){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!M_(l))throw Error(t(200));return zI(i,l,null,h)},ms.createRoot=function(i,l){if(!M_(i))throw Error(t(299));var h=!1,m="",_=pk;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onRecoverableError!==void 0&&(_=l.onRecoverableError)),l=I_(i,1,!1,null,null,h,!1,m,_),i[Sa]=l.current,Fg(i.nodeType===8?i.parentNode:i),new j_(l)},ms.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var l=i._reactInternals;if(l===void 0)throw typeof i.render=="function"?Error(t(188)):(i=Object.keys(i).join(","),Error(t(268,i)));return i=yg(l),i=i===null?null:i.stateNode,i},ms.flushSync=function(i){return Du(i)},ms.hydrate=function(i,l,h){if(!sb(l))throw Error(t(200));return ib(null,i,l,!0,h)},ms.hydrateRoot=function(i,l,h){if(!M_(i))throw Error(t(405));var m=h!=null&&h.hydratedSources||null,_=!1,C="",D=pk;if(h!=null&&(h.unstable_strictMode===!0&&(_=!0),h.identifierPrefix!==void 0&&(C=h.identifierPrefix),h.onRecoverableError!==void 0&&(D=h.onRecoverableError)),l=hk(l,null,i,1,h??null,_,!1,C,D),i[Sa]=l.current,Fg(i),m)for(i=0;i<m.length;i++)h=m[i],_=h._getVersion,_=_(h._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[h,_]:l.mutableSourceEagerHydrationData.push(h,_);return new rb(l)},ms.render=function(i,l,h){if(!sb(l))throw Error(t(200));return ib(null,i,l,!1,h)},ms.unmountComponentAtNode=function(i){if(!sb(i))throw Error(t(40));return i._reactRootContainer?(Du(function(){ib(null,null,i,!1,function(){i._reactRootContainer=null,i[Sa]=null})}),!0):!1},ms.unstable_batchedUpdates=k_,ms.unstable_renderSubtreeIntoContainer=function(i,l,h,m){if(!sb(h))throw Error(t(200));if(i==null||i._reactInternals===void 0)throw Error(t(38));return ib(i,l,h,!1,m)},ms.version="18.3.1-next-f1338f8080-20240426",ms}var Ek;function s2(){if(Ek)return B_.exports;Ek=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),B_.exports=r2(),B_.exports}var Ak;function i2(){if(Ak)return ab;Ak=1;var a=s2();return ab.createRoot=a.createRoot,ab.hydrateRoot=a.hydrateRoot,ab}var o2=i2();/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a2=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l2=a=>a.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),kk=a=>{const e=l2(a);return e.charAt(0).toUpperCase()+e.slice(1)},aT=(...a)=>a.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),c2=a=>{for(const e in a)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var u2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d2=ue.forwardRef(({color:a="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:s,iconNode:o,...u},d)=>ue.createElement("svg",{ref:d,...u2,width:e,height:e,stroke:a,strokeWidth:n?Number(t)*24/Number(e):t,className:aT("lucide",r),...!s&&!c2(u)&&{"aria-hidden":"true"},...u},[...o.map(([f,p])=>ue.createElement(f,p)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=(a,e)=>{const t=ue.forwardRef(({className:n,...r},s)=>ue.createElement(d2,{ref:s,iconNode:e,className:aT(`lucide-${a2(kk(a))}`,`lucide-${a}`,n),...r}));return t.displayName=kk(a),t};/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h2=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],kl=Wt("arrow-left",h2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f2=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],wl=Wt("book-open",f2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p2=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],lT=Wt("camera",p2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g2=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],lx=Wt("circle-alert",g2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m2=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],If=Wt("circle-check-big",m2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y2=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ck=Wt("circle-x",y2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v2=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]],b2=Wt("clipboard-check",v2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w2=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]],x2=Wt("cloud-off",w2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _2=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],S2=Wt("cloud",_2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E2=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],A2=Wt("columns-2",E2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k2=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],gw=Wt("download",k2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C2=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],Fm=Wt("file-image",C2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T2=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}]],N2=Wt("file-question-mark",T2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P2=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Tk=Wt("image",P2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R2=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],I2=Wt("info",R2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O2=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],j2=Wt("layers",O2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M2=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],ri=Wt("loader",M2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D2=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],L2=Wt("mic-off",D2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F2=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],B2=Wt("mic",F2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $2=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],mw=Wt("pen",$2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U2=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Of=Wt("plus",U2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z2=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],cT=Wt("refresh-cw",z2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H2=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],z_=Wt("rotate-ccw",H2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q2=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],V2=Wt("settings",q2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W2=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],jf=Wt("sparkles",W2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G2=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],yw=Wt("trash-2",G2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K2=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Nk=Wt("triangle-alert",K2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X2=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Y2=Wt("upload",X2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J2=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Q2=Wt("user",J2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z2=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],nA=Wt("users",Z2);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eO=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Bm=Wt("x",eO);var Tb={exports:{}},tO=Tb.exports,Pk;function nO(){return Pk||(Pk=1,(function(a,e){(function(t,n){a.exports=n()})(tO,function(){var t=function(g,b){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,P){A.__proto__=P}||function(A,P){for(var I in P)Object.prototype.hasOwnProperty.call(P,I)&&(A[I]=P[I])})(g,b)},n=function(){return(n=Object.assign||function(g){for(var b,A=1,P=arguments.length;A<P;A++)for(var I in b=arguments[A])Object.prototype.hasOwnProperty.call(b,I)&&(g[I]=b[I]);return g}).apply(this,arguments)};function r(g,b,A){for(var P,I=0,M=b.length;I<M;I++)!P&&I in b||((P=P||Array.prototype.slice.call(b,0,I))[I]=b[I]);return g.concat(P||Array.prototype.slice.call(b))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:JI,o=Object.keys,u=Array.isArray;function d(g,b){return typeof b!="object"||o(b).forEach(function(A){g[A]=b[A]}),g}typeof Promise>"u"||s.Promise||(s.Promise=Promise);var f=Object.getPrototypeOf,p={}.hasOwnProperty;function y(g,b){return p.call(g,b)}function v(g,b){typeof b=="function"&&(b=b(f(g))),(typeof Reflect>"u"?o:Reflect.ownKeys)(b).forEach(function(A){S(g,A,b[A])})}var x=Object.defineProperty;function S(g,b,A,P){x(g,b,d(A&&y(A,"get")&&typeof A.get=="function"?{get:A.get,set:A.set,configurable:!0}:{value:A,configurable:!0,writable:!0},P))}function E(g){return{from:function(b){return g.prototype=Object.create(b.prototype),S(g.prototype,"constructor",g),{extend:v.bind(null,g.prototype)}}}}var T=Object.getOwnPropertyDescriptor,N=[].slice;function L(g,b,A){return N.call(g,b,A)}function j(g,b){return b(g)}function F(g){if(!g)throw new Error("Assertion Failed")}function B(g){s.setImmediate?setImmediate(g):setTimeout(g,0)}function $(g,b){if(typeof b=="string"&&y(g,b))return g[b];if(!b)return g;if(typeof b!="string"){for(var A=[],P=0,I=b.length;P<I;++P){var M=$(g,b[P]);A.push(M)}return A}var U=b.indexOf(".");if(U!==-1){var V=g[b.substr(0,U)];return V==null?void 0:$(V,b.substr(U+1))}}function H(g,b,A){if(g&&b!==void 0&&!("isFrozen"in Object&&Object.isFrozen(g)))if(typeof b!="string"&&"length"in b){F(typeof A!="string"&&"length"in A);for(var P=0,I=b.length;P<I;++P)H(g,b[P],A[P])}else{var M,U,V=b.indexOf(".");V!==-1?(M=b.substr(0,V),(U=b.substr(V+1))===""?A===void 0?u(g)&&!isNaN(parseInt(M))?g.splice(M,1):delete g[M]:g[M]=A:H(V=!(V=g[M])||!y(g,M)?g[M]={}:V,U,A)):A===void 0?u(g)&&!isNaN(parseInt(b))?g.splice(b,1):delete g[b]:g[b]=A}}function W(g){var b,A={};for(b in g)y(g,b)&&(A[b]=g[b]);return A}var ae=[].concat;function me(g){return ae.apply([],g)}var lo="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(me([8,16,32,64].map(function(g){return["Int","Uint","Float"].map(function(b){return b+g+"Array"})}))).filter(function(g){return s[g]}),ne=new Set(lo.map(function(g){return s[g]})),re=null;function xe(g){return re=new WeakMap,g=(function b(A){if(!A||typeof A!="object")return A;var P=re.get(A);if(P)return P;if(u(A)){P=[],re.set(A,P);for(var I=0,M=A.length;I<M;++I)P.push(b(A[I]))}else if(ne.has(A.constructor))P=A;else{var U,V=f(A);for(U in P=V===Object.prototype?{}:Object.create(V),re.set(A,P),A)y(A,U)&&(P[U]=b(A[U]))}return P})(g),re=null,g}var ve={}.toString;function _e(g){return ve.call(g).slice(8,-1)}var pe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",fe=typeof pe=="symbol"?function(g){var b;return g!=null&&(b=g[pe])&&b.apply(g)}:function(){return null};function Z(g,b){return b=g.indexOf(b),0<=b&&g.splice(b,1),0<=b}var ke={};function Q(g){var b,A,P,I;if(arguments.length===1){if(u(g))return g.slice();if(this===ke&&typeof g=="string")return[g];if(I=fe(g)){for(A=[];!(P=I.next()).done;)A.push(P.value);return A}if(g==null)return[g];if(typeof(b=g.length)!="number")return[g];for(A=new Array(b);b--;)A[b]=g[b];return A}for(b=arguments.length,A=new Array(b);b--;)A[b]=arguments[b];return A}var z=typeof Symbol<"u"?function(g){return g[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Pl=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Zr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Pl),K={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Se(g,b){this.name=g,this.message=b}function Pe(g,b){return g+". Errors: "+Object.keys(b).map(function(A){return b[A].toString()}).filter(function(A,P,I){return I.indexOf(A)===P}).join(`
`)}function Ve(g,b,A,P){this.failures=b,this.failedKeys=P,this.successCount=A,this.message=Pe(g,b)}function We(g,b){this.name="BulkError",this.failures=Object.keys(b).map(function(A){return b[A]}),this.failuresByPos=b,this.message=Pe(g,this.failures)}E(Se).from(Error).extend({toString:function(){return this.name+": "+this.message}}),E(Ve).from(Se),E(We).from(Se);var be=Zr.reduce(function(g,b){return g[b]=b+"Error",g},{}),Te=Se,Ee=Zr.reduce(function(g,b){var A=b+"Error";function P(I,M){this.name=A,I?typeof I=="string"?(this.message="".concat(I).concat(M?`
 `+M:""),this.inner=M||null):typeof I=="object"&&(this.message="".concat(I.name," ").concat(I.message),this.inner=I):(this.message=K[b]||A,this.inner=null)}return E(P).from(Te),g[b]=P,g},{});Ee.Syntax=SyntaxError,Ee.Type=TypeError,Ee.Range=RangeError;var at=Pl.reduce(function(g,b){return g[b+"Error"]=Ee[b],g},{}),bt=Zr.reduce(function(g,b){return["Syntax","Type","Range"].indexOf(b)===-1&&(g[b+"Error"]=Ee[b]),g},{});function tt(){}function Ht(g){return g}function Le(g,b){return g==null||g===Ht?b:function(A){return b(g(A))}}function Ke(g,b){return function(){g.apply(this,arguments),b.apply(this,arguments)}}function Mt(g,b){return g===tt?b:function(){var A=g.apply(this,arguments);A!==void 0&&(arguments[0]=A);var P=this.onsuccess,I=this.onerror;this.onsuccess=null,this.onerror=null;var M=b.apply(this,arguments);return P&&(this.onsuccess=this.onsuccess?Ke(P,this.onsuccess):P),I&&(this.onerror=this.onerror?Ke(I,this.onerror):I),M!==void 0?M:A}}function Nt(g,b){return g===tt?b:function(){g.apply(this,arguments);var A=this.onsuccess,P=this.onerror;this.onsuccess=this.onerror=null,b.apply(this,arguments),A&&(this.onsuccess=this.onsuccess?Ke(A,this.onsuccess):A),P&&(this.onerror=this.onerror?Ke(P,this.onerror):P)}}function Tl(g,b){return g===tt?b:function(A){var P=g.apply(this,arguments);d(A,P);var I=this.onsuccess,M=this.onerror;return this.onsuccess=null,this.onerror=null,A=b.apply(this,arguments),I&&(this.onsuccess=this.onsuccess?Ke(I,this.onsuccess):I),M&&(this.onerror=this.onerror?Ke(M,this.onerror):M),P===void 0?A===void 0?void 0:A:d(P,A)}}function ra(g,b){return g===tt?b:function(){return b.apply(this,arguments)!==!1&&g.apply(this,arguments)}}function sa(g,b){return g===tt?b:function(){var A=g.apply(this,arguments);if(A&&typeof A.then=="function"){for(var P=this,I=arguments.length,M=new Array(I);I--;)M[I]=arguments[I];return A.then(function(){return b.apply(P,M)})}return b.apply(this,arguments)}}bt.ModifyError=Ve,bt.DexieError=Se,bt.BulkError=We;var br=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Sh(g){br=g}var Nl={},gg=100,lo=typeof Promise>"u"?[]:(function(){var g=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[g,f(g),g];var b=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[b,f(b),g]})(),Pl=lo[0],Zr=lo[1],lo=lo[2],Zr=Zr&&Zr.then,Ni=Pl&&Pl.constructor,Rl=!!lo,Il=function(g,b){aa.push([g,b]),co&&(queueMicrotask(Y0),co=!1)},ia=!0,co=!0,oa=[],hu=[],Eh=Ht,uo={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:tt,pgp:!1,env:{},finalize:tt},it=uo,aa=[],Pi=0,Ol=[];function He(g){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var b=this._PSD=it;if(typeof g!="function"){if(g!==Nl)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ah(this,this._value))}this._state=null,this._value=null,++b.ref,(function A(P,I){try{I(function(M){if(P._state===null){if(M===P)throw new TypeError("A promise cannot be resolved with itself.");var U=P._lib&&fo();M&&typeof M.then=="function"?A(P,function(V,J){M instanceof He?M._then(V,J):M.then(V,J)}):(P._state=!0,P._value=M,mg(P)),U&&ca()}},Ah.bind(null,P))}catch(M){Ah(P,M)}})(this,g)}var ho={get:function(){var g=it,b=Ml;function A(P,I){var M=this,U=!g.global&&(g!==it||b!==Ml),V=U&&!Dr(),J=new He(function(X,oe){kh(M,new la(vg(P,g,U,V),vg(I,g,U,V),X,oe,g))});return this._consoleTask&&(J._consoleTask=this._consoleTask),J}return A.prototype=Nl,A},set:function(g){S(this,"then",g&&g.prototype===Nl?ho:{get:function(){return g},set:ho.set})}};function la(g,b,A,P,I){this.onFulfilled=typeof g=="function"?g:null,this.onRejected=typeof b=="function"?b:null,this.resolve=A,this.reject=P,this.psd=I}function Ah(g,b){var A,P;hu.push(b),g._state===null&&(A=g._lib&&fo(),b=Eh(b),g._state=!1,g._value=b,P=g,oa.some(function(I){return I._value===P._value})||oa.push(P),mg(g),A&&ca())}function mg(g){var b=g._listeners;g._listeners=[];for(var A=0,P=b.length;A<P;++A)kh(g,b[A]);var I=g._PSD;--I.ref||I.finalize(),Pi===0&&(++Pi,Il(function(){--Pi==0&&ua()},[]))}function kh(g,b){if(g._state!==null){var A=g._state?b.onFulfilled:b.onRejected;if(A===null)return(g._state?b.resolve:b.reject)(g._value);++b.psd.ref,++Pi,Il(X0,[A,g,b])}else g._listeners.push(b)}function X0(g,b,A){try{var P,I=b._value;!b._state&&hu.length&&(hu=[]),P=br&&b._consoleTask?b._consoleTask.run(function(){return g(I)}):g(I),b._state||hu.indexOf(I)!==-1||(function(M){for(var U=oa.length;U;)if(oa[--U]._value===M._value)return oa.splice(U,1)})(b),A.resolve(P)}catch(M){A.reject(M)}finally{--Pi==0&&ua(),--A.psd.ref||A.psd.finalize()}}function Y0(){mo(uo,function(){fo()&&ca()})}function fo(){var g=ia;return co=ia=!1,g}function ca(){var g,b,A;do for(;0<aa.length;)for(g=aa,aa=[],A=g.length,b=0;b<A;++b){var P=g[b];P[0].apply(null,P[1])}while(0<aa.length);co=ia=!0}function ua(){var g=oa;oa=[],g.forEach(function(P){P._PSD.onunhandled.call(null,P._value,P)});for(var b=Ol.slice(0),A=b.length;A;)b[--A]()}function jl(g){return new He(Nl,!1,g)}function Gt(g,b){var A=it;return function(){var P=fo(),I=it;try{return go(A,!0),g.apply(this,arguments)}catch(M){b&&b(M)}finally{go(I,!1),P&&ca()}}}v(He.prototype,{then:ho,_then:function(g,b){kh(this,new la(null,null,g,b,it))},catch:function(g){if(arguments.length===1)return this.then(null,g);var b=g,A=arguments[1];return typeof b=="function"?this.then(null,function(P){return(P instanceof b?A:jl)(P)}):this.then(null,function(P){return(P&&P.name===b?A:jl)(P)})},finally:function(g){return this.then(function(b){return He.resolve(g()).then(function(){return b})},function(b){return He.resolve(g()).then(function(){return jl(b)})})},timeout:function(g,b){var A=this;return g<1/0?new He(function(P,I){var M=setTimeout(function(){return I(new Ee.Timeout(b))},g);A.then(P,I).finally(clearTimeout.bind(null,M))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&S(He.prototype,Symbol.toStringTag,"Dexie.Promise"),uo.env=yg(),v(He,{all:function(){var g=Q.apply(null,arguments).map(pu);return new He(function(b,A){g.length===0&&b([]);var P=g.length;g.forEach(function(I,M){return He.resolve(I).then(function(U){g[M]=U,--P||b(g)},A)})})},resolve:function(g){return g instanceof He?g:g&&typeof g.then=="function"?new He(function(b,A){g.then(b,A)}):new He(Nl,!0,g)},reject:jl,race:function(){var g=Q.apply(null,arguments).map(pu);return new He(function(b,A){g.map(function(P){return He.resolve(P).then(b,A)})})},PSD:{get:function(){return it},set:function(g){return it=g}},totalEchoes:{get:function(){return Ml}},newPSD:po,usePSD:mo,scheduler:{get:function(){return Il},set:function(g){Il=g}},rejectionMapper:{get:function(){return Eh},set:function(g){Eh=g}},follow:function(g,b){return new He(function(A,P){return po(function(I,M){var U=it;U.unhandleds=[],U.onunhandled=M,U.finalize=Ke(function(){var V,J=this;V=function(){J.unhandleds.length===0?I():M(J.unhandleds[0])},Ol.push(function X(){V(),Ol.splice(Ol.indexOf(X),1)}),++Pi,Il(function(){--Pi==0&&ua()},[])},U.finalize),g()},b,A,P)})}}),Ni&&(Ni.allSettled&&S(He,"allSettled",function(){var g=Q.apply(null,arguments).map(pu);return new He(function(b){g.length===0&&b([]);var A=g.length,P=new Array(A);g.forEach(function(I,M){return He.resolve(I).then(function(U){return P[M]={status:"fulfilled",value:U}},function(U){return P[M]={status:"rejected",reason:U}}).then(function(){return--A||b(P)})})})}),Ni.any&&typeof AggregateError<"u"&&S(He,"any",function(){var g=Q.apply(null,arguments).map(pu);return new He(function(b,A){g.length===0&&A(new AggregateError([]));var P=g.length,I=new Array(P);g.forEach(function(M,U){return He.resolve(M).then(function(V){return b(V)},function(V){I[U]=V,--P||A(new AggregateError(I))})})})}),Ni.withResolvers&&(He.withResolvers=Ni.withResolvers));var Un={awaits:0,echoes:0,id:0},fu=0,da=[],ha=0,Ml=0,bx=0;function po(g,b,A,P){var I=it,M=Object.create(I);return M.parent=I,M.ref=0,M.global=!1,M.id=++bx,uo.env,M.env=Rl?{Promise:He,PromiseProp:{value:He,configurable:!0,writable:!0},all:He.all,race:He.race,allSettled:He.allSettled,any:He.any,resolve:He.resolve,reject:He.reject}:{},b&&d(M,b),++I.ref,M.finalize=function(){--this.parent.ref||this.parent.finalize()},P=mo(M,g,A,P),M.ref===0&&M.finalize(),P}function Dl(){return Un.id||(Un.id=++fu),++Un.awaits,Un.echoes+=gg,Un.id}function Dr(){return!!Un.awaits&&(--Un.awaits==0&&(Un.id=0),Un.echoes=Un.awaits*gg,!0)}function pu(g){return Un.echoes&&g&&g.constructor===Ni?(Dl(),g.then(function(b){return Dr(),b},function(b){return Dr(),En(b)})):g}function J0(){var g=da[da.length-1];da.pop(),go(g,!1)}function go(g,b){var A,P=it;(b?!Un.echoes||ha++&&g===it:!ha||--ha&&g===it)||queueMicrotask(b?(function(I){++Ml,Un.echoes&&--Un.echoes!=0||(Un.echoes=Un.awaits=Un.id=0),da.push(it),go(I,!0)}).bind(null,g):J0),g!==it&&(it=g,P===uo&&(uo.env=yg()),Rl&&(A=uo.env.Promise,b=g.env,(P.global||g.global)&&(Object.defineProperty(s,"Promise",b.PromiseProp),A.all=b.all,A.race=b.race,A.resolve=b.resolve,A.reject=b.reject,b.allSettled&&(A.allSettled=b.allSettled),b.any&&(A.any=b.any))))}function yg(){var g=s.Promise;return Rl?{Promise:g,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:g.all,race:g.race,allSettled:g.allSettled,any:g.any,resolve:g.resolve,reject:g.reject}:{}}function mo(g,b,A,P,I){var M=it;try{return go(g,!0),b(A,P,I)}finally{go(M,!1)}}function vg(g,b,A,P){return typeof g!="function"?g:function(){var I=it;A&&Dl(),go(b,!0);try{return g.apply(this,arguments)}finally{go(I,!1),P&&queueMicrotask(Dr)}}}function Ch(g){Promise===Ni&&Un.echoes===0?ha===0?g():enqueueNativeMicroTask(g):setTimeout(g,0)}(""+Zr).indexOf("[native code]")===-1&&(Dl=Dr=tt);var En=He.reject,fa="",qt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Q0="String expected.",yo=[],gu="__dbnames",Ll="readonly",bg="readwrite";function vo(g,b){return g?b?function(){return g.apply(this,arguments)&&b.apply(this,arguments)}:g:b}var mu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Jr(g){return typeof g!="string"||/\./.test(g)?function(b){return b}:function(b){return b[g]===void 0&&g in b&&delete(b=xe(b))[g],b}}function Z0(){throw Ee.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function gt(g,b){try{var A=ev(g),P=ev(b);if(A!==P)return A==="Array"?1:P==="Array"?-1:A==="binary"?1:P==="binary"?-1:A==="string"?1:P==="string"?-1:A==="Date"?1:P!=="Date"?NaN:-1;switch(A){case"number":case"Date":case"string":return b<g?1:g<b?-1:0;case"binary":return(function(I,M){for(var U=I.length,V=M.length,J=U<V?U:V,X=0;X<J;++X)if(I[X]!==M[X])return I[X]<M[X]?-1:1;return U===V?0:U<V?-1:1})(tv(g),tv(b));case"Array":return(function(I,M){for(var U=I.length,V=M.length,J=U<V?U:V,X=0;X<J;++X){var oe=gt(I[X],M[X]);if(oe!==0)return oe}return U===V?0:U<V?-1:1})(g,b)}}catch{}return NaN}function ev(g){var b=typeof g;return b!="object"?b:ArrayBuffer.isView(g)?"binary":(g=_e(g),g==="ArrayBuffer"?"binary":g)}function tv(g){return g instanceof Uint8Array?g:ArrayBuffer.isView(g)?new Uint8Array(g.buffer,g.byteOffset,g.byteLength):new Uint8Array(g)}function Th(g,b,A){var P=g.schema.yProps;return P?(b&&0<A.numFailures&&(b=b.filter(function(I,M){return!A.failures[M]})),Promise.all(P.map(function(I){return I=I.updatesTable,b?g.db.table(I).where("k").anyOf(b).delete():g.db.table(I).clear()})).then(function(){return A})):A}var bo=(yu.prototype.execute=function(g){var b=this["@@propmod"];if(b.add!==void 0){var A=b.add;if(u(A))return r(r([],u(g)?g:[],!0),A).sort();if(typeof A=="number")return(Number(g)||0)+A;if(typeof A=="bigint")try{return BigInt(g)+A}catch{return BigInt(0)+A}throw new TypeError("Invalid term ".concat(A))}if(b.remove!==void 0){var P=b.remove;if(u(P))return u(g)?g.filter(function(I){return!P.includes(I)}).sort():[];if(typeof P=="number")return Number(g)-P;if(typeof P=="bigint")try{return BigInt(g)-P}catch{return BigInt(0)-P}throw new TypeError("Invalid subtrahend ".concat(P))}return A=(A=b.replacePrefix)===null||A===void 0?void 0:A[0],A&&typeof g=="string"&&g.startsWith(A)?b.replacePrefix[1]+g.substring(A.length):g},yu);function yu(g){this["@@propmod"]=g}function Fl(g,b){for(var A=o(b),P=A.length,I=!1,M=0;M<P;++M){var U=A[M],V=b[U],J=$(g,U);V instanceof bo?(H(g,U,V.execute(J)),I=!0):J!==V&&(H(g,U,V),I=!0)}return I}var vu=(Jt.prototype._trans=function(g,b,A){var P=this._tx||it.trans,I=this.name,M=br&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(g==="readonly"?"read":"write"," ").concat(this.name));function U(X,oe,G){if(!G.schema[I])throw new Ee.NotFound("Table "+I+" not part of transaction");return b(G.idbtrans,G)}var V=fo();try{var J=P&&P.db._novip===this.db._novip?P===it.trans?P._promise(g,U,A):po(function(){return P._promise(g,U,A)},{trans:P,transless:it.transless||it}):(function X(oe,G,ce,ee){if(oe.idbdb&&(oe._state.openComplete||it.letThrough||oe._vip)){var ie=oe._createTransaction(G,ce,oe._dbSchema);try{ie.create(),oe._state.PR1398_maxLoop=3}catch(se){return se.name===be.InvalidState&&oe.isOpen()&&0<--oe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),oe.close({disableAutoOpen:!1}),oe.open().then(function(){return X(oe,G,ce,ee)})):En(se)}return ie._promise(G,function(se,le){return po(function(){return it.trans=ie,ee(se,le,ie)})}).then(function(se){if(G==="readwrite")try{ie.idbtrans.commit()}catch{}return G==="readonly"?se:ie._completion.then(function(){return se})})}if(oe._state.openComplete)return En(new Ee.DatabaseClosed(oe._state.dbOpenError));if(!oe._state.isBeingOpened){if(!oe._state.autoOpen)return En(new Ee.DatabaseClosed);oe.open().catch(tt)}return oe._state.dbReadyPromise.then(function(){return X(oe,G,ce,ee)})})(this.db,g,[this.name],U);return M&&(J._consoleTask=M,J=J.catch(function(X){return console.trace(X),En(X)})),J}finally{V&&ca()}},Jt.prototype.get=function(g,b){var A=this;return g&&g.constructor===Object?this.where(g).first(b):g==null?En(new Ee.Type("Invalid argument to Table.get()")):this._trans("readonly",function(P){return A.core.get({trans:P,key:g}).then(function(I){return A.hook.reading.fire(I)})}).then(b)},Jt.prototype.where=function(g){if(typeof g=="string")return new this.db.WhereClause(this,g);if(u(g))return new this.db.WhereClause(this,"[".concat(g.join("+"),"]"));var b=o(g);if(b.length===1)return this.where(b[0]).equals(g[b[0]]);var A=this.schema.indexes.concat(this.schema.primKey).filter(function(V){if(V.compound&&b.every(function(X){return 0<=V.keyPath.indexOf(X)})){for(var J=0;J<b.length;++J)if(b.indexOf(V.keyPath[J])===-1)return!1;return!0}return!1}).sort(function(V,J){return V.keyPath.length-J.keyPath.length})[0];if(A&&this.db._maxKey!==fa){var M=A.keyPath.slice(0,b.length);return this.where(M).equals(M.map(function(J){return g[J]}))}!A&&br&&console.warn("The query ".concat(JSON.stringify(g)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(b.join("+"),"]"));var P=this.schema.idxByName;function I(V,J){return gt(V,J)===0}var U=b.reduce(function(G,J){var X=G[0],oe=G[1],G=P[J],ce=g[J];return[X||G,X||!G?vo(oe,G&&G.multi?function(ee){return ee=$(ee,J),u(ee)&&ee.some(function(ie){return I(ce,ie)})}:function(ee){return I(ce,$(ee,J))}):oe]},[null,null]),M=U[0],U=U[1];return M?this.where(M.name).equals(g[M.keyPath]).filter(U):A?this.filter(U):this.where(b).equals("")},Jt.prototype.filter=function(g){return this.toCollection().and(g)},Jt.prototype.count=function(g){return this.toCollection().count(g)},Jt.prototype.offset=function(g){return this.toCollection().offset(g)},Jt.prototype.limit=function(g){return this.toCollection().limit(g)},Jt.prototype.each=function(g){return this.toCollection().each(g)},Jt.prototype.toArray=function(g){return this.toCollection().toArray(g)},Jt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Jt.prototype.orderBy=function(g){return new this.db.Collection(new this.db.WhereClause(this,u(g)?"[".concat(g.join("+"),"]"):g))},Jt.prototype.reverse=function(){return this.toCollection().reverse()},Jt.prototype.mapToClass=function(g){var b,A=this.db,P=this.name;function I(){return b!==null&&b.apply(this,arguments)||this}(this.schema.mappedClass=g).prototype instanceof Z0&&((function(J,X){if(typeof X!="function"&&X!==null)throw new TypeError("Class extends value "+String(X)+" is not a constructor or null");function oe(){this.constructor=J}t(J,X),J.prototype=X===null?Object.create(X):(oe.prototype=X.prototype,new oe)})(I,b=g),Object.defineProperty(I.prototype,"db",{get:function(){return A},enumerable:!1,configurable:!0}),I.prototype.table=function(){return P},g=I);for(var M=new Set,U=g.prototype;U;U=f(U))Object.getOwnPropertyNames(U).forEach(function(J){return M.add(J)});function V(J){if(!J)return J;var X,oe=Object.create(g.prototype);for(X in J)if(!M.has(X))try{oe[X]=J[X]}catch{}return oe}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=V,this.hook("reading",V),g},Jt.prototype.defineClass=function(){return this.mapToClass(function(g){d(this,g)})},Jt.prototype.add=function(g,b){var A=this,P=this.schema.primKey,I=P.auto,M=P.keyPath,U=g;return M&&I&&(U=Jr(M)(g)),this._trans("readwrite",function(V){return A.core.mutate({trans:V,type:"add",keys:b!=null?[b]:null,values:[U]})}).then(function(V){return V.numFailures?He.reject(V.failures[0]):V.lastResult}).then(function(V){if(M)try{H(g,M,V)}catch{}return V})},Jt.prototype.upsert=function(g,b){var A=this,P=this.schema.primKey.keyPath;return this._trans("readwrite",function(I){return A.core.get({trans:I,key:g}).then(function(M){var U=M??{};return Fl(U,b),P&&H(U,P,g),A.core.mutate({trans:I,type:"put",values:[U],keys:[g],upsert:!0,updates:{keys:[g],changeSpecs:[b]}}).then(function(V){return V.numFailures?He.reject(V.failures[0]):!!M})})})},Jt.prototype.update=function(g,b){return typeof g!="object"||u(g)?this.where(":id").equals(g).modify(b):(g=$(g,this.schema.primKey.keyPath),g===void 0?En(new Ee.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(g).modify(b))},Jt.prototype.put=function(g,b){var A=this,P=this.schema.primKey,I=P.auto,M=P.keyPath,U=g;return M&&I&&(U=Jr(M)(g)),this._trans("readwrite",function(V){return A.core.mutate({trans:V,type:"put",values:[U],keys:b!=null?[b]:null})}).then(function(V){return V.numFailures?He.reject(V.failures[0]):V.lastResult}).then(function(V){if(M)try{H(g,M,V)}catch{}return V})},Jt.prototype.delete=function(g){var b=this;return this._trans("readwrite",function(A){return b.core.mutate({trans:A,type:"delete",keys:[g]}).then(function(P){return Th(b,[g],P)}).then(function(P){return P.numFailures?He.reject(P.failures[0]):void 0})})},Jt.prototype.clear=function(){var g=this;return this._trans("readwrite",function(b){return g.core.mutate({trans:b,type:"deleteRange",range:mu}).then(function(A){return Th(g,null,A)})}).then(function(b){return b.numFailures?He.reject(b.failures[0]):void 0})},Jt.prototype.bulkGet=function(g){var b=this;return this._trans("readonly",function(A){return b.core.getMany({keys:g,trans:A}).then(function(P){return P.map(function(I){return b.hook.reading.fire(I)})})})},Jt.prototype.bulkAdd=function(g,b,A){var P=this,I=Array.isArray(b)?b:void 0,M=(A=A||(I?void 0:b))?A.allKeys:void 0;return this._trans("readwrite",function(U){var X=P.schema.primKey,V=X.auto,X=X.keyPath;if(X&&I)throw new Ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(I&&I.length!==g.length)throw new Ee.InvalidArgument("Arguments objects and keys must have the same length");var J=g.length,X=X&&V?g.map(Jr(X)):g;return P.core.mutate({trans:U,type:"add",keys:I,values:X,wantResults:M}).then(function(ie){var G=ie.numFailures,ce=ie.results,ee=ie.lastResult,ie=ie.failures;if(G===0)return M?ce:ee;throw new We("".concat(P.name,".bulkAdd(): ").concat(G," of ").concat(J," operations failed"),ie)})})},Jt.prototype.bulkPut=function(g,b,A){var P=this,I=Array.isArray(b)?b:void 0,M=(A=A||(I?void 0:b))?A.allKeys:void 0;return this._trans("readwrite",function(U){var X=P.schema.primKey,V=X.auto,X=X.keyPath;if(X&&I)throw new Ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(I&&I.length!==g.length)throw new Ee.InvalidArgument("Arguments objects and keys must have the same length");var J=g.length,X=X&&V?g.map(Jr(X)):g;return P.core.mutate({trans:U,type:"put",keys:I,values:X,wantResults:M}).then(function(ie){var G=ie.numFailures,ce=ie.results,ee=ie.lastResult,ie=ie.failures;if(G===0)return M?ce:ee;throw new We("".concat(P.name,".bulkPut(): ").concat(G," of ").concat(J," operations failed"),ie)})})},Jt.prototype.bulkUpdate=function(g){var b=this,A=this.core,P=g.map(function(U){return U.key}),I=g.map(function(U){return U.changes}),M=[];return this._trans("readwrite",function(U){return A.getMany({trans:U,keys:P,cache:"clone"}).then(function(V){var J=[],X=[];g.forEach(function(G,ce){var ee=G.key,ie=G.changes,se=V[ce];if(se){for(var le=0,de=Object.keys(ie);le<de.length;le++){var ge=de[le],Ae=ie[ge];if(ge===b.schema.primKey.keyPath){if(gt(Ae,ee)!==0)throw new Ee.Constraint("Cannot update primary key in bulkUpdate()")}else H(se,ge,Ae)}M.push(ce),J.push(ee),X.push(se)}});var oe=J.length;return A.mutate({trans:U,type:"put",keys:J,values:X,updates:{keys:P,changeSpecs:I}}).then(function(G){var ce=G.numFailures,ee=G.failures;if(ce===0)return oe;for(var ie=0,se=Object.keys(ee);ie<se.length;ie++){var le,de=se[ie],ge=M[Number(de)];ge!=null&&(le=ee[de],delete ee[de],ee[ge]=le)}throw new We("".concat(b.name,".bulkUpdate(): ").concat(ce," of ").concat(oe," operations failed"),ee)})})})},Jt.prototype.bulkDelete=function(g){var b=this,A=g.length;return this._trans("readwrite",function(P){return b.core.mutate({trans:P,type:"delete",keys:g}).then(function(I){return Th(b,g,I)})}).then(function(U){var I=U.numFailures,M=U.lastResult,U=U.failures;if(I===0)return M;throw new We("".concat(b.name,".bulkDelete(): ").concat(I," of ").concat(A," operations failed"),U)})},Jt);function Jt(){}function bu(g){function b(U,V){if(V){for(var J=arguments.length,X=new Array(J-1);--J;)X[J-1]=arguments[J];return A[U].subscribe.apply(null,X),g}if(typeof U=="string")return A[U]}var A={};b.addEventType=M;for(var P=1,I=arguments.length;P<I;++P)M(arguments[P]);return b;function M(U,V,J){if(typeof U!="object"){var X;V=V||ra;var oe={subscribers:[],fire:J=J||tt,subscribe:function(G){oe.subscribers.indexOf(G)===-1&&(oe.subscribers.push(G),oe.fire=V(oe.fire,G))},unsubscribe:function(G){oe.subscribers=oe.subscribers.filter(function(ce){return ce!==G}),oe.fire=oe.subscribers.reduce(V,J)}};return A[U]=b[U]=oe}o(X=U).forEach(function(G){var ce=X[G];if(u(ce))M(G,X[G][0],X[G][1]);else{if(ce!=="asap")throw new Ee.InvalidArgument("Invalid event config");var ee=M(G,Ht,function(){for(var ie=arguments.length,se=new Array(ie);ie--;)se[ie]=arguments[ie];ee.subscribers.forEach(function(le){B(function(){le.apply(null,se)})})})}})}}function pa(g,b){return E(b).from({prototype:g}),b}function ga(g,b){return!(g.filter||g.algorithm||g.or)&&(b?g.justLimit:!g.replayFilter)}function wu(g,b){g.filter=vo(g.filter,b)}function ma(g,b,A){var P=g.replayFilter;g.replayFilter=P?function(){return vo(P(),b())}:b,g.justLimit=A&&!P}function Nh(g,b){if(g.isPrimKey)return b.primaryKey;var A=b.getIndexByKeyPath(g.index);if(!A)throw new Ee.Schema("KeyPath "+g.index+" on object store "+b.name+" is not indexed");return A}function Ph(g,b,A){var P=Nh(g,b.schema);return b.openCursor({trans:A,values:!g.keysOnly,reverse:g.dir==="prev",unique:!!g.unique,query:{index:P,range:g.range}})}function Ft(g,b,A,P){var I=g.replayFilter?vo(g.filter,g.replayFilter()):g.filter;if(g.or){var M={},U=function(V,J,X){var oe,G;I&&!I(J,X,function(ce){return J.stop(ce)},function(ce){return J.fail(ce)})||((G=""+(oe=J.primaryKey))=="[object ArrayBuffer]"&&(G=""+new Uint8Array(oe)),y(M,G)||(M[G]=!0,b(V,J,X)))};return Promise.all([g.or._iterate(U,A),wg(Ph(g,P,A),g.algorithm,U,!g.keysOnly&&g.valueMapper)])}return wg(Ph(g,P,A),vo(g.algorithm,I),b,!g.keysOnly&&g.valueMapper)}function wg(g,b,A,P){var I=Gt(P?function(M,U,V){return A(P(M),U,V)}:A);return g.then(function(M){if(M)return M.start(function(){var U=function(){return M.continue()};b&&!b(M,function(V){return U=V},function(V){M.stop(V),U=tt},function(V){M.fail(V),U=tt})||I(M.value,M,function(V){return U=V}),U()})})}var nv=(Ot.prototype._read=function(g,b){var A=this._ctx;return A.error?A.table._trans(null,En.bind(null,A.error)):A.table._trans("readonly",g).then(b)},Ot.prototype._write=function(g){var b=this._ctx;return b.error?b.table._trans(null,En.bind(null,b.error)):b.table._trans("readwrite",g,"locked")},Ot.prototype._addAlgorithm=function(g){var b=this._ctx;b.algorithm=vo(b.algorithm,g)},Ot.prototype._iterate=function(g,b){return Ft(this._ctx,g,b,this._ctx.table.core)},Ot.prototype.clone=function(g){var b=Object.create(this.constructor.prototype),A=Object.create(this._ctx);return g&&d(A,g),b._ctx=A,b},Ot.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ot.prototype.each=function(g){var b=this._ctx;return this._read(function(A){return Ft(b,g,A,b.table.core)})},Ot.prototype.count=function(g){var b=this;return this._read(function(A){var P=b._ctx,I=P.table.core;if(ga(P,!0))return I.count({trans:A,query:{index:Nh(P,I.schema),range:P.range}}).then(function(U){return Math.min(U,P.limit)});var M=0;return Ft(P,function(){return++M,!1},A,I).then(function(){return M})}).then(g)},Ot.prototype.sortBy=function(g,b){var A=g.split(".").reverse(),P=A[0],I=A.length-1;function M(J,X){return X?M(J[A[X]],X-1):J[P]}var U=this._ctx.dir==="next"?1:-1;function V(J,X){return gt(M(J,I),M(X,I))*U}return this.toArray(function(J){return J.sort(V)}).then(b)},Ot.prototype.toArray=function(g){var b=this;return this._read(function(A){var P=b._ctx;if(P.dir==="next"&&ga(P,!0)&&0<P.limit){var I=P.valueMapper,M=Nh(P,P.table.core.schema);return P.table.core.query({trans:A,limit:P.limit,values:!0,query:{index:M,range:P.range}}).then(function(V){return V=V.result,I?V.map(I):V})}var U=[];return Ft(P,function(V){return U.push(V)},A,P.table.core).then(function(){return U})},g)},Ot.prototype.offset=function(g){var b=this._ctx;return g<=0||(b.offset+=g,ga(b)?ma(b,function(){var A=g;return function(P,I){return A===0||(A===1?--A:I(function(){P.advance(A),A=0}),!1)}}):ma(b,function(){var A=g;return function(){return--A<0}})),this},Ot.prototype.limit=function(g){return this._ctx.limit=Math.min(this._ctx.limit,g),ma(this._ctx,function(){var b=g;return function(A,P,I){return--b<=0&&P(I),0<=b}},!0),this},Ot.prototype.until=function(g,b){return wu(this._ctx,function(A,P,I){return!g(A.value)||(P(I),b)}),this},Ot.prototype.first=function(g){return this.limit(1).toArray(function(b){return b[0]}).then(g)},Ot.prototype.last=function(g){return this.reverse().first(g)},Ot.prototype.filter=function(g){var b;return wu(this._ctx,function(A){return g(A.value)}),(b=this._ctx).isMatch=vo(b.isMatch,g),this},Ot.prototype.and=function(g){return this.filter(g)},Ot.prototype.or=function(g){return new this.db.WhereClause(this._ctx.table,g,this)},Ot.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ot.prototype.desc=function(){return this.reverse()},Ot.prototype.eachKey=function(g){var b=this._ctx;return b.keysOnly=!b.isMatch,this.each(function(A,P){g(P.key,P)})},Ot.prototype.eachUniqueKey=function(g){return this._ctx.unique="unique",this.eachKey(g)},Ot.prototype.eachPrimaryKey=function(g){var b=this._ctx;return b.keysOnly=!b.isMatch,this.each(function(A,P){g(P.primaryKey,P)})},Ot.prototype.keys=function(g){var b=this._ctx;b.keysOnly=!b.isMatch;var A=[];return this.each(function(P,I){A.push(I.key)}).then(function(){return A}).then(g)},Ot.prototype.primaryKeys=function(g){var b=this._ctx;if(b.dir==="next"&&ga(b,!0)&&0<b.limit)return this._read(function(P){var I=Nh(b,b.table.core.schema);return b.table.core.query({trans:P,values:!1,limit:b.limit,query:{index:I,range:b.range}})}).then(function(P){return P.result}).then(g);b.keysOnly=!b.isMatch;var A=[];return this.each(function(P,I){A.push(I.primaryKey)}).then(function(){return A}).then(g)},Ot.prototype.uniqueKeys=function(g){return this._ctx.unique="unique",this.keys(g)},Ot.prototype.firstKey=function(g){return this.limit(1).keys(function(b){return b[0]}).then(g)},Ot.prototype.lastKey=function(g){return this.reverse().firstKey(g)},Ot.prototype.distinct=function(){var g=this._ctx,g=g.index&&g.table.schema.idxByName[g.index];if(!g||!g.multi)return this;var b={};return wu(this._ctx,function(I){var P=I.primaryKey.toString(),I=y(b,P);return b[P]=!0,!I}),this},Ot.prototype.modify=function(g){var b=this,A=this._ctx;return this._write(function(P){var I=typeof g=="function"?g:function(se){return Fl(se,g)},M=A.table.core,X=M.schema.primaryKey,U=X.outbound,V=X.extractKey,J=200,X=b.db._options.modifyChunkSize;X&&(J=typeof X=="object"?X[M.name]||X["*"]||200:X);function oe(se,ge){var de=ge.failures,ge=ge.numFailures;ce+=se-ge;for(var Ae=0,Ce=o(de);Ae<Ce.length;Ae++){var Me=Ce[Ae];G.push(de[Me])}}var G=[],ce=0,ee=[],ie=g===xg;return b.clone().primaryKeys().then(function(se){function le(ge){var Ae=Math.min(J,se.length-ge),Ce=se.slice(ge,ge+Ae);return(ie?Promise.resolve([]):M.getMany({trans:P,keys:Ce,cache:"immutable"})).then(function(Me){var $e=[],Oe=[],De=U?[]:null,Ue=ie?Ce:[];if(!ie)for(var Be=0;Be<Ae;++Be){var Ge=Me[Be],vt={value:xe(Ge),primKey:se[ge+Be]};I.call(vt,vt.value,vt)!==!1&&(vt.value==null?Ue.push(se[ge+Be]):U||gt(V(Ge),V(vt.value))===0?(Oe.push(vt.value),U&&De.push(se[ge+Be])):(Ue.push(se[ge+Be]),$e.push(vt.value)))}return Promise.resolve(0<$e.length&&M.mutate({trans:P,type:"add",values:$e}).then(function(_t){for(var kt in _t.failures)Ue.splice(parseInt(kt),1);oe($e.length,_t)})).then(function(){return(0<Oe.length||de&&typeof g=="object")&&M.mutate({trans:P,type:"put",keys:De,values:Oe,criteria:de,changeSpec:typeof g!="function"&&g,isAdditionalChunk:0<ge}).then(function(_t){return oe(Oe.length,_t)})}).then(function(){return(0<Ue.length||de&&ie)&&M.mutate({trans:P,type:"delete",keys:Ue,criteria:de,isAdditionalChunk:0<ge}).then(function(_t){return Th(A.table,Ue,_t)}).then(function(_t){return oe(Ue.length,_t)})}).then(function(){return se.length>ge+Ae&&le(ge+J)})})}var de=ga(A)&&A.limit===1/0&&(typeof g!="function"||ie)&&{index:A.index,range:A.range};return le(0).then(function(){if(0<G.length)throw new Ve("Error modifying one or more objects",G,ce,ee);return se.length})})})},Ot.prototype.delete=function(){var g=this._ctx,b=g.range;return!ga(g)||g.table.schema.yProps||!g.isPrimKey&&b.type!==3?this.modify(xg):this._write(function(A){var P=g.table.core.schema.primaryKey,I=b;return g.table.core.count({trans:A,query:{index:P,range:I}}).then(function(M){return g.table.core.mutate({trans:A,type:"deleteRange",range:I}).then(function(J){var V=J.failures,J=J.numFailures;if(J)throw new Ve("Could not delete some values",Object.keys(V).map(function(X){return V[X]}),M-J);return M-J})})})},Ot);function Ot(){}var xg=function(g,b){return b.value=null};function rv(g,b){return g<b?-1:g===b?0:1}function sv(g,b){return b<g?-1:g===b?0:1}function wr(g,b,A){return g=g instanceof Bl?new g.Collection(g):g,g._ctx.error=new(A||TypeError)(b),g}function Ri(g){return new g.Collection(g,function(){return Ii("")}).limit(0)}function Ns(g,b,A,P){var I,M,U,V,J,X,oe,G=A.length;if(!A.every(function(ie){return typeof ie=="string"}))return wr(g,Q0);function ce(ie){I=ie==="next"?function(le){return le.toUpperCase()}:function(le){return le.toLowerCase()},M=ie==="next"?function(le){return le.toLowerCase()}:function(le){return le.toUpperCase()},U=ie==="next"?rv:sv;var se=A.map(function(le){return{lower:M(le),upper:I(le)}}).sort(function(le,de){return U(le.lower,de.lower)});V=se.map(function(le){return le.upper}),J=se.map(function(le){return le.lower}),oe=(X=ie)==="next"?"":P}ce("next"),g=new g.Collection(g,function(){return xr(V[0],J[G-1]+P)}),g._ondirectionchange=function(ie){ce(ie)};var ee=0;return g._addAlgorithm(function(ie,se,le){var de=ie.key;if(typeof de!="string")return!1;var ge=M(de);if(b(ge,J,ee))return!0;for(var Ae=null,Ce=ee;Ce<G;++Ce){var Me=(function($e,Oe,De,Ue,Be,Ge){for(var vt=Math.min($e.length,Ue.length),_t=-1,kt=0;kt<vt;++kt){var Lr=Oe[kt];if(Lr!==Ue[kt])return Be($e[kt],De[kt])<0?$e.substr(0,kt)+De[kt]+De.substr(kt+1):Be($e[kt],Ue[kt])<0?$e.substr(0,kt)+Ue[kt]+De.substr(kt+1):0<=_t?$e.substr(0,_t)+Oe[_t]+De.substr(_t+1):null;Be($e[kt],Lr)<0&&(_t=kt)}return vt<Ue.length&&Ge==="next"?$e+De.substr($e.length):vt<$e.length&&Ge==="prev"?$e.substr(0,De.length):_t<0?null:$e.substr(0,_t)+Ue[_t]+De.substr(_t+1)})(de,ge,V[Ce],J[Ce],U,X);Me===null&&Ae===null?ee=Ce+1:(Ae===null||0<U(Ae,Me))&&(Ae=Me)}return se(Ae!==null?function(){ie.continue(Ae+oe)}:le),!1}),g}function xr(g,b,A,P){return{type:2,lower:g,upper:b,lowerOpen:A,upperOpen:P}}function Ii(g){return{type:1,lower:g,upper:g}}var Bl=(Object.defineProperty(vn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),vn.prototype.between=function(g,b,A,P){A=A!==!1,P=P===!0;try{return 0<this._cmp(g,b)||this._cmp(g,b)===0&&(A||P)&&(!A||!P)?Ri(this):new this.Collection(this,function(){return xr(g,b,!A,!P)})}catch{return wr(this,qt)}},vn.prototype.equals=function(g){return g==null?wr(this,qt):new this.Collection(this,function(){return Ii(g)})},vn.prototype.above=function(g){return g==null?wr(this,qt):new this.Collection(this,function(){return xr(g,void 0,!0)})},vn.prototype.aboveOrEqual=function(g){return g==null?wr(this,qt):new this.Collection(this,function(){return xr(g,void 0,!1)})},vn.prototype.below=function(g){return g==null?wr(this,qt):new this.Collection(this,function(){return xr(void 0,g,!1,!0)})},vn.prototype.belowOrEqual=function(g){return g==null?wr(this,qt):new this.Collection(this,function(){return xr(void 0,g)})},vn.prototype.startsWith=function(g){return typeof g!="string"?wr(this,Q0):this.between(g,g+fa,!0,!0)},vn.prototype.startsWithIgnoreCase=function(g){return g===""?this.startsWith(g):Ns(this,function(b,A){return b.indexOf(A[0])===0},[g],fa)},vn.prototype.equalsIgnoreCase=function(g){return Ns(this,function(b,A){return b===A[0]},[g],"")},vn.prototype.anyOfIgnoreCase=function(){var g=Q.apply(ke,arguments);return g.length===0?Ri(this):Ns(this,function(b,A){return A.indexOf(b)!==-1},g,"")},vn.prototype.startsWithAnyOfIgnoreCase=function(){var g=Q.apply(ke,arguments);return g.length===0?Ri(this):Ns(this,function(b,A){return A.some(function(P){return b.indexOf(P)===0})},g,fa)},vn.prototype.anyOf=function(){var g=this,b=Q.apply(ke,arguments),A=this._cmp;try{b.sort(A)}catch{return wr(this,qt)}if(b.length===0)return Ri(this);var P=new this.Collection(this,function(){return xr(b[0],b[b.length-1])});P._ondirectionchange=function(M){A=M==="next"?g._ascending:g._descending,b.sort(A)};var I=0;return P._addAlgorithm(function(M,U,V){for(var J=M.key;0<A(J,b[I]);)if(++I===b.length)return U(V),!1;return A(J,b[I])===0||(U(function(){M.continue(b[I])}),!1)}),P},vn.prototype.notEqual=function(g){return this.inAnyRange([[-1/0,g],[g,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},vn.prototype.noneOf=function(){var g=Q.apply(ke,arguments);if(g.length===0)return new this.Collection(this);try{g.sort(this._ascending)}catch{return wr(this,qt)}var b=g.reduce(function(A,P){return A?A.concat([[A[A.length-1][1],P]]):[[-1/0,P]]},null);return b.push([g[g.length-1],this.db._maxKey]),this.inAnyRange(b,{includeLowers:!1,includeUppers:!1})},vn.prototype.inAnyRange=function(de,b){var A=this,P=this._cmp,I=this._ascending,M=this._descending,U=this._min,V=this._max;if(de.length===0)return Ri(this);if(!de.every(function(ge){return ge[0]!==void 0&&ge[1]!==void 0&&I(ge[0],ge[1])<=0}))return wr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Ee.InvalidArgument);var J=!b||b.includeLowers!==!1,X=b&&b.includeUppers===!0,oe,G=I;function ce(ge,Ae){return G(ge[0],Ae[0])}try{(oe=de.reduce(function(ge,Ae){for(var Ce=0,Me=ge.length;Ce<Me;++Ce){var $e=ge[Ce];if(P(Ae[0],$e[1])<0&&0<P(Ae[1],$e[0])){$e[0]=U($e[0],Ae[0]),$e[1]=V($e[1],Ae[1]);break}}return Ce===Me&&ge.push(Ae),ge},[])).sort(ce)}catch{return wr(this,qt)}var ee=0,ie=X?function(ge){return 0<I(ge,oe[ee][1])}:function(ge){return 0<=I(ge,oe[ee][1])},se=J?function(ge){return 0<M(ge,oe[ee][0])}:function(ge){return 0<=M(ge,oe[ee][0])},le=ie,de=new this.Collection(this,function(){return xr(oe[0][0],oe[oe.length-1][1],!J,!X)});return de._ondirectionchange=function(ge){G=ge==="next"?(le=ie,I):(le=se,M),oe.sort(ce)},de._addAlgorithm(function(ge,Ae,Ce){for(var Me,$e=ge.key;le($e);)if(++ee===oe.length)return Ae(Ce),!1;return!ie(Me=$e)&&!se(Me)||(A._cmp($e,oe[ee][1])===0||A._cmp($e,oe[ee][0])===0||Ae(function(){G===I?ge.continue(oe[ee][0]):ge.continue(oe[ee][1])}),!1)}),de},vn.prototype.startsWithAnyOf=function(){var g=Q.apply(ke,arguments);return g.every(function(b){return typeof b=="string"})?g.length===0?Ri(this):this.inAnyRange(g.map(function(b){return[b,b+fa]})):wr(this,"startsWithAnyOf() only works with strings")},vn);function vn(){}function Xn(g){return Gt(function(b){return xu(b),g(b.target.error),!1})}function xu(g){g.stopPropagation&&g.stopPropagation(),g.preventDefault&&g.preventDefault()}var $l="storagemutated",ya="x-storagemutated-1",wo=bu(null,$l),iv=(Qr.prototype._lock=function(){return F(!it.global),++this._reculock,this._reculock!==1||it.global||(it.lockOwnerFor=this),this},Qr.prototype._unlock=function(){if(F(!it.global),--this._reculock==0)for(it.global||(it.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var g=this._blockedFuncs.shift();try{mo(g[1],g[0])}catch{}}return this},Qr.prototype._locked=function(){return this._reculock&&it.lockOwnerFor!==this},Qr.prototype.create=function(g){var b=this;if(!this.mode)return this;var A=this.db.idbdb,P=this.db._state.dbOpenError;if(F(!this.idbtrans),!g&&!A)switch(P&&P.name){case"DatabaseClosedError":throw new Ee.DatabaseClosed(P);case"MissingAPIError":throw new Ee.MissingAPI(P.message,P);default:throw new Ee.OpenFailed(P)}if(!this.active)throw new Ee.TransactionInactive;return F(this._completion._state===null),(g=this.idbtrans=g||(this.db.core||A).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Gt(function(I){xu(I),b._reject(g.error)}),g.onabort=Gt(function(I){xu(I),b.active&&b._reject(new Ee.Abort(g.error)),b.active=!1,b.on("abort").fire(I)}),g.oncomplete=Gt(function(){b.active=!1,b._resolve(),"mutatedParts"in g&&wo.storagemutated.fire(g.mutatedParts)}),this},Qr.prototype._promise=function(g,b,A){var P=this;if(g==="readwrite"&&this.mode!=="readwrite")return En(new Ee.ReadOnly("Transaction is readonly"));if(!this.active)return En(new Ee.TransactionInactive);if(this._locked())return new He(function(M,U){P._blockedFuncs.push([function(){P._promise(g,b,A).then(M,U)},it])});if(A)return po(function(){var M=new He(function(U,V){P._lock();var J=b(U,V,P);J&&J.then&&J.then(U,V)});return M.finally(function(){return P._unlock()}),M._lib=!0,M});var I=new He(function(M,U){var V=b(M,U,P);V&&V.then&&V.then(M,U)});return I._lib=!0,I},Qr.prototype._root=function(){return this.parent?this.parent._root():this},Qr.prototype.waitFor=function(g){var b,A=this._root(),P=He.resolve(g);A._waitingFor?A._waitingFor=A._waitingFor.then(function(){return P}):(A._waitingFor=P,A._waitingQueue=[],b=A.idbtrans.objectStore(A.storeNames[0]),(function M(){for(++A._spinCount;A._waitingQueue.length;)A._waitingQueue.shift()();A._waitingFor&&(b.get(-1/0).onsuccess=M)})());var I=A._waitingFor;return new He(function(M,U){P.then(function(V){return A._waitingQueue.push(Gt(M.bind(null,V)))},function(V){return A._waitingQueue.push(Gt(U.bind(null,V)))}).finally(function(){A._waitingFor===I&&(A._waitingFor=null)})})},Qr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Ee.Abort))},Qr.prototype.table=function(g){var b=this._memoizedTables||(this._memoizedTables={});if(y(b,g))return b[g];var A=this.schema[g];if(!A)throw new Ee.NotFound("Table "+g+" not part of transaction");return A=new this.db.Table(g,A,this),A.core=this.db.core.table(g),b[g]=A},Qr);function Qr(){}function Rh(g,b,A,P,I,M,U,V){return{name:g,keyPath:b,unique:A,multi:P,auto:I,compound:M,src:(A&&!U?"&":"")+(P?"*":"")+(I?"++":"")+ov(b),type:V}}function ov(g){return typeof g=="string"?g:g?"["+[].join.call(g,"+")+"]":""}function va(g,b,A){return{name:g,primKey:b,indexes:A,mappedClass:null,idxByName:(P=function(I){return[I.name,I]},A.reduce(function(I,M,U){return U=P(M,U),U&&(I[U[0]]=U[1]),I},{}))};var P}var Oi=function(g){try{return g.only([[]]),Oi=function(){return[[]]},[[]]}catch{return Oi=function(){return fa},fa}};function xo(g){return g==null?function(){}:typeof g=="string"?(b=g).split(".").length===1?function(A){return A[b]}:function(A){return $(A,b)}:function(A){return $(A,g)};var b}function _u(g){return[].slice.call(g)}var wx=0;function Su(g){return g==null?":id":typeof g=="string"?g:"[".concat(g.join("+"),"]")}function _g(g,b,J){function P(le){if(le.type===3)return null;if(le.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var ee=le.lower,ie=le.upper,se=le.lowerOpen,le=le.upperOpen;return ee===void 0?ie===void 0?null:b.upperBound(ie,!!le):ie===void 0?b.lowerBound(ee,!!se):b.bound(ee,ie,!!se,!!le)}function I(ce){var ee,ie=ce.name;return{name:ie,schema:ce,mutate:function(se){var le=se.trans,de=se.type,ge=se.keys,Ae=se.values,Ce=se.range;return new Promise(function(Me,$e){Me=Gt(Me);var Oe=le.objectStore(ie),De=Oe.keyPath==null,Ue=de==="put"||de==="add";if(!Ue&&de!=="delete"&&de!=="deleteRange")throw new Error("Invalid operation type: "+de);var Be,Ge=(ge||Ae||{length:1}).length;if(ge&&Ae&&ge.length!==Ae.length)throw new Error("Given keys array must have same length as given values array.");if(Ge===0)return Me({numFailures:0,failures:{},results:[],lastResult:void 0});function vt(Jn){++Lr,xu(Jn)}var _t=[],kt=[],Lr=0;if(de==="deleteRange"){if(Ce.type===4)return Me({numFailures:Lr,failures:kt,results:[],lastResult:void 0});Ce.type===3?_t.push(Be=Oe.clear()):_t.push(Be=Oe.delete(P(Ce)))}else{var De=Ue?De?[Ae,ge]:[Ae,null]:[ge,null],yt=De[0],Yn=De[1];if(Ue)for(var pn=0;pn<Ge;++pn)_t.push(Be=Yn&&Yn[pn]!==void 0?Oe[de](yt[pn],Yn[pn]):Oe[de](yt[pn])),Be.onerror=vt;else for(pn=0;pn<Ge;++pn)_t.push(Be=Oe[de](yt[pn])),Be.onerror=vt}function Jl(Jn){Jn=Jn.target.result,_t.forEach(function(_a,Dg){return _a.error!=null&&(kt[Dg]=_a.error)}),Me({numFailures:Lr,failures:kt,results:de==="delete"?ge:_t.map(function(_a){return _a.result}),lastResult:Jn})}Be.onerror=function(Jn){vt(Jn),Jl(Jn)},Be.onsuccess=Jl})},getMany:function(se){var le=se.trans,de=se.keys;return new Promise(function(ge,Ae){ge=Gt(ge);for(var Ce,Me=le.objectStore(ie),$e=de.length,Oe=new Array($e),De=0,Ue=0,Be=function(_t){_t=_t.target,Oe[_t._pos]=_t.result,++Ue===De&&ge(Oe)},Ge=Xn(Ae),vt=0;vt<$e;++vt)de[vt]!=null&&((Ce=Me.get(de[vt]))._pos=vt,Ce.onsuccess=Be,Ce.onerror=Ge,++De);De===0&&ge(Oe)})},get:function(se){var le=se.trans,de=se.key;return new Promise(function(ge,Ae){ge=Gt(ge);var Ce=le.objectStore(ie).get(de);Ce.onsuccess=function(Me){return ge(Me.target.result)},Ce.onerror=Xn(Ae)})},query:(ee=X,function(se){return new Promise(function(le,de){le=Gt(le);var ge,Ae,Ce,De=se.trans,Me=se.values,$e=se.limit,Be=se.query,Oe=$e===1/0?void 0:$e,Ue=Be.index,Be=Be.range,De=De.objectStore(ie),Ue=Ue.isPrimaryKey?De:De.index(Ue.name),Be=P(Be);if($e===0)return le({result:[]});ee?((Oe=Me?Ue.getAll(Be,Oe):Ue.getAllKeys(Be,Oe)).onsuccess=function(Ge){return le({result:Ge.target.result})},Oe.onerror=Xn(de)):(ge=0,Ae=!Me&&"openKeyCursor"in Ue?Ue.openKeyCursor(Be):Ue.openCursor(Be),Ce=[],Ae.onsuccess=function(Ge){var vt=Ae.result;return vt?(Ce.push(Me?vt.value:vt.primaryKey),++ge===$e?le({result:Ce}):void vt.continue()):le({result:Ce})},Ae.onerror=Xn(de))})}),openCursor:function(se){var le=se.trans,de=se.values,ge=se.query,Ae=se.reverse,Ce=se.unique;return new Promise(function(Me,$e){Me=Gt(Me);var Ue=ge.index,Oe=ge.range,De=le.objectStore(ie),De=Ue.isPrimaryKey?De:De.index(Ue.name),Ue=Ae?Ce?"prevunique":"prev":Ce?"nextunique":"next",Be=!de&&"openKeyCursor"in De?De.openKeyCursor(P(Oe),Ue):De.openCursor(P(Oe),Ue);Be.onerror=Xn($e),Be.onsuccess=Gt(function(Ge){var vt,_t,kt,Lr,yt=Be.result;yt?(yt.___id=++wx,yt.done=!1,vt=yt.continue.bind(yt),_t=(_t=yt.continuePrimaryKey)&&_t.bind(yt),kt=yt.advance.bind(yt),Lr=function(){throw new Error("Cursor not stopped")},yt.trans=le,yt.stop=yt.continue=yt.continuePrimaryKey=yt.advance=function(){throw new Error("Cursor not started")},yt.fail=Gt($e),yt.next=function(){var Yn=this,pn=1;return this.start(function(){return pn--?Yn.continue():Yn.stop()}).then(function(){return Yn})},yt.start=function(Yn){function pn(){if(Be.result)try{Yn()}catch(Jn){yt.fail(Jn)}else yt.done=!0,yt.start=function(){throw new Error("Cursor behind last entry")},yt.stop()}var Jl=new Promise(function(Jn,_a){Jn=Gt(Jn),Be.onerror=Xn(_a),yt.fail=_a,yt.stop=function(Dg){yt.stop=yt.continue=yt.continuePrimaryKey=yt.advance=Lr,Jn(Dg)}});return Be.onsuccess=Gt(function(Jn){Be.onsuccess=pn,pn()}),yt.continue=vt,yt.continuePrimaryKey=_t,yt.advance=kt,pn(),Jl},Me(yt)):Me(null)},$e)})},count:function(se){var le=se.query,de=se.trans,ge=le.index,Ae=le.range;return new Promise(function(Ce,Me){var $e=de.objectStore(ie),Oe=ge.isPrimaryKey?$e:$e.index(ge.name),$e=P(Ae),Oe=$e?Oe.count($e):Oe.count();Oe.onsuccess=Gt(function(De){return Ce(De.target.result)}),Oe.onerror=Xn(Me)})}}}var M,U,V,oe=(U=J,V=_u((M=g).objectStoreNames),{schema:{name:M.name,tables:V.map(function(ce){return U.objectStore(ce)}).map(function(ce){var ee=ce.keyPath,le=ce.autoIncrement,ie=u(ee),se={},le={name:ce.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:ee==null,compound:ie,keyPath:ee,autoIncrement:le,unique:!0,extractKey:xo(ee)},indexes:_u(ce.indexNames).map(function(de){return ce.index(de)}).map(function(Ce){var ge=Ce.name,Ae=Ce.unique,Me=Ce.multiEntry,Ce=Ce.keyPath,Me={name:ge,compound:u(Ce),keyPath:Ce,unique:Ae,multiEntry:Me,extractKey:xo(Ce)};return se[Su(Ce)]=Me}),getIndexByKeyPath:function(de){return se[Su(de)]}};return se[":id"]=le.primaryKey,ee!=null&&(se[Su(ee)]=le.primaryKey),le})},hasGetAll:0<V.length&&"getAll"in U.objectStore(V[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),J=oe.schema,X=oe.hasGetAll,oe=J.tables.map(I),G={};return oe.forEach(function(ce){return G[ce.name]=ce}),{stack:"dbcore",transaction:g.transaction.bind(g),table:function(ce){if(!G[ce])throw new Error("Table '".concat(ce,"' not found"));return G[ce]},MIN_KEY:-1/0,MAX_KEY:Oi(b),schema:J}}function Ih(g,b,A,P){var I=A.IDBKeyRange;return A.indexedDB,{dbcore:(P=_g(b,I,P),g.dbcore.reduce(function(M,U){return U=U.create,n(n({},M),U(M))},P))}}function Ul(g,P){var A=P.db,P=Ih(g._middlewares,A,g._deps,P);g.core=P.dbcore,g.tables.forEach(function(I){var M=I.name;g.core.schema.tables.some(function(U){return U.name===M})&&(I.core=g.core.table(M),g[M]instanceof g.Table&&(g[M].core=I.core))})}function Eu(g,b,A,P){A.forEach(function(I){var M=P[I];b.forEach(function(U){var V=(function J(X,oe){return T(X,oe)||(X=f(X))&&J(X,oe)})(U,I);(!V||"value"in V&&V.value===void 0)&&(U===g.Transaction.prototype||U instanceof g.Transaction?S(U,I,{get:function(){return this.table(I)},set:function(J){x(this,I,{value:J,writable:!0,configurable:!0,enumerable:!0})}}):U[I]=new g.Table(I,M))})})}function si(g,b){b.forEach(function(A){for(var P in A)A[P]instanceof g.Table&&delete A[P]})}function Sg(g,b){return g._cfg.version-b._cfg.version}function Oh(g,b,A,P){var I=g._dbSchema;A.objectStoreNames.contains("$meta")&&!I.$meta&&(I.$meta=va("$meta",Vl("")[0],[]),g._storeNames.push("$meta"));var M=g._createTransaction("readwrite",g._storeNames,I);M.create(A),M._completion.catch(P);var U=M._reject.bind(M),V=it.transless||it;po(function(){return it.trans=M,it.transless=V,b!==0?(Ul(g,A),X=b,((J=M).storeNames.includes("$meta")?J.table("$meta").get("version").then(function(oe){return oe??X}):He.resolve(X)).then(function(oe){return ce=oe,ee=M,ie=A,se=[],oe=(G=g)._versions,le=G._dbSchema=ji(0,G.idbdb,ie),(oe=oe.filter(function(de){return de._cfg.version>=ce})).length!==0?(oe.forEach(function(de){se.push(function(){var ge=le,Ae=de._cfg.dbschema;ql(G,ge,ie),ql(G,Ae,ie),le=G._dbSchema=Ae;var Ce=zl(ge,Ae);Ce.add.forEach(function(Ue){Hl(ie,Ue[0],Ue[1].primKey,Ue[1].indexes)}),Ce.change.forEach(function(Ue){if(Ue.recreate)throw new Ee.Upgrade("Not yet support for changing primary key");var Be=ie.objectStore(Ue.name);Ue.add.forEach(function(Ge){return ar(Be,Ge)}),Ue.change.forEach(function(Ge){Be.deleteIndex(Ge.name),ar(Be,Ge)}),Ue.del.forEach(function(Ge){return Be.deleteIndex(Ge)})});var Me=de._cfg.contentUpgrade;if(Me&&de._cfg.version>ce){Ul(G,ie),ee._memoizedTables={};var $e=W(Ae);Ce.del.forEach(function(Ue){$e[Ue]=ge[Ue]}),si(G,[G.Transaction.prototype]),Eu(G,[G.Transaction.prototype],o($e),$e),ee.schema=$e;var Oe,De=z(Me);return De&&Dl(),Ce=He.follow(function(){var Ue;(Oe=Me(ee))&&De&&(Ue=Dr.bind(null,null),Oe.then(Ue,Ue))}),Oe&&typeof Oe.then=="function"?He.resolve(Oe):Ce.then(function(){return Oe})}}),se.push(function(ge){var Ae,Ce,Me=de._cfg.dbschema;Ae=Me,Ce=ge,[].slice.call(Ce.db.objectStoreNames).forEach(function($e){return Ae[$e]==null&&Ce.db.deleteObjectStore($e)}),si(G,[G.Transaction.prototype]),Eu(G,[G.Transaction.prototype],G._storeNames,G._dbSchema),ee.schema=G._dbSchema}),se.push(function(ge){G.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(G.idbdb.version/10)===de._cfg.version?(G.idbdb.deleteObjectStore("$meta"),delete G._dbSchema.$meta,G._storeNames=G._storeNames.filter(function(Ae){return Ae!=="$meta"})):ge.objectStore("$meta").put(de._cfg.version,"version"))})}),(function de(){return se.length?He.resolve(se.shift()(ee.idbtrans)).then(de):He.resolve()})().then(function(){Eg(le,ie)})):He.resolve();var G,ce,ee,ie,se,le}).catch(U)):(o(I).forEach(function(oe){Hl(A,oe,I[oe].primKey,I[oe].indexes)}),Ul(g,A),void He.follow(function(){return g.on.populate.fire(M)}).catch(U));var J,X})}function av(g,b){Eg(g._dbSchema,b),b.db.version%10!=0||b.objectStoreNames.contains("$meta")||b.db.createObjectStore("$meta").add(Math.ceil(b.db.version/10-1),"version");var A=ji(0,g.idbdb,b);ql(g,g._dbSchema,b);for(var P=0,I=zl(A,g._dbSchema).change;P<I.length;P++){var M=(function(U){if(U.change.length||U.recreate)return console.warn("Unable to patch indexes of table ".concat(U.name," because it has changes on the type of index or primary key.")),{value:void 0};var V=b.objectStore(U.name);U.add.forEach(function(J){br&&console.debug("Dexie upgrade patch: Creating missing index ".concat(U.name,".").concat(J.src)),ar(V,J)})})(I[P]);if(typeof M=="object")return M.value}}function zl(g,b){var A,P={del:[],add:[],change:[]};for(A in g)b[A]||P.del.push(A);for(A in b){var I=g[A],M=b[A];if(I){var U={name:A,def:M,recreate:!1,del:[],add:[],change:[]};if(""+(I.primKey.keyPath||"")!=""+(M.primKey.keyPath||"")||I.primKey.auto!==M.primKey.auto)U.recreate=!0,P.change.push(U);else{var V=I.idxByName,J=M.idxByName,X=void 0;for(X in V)J[X]||U.del.push(X);for(X in J){var oe=V[X],G=J[X];oe?oe.src!==G.src&&U.change.push(G):U.add.push(G)}(0<U.del.length||0<U.add.length||0<U.change.length)&&P.change.push(U)}}else P.add.push([A,M])}return P}function Hl(g,b,A,P){var I=g.db.createObjectStore(b,A.keyPath?{keyPath:A.keyPath,autoIncrement:A.auto}:{autoIncrement:A.auto});return P.forEach(function(M){return ar(I,M)}),I}function Eg(g,b){o(g).forEach(function(A){b.db.objectStoreNames.contains(A)||(br&&console.debug("Dexie: Creating missing table",A),Hl(b,A,g[A].primKey,g[A].indexes))})}function ar(g,b){g.createIndex(b.name,b.keyPath,{unique:b.unique,multiEntry:b.multi})}function ji(g,b,A){var P={};return L(b.objectStoreNames,0).forEach(function(I){for(var M=A.objectStore(I),U=Rh(ov(X=M.keyPath),X||"",!0,!1,!!M.autoIncrement,X&&typeof X!="string",!0),V=[],J=0;J<M.indexNames.length;++J){var oe=M.index(M.indexNames[J]),X=oe.keyPath,oe=Rh(oe.name,X,!!oe.unique,!!oe.multiEntry,!1,X&&typeof X!="string",!1);V.push(oe)}P[I]=va(I,U,V)}),P}function ql(g,b,A){for(var P=A.db.objectStoreNames,I=0;I<P.length;++I){var M=P[I],U=A.objectStore(M);g._hasGetAll="getAll"in U;for(var V=0;V<U.indexNames.length;++V){var J=U.indexNames[V],X=U.index(J).keyPath,oe=typeof X=="string"?X:"["+L(X).join("+")+"]";!b[M]||(X=b[M].idxByName[oe])&&(X.name=J,delete b[M].idxByName[oe],b[M].idxByName[J]=X)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(g._hasGetAll=!1)}function Vl(g){return g.split(",").map(function(b,A){var M=b.split(":"),P=(I=M[1])===null||I===void 0?void 0:I.trim(),I=(b=M[0].trim()).replace(/([&*]|\+\+)/g,""),M=/^\[/.test(I)?I.match(/^\[(.*)\]$/)[1].split("+"):I;return Rh(I,M||null,/\&/.test(b),/\*/.test(b),/\+\+/.test(b),u(M),A===0,P)})}var xx=(_o.prototype._createTableSchema=va,_o.prototype._parseIndexSyntax=Vl,_o.prototype._parseStoresSpec=function(g,b){var A=this;o(g).forEach(function(P){if(g[P]!==null){var I=A._parseIndexSyntax(g[P]),M=I.shift();if(!M)throw new Ee.Schema("Invalid schema for table "+P+": "+g[P]);if(M.unique=!0,M.multi)throw new Ee.Schema("Primary key cannot be multiEntry*");I.forEach(function(U){if(U.auto)throw new Ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!U.keyPath)throw new Ee.Schema("Index must have a name and cannot be an empty string")}),I=A._createTableSchema(P,M,I),b[P]=I}})},_o.prototype.stores=function(A){var b=this.db;this._cfg.storesSource=this._cfg.storesSource?d(this._cfg.storesSource,A):A;var A=b._versions,P={},I={};return A.forEach(function(M){d(P,M._cfg.storesSource),I=M._cfg.dbschema={},M._parseStoresSpec(P,I)}),b._dbSchema=I,si(b,[b._allTables,b,b.Transaction.prototype]),Eu(b,[b._allTables,b,b.Transaction.prototype,this._cfg.tables],o(I),I),b._storeNames=o(I),this},_o.prototype.upgrade=function(g){return this._cfg.contentUpgrade=sa(this._cfg.contentUpgrade||tt,g),this},_o);function _o(){}function Au(g,b){var A=g._dbNamesDB;return A||(A=g._dbNamesDB=new Di(gu,{addons:[],indexedDB:g,IDBKeyRange:b})).version(1).stores({dbnames:"name"}),A.table("dbnames")}function ba(g){return g&&typeof g.databases=="function"}function Wl(g){return po(function(){return it.letThrough=!0,g()})}function jh(g){return!("from"in g)}var lr=function(g,b){if(!this){var A=new lr;return g&&"d"in g&&d(A,g),A}d(this,arguments.length?{d:1,from:g,to:1<arguments.length?b:g}:{d:0})};function ku(g,b,A){var P=gt(b,A);if(!isNaN(P)){if(0<P)throw RangeError();if(jh(g))return d(g,{from:b,to:A,d:1});var I=g.l,P=g.r;if(gt(A,g.from)<0)return I?ku(I,b,A):g.l={from:b,to:A,d:1,l:null,r:null},lv(g);if(0<gt(b,g.to))return P?ku(P,b,A):g.r={from:b,to:A,d:1,l:null,r:null},lv(g);gt(b,g.from)<0&&(g.from=b,g.l=null,g.d=P?P.d+1:1),0<gt(A,g.to)&&(g.to=A,g.r=null,g.d=g.l?g.l.d+1:1),A=!g.r,I&&!g.l&&Cu(g,I),P&&A&&Cu(g,P)}}function Cu(g,b){jh(b)||(function A(P,J){var M=J.from,U=J.to,V=J.l,J=J.r;ku(P,M,U),V&&A(P,V),J&&A(P,J)})(g,b)}function Mh(g,b){var A=Dh(b),P=A.next();if(P.done)return!1;for(var I=P.value,M=Dh(g),U=M.next(I.from),V=U.value;!P.done&&!U.done;){if(gt(V.from,I.to)<=0&&0<=gt(V.to,I.from))return!0;gt(I.from,V.from)<0?I=(P=A.next(V.from)).value:V=(U=M.next(I.from)).value}return!1}function Dh(g){var b=jh(g)?null:{s:0,n:g};return{next:function(A){for(var P=0<arguments.length;b;)switch(b.s){case 0:if(b.s=1,P)for(;b.n.l&&gt(A,b.n.from)<0;)b={up:b,n:b.n.l,s:1};else for(;b.n.l;)b={up:b,n:b.n.l,s:1};case 1:if(b.s=2,!P||gt(A,b.n.to)<=0)return{value:b.n,done:!1};case 2:if(b.n.r){b.s=3,b={up:b,n:b.n.r,s:0};continue}case 3:b=b.up}return{done:!0}}}}function lv(g){var b,A,P=(((b=g.r)===null||b===void 0?void 0:b.d)||0)-(((A=g.l)===null||A===void 0?void 0:A.d)||0),I=1<P?"r":P<-1?"l":"";I&&(b=I=="r"?"l":"r",A=n({},g),P=g[I],g.from=P.from,g.to=P.to,g[I]=P[I],A[I]=P[b],(g[b]=A).d=cv(A)),g.d=cv(g)}function cv(A){var b=A.r,A=A.l;return(b?A?Math.max(b.d,A.d):b.d:A?A.d:0)+1}function Lh(g,b){return o(b).forEach(function(A){g[A]?Cu(g[A],b[A]):g[A]=(function P(I){var M,U,V={};for(M in I)y(I,M)&&(U=I[M],V[M]=!U||typeof U!="object"||ne.has(U.constructor)?U:P(U));return V})(b[A])}),g}function Ag(g,b){return g.all||b.all||Object.keys(g).some(function(A){return b[A]&&Mh(b[A],g[A])})}v(lr.prototype,((Zr={add:function(g){return Cu(this,g),this},addKey:function(g){return ku(this,g,g),this},addKeys:function(g){var b=this;return g.forEach(function(A){return ku(b,A,A)}),this},hasKey:function(g){var b=Dh(this).next(g).value;return b&&gt(b.from,g)<=0&&0<=gt(b.to,g)}})[pe]=function(){return Dh(this)},Zr));var So={},kg={},Cg=!1;function Fh(g){Lh(kg,g),Cg||(Cg=!0,setTimeout(function(){Cg=!1,Tg(kg,!(kg={}))},0))}function Tg(g,b){b===void 0&&(b=!1);var A=new Set;if(g.all)for(var P=0,I=Object.values(So);P<I.length;P++)Bh(U=I[P],g,A,b);else for(var M in g){var U,V=/^idb\:\/\/(.*)\/(.*)\//.exec(M);V&&(M=V[1],V=V[2],(U=So["idb://".concat(M,"/").concat(V)])&&Bh(U,g,A,b))}A.forEach(function(J){return J()})}function Bh(g,b,A,P){for(var I=[],M=0,U=Object.entries(g.queries.query);M<U.length;M++){for(var V=U[M],J=V[0],X=[],oe=0,G=V[1];oe<G.length;oe++){var ce=G[oe];Ag(b,ce.obsSet)?ce.subscribers.forEach(function(le){return A.add(le)}):P&&X.push(ce)}P&&I.push([J,X])}if(P)for(var ee=0,ie=I;ee<ie.length;ee++){var se=ie[ee],J=se[0],X=se[1];g.queries.query[J]=X}}function _x(g){var b=g._state,A=g._deps.indexedDB;if(b.isBeingOpened||g.idbdb)return b.dbReadyPromise.then(function(){return b.dbOpenError?En(b.dbOpenError):g});b.isBeingOpened=!0,b.dbOpenError=null,b.openComplete=!1;var P=b.openCanceller,I=Math.round(10*g.verno),M=!1;function U(){if(b.openCanceller!==P)throw new Ee.DatabaseClosed("db.open() was cancelled")}function V(){return new He(function(ce,ee){if(U(),!A)throw new Ee.MissingAPI;var ie=g.name,se=b.autoSchema||!I?A.open(ie):A.open(ie,I);if(!se)throw new Ee.MissingAPI;se.onerror=Xn(ee),se.onblocked=Gt(g._fireOnBlocked),se.onupgradeneeded=Gt(function(le){var de;oe=se.transaction,b.autoSchema&&!g._options.allowEmptyDB?(se.onerror=xu,oe.abort(),se.result.close(),(de=A.deleteDatabase(ie)).onsuccess=de.onerror=Gt(function(){ee(new Ee.NoSuchDatabase("Database ".concat(ie," doesnt exist")))})):(oe.onerror=Xn(ee),le=le.oldVersion>Math.pow(2,62)?0:le.oldVersion,G=le<1,g.idbdb=se.result,M&&av(g,oe),Oh(g,le/10,oe,ee))},ee),se.onsuccess=Gt(function(){oe=null;var le,de,ge,Ae,Ce,Me=g.idbdb=se.result,$e=L(Me.objectStoreNames);if(0<$e.length)try{var Oe=Me.transaction((Ae=$e).length===1?Ae[0]:Ae,"readonly");if(b.autoSchema)de=Me,ge=Oe,(le=g).verno=de.version/10,ge=le._dbSchema=ji(0,de,ge),le._storeNames=L(de.objectStoreNames,0),Eu(le,[le._allTables],o(ge),ge);else if(ql(g,g._dbSchema,Oe),((Ce=zl(ji(0,(Ce=g).idbdb,Oe),Ce._dbSchema)).add.length||Ce.change.some(function(De){return De.add.length||De.change.length}))&&!M)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Me.close(),I=Me.version+1,M=!0,ce(V());Ul(g,Oe)}catch{}yo.push(g),Me.onversionchange=Gt(function(De){b.vcFired=!0,g.on("versionchange").fire(De)}),Me.onclose=Gt(function(){g.close({disableAutoOpen:!1})}),G&&(Ce=g._deps,Oe=ie,Me=Ce.indexedDB,Ce=Ce.IDBKeyRange,ba(Me)||Oe===gu||Au(Me,Ce).put({name:Oe}).catch(tt)),ce()},ee)}).catch(function(ce){switch(ce==null?void 0:ce.name){case"UnknownError":if(0<b.PR1398_maxLoop)return b.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),V();break;case"VersionError":if(0<I)return I=0,V()}return He.reject(ce)})}var J,X=b.dbReadyResolve,oe=null,G=!1;return He.race([P,(typeof navigator>"u"?He.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(ce){function ee(){return indexedDB.databases().finally(ce)}J=setInterval(ee,100),ee()}).finally(function(){return clearInterval(J)}):Promise.resolve()).then(V)]).then(function(){return U(),b.onReadyBeingFired=[],He.resolve(Wl(function(){return g.on.ready.fire(g.vip)})).then(function ce(){if(0<b.onReadyBeingFired.length){var ee=b.onReadyBeingFired.reduce(sa,tt);return b.onReadyBeingFired=[],He.resolve(Wl(function(){return ee(g.vip)})).then(ce)}})}).finally(function(){b.openCanceller===P&&(b.onReadyBeingFired=null,b.isBeingOpened=!1)}).catch(function(ce){b.dbOpenError=ce;try{oe&&oe.abort()}catch{}return P===b.openCanceller&&g._close(),En(ce)}).finally(function(){b.openComplete=!0,X()}).then(function(){var ce;return G&&(ce={},g.tables.forEach(function(ee){ee.schema.indexes.forEach(function(ie){ie.name&&(ce["idb://".concat(g.name,"/").concat(ee.name,"/").concat(ie.name)]=new lr(-1/0,[[[]]]))}),ce["idb://".concat(g.name,"/").concat(ee.name,"/")]=ce["idb://".concat(g.name,"/").concat(ee.name,"/:dels")]=new lr(-1/0,[[[]]])}),wo($l).fire(ce),Tg(ce,!0)),g})}function Ng(g){function b(M){return g.next(M)}var A=I(b),P=I(function(M){return g.throw(M)});function I(M){return function(J){var V=M(J),J=V.value;return V.done?J:J&&typeof J.then=="function"?J.then(A,P):u(J)?Promise.all(J).then(A,P):A(J)}}return I(b)()}function $h(g,b,A){for(var P=u(g)?g.slice():[g],I=0;I<A;++I)P.push(b);return P}var uv={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(g){return n(n({},g),{table:function(b){var A=g.table(b),P=A.schema,I={},M=[];function U(G,ce,ee){var ie=Su(G),se=I[ie]=I[ie]||[],le=G==null?0:typeof G=="string"?1:G.length,de=0<ce,de=n(n({},ee),{name:de?"".concat(ie,"(virtual-from:").concat(ee.name,")"):ee.name,lowLevelIndex:ee,isVirtual:de,keyTail:ce,keyLength:le,extractKey:xo(G),unique:!de&&ee.unique});return se.push(de),de.isPrimaryKey||M.push(de),1<le&&U(le===2?G[0]:G.slice(0,le-1),ce+1,ee),se.sort(function(ge,Ae){return ge.keyTail-Ae.keyTail}),de}b=U(P.primaryKey.keyPath,0,P.primaryKey),I[":id"]=[b];for(var V=0,J=P.indexes;V<J.length;V++){var X=J[V];U(X.keyPath,0,X)}function oe(G){var ce,ee=G.query.index;return ee.isVirtual?n(n({},G),{query:{index:ee.lowLevelIndex,range:(ce=G.query.range,ee=ee.keyTail,{type:ce.type===1?2:ce.type,lower:$h(ce.lower,ce.lowerOpen?g.MAX_KEY:g.MIN_KEY,ee),lowerOpen:!0,upper:$h(ce.upper,ce.upperOpen?g.MIN_KEY:g.MAX_KEY,ee),upperOpen:!0})}}):G}return n(n({},A),{schema:n(n({},P),{primaryKey:b,indexes:M,getIndexByKeyPath:function(G){return(G=I[Su(G)])&&G[0]}}),count:function(G){return A.count(oe(G))},query:function(G){return A.query(oe(G))},openCursor:function(G){var ce=G.query.index,ee=ce.keyTail,ie=ce.isVirtual,se=ce.keyLength;return ie?A.openCursor(oe(G)).then(function(de){return de&&le(de)}):A.openCursor(G);function le(de){return Object.create(de,{continue:{value:function(ge){ge!=null?de.continue($h(ge,G.reverse?g.MAX_KEY:g.MIN_KEY,ee)):G.unique?de.continue(de.key.slice(0,se).concat(G.reverse?g.MIN_KEY:g.MAX_KEY,ee)):de.continue()}},continuePrimaryKey:{value:function(ge,Ae){de.continuePrimaryKey($h(ge,g.MAX_KEY,ee),Ae)}},primaryKey:{get:function(){return de.primaryKey}},key:{get:function(){var ge=de.key;return se===1?ge[0]:ge.slice(0,se)}},value:{get:function(){return de.value}}})}}})}})}};function Pg(g,b,A,P){return A=A||{},P=P||"",o(g).forEach(function(I){var M,U,V;y(b,I)?(M=g[I],U=b[I],typeof M=="object"&&typeof U=="object"&&M&&U?(V=_e(M))!==_e(U)?A[P+I]=b[I]:V==="Object"?Pg(M,U,A,P+I+"."):M!==U&&(A[P+I]=b[I]):M!==U&&(A[P+I]=b[I])):A[P+I]=void 0}),o(b).forEach(function(I){y(g,I)||(A[P+I]=b[I])}),A}function Rg(g,b){return b.type==="delete"?b.keys:b.keys||b.values.map(g.extractKey)}var Sx={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(g){return n(n({},g),{table:function(b){var A=g.table(b),P=A.schema.primaryKey;return n(n({},A),{mutate:function(I){var M=it.trans,U=M.table(b).hook,V=U.deleting,J=U.creating,X=U.updating;switch(I.type){case"add":if(J.fire===tt)break;return M._promise("readwrite",function(){return oe(I)},!0);case"put":if(J.fire===tt&&X.fire===tt)break;return M._promise("readwrite",function(){return oe(I)},!0);case"delete":if(V.fire===tt)break;return M._promise("readwrite",function(){return oe(I)},!0);case"deleteRange":if(V.fire===tt)break;return M._promise("readwrite",function(){return(function G(ce,ee,ie){return A.query({trans:ce,values:!1,query:{index:P,range:ee},limit:ie}).then(function(se){var le=se.result;return oe({type:"delete",keys:le,trans:ce}).then(function(de){return 0<de.numFailures?Promise.reject(de.failures[0]):le.length<ie?{failures:[],numFailures:0,lastResult:void 0}:G(ce,n(n({},ee),{lower:le[le.length-1],lowerOpen:!0}),ie)})})})(I.trans,I.range,1e4)},!0)}return A.mutate(I);function oe(G){var ce,ee,ie,se=it.trans,le=G.keys||Rg(P,G);if(!le)throw new Error("Keys missing");return(G=G.type==="add"||G.type==="put"?n(n({},G),{keys:le}):n({},G)).type!=="delete"&&(G.values=r([],G.values)),G.keys&&(G.keys=r([],G.keys)),ce=A,ie=le,((ee=G).type==="add"?Promise.resolve([]):ce.getMany({trans:ee.trans,keys:ie,cache:"immutable"})).then(function(de){var ge=le.map(function(Ae,Ce){var Me,$e,Oe,De=de[Ce],Ue={onerror:null,onsuccess:null};return G.type==="delete"?V.fire.call(Ue,Ae,De,se):G.type==="add"||De===void 0?(Me=J.fire.call(Ue,Ae,G.values[Ce],se),Ae==null&&Me!=null&&(G.keys[Ce]=Ae=Me,P.outbound||H(G.values[Ce],P.keyPath,Ae))):(Me=Pg(De,G.values[Ce]),($e=X.fire.call(Ue,Me,Ae,De,se))&&(Oe=G.values[Ce],Object.keys($e).forEach(function(Be){y(Oe,Be)?Oe[Be]=$e[Be]:H(Oe,Be,$e[Be])}))),Ue});return A.mutate(G).then(function(Ae){for(var Ce=Ae.failures,Me=Ae.results,$e=Ae.numFailures,Ae=Ae.lastResult,Oe=0;Oe<le.length;++Oe){var De=(Me||le)[Oe],Ue=ge[Oe];De==null?Ue.onerror&&Ue.onerror(Ce[Oe]):Ue.onsuccess&&Ue.onsuccess(G.type==="put"&&de[Oe]?G.values[Oe]:De)}return{failures:Ce,results:Me,numFailures:$e,lastResult:Ae}}).catch(function(Ae){return ge.forEach(function(Ce){return Ce.onerror&&Ce.onerror(Ae)}),Promise.reject(Ae)})})}}})}})}};function dv(g,b,A){try{if(!b||b.keys.length<g.length)return null;for(var P=[],I=0,M=0;I<b.keys.length&&M<g.length;++I)gt(b.keys[I],g[M])===0&&(P.push(A?xe(b.values[I]):b.values[I]),++M);return P.length===g.length?P:null}catch{return null}}var Ex={stack:"dbcore",level:-1,create:function(g){return{table:function(b){var A=g.table(b);return n(n({},A),{getMany:function(P){if(!P.cache)return A.getMany(P);var I=dv(P.keys,P.trans._cache,P.cache==="clone");return I?He.resolve(I):A.getMany(P).then(function(M){return P.trans._cache={keys:P.keys,values:P.cache==="clone"?xe(M):M},M})},mutate:function(P){return P.type!=="add"&&(P.trans._cache=null),A.mutate(P)}})}}}};function hv(g,b){return g.trans.mode==="readonly"&&!!g.subscr&&!g.trans.explicit&&g.trans.db._options.cache!=="disabled"&&!b.schema.primaryKey.outbound}function fv(g,b){switch(g){case"query":return b.values&&!b.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ig={stack:"dbcore",level:0,name:"Observability",create:function(g){var b=g.schema.name,A=new lr(g.MIN_KEY,g.MAX_KEY);return n(n({},g),{transaction:function(P,I,M){if(it.subscr&&I!=="readonly")throw new Ee.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(it.querier));return g.transaction(P,I,M)},table:function(P){var I=g.table(P),M=I.schema,U=M.primaryKey,G=M.indexes,V=U.extractKey,J=U.outbound,X=U.autoIncrement&&G.filter(function(ee){return ee.compound&&ee.keyPath.includes(U.keyPath)}),oe=n(n({},I),{mutate:function(ee){function ie(Be){return Be="idb://".concat(b,"/").concat(P,"/").concat(Be),Ae[Be]||(Ae[Be]=new lr)}var se,le,de,ge=ee.trans,Ae=ee.mutatedParts||(ee.mutatedParts={}),Ce=ie(""),Me=ie(":dels"),$e=ee.type,Ue=ee.type==="deleteRange"?[ee.range]:ee.type==="delete"?[ee.keys]:ee.values.length<50?[Rg(U,ee).filter(function(Be){return Be}),ee.values]:[],Oe=Ue[0],De=Ue[1],Ue=ee.trans._cache;return u(Oe)?(Ce.addKeys(Oe),(Ue=$e==="delete"||Oe.length===De.length?dv(Oe,Ue):null)||Me.addKeys(Oe),(Ue||De)&&(se=ie,le=Ue,de=De,M.indexes.forEach(function(Be){var Ge=se(Be.name||"");function vt(kt){return kt!=null?Be.extractKey(kt):null}function _t(kt){return Be.multiEntry&&u(kt)?kt.forEach(function(Lr){return Ge.addKey(Lr)}):Ge.addKey(kt)}(le||de).forEach(function(kt,Yn){var yt=le&&vt(le[Yn]),Yn=de&&vt(de[Yn]);gt(yt,Yn)!==0&&(yt!=null&&_t(yt),Yn!=null&&_t(Yn))})}))):Oe?(De={from:(De=Oe.lower)!==null&&De!==void 0?De:g.MIN_KEY,to:(De=Oe.upper)!==null&&De!==void 0?De:g.MAX_KEY},Me.add(De),Ce.add(De)):(Ce.add(A),Me.add(A),M.indexes.forEach(function(Be){return ie(Be.name).add(A)})),I.mutate(ee).then(function(Be){return!Oe||ee.type!=="add"&&ee.type!=="put"||(Ce.addKeys(Be.results),X&&X.forEach(function(Ge){for(var vt=ee.values.map(function(yt){return Ge.extractKey(yt)}),_t=Ge.keyPath.findIndex(function(yt){return yt===U.keyPath}),kt=0,Lr=Be.results.length;kt<Lr;++kt)vt[kt][_t]=Be.results[kt];ie(Ge.name).addKeys(vt)})),ge.mutatedParts=Lh(ge.mutatedParts||{},Ae),Be})}}),G=function(ie){var se=ie.query,ie=se.index,se=se.range;return[ie,new lr((ie=se.lower)!==null&&ie!==void 0?ie:g.MIN_KEY,(se=se.upper)!==null&&se!==void 0?se:g.MAX_KEY)]},ce={get:function(ee){return[U,new lr(ee.key)]},getMany:function(ee){return[U,new lr().addKeys(ee.keys)]},count:G,query:G,openCursor:G};return o(ce).forEach(function(ee){oe[ee]=function(ie){var se=it.subscr,le=!!se,de=hv(it,I)&&fv(ee,ie)?ie.obsSet={}:se;if(le){var ge=function(De){return De="idb://".concat(b,"/").concat(P,"/").concat(De),de[De]||(de[De]=new lr)},Ae=ge(""),Ce=ge(":dels"),se=ce[ee](ie),le=se[0],se=se[1];if((ee==="query"&&le.isPrimaryKey&&!ie.values?Ce:ge(le.name||"")).add(se),!le.isPrimaryKey){if(ee!=="count"){var Me=ee==="query"&&J&&ie.values&&I.query(n(n({},ie),{values:!1}));return I[ee].apply(this,arguments).then(function(De){if(ee==="query"){if(J&&ie.values)return Me.then(function(vt){return vt=vt.result,Ae.addKeys(vt),De});var Ue=ie.values?De.result.map(V):De.result;(ie.values?Ae:Ce).addKeys(Ue)}else if(ee==="openCursor"){var Be=De,Ge=ie.values;return Be&&Object.create(Be,{key:{get:function(){return Ce.addKey(Be.primaryKey),Be.key}},primaryKey:{get:function(){var vt=Be.primaryKey;return Ce.addKey(vt),vt}},value:{get:function(){return Ge&&Ae.addKey(Be.primaryKey),Be.value}}})}return De})}Ce.add(A)}}return I[ee].apply(this,arguments)}}),oe}})}};function Gl(g,b,A){if(A.numFailures===0)return b;if(b.type==="deleteRange")return null;var P=b.keys?b.keys.length:"values"in b&&b.values?b.values.length:1;return A.numFailures===P?null:(b=n({},b),u(b.keys)&&(b.keys=b.keys.filter(function(I,M){return!(M in A.failures)})),"values"in b&&u(b.values)&&(b.values=b.values.filter(function(I,M){return!(M in A.failures)})),b)}function Og(g,b){return A=g,((P=b).lower===void 0||(P.lowerOpen?0<gt(A,P.lower):0<=gt(A,P.lower)))&&(g=g,(b=b).upper===void 0||(b.upperOpen?gt(g,b.upper)<0:gt(g,b.upper)<=0));var A,P}function jg(g,b,ce,P,I,M){if(!ce||ce.length===0)return g;var U=b.query.index,V=U.multiEntry,J=b.query.range,X=P.schema.primaryKey.extractKey,oe=U.extractKey,G=(U.lowLevelIndex||U).extractKey,ce=ce.reduce(function(ee,ie){var se=ee,le=[];if(ie.type==="add"||ie.type==="put")for(var de=new lr,ge=ie.values.length-1;0<=ge;--ge){var Ae,Ce=ie.values[ge],Me=X(Ce);de.hasKey(Me)||(Ae=oe(Ce),(V&&u(Ae)?Ae.some(function(Be){return Og(Be,J)}):Og(Ae,J))&&(de.addKey(Me),le.push(Ce)))}switch(ie.type){case"add":var $e=new lr().addKeys(b.values?ee.map(function(Ge){return X(Ge)}):ee),se=ee.concat(b.values?le.filter(function(Ge){return Ge=X(Ge),!$e.hasKey(Ge)&&($e.addKey(Ge),!0)}):le.map(function(Ge){return X(Ge)}).filter(function(Ge){return!$e.hasKey(Ge)&&($e.addKey(Ge),!0)}));break;case"put":var Oe=new lr().addKeys(ie.values.map(function(Ge){return X(Ge)}));se=ee.filter(function(Ge){return!Oe.hasKey(b.values?X(Ge):Ge)}).concat(b.values?le:le.map(function(Ge){return X(Ge)}));break;case"delete":var De=new lr().addKeys(ie.keys);se=ee.filter(function(Ge){return!De.hasKey(b.values?X(Ge):Ge)});break;case"deleteRange":var Ue=ie.range;se=ee.filter(function(Ge){return!Og(X(Ge),Ue)})}return se},g);return ce===g?g:(ce.sort(function(ee,ie){return gt(G(ee),G(ie))||gt(X(ee),X(ie))}),b.limit&&b.limit<1/0&&(ce.length>b.limit?ce.length=b.limit:g.length===b.limit&&ce.length<b.limit&&(I.dirty=!0)),M?Object.freeze(ce):ce)}function Mg(g,b){return gt(g.lower,b.lower)===0&&gt(g.upper,b.upper)===0&&!!g.lowerOpen==!!b.lowerOpen&&!!g.upperOpen==!!b.upperOpen}function pv(g,b){return(function(A,P,I,M){if(A===void 0)return P!==void 0?-1:0;if(P===void 0)return 1;if((P=gt(A,P))===0){if(I&&M)return 0;if(I)return 1;if(M)return-1}return P})(g.lower,b.lower,g.lowerOpen,b.lowerOpen)<=0&&0<=(function(A,P,I,M){if(A===void 0)return P!==void 0?1:0;if(P===void 0)return-1;if((P=gt(A,P))===0){if(I&&M)return 0;if(I)return-1;if(M)return 1}return P})(g.upper,b.upper,g.upperOpen,b.upperOpen)}function gv(g,b,A,P){g.subscribers.add(A),P.addEventListener("abort",function(){var I,M;g.subscribers.delete(A),g.subscribers.size===0&&(I=g,M=b,setTimeout(function(){I.subscribers.size===0&&Z(M,I)},3e3))})}var mv={stack:"dbcore",level:0,name:"Cache",create:function(g){var b=g.schema.name;return n(n({},g),{transaction:function(A,P,I){var M,U,V=g.transaction(A,P,I);return P==="readwrite"&&(U=(M=new AbortController).signal,I=function(J){return function(){if(M.abort(),P==="readwrite"){for(var X=new Set,oe=0,G=A;oe<G.length;oe++){var ce=G[oe],ee=So["idb://".concat(b,"/").concat(ce)];if(ee){var ie=g.table(ce),se=ee.optimisticOps.filter(function(Ge){return Ge.trans===V});if(V._explicit&&J&&V.mutatedParts)for(var le=0,de=Object.values(ee.queries.query);le<de.length;le++)for(var ge=0,Ae=($e=de[le]).slice();ge<Ae.length;ge++)Ag((Oe=Ae[ge]).obsSet,V.mutatedParts)&&(Z($e,Oe),Oe.subscribers.forEach(function(Ge){return X.add(Ge)}));else if(0<se.length){ee.optimisticOps=ee.optimisticOps.filter(function(Ge){return Ge.trans!==V});for(var Ce=0,Me=Object.values(ee.queries.query);Ce<Me.length;Ce++)for(var $e,Oe,De,Ue=0,Be=($e=Me[Ce]).slice();Ue<Be.length;Ue++)(Oe=Be[Ue]).res!=null&&V.mutatedParts&&(J&&!Oe.dirty?(De=Object.isFrozen(Oe.res),De=jg(Oe.res,Oe.req,se,ie,Oe,De),Oe.dirty?(Z($e,Oe),Oe.subscribers.forEach(function(Ge){return X.add(Ge)})):De!==Oe.res&&(Oe.res=De,Oe.promise=He.resolve({result:De}))):(Oe.dirty&&Z($e,Oe),Oe.subscribers.forEach(function(Ge){return X.add(Ge)})))}}}X.forEach(function(Ge){return Ge()})}}},V.addEventListener("abort",I(!1),{signal:U}),V.addEventListener("error",I(!1),{signal:U}),V.addEventListener("complete",I(!0),{signal:U})),V},table:function(A){var P=g.table(A),I=P.schema.primaryKey;return n(n({},P),{mutate:function(M){var U=it.trans;if(I.outbound||U.db._options.cache==="disabled"||U.explicit||U.idbtrans.mode!=="readwrite")return P.mutate(M);var V=So["idb://".concat(b,"/").concat(A)];return V?(U=P.mutate(M),M.type!=="add"&&M.type!=="put"||!(50<=M.values.length||Rg(I,M).some(function(J){return J==null}))?(V.optimisticOps.push(M),M.mutatedParts&&Fh(M.mutatedParts),U.then(function(J){0<J.numFailures&&(Z(V.optimisticOps,M),(J=Gl(0,M,J))&&V.optimisticOps.push(J),M.mutatedParts&&Fh(M.mutatedParts))}),U.catch(function(){Z(V.optimisticOps,M),M.mutatedParts&&Fh(M.mutatedParts)})):U.then(function(J){var X=Gl(0,n(n({},M),{values:M.values.map(function(oe,G){var ce;return J.failures[G]?oe:(oe=(ce=I.keyPath)!==null&&ce!==void 0&&ce.includes(".")?xe(oe):n({},oe),H(oe,I.keyPath,J.results[G]),oe)})}),J);V.optimisticOps.push(X),queueMicrotask(function(){return M.mutatedParts&&Fh(M.mutatedParts)})}),U):P.mutate(M)},query:function(M){if(!hv(it,P)||!fv("query",M))return P.query(M);var U=((X=it.trans)===null||X===void 0?void 0:X.db._options.cache)==="immutable",G=it,V=G.requery,J=G.signal,X=(function(ie,se,le,de){var ge=So["idb://".concat(ie,"/").concat(se)];if(!ge)return[];if(!(se=ge.queries[le]))return[null,!1,ge,null];var Ae=se[(de.query?de.query.index.name:null)||""];if(!Ae)return[null,!1,ge,null];switch(le){case"query":var Ce=Ae.find(function(Me){return Me.req.limit===de.limit&&Me.req.values===de.values&&Mg(Me.req.query.range,de.query.range)});return Ce?[Ce,!0,ge,Ae]:[Ae.find(function(Me){return("limit"in Me.req?Me.req.limit:1/0)>=de.limit&&(!de.values||Me.req.values)&&pv(Me.req.query.range,de.query.range)}),!1,ge,Ae];case"count":return Ce=Ae.find(function(Me){return Mg(Me.req.query.range,de.query.range)}),[Ce,!!Ce,ge,Ae]}})(b,A,"query",M),oe=X[0],G=X[1],ce=X[2],ee=X[3];return oe&&G?oe.obsSet=M.obsSet:(G=P.query(M).then(function(ie){var se=ie.result;if(oe&&(oe.res=se),U){for(var le=0,de=se.length;le<de;++le)Object.freeze(se[le]);Object.freeze(se)}else ie.result=xe(se);return ie}).catch(function(ie){return ee&&oe&&Z(ee,oe),Promise.reject(ie)}),oe={obsSet:M.obsSet,promise:G,subscribers:new Set,type:"query",req:M,dirty:!1},ee?ee.push(oe):(ee=[oe],(ce=ce||(So["idb://".concat(b,"/").concat(A)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[M.query.index.name||""]=ee)),gv(oe,ee,V,J),oe.promise.then(function(ie){return{result:jg(ie.result,M,ce==null?void 0:ce.optimisticOps,P,oe,U)}})}})}})}};function Mi(g,b){return new Proxy(g,{get:function(A,P,I){return P==="db"?b:Reflect.get(A,P,I)}})}var Di=(An.prototype.version=function(g){if(isNaN(g)||g<.1)throw new Ee.Type("Given version is not a positive number");if(g=Math.round(10*g)/10,this.idbdb||this._state.isBeingOpened)throw new Ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,g);var b=this._versions,A=b.filter(function(P){return P._cfg.version===g})[0];return A||(A=new this.Version(g),b.push(A),b.sort(Sg),A.stores({}),this._state.autoSchema=!1,A)},An.prototype._whenReady=function(g){var b=this;return this.idbdb&&(this._state.openComplete||it.letThrough||this._vip)?g():new He(function(A,P){if(b._state.openComplete)return P(new Ee.DatabaseClosed(b._state.dbOpenError));if(!b._state.isBeingOpened){if(!b._state.autoOpen)return void P(new Ee.DatabaseClosed);b.open().catch(tt)}b._state.dbReadyPromise.then(A,P)}).then(g)},An.prototype.use=function(g){var b=g.stack,A=g.create,P=g.level,I=g.name;return I&&this.unuse({stack:b,name:I}),g=this._middlewares[b]||(this._middlewares[b]=[]),g.push({stack:b,create:A,level:P??10,name:I}),g.sort(function(M,U){return M.level-U.level}),this},An.prototype.unuse=function(g){var b=g.stack,A=g.name,P=g.create;return b&&this._middlewares[b]&&(this._middlewares[b]=this._middlewares[b].filter(function(I){return P?I.create!==P:!!A&&I.name!==A})),this},An.prototype.open=function(){var g=this;return mo(uo,function(){return _x(g)})},An.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var g=this._state,b=yo.indexOf(this);if(0<=b&&yo.splice(b,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}g.isBeingOpened||(g.dbReadyPromise=new He(function(A){g.dbReadyResolve=A}),g.openCanceller=new He(function(A,P){g.cancelOpen=P}))},An.prototype.close=function(A){var b=(A===void 0?{disableAutoOpen:!0}:A).disableAutoOpen,A=this._state;b?(A.isBeingOpened&&A.cancelOpen(new Ee.DatabaseClosed),this._close(),A.autoOpen=!1,A.dbOpenError=new Ee.DatabaseClosed):(this._close(),A.autoOpen=this._options.autoOpen||A.isBeingOpened,A.openComplete=!1,A.dbOpenError=null)},An.prototype.delete=function(g){var b=this;g===void 0&&(g={disableAutoOpen:!0});var A=0<arguments.length&&typeof arguments[0]!="object",P=this._state;return new He(function(I,M){function U(){b.close(g);var V=b._deps.indexedDB.deleteDatabase(b.name);V.onsuccess=Gt(function(){var J,X,oe;J=b._deps,X=b.name,oe=J.indexedDB,J=J.IDBKeyRange,ba(oe)||X===gu||Au(oe,J).delete(X).catch(tt),I()}),V.onerror=Xn(M),V.onblocked=b._fireOnBlocked}if(A)throw new Ee.InvalidArgument("Invalid closeOptions argument to db.delete()");P.isBeingOpened?P.dbReadyPromise.then(U):U()})},An.prototype.backendDB=function(){return this.idbdb},An.prototype.isOpen=function(){return this.idbdb!==null},An.prototype.hasBeenClosed=function(){var g=this._state.dbOpenError;return g&&g.name==="DatabaseClosed"},An.prototype.hasFailed=function(){return this._state.dbOpenError!==null},An.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(An.prototype,"tables",{get:function(){var g=this;return o(this._allTables).map(function(b){return g._allTables[b]})},enumerable:!1,configurable:!0}),An.prototype.transaction=function(){var g=(function(b,A,P){var I=arguments.length;if(I<2)throw new Ee.InvalidArgument("Too few arguments");for(var M=new Array(I-1);--I;)M[I-1]=arguments[I];return P=M.pop(),[b,me(M),P]}).apply(this,arguments);return this._transaction.apply(this,g)},An.prototype._transaction=function(g,b,A){var P=this,I=it.trans;I&&I.db===this&&g.indexOf("!")===-1||(I=null);var M,U,V=g.indexOf("?")!==-1;g=g.replace("!","").replace("?","");try{if(U=b.map(function(X){if(X=X instanceof P.Table?X.name:X,typeof X!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return X}),g=="r"||g===Ll)M=Ll;else{if(g!="rw"&&g!=bg)throw new Ee.InvalidArgument("Invalid transaction mode: "+g);M=bg}if(I){if(I.mode===Ll&&M===bg){if(!V)throw new Ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");I=null}I&&U.forEach(function(X){if(I&&I.storeNames.indexOf(X)===-1){if(!V)throw new Ee.SubTransaction("Table "+X+" not included in parent transaction.");I=null}}),V&&I&&!I.active&&(I=null)}}catch(X){return I?I._promise(null,function(oe,G){G(X)}):En(X)}var J=(function X(oe,G,ce,ee,ie){return He.resolve().then(function(){var se=it.transless||it,le=oe._createTransaction(G,ce,oe._dbSchema,ee);if(le.explicit=!0,se={trans:le,transless:se},ee)le.idbtrans=ee.idbtrans;else try{le.create(),le.idbtrans._explicit=!0,oe._state.PR1398_maxLoop=3}catch(Ae){return Ae.name===be.InvalidState&&oe.isOpen()&&0<--oe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),oe.close({disableAutoOpen:!1}),oe.open().then(function(){return X(oe,G,ce,null,ie)})):En(Ae)}var de,ge=z(ie);return ge&&Dl(),se=He.follow(function(){var Ae;(de=ie.call(le,le))&&(ge?(Ae=Dr.bind(null,null),de.then(Ae,Ae)):typeof de.next=="function"&&typeof de.throw=="function"&&(de=Ng(de)))},se),(de&&typeof de.then=="function"?He.resolve(de).then(function(Ae){return le.active?Ae:En(new Ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):se.then(function(){return de})).then(function(Ae){return ee&&le._resolve(),le._completion.then(function(){return Ae})}).catch(function(Ae){return le._reject(Ae),En(Ae)})})}).bind(null,this,M,U,I,A);return I?I._promise(M,J,"lock"):it.trans?mo(it.transless,function(){return P._whenReady(J)}):this._whenReady(J)},An.prototype.table=function(g){if(!y(this._allTables,g))throw new Ee.InvalidTable("Table ".concat(g," does not exist"));return this._allTables[g]},An);function An(g,b){var A=this;this._middlewares={},this.verno=0;var P=An.dependencies;this._options=b=n({addons:An.addons,autoOpen:!0,indexedDB:P.indexedDB,IDBKeyRange:P.IDBKeyRange,cache:"cloned"},b),this._deps={indexedDB:b.indexedDB,IDBKeyRange:b.IDBKeyRange},P=b.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var I,M,U,V,J,X={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:tt,dbReadyPromise:null,cancelOpen:tt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:b.autoOpen};X.dbReadyPromise=new He(function(G){X.dbReadyResolve=G}),X.openCanceller=new He(function(G,ce){X.cancelOpen=ce}),this._state=X,this.name=g,this.on=bu(this,"populate","blocked","versionchange","close",{ready:[sa,tt]}),this.once=function(G,ce){var ee=function(){for(var ie=[],se=0;se<arguments.length;se++)ie[se]=arguments[se];A.on(G).unsubscribe(ee),ce.apply(A,ie)};return A.on(G,ee)},this.on.ready.subscribe=j(this.on.ready.subscribe,function(G){return function(ce,ee){An.vip(function(){var ie,se=A._state;se.openComplete?(se.dbOpenError||He.resolve().then(ce),ee&&G(ce)):se.onReadyBeingFired?(se.onReadyBeingFired.push(ce),ee&&G(ce)):(G(ce),ie=A,ee||G(function le(){ie.on.ready.unsubscribe(ce),ie.on.ready.unsubscribe(le)}))})}}),this.Collection=(I=this,pa(nv.prototype,function(de,le){this.db=I;var ee=mu,ie=null;if(le)try{ee=le()}catch(ge){ie=ge}var se=de._ctx,le=se.table,de=le.hook.reading.fire;this._ctx={table:le,index:se.index,isPrimKey:!se.index||le.schema.primKey.keyPath&&se.index===le.schema.primKey.name,range:ee,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:ie,or:se.or,valueMapper:de!==Ht?de:null}})),this.Table=(M=this,pa(vu.prototype,function(G,ce,ee){this.db=M,this._tx=ee,this.name=G,this.schema=ce,this.hook=M._allTables[G]?M._allTables[G].hook:bu(null,{creating:[Mt,tt],reading:[Le,Ht],updating:[Tl,tt],deleting:[Nt,tt]})})),this.Transaction=(U=this,pa(iv.prototype,function(G,ce,ee,ie,se){var le=this;G!=="readonly"&&ce.forEach(function(de){de=(de=ee[de])===null||de===void 0?void 0:de.yProps,de&&(ce=ce.concat(de.map(function(ge){return ge.updatesTable})))}),this.db=U,this.mode=G,this.storeNames=ce,this.schema=ee,this.chromeTransactionDurability=ie,this.idbtrans=null,this.on=bu(this,"complete","error","abort"),this.parent=se||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new He(function(de,ge){le._resolve=de,le._reject=ge}),this._completion.then(function(){le.active=!1,le.on.complete.fire()},function(de){var ge=le.active;return le.active=!1,le.on.error.fire(de),le.parent?le.parent._reject(de):ge&&le.idbtrans&&le.idbtrans.abort(),En(de)})})),this.Version=(V=this,pa(xx.prototype,function(G){this.db=V,this._cfg={version:G,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(J=this,pa(Bl.prototype,function(G,ce,ee){if(this.db=J,this._ctx={table:G,index:ce===":id"?null:ce,or:ee},this._cmp=this._ascending=gt,this._descending=function(ie,se){return gt(se,ie)},this._max=function(ie,se){return 0<gt(ie,se)?ie:se},this._min=function(ie,se){return gt(ie,se)<0?ie:se},this._IDBKeyRange=J._deps.IDBKeyRange,!this._IDBKeyRange)throw new Ee.MissingAPI})),this.on("versionchange",function(G){0<G.newVersion?console.warn("Another connection wants to upgrade database '".concat(A.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(A.name,"'. Closing db now to resume the delete request.")),A.close({disableAutoOpen:!1})}),this.on("blocked",function(G){!G.newVersion||G.newVersion<G.oldVersion?console.warn("Dexie.delete('".concat(A.name,"') was blocked")):console.warn("Upgrade '".concat(A.name,"' blocked by other connection holding version ").concat(G.oldVersion/10))}),this._maxKey=Oi(b.IDBKeyRange),this._createTransaction=function(G,ce,ee,ie){return new A.Transaction(G,ce,ee,A._options.chromeTransactionDurability,ie)},this._fireOnBlocked=function(G){A.on("blocked").fire(G),yo.filter(function(ce){return ce.name===A.name&&ce!==A&&!ce._state.vcFired}).map(function(ce){return ce.on("versionchange").fire(G)})},this.use(Ex),this.use(mv),this.use(Ig),this.use(uv),this.use(Sx);var oe=new Proxy(this,{get:function(G,ce,ee){if(ce==="_vip")return!0;if(ce==="table")return function(se){return Mi(A.table(se),oe)};var ie=Reflect.get(G,ce,ee);return ie instanceof vu?Mi(ie,oe):ce==="tables"?ie.map(function(se){return Mi(se,oe)}):ce==="_createTransaction"?function(){return Mi(ie.apply(this,arguments),oe)}:ie}});this.vip=oe,P.forEach(function(G){return G(A)})}var Uh,Zr=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",yv=(wa.prototype.subscribe=function(g,b,A){return this._subscribe(g&&typeof g!="function"?g:{next:g,error:b,complete:A})},wa.prototype[Zr]=function(){return this},wa);function wa(g){this._subscribe=g}try{Uh={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{Uh={indexedDB:null,IDBKeyRange:null}}function Kl(g){var b,A=!1,P=new yv(function(I){var M=z(g),U,V=!1,J={},X={},oe={get closed(){return V},unsubscribe:function(){V||(V=!0,U&&U.abort(),G&&wo.storagemutated.unsubscribe(ee))}};I.start&&I.start(oe);var G=!1,ce=function(){return Ch(ie)},ee=function(se){Lh(J,se),Ag(X,J)&&ce()},ie=function(){var se,le,de;!V&&Uh.indexedDB&&(J={},se={},U&&U.abort(),U=new AbortController,de=(function(ge){var Ae=fo();try{M&&Dl();var Ce=po(g,ge);return Ce=M?Ce.finally(Dr):Ce}finally{Ae&&ca()}})(le={subscr:se,signal:U.signal,requery:ce,querier:g,trans:null}),Promise.resolve(de).then(function(ge){A=!0,b=ge,V||le.signal.aborted||(J={},(function(Ae){for(var Ce in Ae)if(y(Ae,Ce))return;return 1})(X=se)||G||(wo($l,ee),G=!0),Ch(function(){return!V&&I.next&&I.next(ge)}))},function(ge){A=!1,["DatabaseClosedError","AbortError"].includes(ge==null?void 0:ge.name)||V||Ch(function(){V||I.error&&I.error(ge)})}))};return setTimeout(ce,0),oe});return P.hasValue=function(){return A},P.getValue=function(){return b},P}var xa=Di;function Xl(g){var b=Li;try{Li=!0,wo.storagemutated.fire(g),Tg(g,!0)}finally{Li=b}}v(xa,n(n({},bt),{delete:function(g){return new xa(g,{addons:[]}).delete()},exists:function(g){return new xa(g,{addons:[]}).open().then(function(b){return b.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(g){try{return b=xa.dependencies,A=b.indexedDB,b=b.IDBKeyRange,(ba(A)?Promise.resolve(A.databases()).then(function(P){return P.map(function(I){return I.name}).filter(function(I){return I!==gu})}):Au(A,b).toCollection().primaryKeys()).then(g)}catch{return En(new Ee.MissingAPI)}var b,A},defineClass:function(){return function(g){d(this,g)}},ignoreTransaction:function(g){return it.trans?mo(it.transless,g):g()},vip:Wl,async:function(g){return function(){try{var b=Ng(g.apply(this,arguments));return b&&typeof b.then=="function"?b:He.resolve(b)}catch(A){return En(A)}}},spawn:function(g,b,A){try{var P=Ng(g.apply(A,b||[]));return P&&typeof P.then=="function"?P:He.resolve(P)}catch(I){return En(I)}},currentTransaction:{get:function(){return it.trans||null}},waitFor:function(g,b){return b=He.resolve(typeof g=="function"?xa.ignoreTransaction(g):g).timeout(b||6e4),it.trans?it.trans.waitFor(b):b},Promise:He,debug:{get:function(){return br},set:function(g){Sh(g)}},derive:E,extend:d,props:v,override:j,Events:bu,on:wo,liveQuery:Kl,extendObservabilitySet:Lh,getByKeyPath:$,setByKeyPath:H,delByKeyPath:function(g,b){typeof b=="string"?H(g,b,void 0):"length"in b&&[].map.call(b,function(A){H(g,A,void 0)})},shallowClone:W,deepClone:xe,getObjectDiff:Pg,cmp:gt,asap:B,minKey:-1/0,addons:[],connections:yo,errnames:be,dependencies:Uh,cache:So,semVer:"4.2.1",version:"4.2.1".split(".").map(function(g){return parseInt(g)}).reduce(function(g,b,A){return g+b/Math.pow(10,2*A)})})),xa.maxKey=Oi(xa.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(wo($l,function(g){Li||(g=new CustomEvent(ya,{detail:g}),Li=!0,dispatchEvent(g),Li=!1)}),addEventListener(ya,function(g){g=g.detail,Li||Xl(g)}));var Yl,Li=!1,zh=function(){};return typeof BroadcastChannel<"u"&&((zh=function(){(Yl=new BroadcastChannel(ya)).onmessage=function(g){return g.data&&Xl(g.data)}})(),typeof Yl.unref=="function"&&Yl.unref(),wo($l,function(g){Li||Yl.postMessage(g)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(g){if(!Di.disableBfCache&&g.persisted){br&&console.debug("Dexie: handling persisted pagehide"),Yl!=null&&Yl.close();for(var b=0,A=yo;b<A.length;b++)A[b].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(g){!Di.disableBfCache&&g.persisted&&(br&&console.debug("Dexie: handling persisted pageshow"),zh(),Xl({all:new lr(-1/0,[[]])}))})),He.rejectionMapper=function(g,b){return!g||g instanceof Se||g instanceof TypeError||g instanceof SyntaxError||!g.name||!at[g.name]?g:(b=new at[g.name](b||g.message,g),"stack"in g&&S(b,"stack",{get:function(){return this.inner.stack}}),b)},Sh(br),n(Di,Object.freeze({__proto__:null,Dexie:Di,liveQuery:Kl,Entity:Z0,cmp:gt,PropModification:bo,replacePrefix:function(g,b){return new bo({replacePrefix:[g,b]})},add:function(g){return new bo({add:g})},remove:function(g){return new bo({remove:g})},default:Di,RangeSet:lr,mergeRanges:Cu,rangesOverlap:Mh}),{default:Di}),Di})})(Tb)),Tb.exports}var rO=nO();const lS=tA(rO),Rk=Symbol.for("Dexie"),vw=globalThis[Rk]||(globalThis[Rk]=lS);if(lS.semVer!==vw.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${lS.semVer} and ${vw.semVer}`);const{liveQuery:yB,mergeRanges:vB,rangesOverlap:bB,RangeSet:wB,cmp:xB,Entity:_B,PropModification:SB,replacePrefix:EB,add:AB,remove:kB,DexieYProvider:CB}=vw;class sO extends vw{constructor(){super("RedPenDB");Re(this,"classrooms");Re(this,"students");Re(this,"assignments");Re(this,"submissions");Re(this,"syncQueue");this.version(1).stores({classrooms:"&id, name",students:"&id, classroomId, seatNumber, name",assignments:"&id, classroomId, title",submissions:"&id, assignmentId, studentId, status, createdAt, [assignmentId+studentId]",syncQueue:"++id, tableName, recordId, createdAt"})}}const ze=new sO;function Dm(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function iO(){return Date.now()}function oO({onBack:a}){const[e,t]=ue.useState([]),[n,r]=ue.useState(!1),[s,o]=ue.useState(null),[u,d]=ue.useState(!1),[f,p]=ue.useState(""),[y,v]=ue.useState(30),[x,S]=ue.useState(""),[E,T]=ue.useState(!1),[N,L]=ue.useState(null),[j,F]=ue.useState(""),[B,$]=ue.useState(!1),H=ue.useCallback(async()=>{r(!0),o(null);try{const[re,xe,ve]=await Promise.all([ze.classrooms.toArray(),ze.students.toArray(),ze.assignments.toArray()]),_e=re.map(pe=>{const fe=xe.filter(ke=>ke.classroomId===pe.id).length,Z=ve.filter(ke=>ke.classroomId===pe.id).length;return{classroom:pe,studentCount:fe,assignmentCount:Z}});t(_e)}catch(re){console.error(re),o(re instanceof Error?re.message:"")}finally{r(!1)}},[]);ue.useEffect(()=>{H()},[H]);const W=re=>{const xe=re.split(/\r?\n/).map(_e=>_e.trim()).filter(_e=>_e.length>0),ve=[];for(const _e of xe){const pe=_e.split(/[\t,;]/).map(Z=>Z.trim()).filter(Z=>Z.length>0);if(pe.length>=2&&/^\d+$/.test(pe[0])){const Z=Number.parseInt(pe[0],10),ke=pe.slice(1).join(" ");Number.isFinite(Z)&&ke&&ve.push({seatNumber:Z,name:ke});continue}const fe=_e.match(/^(\d+)\s+(.+)$/);if(fe){const Z=Number.parseInt(fe[1],10),ke=fe[2].trim();Number.isFinite(Z)&&ke&&ve.push({seatNumber:Z,name:ke})}}return ve.sort((_e,pe)=>_e.seatNumber-pe.seatNumber),ve},ae=async re=>{re.preventDefault();const xe=f.trim(),ve=W(x);if(!xe){o("");return}if(ve.length===0&&(y<1||y>100)){o("");return}T(!0),o(null);try{const _e={id:Dm(),name:xe};await ze.classrooms.add(_e);const pe=[];if(ve.length>0)for(const fe of ve)pe.push({id:Dm(),classroomId:_e.id,seatNumber:fe.seatNumber,name:fe.name});else for(let fe=1;fe<=y;fe+=1)pe.push({id:Dm(),classroomId:_e.id,seatNumber:fe,name:` ${fe}`});pe.length>0&&await ze.students.bulkAdd(pe),p(""),v(30),S(""),d(!1),await H()}catch(_e){console.error(_e),o(_e instanceof Error?_e.message:"")}finally{T(!1)}},me=async()=>{if(!N||!j.trim()){L(null),F("");return}$(!0),o(null);try{const re=j.trim();await ze.classrooms.update(N,{name:re}),t(xe=>xe.map(ve=>ve.classroom.id===N?{...ve,classroom:{...ve.classroom,name:re}}:ve))}catch(re){console.error(re),o(re instanceof Error?re.message:"")}finally{$(!1),L(null),F("")}},ne=async re=>{if(!(B||!window.confirm(""))){$(!0),o(null);try{const ve=re.classroom.id,pe=(await ze.assignments.where("classroomId").equals(ve).toArray()).map(fe=>fe.id);await ze.students.where("classroomId").equals(ve).delete(),pe.length>0&&await ze.submissions.where("assignmentId").anyOf(pe).delete(),await ze.assignments.where("classroomId").equals(ve).delete(),await ze.classrooms.delete(ve),await H()}catch(ve){console.error(ve),o(ve instanceof Error?ve.message:"")}finally{$(!1)}}};return w.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[w.jsxs("div",{className:"max-w-5xl mx-auto pt-8",children:[a&&w.jsxs("button",{onClick:a,className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[w.jsx(kl,{className:"w-5 h-5"}),""]}),w.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6",children:w.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:w.jsx(nA,{className:"w-8 h-8 text-blue-600"})}),w.jsxs("div",{children:[w.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:""}),w.jsx("p",{className:"text-sm text-gray-600",children:""})]})]}),w.jsx("button",{type:"button",onClick:()=>{p(""),v(30),S(""),d(!0)},className:"inline-flex items-center justify-center w-10 h-10 rounded-full bg-blue-600 text-white shadow hover:bg-blue-700",title:"",children:w.jsx(Of,{className:"w-5 h-5"})})]})}),s&&w.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-sm text-red-700 rounded-xl",children:s}),w.jsxs("div",{className:"bg-white rounded-2xl shadow-xl flex flex-col md:flex-row overflow-hidden",children:[w.jsxs("div",{className:"md:w-1/2 border-b md:border-b-0 md:border-r border-gray-200 p-4 md:p-6 max-h-[70vh] overflow-auto",children:[w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(j2,{className:"w-4 h-4 text-blue-500"}),w.jsx("h2",{className:"text-sm font-semibold text-gray-700",children:""})]}),n&&w.jsx(ri,{className:"w-4 h-4 text-gray-400 animate-spin"})]}),e.length===0&&!n&&w.jsx("p",{className:"text-sm text-gray-500",children:""}),w.jsx("div",{className:"space-y-2",children:e.map(re=>w.jsxs("div",{className:"w-full px-3 py-3 rounded-xl border border-gray-200 bg-white hover:bg-gray-50 flex items-center justify-between gap-3",children:[w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsx("div",{className:"flex items-center gap-1",children:N===re.classroom.id?w.jsx("input",{autoFocus:!0,type:"text",value:j,onChange:xe=>F(xe.target.value),onBlur:()=>{me()},onKeyDown:xe=>{xe.key==="Enter"?me():xe.key==="Escape"&&(L(null),F(""))},className:"px-2 py-1 border border-blue-300 rounded text-sm w-full max-w-[180px] focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:B}):w.jsxs(w.Fragment,{children:[w.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:re.classroom.name}),w.jsx("button",{type:"button",onClick:xe=>{xe.stopPropagation(),L(re.classroom.id),F(re.classroom.name)},className:"p-1 text-gray-400 hover:text-blue-600",title:"",children:w.jsx(mw,{className:"w-3 h-3"})})]})}),w.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[re.studentCount,"   ",re.assignmentCount," "]})]}),w.jsx("button",{type:"button",onClick:xe=>{xe.stopPropagation(),ne(re)},className:"p-1.5 rounded-full text-gray-400 hover:text-red-600 hover:bg-red-50 disabled:opacity-60",title:"",disabled:B,children:w.jsx(yw,{className:"w-4 h-4"})})]},re.classroom.id))})]}),w.jsx("div",{className:"md:w-1/2 p-6 flex items-center justify-center",children:w.jsxs("div",{className:"text-sm text-gray-500 space-y-2",children:[w.jsx("p",{className:"font-semibold text-gray-700",children:""}),w.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[w.jsx("li",{children:""}),w.jsxs("li",{children:["",w.jsx("span",{className:"inline-flex items-center px-1",children:w.jsx(mw,{className:"w-3 h-3"})}),""]}),w.jsxs("li",{children:["",w.jsx("span",{className:"inline-flex items-center px-1",children:w.jsx(yw,{className:"w-3 h-3"})}),""]}),w.jsx("li",{children:""})]})]})})]})]}),u&&w.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",onClick:()=>d(!1),children:w.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-auto",onClick:re=>re.stopPropagation(),children:[w.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-base font-semibold text-gray-900",children:""}),w.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:" Excel / CSV "})]}),w.jsx("button",{type:"button",onClick:()=>d(!1),className:"p-1 rounded-full hover:bg-gray-100 text-gray-500",children:""})]}),w.jsxs("form",{onSubmit:ae,className:"px-5 py-4 space-y-4",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:""}),w.jsx("input",{type:"text",value:f,onChange:re=>p(re.target.value),placeholder:"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:E})]}),w.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:""}),w.jsxs("div",{className:"relative",children:[w.jsx("input",{type:"number",min:1,max:100,value:y,onChange:re=>v(Number.isNaN(Number.parseInt(re.target.value,10))?1:Number.parseInt(re.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:E}),w.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-400",children:""})]}),w.jsx("p",{className:"mt-1 text-xs text-gray-500",children:" 1 2..."})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:""}),w.jsx("textarea",{rows:6,value:x,onChange:re=>S(re.target.value),placeholder:` Excel 
1	
2	
3	

1,`,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-xs font-mono focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:E}),w.jsx("p",{className:"mt-1 text-xs text-gray-500",children:""})]})]}),w.jsxs("div",{className:"pt-2 flex justify-end gap-2",children:[w.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 rounded-lg border border-gray-200 text-sm text-gray-600 hover:bg-gray-50",disabled:E,children:""}),w.jsx("button",{type:"submit",disabled:E||!f.trim(),className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:E?w.jsxs(w.Fragment,{children:[w.jsx(ri,{className:"w-4 h-4 animate-spin"}),"..."]}):w.jsxs(w.Fragment,{children:[w.jsx(Of,{className:"w-4 h-4"}),""]})})]})]})]})})]})}var Ik;(function(a){a.STRING="string",a.NUMBER="number",a.INTEGER="integer",a.BOOLEAN="boolean",a.ARRAY="array",a.OBJECT="object"})(Ik||(Ik={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ok;(function(a){a.LANGUAGE_UNSPECIFIED="language_unspecified",a.PYTHON="python"})(Ok||(Ok={}));var jk;(function(a){a.OUTCOME_UNSPECIFIED="outcome_unspecified",a.OUTCOME_OK="outcome_ok",a.OUTCOME_FAILED="outcome_failed",a.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(jk||(jk={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk=["user","model","function","system"];var Dk;(function(a){a.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",a.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",a.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",a.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",a.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",a.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Dk||(Dk={}));var Lk;(function(a){a.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",a.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",a.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",a.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",a.BLOCK_NONE="BLOCK_NONE"})(Lk||(Lk={}));var Fk;(function(a){a.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",a.NEGLIGIBLE="NEGLIGIBLE",a.LOW="LOW",a.MEDIUM="MEDIUM",a.HIGH="HIGH"})(Fk||(Fk={}));var Bk;(function(a){a.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",a.SAFETY="SAFETY",a.OTHER="OTHER"})(Bk||(Bk={}));var Lm;(function(a){a.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",a.STOP="STOP",a.MAX_TOKENS="MAX_TOKENS",a.SAFETY="SAFETY",a.RECITATION="RECITATION",a.LANGUAGE="LANGUAGE",a.BLOCKLIST="BLOCKLIST",a.PROHIBITED_CONTENT="PROHIBITED_CONTENT",a.SPII="SPII",a.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",a.OTHER="OTHER"})(Lm||(Lm={}));var $k;(function(a){a.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",a.RETRIEVAL_QUERY="RETRIEVAL_QUERY",a.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",a.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",a.CLASSIFICATION="CLASSIFICATION",a.CLUSTERING="CLUSTERING"})($k||($k={}));var Uk;(function(a){a.MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.AUTO="AUTO",a.ANY="ANY",a.NONE="NONE"})(Uk||(Uk={}));var zk;(function(a){a.MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.MODE_DYNAMIC="MODE_DYNAMIC"})(zk||(zk={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class af extends Yr{constructor(e,t){super(e),this.response=t}}class uT extends Yr{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class lu extends Yr{}class dT extends Yr{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aO="https://generativelanguage.googleapis.com",lO="v1beta",cO="0.24.1",uO="genai-js";var mh;(function(a){a.GENERATE_CONTENT="generateContent",a.STREAM_GENERATE_CONTENT="streamGenerateContent",a.COUNT_TOKENS="countTokens",a.EMBED_CONTENT="embedContent",a.BATCH_EMBED_CONTENTS="batchEmbedContents"})(mh||(mh={}));class dO{constructor(e,t,n,r,s){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=s}toString(){var e,t;const n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||lO;let s=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||aO}/${n}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}function hO(a){const e=[];return a!=null&&a.apiClient&&e.push(a.apiClient),e.push(`${uO}/${cO}`),e.join(" ")}async function fO(a){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",hO(a.requestOptions)),t.append("x-goog-api-key",a.apiKey);let n=(e=a.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(r){throw new lu(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${r.message}`)}for(const[r,s]of n.entries()){if(r==="x-goog-api-key")throw new lu(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new lu(`Header name ${r} can only be set using the apiClient field`);t.append(r,s)}}return t}async function pO(a,e,t,n,r,s){const o=new dO(a,e,t,n,s);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},vO(s)),{method:"POST",headers:await fO(o),body:r})}}async function B0(a,e,t,n,r,s={},o=fetch){const{url:u,fetchOptions:d}=await pO(a,e,t,n,r,s);return gO(u,d,o)}async function gO(a,e,t=fetch){let n;try{n=await t(a,e)}catch(r){mO(r,a)}return n.ok||await yO(n,a),n}function mO(a,e){let t=a;throw t.name==="AbortError"?(t=new dT(`Request aborted when fetching ${e.toString()}: ${a.message}`),t.stack=a.stack):a instanceof uT||a instanceof lu||(t=new Yr(`Error fetching from ${e.toString()}: ${a.message}`),t.stack=a.stack),t}async function yO(a,e){let t="",n;try{const r=await a.json();t=r.error.message,r.error.details&&(t+=` ${JSON.stringify(r.error.details)}`,n=r.error.details)}catch{}throw new uT(`Error fetching from ${e.toString()}: [${a.status} ${a.statusText}] ${t}`,a.status,a.statusText,n)}function vO(a){const e={};if((a==null?void 0:a.signal)!==void 0||(a==null?void 0:a.timeout)>=0){const t=new AbortController;(a==null?void 0:a.timeout)>=0&&setTimeout(()=>t.abort(),a.timeout),a!=null&&a.signal&&a.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rA(a){return a.text=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Nb(a.candidates[0]))throw new af(`${fc(a)}`,a);return bO(a)}else if(a.promptFeedback)throw new af(`Text not available. ${fc(a)}`,a);return""},a.functionCall=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Nb(a.candidates[0]))throw new af(`${fc(a)}`,a);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Hk(a)[0]}else if(a.promptFeedback)throw new af(`Function call not available. ${fc(a)}`,a)},a.functionCalls=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Nb(a.candidates[0]))throw new af(`${fc(a)}`,a);return Hk(a)}else if(a.promptFeedback)throw new af(`Function call not available. ${fc(a)}`,a)},a}function bO(a){var e,t,n,r;const s=[];if(!((t=(e=a.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const o of(r=(n=a.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)o.text&&s.push(o.text),o.executableCode&&s.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&s.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function Hk(a){var e,t,n,r;const s=[];if(!((t=(e=a.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const o of(r=(n=a.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)o.functionCall&&s.push(o.functionCall);if(s.length>0)return s}const wO=[Lm.RECITATION,Lm.SAFETY,Lm.LANGUAGE];function Nb(a){return!!a.finishReason&&wO.includes(a.finishReason)}function fc(a){var e,t,n;let r="";if((!a.candidates||a.candidates.length===0)&&a.promptFeedback)r+="Response was blocked",!((e=a.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${a.promptFeedback.blockReason}`),!((t=a.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(r+=`: ${a.promptFeedback.blockReasonMessage}`);else if(!((n=a.candidates)===null||n===void 0)&&n[0]){const s=a.candidates[0];Nb(s)&&(r+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(r+=`: ${s.finishMessage}`))}return r}function $m(a){return this instanceof $m?(this.v=a,this):new $m(a)}function xO(a,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(a,e||[]),r,s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(v){n[v]&&(r[v]=function(x){return new Promise(function(S,E){s.push([v,x,S,E])>1||u(v,x)})})}function u(v,x){try{d(n[v](x))}catch(S){y(s[0][3],S)}}function d(v){v.value instanceof $m?Promise.resolve(v.value.v).then(f,p):y(s[0][2],v)}function f(v){u("next",v)}function p(v){u("throw",v)}function y(v,x){v(x),s.shift(),s.length&&u(s[0][0],s[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qk=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function _O(a){const e=a.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=AO(e),[n,r]=t.tee();return{stream:EO(n),response:SO(r)}}async function SO(a){const e=[],t=a.getReader();for(;;){const{done:n,value:r}=await t.read();if(n)return rA(kO(e));e.push(r)}}function EO(a){return xO(this,arguments,function*(){const t=a.getReader();for(;;){const{value:n,done:r}=yield $m(t.read());if(r)break;yield yield $m(rA(n))}})}function AO(a){const e=a.getReader();return new ReadableStream({start(n){let r="";return s();function s(){return e.read().then(({value:o,done:u})=>{if(u){if(r.trim()){n.error(new Yr("Failed to parse stream"));return}n.close();return}r+=o;let d=r.match(qk),f;for(;d;){try{f=JSON.parse(d[1])}catch{n.error(new Yr(`Error parsing JSON response: "${d[1]}"`));return}n.enqueue(f),r=r.substring(d[0].length),d=r.match(qk)}return s()}).catch(o=>{let u=o;throw u.stack=o.stack,u.name==="AbortError"?u=new dT("Request aborted when reading from the stream"):u=new Yr("Error reading from the stream"),u})}}})}function kO(a){const e=a[a.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const n of a){if(n.candidates){let r=0;for(const s of n.candidates)if(t.candidates||(t.candidates=[]),t.candidates[r]||(t.candidates[r]={index:r}),t.candidates[r].citationMetadata=s.citationMetadata,t.candidates[r].groundingMetadata=s.groundingMetadata,t.candidates[r].finishReason=s.finishReason,t.candidates[r].finishMessage=s.finishMessage,t.candidates[r].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[r].content||(t.candidates[r].content={role:s.content.role||"user",parts:[]});const o={};for(const u of s.content.parts)u.text&&(o.text=u.text),u.functionCall&&(o.functionCall=u.functionCall),u.executableCode&&(o.executableCode=u.executableCode),u.codeExecutionResult&&(o.codeExecutionResult=u.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),t.candidates[r].content.parts.push(o)}r++}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hT(a,e,t,n){const r=await B0(e,mh.STREAM_GENERATE_CONTENT,a,!0,JSON.stringify(t),n);return _O(r)}async function fT(a,e,t,n){const s=await(await B0(e,mh.GENERATE_CONTENT,a,!1,JSON.stringify(t),n)).json();return{response:rA(s)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pT(a){if(a!=null){if(typeof a=="string")return{role:"system",parts:[{text:a}]};if(a.text)return{role:"system",parts:[a]};if(a.parts)return a.role?a:{role:"system",parts:a.parts}}}function Um(a){let e=[];if(typeof a=="string")e=[{text:a}];else for(const t of a)typeof t=="string"?e.push({text:t}):e.push(t);return CO(e)}function CO(a){const e={role:"user",parts:[]},t={role:"function",parts:[]};let n=!1,r=!1;for(const s of a)"functionResponse"in s?(t.parts.push(s),r=!0):(e.parts.push(s),n=!0);if(n&&r)throw new Yr("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!r)throw new Yr("No content is provided for sending chat message.");return n?e:t}function TO(a,e){var t;let n={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const r=a.generateContentRequest!=null;if(a.contents){if(r)throw new lu("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=a.contents}else if(r)n=Object.assign(Object.assign({},n),a.generateContentRequest);else{const s=Um(a);n.contents=[s]}return{generateContentRequest:n}}function Vk(a){let e;return a.contents?e=a:e={contents:[Um(a)]},a.systemInstruction&&(e.systemInstruction=pT(a.systemInstruction)),e}function NO(a){return typeof a=="string"||Array.isArray(a)?{content:Um(a)}:a}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wk=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],PO={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function RO(a){let e=!1;for(const t of a){const{role:n,parts:r}=t;if(!e&&n!=="user")throw new Yr(`First content should be with role 'user', got ${n}`);if(!Mk.includes(n))throw new Yr(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(Mk)}`);if(!Array.isArray(r))throw new Yr("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new Yr("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const u of r)for(const d of Wk)d in u&&(s[d]+=1);const o=PO[n];for(const u of Wk)if(!o.includes(u)&&s[u]>0)throw new Yr(`Content with role '${n}' can't contain '${u}' part`);e=!0}}function Gk(a){var e;if(a.candidates===void 0||a.candidates.length===0)return!1;const t=(e=a.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const n of t.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk="SILENT_ERROR";class IO{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n!=null&&n.history&&(RO(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,s,o,u,d;await this._sendPromise;const f=Um(e),p={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(u=this.params)===null||u===void 0?void 0:u.systemInstruction,cachedContent:(d=this.params)===null||d===void 0?void 0:d.cachedContent,contents:[...this._history,f]},y=Object.assign(Object.assign({},this._requestOptions),t);let v;return this._sendPromise=this._sendPromise.then(()=>fT(this._apiKey,this.model,p,y)).then(x=>{var S;if(Gk(x.response)){this._history.push(f);const E=Object.assign({parts:[],role:"model"},(S=x.response.candidates)===null||S===void 0?void 0:S[0].content);this._history.push(E)}else{const E=fc(x.response);E&&console.warn(`sendMessage() was unsuccessful. ${E}. Inspect response object for details.`)}v=x}).catch(x=>{throw this._sendPromise=Promise.resolve(),x}),await this._sendPromise,v}async sendMessageStream(e,t={}){var n,r,s,o,u,d;await this._sendPromise;const f=Um(e),p={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(u=this.params)===null||u===void 0?void 0:u.systemInstruction,cachedContent:(d=this.params)===null||d===void 0?void 0:d.cachedContent,contents:[...this._history,f]},y=Object.assign(Object.assign({},this._requestOptions),t),v=hT(this._apiKey,this.model,p,y);return this._sendPromise=this._sendPromise.then(()=>v).catch(x=>{throw new Error(Kk)}).then(x=>x.response).then(x=>{if(Gk(x)){this._history.push(f);const S=Object.assign({},x.candidates[0].content);S.role||(S.role="model"),this._history.push(S)}else{const S=fc(x);S&&console.warn(`sendMessageStream() was unsuccessful. ${S}. Inspect response object for details.`)}}).catch(x=>{x.message!==Kk&&console.error(x)}),v}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OO(a,e,t,n){return(await B0(e,mh.COUNT_TOKENS,a,!1,JSON.stringify(t),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jO(a,e,t,n){return(await B0(e,mh.EMBED_CONTENT,a,!1,JSON.stringify(t),n)).json()}async function MO(a,e,t,n){const r=t.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await B0(e,mh.BATCH_EMBED_CONTENTS,a,!1,JSON.stringify({requests:r}),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=pT(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=Vk(e),s=Object.assign(Object.assign({},this._requestOptions),t);return fT(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),s)}async generateContentStream(e,t={}){var n;const r=Vk(e),s=Object.assign(Object.assign({},this._requestOptions),t);return hT(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),s)}startChat(e){var t;return new IO(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=TO(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return OO(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n=NO(e),r=Object.assign(Object.assign({},this._requestOptions),t);return jO(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return MO(this.apiKey,this.model,e,n)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DO{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new Yr("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Xk(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new lu("Cached content must contain a `name` field.");if(!e.model)throw new lu("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const o of r)if(t!=null&&t[o]&&e[o]&&(t==null?void 0:t[o])!==e[o]){if(o==="model"){const u=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,d=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(u===d)continue}throw new lu(`Different value for "${o}" specified in modelParams (${t[o]}) and cachedContent (${e[o]})`)}const s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Xk(this.apiKey,s,n)}}const LO="AIzaSyAH_1QBl9QFchXvbmPWPrBtzFPCAAM16vg";let yh=null;yh=new DO(LO);async function gT(a){return new Promise((e,t)=>{const n=new FileReader;n.onloadend=()=>e(n.result.split(",")[1]),n.onerror=t,n.readAsDataURL(a)})}async function FO(){var t;if(!yh){console.error(" API Key ");return}const a=["gemini-2.5-pro","gemini-2.0-flash-exp","gemini-2.5-flash-image"];console.log("  Gemini ...");let e="";for(const n of a)try{console.log(`Testing: ${n} ...`);const o=await(await yh.getGenerativeModel({model:n}).generateContent("Hi")).response;console.log(` ${n} :`,o.text().slice(0,10)),e||(e=n)}catch(r){console.warn(` ${n} :`,((t=r.message)==null?void 0:t.split(":")[0])||r.message)}return e?(console.log(` : ${e}`),alert(`${e}
( F12 Console)`),e):(console.error("  API Key "),alert(" API Key "),"gemini-1.5-flash")}let Af="gemini-2.5-pro";async function mT(a,e,t){var n,r;if(!yh)throw new Error("Gemini API ");try{console.log(`  ${Af} ...`);const s=yh.getGenerativeModel({model:Af}),o=await gT(a),u=[];let d=`



`.trim();t?d+=`

JSON 
${JSON.stringify(t)}

 AnswerKey 
- 
-  id  AnswerKey  "id"  "q1", "q2-1"
- 6/7
- 
`.trim():e||(d+=`




`.trim()),d+=`

 JSON Markdown 

{
  "totalScore": 0  AnswerKey 0-100,
  "details": [
    {
      "questionId": " q1, q2-1",
      "studentAnswer": "",
      "isCorrect": true  false,
      "score": ,
      "maxScore": ,
      "reason": ""
    }
  ],
  "mistakes": [
    {
      "id": "",
      "question": "",
      "reason": ""
    }
  ],
  "weaknesses": [
    ""
  ],
  "suggestions": [
    ""
  ]
}
`.trim(),u.push(d),u.push({inlineData:{mimeType:"image/jpeg",data:o}});const y=(await(await s.generateContent(u)).response).text().replace(/```json|```/g,"").trim();return JSON.parse(y)}catch(s){return console.error(` ${Af} :`,s),(n=s.message)!=null&&n.includes("404")||(r=s.message)!=null&&r.includes("not found")?{totalScore:0,mistakes:[],weaknesses:[],suggestions:[],feedback:[` ${Af} `]}:{totalScore:0,mistakes:[],weaknesses:[],suggestions:[],feedback:["",s.message]}}}async function BO(a,e,t,n){const r=await FO();r&&(Af=r);let s=0,o=0;for(let u=0;u<a.length;u++){const d=a[u];t(u+1,a.length);try{if(!d.imageBlob)continue;const f=await mT(d.imageBlob,e,n);await ze.submissions.update(d.id,{status:"graded",score:f.totalScore,gradingResult:f,gradedAt:Date.now()}),f.totalScore===0?o++:s++}catch{o++}u<a.length-1&&await new Promise(f=>setTimeout(f,2e3))}return{successCount:s,failCount:o}}async function $O(a){if(!yh)throw new Error("Gemini API ");console.log("  AnswerKey...");const e=yh.getGenerativeModel({model:Af}),t=await gT(a),n=`


 TypeScript  JSON

interface AnswerKey {
  questions: Array<{
    id: string;      //  "q1", "q2-1"
    answer: string;  // 
    maxScore: number;// 
  }>;
  totalScore: number; //  maxScore 
}


-  1  "q1"2-1  "q2-1"
- 6/7because S V
- maxScore  25  815 
- totalScore  maxScore 
-  JSON Markdown
`.trim(),o=(await(await e.generateContent([n,{inlineData:{mimeType:"image/jpeg",data:t}}])).response).text().replace(/```json|```/g,"").trim();return JSON.parse(o)}const as=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),cS=[.001,0,0,.001,0,0],H_=1.35,Qs={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},pc={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},zm="pdfjs_internal_editor_",Et={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Dt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},UO={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},uS={TRIANGLES:1,LATTICE:2},Ar={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Pb={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},qn={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},gf={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},cx={ERRORS:0,WARNINGS:1,INFOS:5},Hm={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},rm={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},zO={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let ux=cx.WARNINGS;function HO(a){Number.isInteger(a)&&(ux=a)}function qO(){return ux}function dx(a){ux>=cx.INFOS&&console.info(`Info: ${a}`)}function wt(a){ux>=cx.WARNINGS&&console.warn(`Warning: ${a}`)}function ln(a){throw new Error(a)}function Lt(a,e){a||ln(e)}function VO(a){switch(a==null?void 0:a.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function yT(a,e=null,t=null){if(!a)return null;if(t&&typeof a=="string"){if(t.addDefaultProtocol&&a.startsWith("www.")){const r=a.match(/\./g);(r==null?void 0:r.length)>=2&&(a=`http://${a}`)}if(t.tryConvertEncoding)try{a=YO(a)}catch{}}const n=e?URL.parse(a,e):URL.parse(a);return VO(n)?n:null}function vT(a,e,t=!1){const n=URL.parse(a);return n?(n.hash=e,n.href):t&&yT(a,"http://example.com")?a.split("#",1)[0]+`${e?`#${e}`:""}`:""}function xt(a,e,t,n=!1){return Object.defineProperty(a,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const xh=(function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e})();class Yk extends xh{constructor(e,t){super(e,"PasswordException"),this.code=t}}class q_ extends xh{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class dS extends xh{constructor(e){super(e,"InvalidPDFException")}}class bw extends xh{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class WO extends xh{constructor(e){super(e,"FormatError")}}class cu extends xh{constructor(e){super(e,"AbortException")}}function bT(a){(typeof a!="object"||(a==null?void 0:a.length)===void 0)&&ln("Invalid argument for bytesToString");const e=a.length,t=8192;if(e<t)return String.fromCharCode.apply(null,a);const n=[];for(let r=0;r<e;r+=t){const s=Math.min(r+t,e),o=a.subarray(r,s);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function $0(a){typeof a!="string"&&ln("Invalid argument for stringToBytes");const e=a.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=a.charCodeAt(n)&255;return t}function GO(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255)}function KO(){const a=new Uint8Array(4);return a[0]=1,new Uint32Array(a.buffer,0,1)[0]===1}function XO(){try{return new Function(""),!0}catch{return!1}}class Mr{static get isLittleEndian(){return xt(this,"isLittleEndian",KO())}static get isEvalSupported(){return xt(this,"isEvalSupported",XO())}static get isOffscreenCanvasSupported(){return xt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return xt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return xt(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return xt(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return xt(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return xt(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const V_=Array.from(Array(256).keys(),a=>a.toString(16).padStart(2,"0"));var xl,Rb,hS;class Ze{static makeHexColor(e,t,n){return`#${V_[e]}${V_[t]}${V_[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,n=0){const r=e[n],s=e[n+1];e[n]=r*t[0]+s*t[2]+t[4],e[n+1]=r*t[1]+s*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const r=t[0],s=t[1],o=t[2],u=t[3],d=t[4],f=t[5];for(let p=0;p<6;p+=2){const y=e[n+p],v=e[n+p+1];e[n+p]=y*r+v*o+d,e[n+p+1]=y*s+v*u+f}}static applyInverseTransform(e,t){const n=e[0],r=e[1],s=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/s,e[1]=(-n*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/s}static axialAlignedBoundingBox(e,t,n){const r=t[0],s=t[1],o=t[2],u=t[3],d=t[4],f=t[5],p=e[0],y=e[1],v=e[2],x=e[3];let S=r*p+d,E=S,T=r*v+d,N=T,L=u*y+f,j=L,F=u*x+f,B=F;if(s!==0||o!==0){const $=s*p,H=s*v,W=o*y,ae=o*x;S+=W,N+=W,T+=ae,E+=ae,L+=$,B+=$,F+=H,j+=H}n[0]=Math.min(n[0],S,T,E,N),n[1]=Math.min(n[1],L,F,j,B),n[2]=Math.max(n[2],S,T,E,N),n[3]=Math.max(n[3],L,F,j,B)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],r=e[1],s=e[2],o=e[3],u=n**2+r**2,d=n*s+r*o,f=s**2+o**2,p=(u+f)/2,y=Math.sqrt(p**2-(u*f-d**2));t[0]=Math.sqrt(p+y||1),t[1]=Math.sqrt(p-y||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;const s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>o?null:[n,s,r,o]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,r,s){s[0]=Math.min(s[0],e,n),s[1]=Math.min(s[1],t,r),s[2]=Math.max(s[2],e,n),s[3]=Math.max(s[3],t,r)}static bezierBoundingBox(e,t,n,r,s,o,u,d,f){f[0]=Math.min(f[0],e,u),f[1]=Math.min(f[1],t,d),f[2]=Math.max(f[2],e,u),f[3]=Math.max(f[3],t,d),O(this,xl,hS).call(this,e,n,s,u,t,r,o,d,3*(-e+3*(n-s)+u),6*(e-2*n+s),3*(n-e),f),O(this,xl,hS).call(this,e,n,s,u,t,r,o,d,3*(-t+3*(r-o)+d),6*(t-2*r+o),3*(r-t),f)}}xl=new WeakSet,Rb=function(e,t,n,r,s,o,u,d,f,p){if(f<=0||f>=1)return;const y=1-f,v=f*f,x=v*f,S=y*(y*(y*e+3*f*t)+3*v*n)+x*r,E=y*(y*(y*s+3*f*o)+3*v*u)+x*d;p[0]=Math.min(p[0],S),p[1]=Math.min(p[1],E),p[2]=Math.max(p[2],S),p[3]=Math.max(p[3],E)},hS=function(e,t,n,r,s,o,u,d,f,p,y,v){if(Math.abs(f)<1e-12){Math.abs(p)>=1e-12&&O(this,xl,Rb).call(this,e,t,n,r,s,o,u,d,-y/p,v);return}const x=p**2-4*y*f;if(x<0)return;const S=Math.sqrt(x),E=2*f;O(this,xl,Rb).call(this,e,t,n,r,s,o,u,d,(-p+S)/E,v),O(this,xl,Rb).call(this,e,t,n,r,s,o,u,d,(-p-S)/E,v)},R(Ze,xl);function YO(a){return decodeURIComponent(escape(a))}let W_=null,Jk=null;function JO(a){return W_||(W_=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Jk=new Map([["","t"]])),a.replaceAll(W_,(e,t,n)=>t?t.normalize("NFKC"):Jk.get(n))}function wT(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const a=new Uint8Array(32);return crypto.getRandomValues(a),bT(a)}const kf="pdfjs_internal_id_";function QO(a,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,r,...s]=t;if(!a(n)&&!Number.isInteger(n)||!e(r))return!1;const o=s.length;let u=!0;switch(r.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;u=!1;break;default:return!1}for(const d of s)if(!(typeof d=="number"||u&&d===null))return!1;return!0}function ls(a,e,t){return Math.min(Math.max(a,e),t)}function xT(a){return Uint8Array.prototype.toBase64?a.toBase64():btoa(bT(a))}function ZO(a){return Uint8Array.fromBase64?Uint8Array.fromBase64(a):$0(atob(a))}typeof Promise.try!="function"&&(Promise.try=function(a,...e){return new Promise(t=>{t(a(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(a){return a.reduce((e,t)=>e+t,0)});class qm{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function r(s){var d;if(!s)return;let o=null;const u=s.name;if(u==="#text")o=s.value;else if(qm.shouldBuildText(u))(d=s==null?void 0:s.attributes)!=null&&d.textContent?o=s.attributes.textContent:s.value&&(o=s.value);else return;if(o!==null&&t.push({str:o}),!!s.children)for(const f of s.children)r(f)}return r(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class _T{static setupStorage(e,t,n,r,s){const o=r.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),s==="print")break;e.addEventListener("input",u=>{r.setValue(t,{value:u.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),s==="print")break;e.addEventListener("change",u=>{r.setValue(t,{value:u.target.checked?u.target.getAttribute("xfaOn"):u.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),s==="print")break;e.addEventListener("input",u=>{r.setValue(t,{value:u.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const u of n.children)u.attributes.value===o.value?u.attributes.selected=!0:u.attributes.hasOwnProperty("selected")&&delete u.attributes.selected}e.addEventListener("input",u=>{const d=u.target.options,f=d.selectedIndex===-1?"":d[d.selectedIndex].value;r.setValue(t,{value:f})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:s}){const{attributes:o}=t,u=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${r}`);for(const[d,f]of Object.entries(o))if(f!=null)switch(d){case"class":f.length&&e.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",f);break;case"style":Object.assign(e.style,f);break;case"textContent":e.textContent=f;break;default:(!u||d!=="href"&&d!=="newWindow")&&e.setAttribute(d,f)}u&&s.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){var y,v;const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,s=e.intent||"display",o=document.createElement(r.name);r.attributes&&this.setAttributes({html:o,element:r,intent:s,linkService:n});const u=s!=="richText",d=e.div;if(d.append(o),e.viewport){const x=`matrix(${e.viewport.transform.join(",")})`;d.style.transform=x}u&&d.setAttribute("class","xfaLayer xfaFont");const f=[];if(r.children.length===0){if(r.value){const x=document.createTextNode(r.value);o.append(x),u&&qm.shouldBuildText(r.name)&&f.push(x)}return{textDivs:f}}const p=[[r,-1,o]];for(;p.length>0;){const[x,S,E]=p.at(-1);if(S+1===x.children.length){p.pop();continue}const T=x.children[++p.at(-1)[1]];if(T===null)continue;const{name:N}=T;if(N==="#text"){const j=document.createTextNode(T.value);f.push(j),E.append(j);continue}const L=(y=T==null?void 0:T.attributes)!=null&&y.xmlns?document.createElementNS(T.attributes.xmlns,N):document.createElement(N);if(E.append(L),T.attributes&&this.setAttributes({html:L,element:T,storage:t,intent:s,linkService:n}),((v=T.children)==null?void 0:v.length)>0)p.push([T,-1,L]);else if(T.value){const j=document.createTextNode(T.value);u&&qm.shouldBuildText(N)&&f.push(j),L.append(j)}}for(const x of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))x.setAttribute("readOnly",!0);return{textDivs:f}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const ja="http://www.w3.org/2000/svg",Ju=class Ju{};Re(Ju,"CSS",96),Re(Ju,"PDF",72),Re(Ju,"PDF_TO_CSS_UNITS",Ju.CSS/Ju.PDF);let uu=Ju;async function U0(a,e="text"){if(hm(a,document.baseURI)){const t=await fetch(a);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("GET",a,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}n(new Error(r.statusText))}},r.send(null)})}class z0{constructor({viewBox:e,userUnit:t,scale:n,rotation:r,offsetX:s=0,offsetY:o=0,dontFlip:u=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=r,this.offsetX=s,this.offsetY=o,n*=t;const d=(e[2]+e[0])/2,f=(e[3]+e[1])/2;let p,y,v,x;switch(r%=360,r<0&&(r+=360),r){case 180:p=-1,y=0,v=0,x=1;break;case 90:p=0,y=1,v=1,x=0;break;case 270:p=0,y=-1,v=-1,x=0;break;case 0:p=1,y=0,v=0,x=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}u&&(v=-v,x=-x);let S,E,T,N;p===0?(S=Math.abs(f-e[1])*n+s,E=Math.abs(d-e[0])*n+o,T=(e[3]-e[1])*n,N=(e[2]-e[0])*n):(S=Math.abs(d-e[0])*n+s,E=Math.abs(f-e[1])*n+o,T=(e[2]-e[0])*n,N=(e[3]-e[1])*n),this.transform=[p*n,y*n,v*n,x*n,S-p*n*d-v*n*f,E-y*n*d-x*n*f],this.width=T,this.height=N}get rawDims(){const e=this.viewBox;return xt(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:s=!1}={}){return new z0({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:s})}convertToViewportPoint(e,t){const n=[e,t];return Ze.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];Ze.applyTransform(t,this.transform);const n=[e[2],e[3]];return Ze.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return Ze.applyInverseTransform(n,this.transform),n}}class sA extends xh{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function hx(a){const e=a.length;let t=0;for(;t<e&&a[t].trim()==="";)t++;return a.substring(t,t+5).toLowerCase()==="data:"}function iA(a){return typeof a=="string"&&/\.pdf$/i.test(a)}function ej(a){return[a]=a.split(/[#?]/,1),a.substring(a.lastIndexOf("/")+1)}function tj(a,e="document.pdf"){if(typeof a!="string")return e;if(hx(a))return wt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(u=>{try{return new URL(u)}catch{try{return new URL(decodeURIComponent(u))}catch{try{return new URL(u,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(u),"https://foo.bar")}catch{return null}}}}})(a);if(!n)return e;const r=u=>{try{let d=decodeURIComponent(u);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:u):d}catch{return u}},s=/\.pdf$/i,o=n.pathname.split("/").at(-1);if(s.test(o))return r(o);if(n.searchParams.size>0){const u=Array.from(n.searchParams.values()).reverse();for(const f of u)if(s.test(f))return r(f);const d=Array.from(n.searchParams.keys()).reverse();for(const f of d)if(s.test(f))return r(f)}if(n.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(d)return r(d[0])}return e}class Qk{constructor(){Re(this,"started",Object.create(null));Re(this,"times",[])}time(e){e in this.started&&wt(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||wt(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:r,end:s}of this.times)e.push(`${n.padEnd(t)} ${s-r}ms
`);return e.join("")}}function hm(a,e){const t=e?URL.parse(a,e):URL.parse(a);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function Ti(a){a.preventDefault()}function Ln(a){a.preventDefault(),a.stopPropagation()}function nj(a){console.log("Deprecated API usage: "+a)}var Xm;class ww{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;c(this,Xm)||k(this,Xm,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=c(this,Xm).exec(e);if(!t)return null;const n=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let u=parseInt(t[5],10);u=u>=0&&u<=59?u:0;let d=parseInt(t[6],10);d=d>=0&&d<=59?d:0;const f=t[7]||"Z";let p=parseInt(t[8],10);p=p>=0&&p<=23?p:0;let y=parseInt(t[9],10)||0;return y=y>=0&&y<=59?y:0,f==="-"?(o+=p,u+=y):f==="+"&&(o-=p,u-=y),new Date(Date.UTC(n,r,s,o,u,d))}}Xm=new WeakMap,R(ww,Xm);function rj(a,{scale:e=1,rotation:t=0}){const{width:n,height:r}=a.attributes.style,s=[0,0,parseInt(n),parseInt(r)];return new z0({viewBox:s,userUnit:1,scale:e,rotation:t})}function H0(a){if(a.startsWith("#")){const e=parseInt(a.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return a.startsWith("rgb(")?a.slice(4,-1).split(",").map(e=>parseInt(e)):a.startsWith("rgba(")?a.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(wt(`Not a valid color format: "${a}"`),[0,0,0])}function sj(a){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of a.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;a.set(t,H0(n))}e.remove()}function Nn(a){const{a:e,b:t,c:n,d:r,e:s,f:o}=a.getTransform();return[e,t,n,r,s,o]}function To(a){const{a:e,b:t,c:n,d:r,e:s,f:o}=a.getTransform().invertSelf();return[e,t,n,r,s,o]}function vh(a,e,t=!1,n=!0){if(e instanceof z0){const{pageWidth:r,pageHeight:s}=e.rawDims,{style:o}=a,u=Mr.isCSSRoundSupported,d=`var(--total-scale-factor) * ${r}px`,f=`var(--total-scale-factor) * ${s}px`,p=u?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,y=u?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!t||e.rotation%180===0?(o.width=p,o.height=y):(o.width=y,o.height=p)}n&&a.setAttribute("data-main-rotation",e.rotation)}class ta{constructor(){const{pixelRatio:e}=ta;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,r,s=-1){let o=1/0,u=1/0,d=1/0;n=ta.capPixels(n,s),n>0&&(o=Math.sqrt(n/(e*t))),r!==-1&&(u=r/e,d=r/t);const f=Math.min(o,u,d);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const fS=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class ij{static get isDarkMode(){var e;return xt(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}}class oj{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:n}=window.getComputedStyle(e);return e.remove(),xt(this,"commentForegroundColor",H0(n))}}function aj(a,e,t,n){n=Math.min(Math.max(n??1,0),1);const r=255*(1-n);return a=Math.round(a*n+r),e=Math.round(e*n+r),t=Math.round(t*n+r),[a,e,t]}function Zk(a,e){const t=a[0]/255,n=a[1]/255,r=a[2]/255,s=Math.max(t,n,r),o=Math.min(t,n,r),u=(s+o)/2;if(s===o)e[0]=e[1]=0;else{const d=s-o;switch(e[1]=u<.5?d/(s+o):d/(2-s-o),s){case t:e[0]=((n-r)/d+(n<r?6:0))*60;break;case n:e[0]=((r-t)/d+2)*60;break;case r:e[0]=((t-n)/d+4)*60;break}}e[2]=u}function pS(a,e){const t=a[0],n=a[1],r=a[2],s=(1-Math.abs(2*r-1))*n,o=s*(1-Math.abs(t/60%2-1)),u=r-s/2;switch(Math.floor(t/60)){case 0:e[0]=s+u,e[1]=o+u,e[2]=u;break;case 1:e[0]=o+u,e[1]=s+u,e[2]=u;break;case 2:e[0]=u,e[1]=s+u,e[2]=o+u;break;case 3:e[0]=u,e[1]=o+u,e[2]=s+u;break;case 4:e[0]=o+u,e[1]=u,e[2]=s+u;break;case 5:case 6:e[0]=s+u,e[1]=u,e[2]=o+u;break}}function eC(a){return a<=.03928?a/12.92:((a+.055)/1.055)**2.4}function tC(a,e,t){pS(a,t),t.map(eC);const n=.2126*t[0]+.7152*t[1]+.0722*t[2];pS(e,t),t.map(eC);const r=.2126*t[0]+.7152*t[1]+.0722*t[2];return n>r?(n+.05)/(r+.05):(r+.05)/(n+.05)}const nC=new Map;function lj(a,e){const t=a[0]+a[1]*256+a[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let n=nC.get(t);if(n)return n;const r=new Float32Array(9),s=r.subarray(0,3),o=r.subarray(3,6);Zk(a,o);const u=r.subarray(6,9);Zk(e,u);const d=u[2]<.5,f=d?12:4.5;if(o[2]=d?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),tC(o,u,s)<f){let p,y;d?(p=o[2],y=1):(p=0,y=o[2]);const v=.005;for(;y-p>v;){const x=o[2]=(p+y)/2;d===tC(o,u,s)<f?p=x:y=x}o[2]=d?y:p}return pS(o,s),n=Ze.makeHexColor(Math.round(s[0]*255),Math.round(s[1]*255),Math.round(s[2]*255)),nC.set(t,n),n}function ST({html:a,dir:e,className:t},n){const r=document.createDocumentFragment();if(typeof a=="string"){const s=document.createElement("p");s.dir=e||"auto";const o=a.split(/(?:\r\n?|\n)/);for(let u=0,d=o.length;u<d;++u){const f=o[u];s.append(document.createTextNode(f)),u<d-1&&s.append(document.createElement("br"))}r.append(s)}else _T.render({xfaHtml:a,div:r,intent:"richText"});r.firstElementChild.classList.add("richText",t),n.append(r)}function ET(a){const e=new Path2D;if(!a)return e;for(let t=0,n=a.length;t<n;)switch(a[t++]){case rm.moveTo:e.moveTo(a[t++],a[t++]);break;case rm.lineTo:e.lineTo(a[t++],a[t++]);break;case rm.curveTo:e.bezierCurveTo(a[t++],a[t++],a[t++],a[t++],a[t++],a[t++]);break;case rm.quadraticCurveTo:e.quadraticCurveTo(a[t++],a[t++],a[t++],a[t++]);break;case rm.closePath:e.closePath();break;default:wt(`Unrecognized drawing path operator: ${a[t-1]}`);break}return e}var yc,vc,fi,pi,Ym,bc,Ff,Bf,Jm,zw,AT,jr,kT,CT,mf,fm;const La=class La{constructor(e){R(this,jr);R(this,yc,null);R(this,vc,null);R(this,fi);R(this,pi,null);R(this,Ym,null);R(this,bc,null);R(this,Ff,null);R(this,Bf,null);k(this,fi,e),c(La,Jm)||k(La,Jm,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=k(this,yc,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=c(this,fi)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",Ti,{signal:t}),e.addEventListener("pointerdown",O(La,zw,AT),{signal:t}));const n=k(this,pi,document.createElement("div"));n.className="buttons",e.append(n);const r=c(this,fi).toolbarPosition;if(r){const{style:s}=e,o=c(this,fi)._uiManager.direction==="ltr"?1-r[0]:r[0];s.insetInlineEnd=`${100*o}%`,s.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return c(this,yc)}hide(){var e;c(this,yc).classList.add("hidden"),(e=c(this,vc))==null||e.hideDropdown()}show(){var e,t;c(this,yc).classList.remove("hidden"),(e=c(this,Ym))==null||e.shown(),(t=c(this,bc))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=c(this,fi),n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",c(La,Jm)[e]),O(this,jr,mf).call(this,n)&&n.addEventListener("click",r=>{t.delete()},{signal:t._signal}),c(this,pi).append(n)}async addAltText(e){const t=await e.render();O(this,jr,mf).call(this,t),c(this,pi).append(t,c(this,jr,fm)),k(this,Ym,e)}addComment(e,t=null){if(c(this,bc))return;const n=e.renderForToolbar();if(!n)return;O(this,jr,mf).call(this,n);const r=k(this,Ff,c(this,jr,fm));t?(c(this,pi).insertBefore(n,t),c(this,pi).insertBefore(r,t)):c(this,pi).append(n,r),k(this,bc,e),e.toolbar=this}addColorPicker(e){if(c(this,vc))return;k(this,vc,e);const t=e.renderButton();O(this,jr,mf).call(this,t),c(this,pi).append(t,c(this,jr,fm))}async addEditSignatureButton(e){const t=k(this,Bf,await e.renderEditButton(c(this,fi)));O(this,jr,mf).call(this,t),c(this,pi).append(t,c(this,jr,fm))}removeButton(e){var t,n;switch(e){case"comment":(t=c(this,bc))==null||t.removeToolbarCommentButton(),k(this,bc,null),(n=c(this,Ff))==null||n.remove(),k(this,Ff,null);break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,n){if(!t&&e==="comment")return;const r=c(this,pi).querySelector(n);r&&e==="comment"&&this.addComment(t,r)}updateEditSignatureButton(e){c(this,Bf)&&(c(this,Bf).title=e)}remove(){var e;c(this,yc).remove(),(e=c(this,vc))==null||e.destroy(),k(this,vc,null)}};yc=new WeakMap,vc=new WeakMap,fi=new WeakMap,pi=new WeakMap,Ym=new WeakMap,bc=new WeakMap,Ff=new WeakMap,Bf=new WeakMap,Jm=new WeakMap,zw=new WeakSet,AT=function(e){e.stopPropagation()},jr=new WeakSet,kT=function(e){c(this,fi)._focusEventsAllowed=!1,Ln(e)},CT=function(e){c(this,fi)._focusEventsAllowed=!0,Ln(e)},mf=function(e){const t=c(this,fi)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",O(this,jr,kT).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",O(this,jr,CT).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Ti,{signal:t}),!0)},fm=function(){const e=document.createElement("div");return e.className="divider",e},R(La,zw),R(La,Jm,null);let gS=La;var Qm,td,Ba,El,TT,NT,mS;class cj{constructor(e){R(this,El);R(this,Qm,null);R(this,td,null);R(this,Ba);k(this,Ba,e)}show(e,t,n){const[r,s]=O(this,El,NT).call(this,t,n),{style:o}=c(this,td)||k(this,td,O(this,El,TT).call(this));e.append(c(this,td)),o.insetInlineEnd=`${100*r}%`,o.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){c(this,td).remove()}}Qm=new WeakMap,td=new WeakMap,Ba=new WeakMap,El=new WeakSet,TT=function(){const e=k(this,td,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=c(this,Ba)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",Ti,{signal:t});const n=k(this,Qm,document.createElement("div"));return n.className="buttons",e.append(n),c(this,Ba).hasCommentManager()&&O(this,El,mS).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{c(this,Ba).commentSelection("floating_button")}),O(this,El,mS).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{c(this,Ba).highlightSelection("floating_button")}),e},NT=function(e,t){let n=0,r=0;for(const s of e){const o=s.y+s.height;if(o<n)continue;const u=s.x+(t?s.width:0);if(o>n){r=u,n=o;continue}t?u>r&&(r=u):u<r&&(r=u)}return[t?1-r:r,n]},mS=function(e,t,n,r){const s=document.createElement("button");s.classList.add("basic",e),s.tabIndex=0,s.setAttribute("data-l10n-id",t);const o=document.createElement("span");s.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",n);const u=c(this,Ba)._signal;u instanceof AbortSignal&&!u.aborted&&(s.addEventListener("contextmenu",Ti,{signal:u}),s.addEventListener("click",r,{signal:u})),c(this,Qm).append(s)};function PT(a,e,t){for(const n of t)e.addEventListener(n,a[n].bind(a))}var nd,rd,$f,sd;const Qt=class Qt{static initializeAndAddPointerId(e){(c(Qt,rd)||k(Qt,rd,new Set)).add(e)}static setPointer(e,t){c(Qt,nd)||k(Qt,nd,t),c(Qt,sd)??k(Qt,sd,e)}static setTimeStamp(e){k(Qt,$f,e)}static isSamePointerId(e){return c(Qt,nd)===e}static isSamePointerIdOrRemove(e){var t;return c(Qt,nd)===e?!0:((t=c(Qt,rd))==null||t.delete(e),!1)}static isSamePointerType(e){return c(Qt,sd)===e}static isInitializedAndDifferentPointerType(e){return c(Qt,sd)!==null&&!Qt.isSamePointerType(e)}static isSameTimeStamp(e){return c(Qt,$f)===e}static isUsingMultiplePointers(){var e;return((e=c(Qt,rd))==null?void 0:e.size)>=1}static clearPointerType(){k(Qt,sd,null)}static clearPointerIds(){k(Qt,nd,NaN),k(Qt,rd,null)}static clearTimeStamp(){k(Qt,$f,NaN)}};nd=new WeakMap,rd=new WeakMap,$f=new WeakMap,sd=new WeakMap,R(Qt,nd,NaN),R(Qt,rd,null),R(Qt,$f,NaN),R(Qt,sd,null);let qr=Qt;var Hw;class uj{constructor(){R(this,Hw,0)}get id(){return`${zm}${er(this,Hw)._++}`}}Hw=new WeakMap;var Uf,Zm,Vr,zf,Ib;const AA=class AA{constructor(){R(this,zf);R(this,Uf,wT());R(this,Zm,0);R(this,Vr,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const s=r.decode().then(()=>(n.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return xt(this,"_isSVGFittingCanvas",s)}async getFromFile(e){const{lastModified:t,name:n,size:r,type:s}=e;return O(this,zf,Ib).call(this,`${t}_${n}_${r}_${s}`,e)}async getFromUrl(e){return O(this,zf,Ib).call(this,e,e)}async getFromBlob(e,t){const n=await t;return O(this,zf,Ib).call(this,e,n)}async getFromId(e){c(this,Vr)||k(this,Vr,new Map);const t=c(this,Vr).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){c(this,Vr)||k(this,Vr,new Map);let n=c(this,Vr).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${c(this,Uf)}_${er(this,Zm)._++}`,refCounter:1,isSvg:!1},c(this,Vr).set(e,n),c(this,Vr).set(n.id,n),n}getSvgUrl(e){const t=c(this,Vr).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var r;c(this,Vr)||k(this,Vr,new Map);const t=c(this,Vr).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const s=new OffscreenCanvas(n.width,n.height);s.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=s.convertToBlob()}(r=n.close)==null||r.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${c(this,Uf)}_`)}};Uf=new WeakMap,Zm=new WeakMap,Vr=new WeakMap,zf=new WeakSet,Ib=async function(e,t){c(this,Vr)||k(this,Vr,new Map);let n=c(this,Vr).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${c(this,Uf)}_${er(this,Zm)._++}`,refCounter:0,isSvg:!1});let r;if(typeof t=="string"?(n.url=t,r=await U0(t,"blob")):t instanceof File?r=n.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const s=AA._isSVGFittingCanvas,o=new FileReader,u=new Image,d=new Promise((f,p)=>{u.onload=()=>{n.bitmap=u,n.isSvg=!0,f()},o.onload=async()=>{const y=n.svgUrl=o.result;u.src=await s?`${y}#svgView(preserveAspectRatio(none))`:y},u.onerror=o.onerror=p});o.readAsDataURL(r),await d}else n.bitmap=await createImageBitmap(r);n.refCounter=1}catch(r){wt(r),n=null}return c(this,Vr).set(e,n),n&&c(this,Vr).set(n.id,n),n};let yS=AA;var Bn,wc,ey,Tn;class dj{constructor(e=128){R(this,Bn,[]);R(this,wc,!1);R(this,ey);R(this,Tn,-1);k(this,ey,e)}add({cmd:e,undo:t,post:n,mustExec:r,type:s=NaN,overwriteIfSameType:o=!1,keepUndo:u=!1}){if(r&&e(),c(this,wc))return;const d={cmd:e,undo:t,post:n,type:s};if(c(this,Tn)===-1){c(this,Bn).length>0&&(c(this,Bn).length=0),k(this,Tn,0),c(this,Bn).push(d);return}if(o&&c(this,Bn)[c(this,Tn)].type===s){u&&(d.undo=c(this,Bn)[c(this,Tn)].undo),c(this,Bn)[c(this,Tn)]=d;return}const f=c(this,Tn)+1;f===c(this,ey)?c(this,Bn).splice(0,1):(k(this,Tn,f),f<c(this,Bn).length&&c(this,Bn).splice(f)),c(this,Bn).push(d)}undo(){if(c(this,Tn)===-1)return;k(this,wc,!0);const{undo:e,post:t}=c(this,Bn)[c(this,Tn)];e(),t==null||t(),k(this,wc,!1),k(this,Tn,c(this,Tn)-1)}redo(){if(c(this,Tn)<c(this,Bn).length-1){k(this,Tn,c(this,Tn)+1),k(this,wc,!0);const{cmd:e,post:t}=c(this,Bn)[c(this,Tn)];e(),t==null||t(),k(this,wc,!1)}}hasSomethingToUndo(){return c(this,Tn)!==-1}hasSomethingToRedo(){return c(this,Tn)<c(this,Bn).length-1}cleanType(e){if(c(this,Tn)!==-1){for(let t=c(this,Tn);t>=0;t--)if(c(this,Bn)[t].type!==e){c(this,Bn).splice(t+1,c(this,Tn)-t),k(this,Tn,t);return}c(this,Bn).length=0,k(this,Tn,-1)}}destroy(){k(this,Bn,null)}}Bn=new WeakMap,wc=new WeakMap,ey=new WeakMap,Tn=new WeakMap;var qw,RT;class q0{constructor(e){R(this,qw);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Mr.platform;for(const[n,r,s={}]of e)for(const o of n){const u=o.startsWith("mac+");t&&u?(this.callbacks.set(o.slice(4),{callback:r,options:s}),this.allKeys.add(o.split("+").at(-1))):!t&&!u&&(this.callbacks.set(o,{callback:r,options:s}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(O(this,qw,RT).call(this,t));if(!n)return;const{callback:r,options:{bubbles:s=!1,args:o=[],checker:u=null}}=n;u&&!u(e,t)||(r.bind(e,...o,t)(),s||Ln(t))}}qw=new WeakSet,RT=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Vw=class Vw{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return sj(e),xt(this,"_colors",e)}convert(e){const t=H0(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,r]of this._colors)if(r.every((s,o)=>s===t[o]))return Vw._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?Ze.makeHexColor(...t):e}};Re(Vw,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let vS=Vw;var Hf,js,qf,In,sr,Vf,gi,Wf,mi,Wr,xc,_c,Gf,Sc,Io,yi,id,ty,ny,Kf,ry,Oo,Ec,Xf,Ac,jo,Ww,kc,Yf,sy,Cc,od,Jf,Tc,iy,Wn,Xt,$a,Nc,Pc,oy,Qf,ay,Rc,Mo,Ua,ly,cy,vi,qe,Ob,bS,IT,OT,pm,jT,MT,DT,wS,LT,FT,BT,$T,ns,Ma,UT,zT,xS,HT,gm,_S;const Tf=class Tf{constructor(e,t,n,r,s,o,u,d,f,p,y,v,x,S,E,T){R(this,qe);R(this,Hf,new AbortController);R(this,js,null);R(this,qf,null);R(this,In,new Map);R(this,sr,new Map);R(this,Vf,null);R(this,gi,null);R(this,Wf,null);R(this,mi,new dj);R(this,Wr,null);R(this,xc,null);R(this,_c,null);R(this,Gf,0);R(this,Sc,new Set);R(this,Io,null);R(this,yi,null);R(this,id,new Set);Re(this,"_editorUndoBar",null);R(this,ty,!1);R(this,ny,!1);R(this,Kf,!1);R(this,ry,null);R(this,Oo,null);R(this,Ec,null);R(this,Xf,null);R(this,Ac,!1);R(this,jo,null);R(this,Ww,new uj);R(this,kc,!1);R(this,Yf,!1);R(this,sy,!1);R(this,Cc,null);R(this,od,null);R(this,Jf,null);R(this,Tc,null);R(this,iy,null);R(this,Wn,Et.NONE);R(this,Xt,new Set);R(this,$a,null);R(this,Nc,null);R(this,Pc,null);R(this,oy,null);R(this,Qf,null);R(this,ay,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});R(this,Rc,[0,0]);R(this,Mo,null);R(this,Ua,null);R(this,ly,null);R(this,cy,null);R(this,vi,null);const N=this._signal=c(this,Hf).signal;k(this,Ua,e),k(this,ly,t),k(this,cy,n),k(this,Vf,r),k(this,Wr,s),k(this,Nc,o),k(this,Qf,d),this._eventBus=u,u._on("editingaction",this.onEditingAction.bind(this),{signal:N}),u._on("pagechanging",this.onPageChanging.bind(this),{signal:N}),u._on("scalechanging",this.onScaleChanging.bind(this),{signal:N}),u._on("rotationchanging",this.onRotationChanging.bind(this),{signal:N}),u._on("setpreference",this.onSetPreference.bind(this),{signal:N}),u._on("switchannotationeditorparams",L=>this.updateParams(L.type,L.value),{signal:N}),window.addEventListener("pointerdown",()=>{k(this,Yf,!0)},{capture:!0,signal:N}),window.addEventListener("pointerup",()=>{k(this,Yf,!1)},{capture:!0,signal:N}),O(this,qe,jT).call(this),O(this,qe,$T).call(this),O(this,qe,wS).call(this),k(this,gi,d.annotationStorage),k(this,ry,d.filterFactory),k(this,Pc,f),k(this,Xf,p||null),k(this,ty,y),k(this,ny,v),k(this,Kf,x),k(this,iy,S||null),this.viewParameters={realScale:uu.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=E||null,this._supportsPinchToZoom=T!==!1,s==null||s.setSidebarUiManager(this)}static get _keyboardManager(){const e=Tf.prototype,t=o=>c(o,Ua).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:u})=>{if(u instanceof HTMLInputElement){const{type:d}=u;return d!=="text"&&d!=="number"}return!0},r=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return xt(this,"_keyboardManager",new q0([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:u})=>!(u instanceof HTMLButtonElement)&&c(o,Ua).contains(u)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:u})=>!(u instanceof HTMLButtonElement)&&c(o,Ua).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}]]))}destroy(){var e,t,n,r,s,o,u,d,f;(e=c(this,vi))==null||e.resolve(),k(this,vi,null),(t=c(this,Hf))==null||t.abort(),k(this,Hf,null),this._signal=null;for(const p of c(this,sr).values())p.destroy();c(this,sr).clear(),c(this,In).clear(),c(this,id).clear(),(n=c(this,Tc))==null||n.clear(),k(this,js,null),c(this,Xt).clear(),c(this,mi).destroy(),(r=c(this,Vf))==null||r.destroy(),(s=c(this,Wr))==null||s.destroy(),(o=c(this,Nc))==null||o.destroy(),(u=c(this,jo))==null||u.hide(),k(this,jo,null),(d=c(this,Jf))==null||d.destroy(),k(this,Jf,null),k(this,qf,null),c(this,Oo)&&(clearTimeout(c(this,Oo)),k(this,Oo,null)),c(this,Mo)&&(clearTimeout(c(this,Mo)),k(this,Mo,null)),(f=this._editorUndoBar)==null||f.destroy(),k(this,Qf,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return c(this,iy)}get useNewAltTextFlow(){return c(this,ny)}get useNewAltTextWhenAddingImage(){return c(this,Kf)}get hcmFilter(){return xt(this,"hcmFilter",c(this,Pc)?c(this,ry).addHCMFilter(c(this,Pc).foreground,c(this,Pc).background):"none")}get direction(){return xt(this,"direction",getComputedStyle(c(this,Ua)).direction)}get _highlightColors(){return xt(this,"_highlightColors",c(this,Xf)?new Map(c(this,Xf).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return xt(this,"highlightColors",null);const t=new Map,n=!!c(this,Pc);for(const[r,s]of e){const o=r.endsWith("_HCM");if(n&&o){t.set(r.replace("_HCM",""),s);continue}!n&&!o&&t.set(r,s)}return xt(this,"highlightColors",t)}get highlightColorNames(){return xt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),k(this,_c,e)}setMainHighlightColorPicker(e){k(this,Jf,e)}editAltText(e,t=!1){var n;(n=c(this,Vf))==null||n.editAltText(this,e,t)}hasCommentManager(){return!!c(this,Wr)}editComment(e,t,n,r){var s;(s=c(this,Wr))==null||s.showDialog(this,e,t,n,r)}selectComment(e,t){const n=c(this,sr).get(e),r=n==null?void 0:n.getEditorByUID(t);r==null||r.toggleComment(!0,!0)}updateComment(e){var t;(t=c(this,Wr))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=c(this,Wr))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=c(this,Wr))==null||t.removeComments([e.uid])}toggleComment(e,t,n=void 0){var r;(r=c(this,Wr))==null||r.toggleCommentPopup(e,t,n)}makeCommentColor(e,t){var n;return e&&((n=c(this,Wr))==null?void 0:n.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=c(this,Wr))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(c(this,sr).has(e-1))return;const{resolve:t,promise:n}=Promise.withResolvers(),r=s=>{s.pageNumber===e&&(this._eventBus._off("editorsrendered",r),t())};this._eventBus.on("editorsrendered",r),await n}getSignature(e){var t;(t=c(this,Nc))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return c(this,Nc)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":k(this,Kf,t);break}}onPageChanging({pageNumber:e}){k(this,Gf,e-1)}focusMainContainer(){c(this,Ua).focus()}findParent(e,t){for(const n of c(this,sr).values()){const{x:r,y:s,width:o,height:u}=n.div.getBoundingClientRect();if(e>=r&&e<=r+o&&t>=s&&t<=s+u)return n}return null}disableUserSelect(e=!1){c(this,ly).classList.toggle("noUserSelect",e)}addShouldRescale(e){c(this,id).add(e)}removeShouldRescale(e){c(this,id).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*uu.PDF_TO_CSS_UNITS;for(const n of c(this,id))n.onScaleChanging();(t=c(this,_c))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:r,anchorOffset:s,focusNode:o,focusOffset:u}=n,d=n.toString(),p=O(this,qe,Ob).call(this,n).closest(".textLayer"),y=this.getSelectionBoxes(p);if(!y)return;n.empty();const v=O(this,qe,bS).call(this,p),x=c(this,Wn)===Et.NONE,S=()=>{const E=v==null?void 0:v.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:y,anchorNode:r,anchorOffset:s,focusNode:o,focusOffset:u,text:d});x&&this.showAllEditors("highlight",!0,!0),t&&(E==null||E.editComment())};if(x){this.switchToMode(Et.HIGHLIGHT,S);return}S()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!c(this,gi))return null;const t=`${zm}${e}`,n=c(this,gi).getRawValue(t);return n&&c(this,gi).remove(t),n}addToAnnotationStorage(e){!e.isEmpty()&&c(this,gi)&&!c(this,gi).has(e.id)&&c(this,gi).setValue(e.id,e)}a11yAlert(e,t=null){const n=c(this,cy);n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,c(this,Ac)&&(k(this,Ac,!1),O(this,qe,pm).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of c(this,Xt))if(t.div.contains(e)){k(this,od,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!c(this,od))return;const[e,t]=c(this,od);k(this,od,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){O(this,qe,wS).call(this),this.setEditingState(!0)}removeEditListeners(){O(this,qe,LT).call(this),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of c(this,yi))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of c(this,yi))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=c(this,js))==null||n.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of c(this,Xt)){const s=r.serialize(!0);s&&t.push(s)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const s of t.items)for(const o of c(this,yi))if(o.isHandlingMimeForPasting(s.type)){o.paste(s,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(s){wt(`paste: "${s.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const r=this.currentLayer;try{const s=[];for(const d of n){const f=await r.deserialize(d);if(!f)return;s.push(f)}const o=()=>{for(const d of s)O(this,qe,xS).call(this,d);O(this,qe,_S).call(this,s)},u=()=>{for(const d of s)d.remove()};this.addCommands({cmd:o,undo:u,mustExec:!0})}catch(s){wt(`paste: "${s.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),c(this,Wn)!==Et.NONE&&!this.isEditorHandlingKeyboard&&Tf._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,c(this,Ac)&&(k(this,Ac,!1),O(this,qe,pm).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(O(this,qe,MT).call(this),O(this,qe,FT).call(this),O(this,qe,ns).call(this,{isEditing:c(this,Wn)!==Et.NONE,isEmpty:O(this,qe,gm).call(this),hasSomethingToUndo:c(this,mi).hasSomethingToUndo(),hasSomethingToRedo:c(this,mi).hasSomethingToRedo(),hasSelectedEditor:!1})):(O(this,qe,DT).call(this),O(this,qe,BT).call(this),O(this,qe,ns).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!c(this,yi)){k(this,yi,e);for(const t of c(this,yi))O(this,qe,Ma).call(this,t.defaultPropertiesToUpdate)}}getId(){return c(this,Ww).id}get currentLayer(){return c(this,sr).get(c(this,Gf))}getLayer(e){return c(this,sr).get(e)}get currentPageIndex(){return c(this,Gf)}addLayer(e){c(this,sr).set(e.pageIndex,e),c(this,kc)?e.enable():e.disable()}removeLayer(e){c(this,sr).delete(e.pageIndex)}async updateMode(e,t=null,n=!1,r=!1,s=!1){var o,u,d,f,p,y;if(c(this,Wn)!==e&&!(c(this,vi)&&(await c(this,vi).promise,!c(this,vi)))){if(k(this,vi,Promise.withResolvers()),(o=c(this,_c))==null||o.commitOrRemove(),c(this,Wn)===Et.POPUP&&((u=c(this,Wr))==null||u.hideSidebar()),(d=c(this,Wr))==null||d.destroyPopup(),k(this,Wn,e),e===Et.NONE){this.setEditingState(!1),O(this,qe,zT).call(this);for(const v of c(this,In).values())v.hideStandaloneCommentButton();(f=this._editorUndoBar)==null||f.hide(),this.toggleComment(null),c(this,vi).resolve();return}for(const v of c(this,In).values())v.addStandaloneCommentButton();e===Et.SIGNATURE&&await((p=c(this,Nc))==null?void 0:p.loadSignatures()),this.setEditingState(!0),await O(this,qe,UT).call(this),this.unselectAll();for(const v of c(this,sr).values())v.updateMode(e);if(e===Et.POPUP){c(this,qf)||k(this,qf,await c(this,Qf).getAnnotationsByType(new Set(c(this,yi).map(S=>S._editorType))));const v=new Set,x=[];for(const S of c(this,In).values()){const{annotationElementId:E,hasComment:T,deleted:N}=S;E&&v.add(E),T&&!N&&x.push(S.getData())}for(const S of c(this,qf)){const{id:E,popupRef:T,contentsObj:N}=S;T&&(N!=null&&N.str)&&!v.has(E)&&!c(this,Sc).has(E)&&x.push(S)}(y=c(this,Wr))==null||y.showSidebar(x)}if(!t){n&&this.addNewEditorFromKeyboard(),c(this,vi).resolve();return}for(const v of c(this,In).values())v.uid===t?(this.setSelected(v),s?v.editComment():r?v.enterInEditMode():v.focus()):v.unselect();c(this,vi).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==c(this,Wn)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(c(this,yi)){switch(e){case Dt.CREATE:this.currentLayer.addNewEditor(t);return;case Dt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(c(this,oy)||k(this,oy,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const n of c(this,Xt))n.updateParams(e,t);else for(const n of c(this,yi))n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var s;for(const o of c(this,In).values())o.editorType===e&&o.show(t);(((s=c(this,oy))==null?void 0:s.get(Dt.HIGHLIGHT_SHOW_ALL))??!0)!==t&&O(this,qe,Ma).call(this,[[Dt.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(c(this,sy)!==e){k(this,sy,e);for(const t of c(this,sr).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of c(this,In).values())t.pageIndex===e&&(yield t)}getEditor(e){return c(this,In).get(e)}addEditor(e){c(this,In).set(e.id,e)}removeEditor(e){var t,n;e.div.contains(document.activeElement)&&(c(this,Oo)&&clearTimeout(c(this,Oo)),k(this,Oo,setTimeout(()=>{this.focusMainContainer(),k(this,Oo,null)},0))),c(this,In).delete(e.id),e.annotationElementId&&((t=c(this,Tc))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!c(this,Sc).has(e.annotationElementId))&&((n=c(this,gi))==null||n.remove(e.id))}addDeletedAnnotationElement(e){c(this,Sc).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return c(this,Sc).has(e)}removeDeletedAnnotationElement(e){c(this,Sc).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){c(this,js)!==e&&(k(this,js,e),e&&O(this,qe,Ma).call(this,e.propertiesToUpdate))}updateUI(e){c(this,qe,HT)===e&&O(this,qe,Ma).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){O(this,qe,Ma).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(c(this,Xt).has(e)){c(this,Xt).delete(e),e.unselect(),O(this,qe,ns).call(this,{hasSelectedEditor:this.hasSelection});return}c(this,Xt).add(e),e.select(),O(this,qe,Ma).call(this,e.propertiesToUpdate),O(this,qe,ns).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.uid}),(t=c(this,_c))==null||t.commitOrRemove();for(const n of c(this,Xt))n!==e&&n.unselect();c(this,Xt).clear(),c(this,Xt).add(e),e.select(),O(this,qe,Ma).call(this,e.propertiesToUpdate),O(this,qe,ns).call(this,{hasSelectedEditor:!0})}isSelected(e){return c(this,Xt).has(e)}get firstSelectedEditor(){return c(this,Xt).values().next().value}unselect(e){e.unselect(),c(this,Xt).delete(e),O(this,qe,ns).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return c(this,Xt).size!==0}get isEnterHandled(){return c(this,Xt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;c(this,mi).undo(),O(this,qe,ns).call(this,{hasSomethingToUndo:c(this,mi).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:O(this,qe,gm).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){c(this,mi).redo(),O(this,qe,ns).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:c(this,mi).hasSomethingToRedo(),isEmpty:O(this,qe,gm).call(this)})}addCommands(e){c(this,mi).add(e),O(this,qe,ns).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:O(this,qe,gm).call(this)})}cleanUndoStack(e){c(this,mi).cleanType(e)}delete(){var s;this.commitOrRemove();const e=(s=this.currentLayer)==null?void 0:s.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...c(this,Xt)],n=()=>{var o;(o=this._editorUndoBar)==null||o.show(r,t.length===1?t[0].editorType:t.length);for(const u of t)u.remove()},r=()=>{for(const o of t)O(this,qe,xS).call(this,o)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){var e;(e=c(this,js))==null||e.commitOrRemove()}hasSomethingToControl(){return c(this,js)||this.hasSelection}selectAll(){for(const e of c(this,Xt))e.commit();O(this,qe,_S).call(this,c(this,In).values())}unselectAll(){var e;if(!(c(this,js)&&(c(this,js).commitOrRemove(),c(this,Wn)!==Et.NONE))&&!((e=c(this,_c))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of c(this,Xt))t.unselect();c(this,Xt).clear(),O(this,qe,ns).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;c(this,Rc)[0]+=e,c(this,Rc)[1]+=t;const[r,s]=c(this,Rc),o=[...c(this,Xt)],u=1e3;c(this,Mo)&&clearTimeout(c(this,Mo)),k(this,Mo,setTimeout(()=>{k(this,Mo,null),c(this,Rc)[0]=c(this,Rc)[1]=0,this.addCommands({cmd:()=>{for(const d of o)c(this,In).has(d.id)&&(d.translateInPage(r,s),d.translationDone())},undo:()=>{for(const d of o)c(this,In).has(d.id)&&(d.translateInPage(-r,-s),d.translationDone())},mustExec:!1})},u));for(const d of o)d.translateInPage(e,t),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),k(this,Io,new Map);for(const e of c(this,Xt))c(this,Io).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!c(this,Io))return!1;this.disableUserSelect(!1);const e=c(this,Io);k(this,Io,null);let t=!1;for(const[{x:r,y:s,pageIndex:o},u]of e)u.newX=r,u.newY=s,u.newPageIndex=o,t||(t=r!==u.savedX||s!==u.savedY||o!==u.savedPageIndex);if(!t)return!1;const n=(r,s,o,u)=>{if(c(this,In).has(r.id)){const d=c(this,sr).get(u);d?r._setParentAndPosition(d,s,o):(r.pageIndex=u,r.x=s,r.y=o)}};return this.addCommands({cmd:()=>{for(const[r,{newX:s,newY:o,newPageIndex:u}]of e)n(r,s,o,u)},undo:()=>{for(const[r,{savedX:s,savedY:o,savedPageIndex:u}]of e)n(r,s,o,u)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(c(this,Io))for(const n of c(this,Io).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||c(this,Xt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return c(this,js)===e}getActive(){return c(this,js)}getMode(){return c(this,Wn)}isEditingMode(){return c(this,Wn)!==Et.NONE}get imageManager(){return xt(this,"imageManager",new yS)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let f=0,p=t.rangeCount;f<p;f++)if(!e.contains(t.getRangeAt(f).commonAncestorContainer))return null;const{x:n,y:r,width:s,height:o}=e.getBoundingClientRect();let u;switch(e.getAttribute("data-main-rotation")){case"90":u=(f,p,y,v)=>({x:(p-r)/o,y:1-(f+y-n)/s,width:v/o,height:y/s});break;case"180":u=(f,p,y,v)=>({x:1-(f+y-n)/s,y:1-(p+v-r)/o,width:y/s,height:v/o});break;case"270":u=(f,p,y,v)=>({x:1-(p+v-r)/o,y:(f-n)/s,width:v/o,height:y/s});break;default:u=(f,p,y,v)=>({x:(f-n)/s,y:(p-r)/o,width:y/s,height:v/o});break}const d=[];for(let f=0,p=t.rangeCount;f<p;f++){const y=t.getRangeAt(f);if(!y.collapsed)for(const{x:v,y:x,width:S,height:E}of y.getClientRects())S===0||E===0||d.push(u(v,x,S,E))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:e,id:t}){(c(this,Wf)||k(this,Wf,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=c(this,Wf))==null||t.delete(e)}renderAnnotationElement(e){var r;const t=(r=c(this,Wf))==null?void 0:r.get(e.data.id);if(!t)return;const n=c(this,gi).getRawValue(t);n&&(c(this,Wn)===Et.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){var s;const r=(s=c(this,Tc))==null?void 0:s.get(e);r&&(r.setCanvas(t,n),c(this,Tc).delete(e))}addMissingCanvas(e,t){(c(this,Tc)||k(this,Tc,new Map)).set(e,t)}};Hf=new WeakMap,js=new WeakMap,qf=new WeakMap,In=new WeakMap,sr=new WeakMap,Vf=new WeakMap,gi=new WeakMap,Wf=new WeakMap,mi=new WeakMap,Wr=new WeakMap,xc=new WeakMap,_c=new WeakMap,Gf=new WeakMap,Sc=new WeakMap,Io=new WeakMap,yi=new WeakMap,id=new WeakMap,ty=new WeakMap,ny=new WeakMap,Kf=new WeakMap,ry=new WeakMap,Oo=new WeakMap,Ec=new WeakMap,Xf=new WeakMap,Ac=new WeakMap,jo=new WeakMap,Ww=new WeakMap,kc=new WeakMap,Yf=new WeakMap,sy=new WeakMap,Cc=new WeakMap,od=new WeakMap,Jf=new WeakMap,Tc=new WeakMap,iy=new WeakMap,Wn=new WeakMap,Xt=new WeakMap,$a=new WeakMap,Nc=new WeakMap,Pc=new WeakMap,oy=new WeakMap,Qf=new WeakMap,ay=new WeakMap,Rc=new WeakMap,Mo=new WeakMap,Ua=new WeakMap,ly=new WeakMap,cy=new WeakMap,vi=new WeakMap,qe=new WeakSet,Ob=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},bS=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of c(this,sr).values())if(n.hasTextLayer(e))return n;return null},IT=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=O(this,qe,Ob).call(this,e).closest(".textLayer"),r=this.getSelectionBoxes(n);r&&(c(this,jo)||k(this,jo,new cj(this)),c(this,jo).show(n,r,this.direction==="ltr"))},OT=function(){var s,o,u;const e=document.getSelection();if(!e||e.isCollapsed){c(this,$a)&&((s=c(this,jo))==null||s.hide(),k(this,$a,null),O(this,qe,ns).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===c(this,$a))return;const r=O(this,qe,Ob).call(this,e).closest(".textLayer");if(!r){c(this,$a)&&((o=c(this,jo))==null||o.hide(),k(this,$a,null),O(this,qe,ns).call(this,{hasSelectedText:!1}));return}if((u=c(this,jo))==null||u.hide(),k(this,$a,t),O(this,qe,ns).call(this,{hasSelectedText:!0}),!(c(this,Wn)!==Et.HIGHLIGHT&&c(this,Wn)!==Et.NONE)&&(c(this,Wn)===Et.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),k(this,Ac,this.isShiftKeyDown),!this.isShiftKeyDown)){const d=c(this,Wn)===Et.HIGHLIGHT?O(this,qe,bS).call(this,r):null;if(d==null||d.toggleDrawing(),c(this,Yf)){const f=new AbortController,p=this.combinedSignal(f),y=v=>{v.type==="pointerup"&&v.button!==0||(f.abort(),d==null||d.toggleDrawing(!0),v.type==="pointerup"&&O(this,qe,pm).call(this,"main_toolbar"))};window.addEventListener("pointerup",y,{signal:p}),window.addEventListener("blur",y,{signal:p})}else d==null||d.toggleDrawing(!0),O(this,qe,pm).call(this,"main_toolbar")}},pm=function(e=""){c(this,Wn)===Et.HIGHLIGHT?this.highlightSelection(e):c(this,ty)&&O(this,qe,IT).call(this)},jT=function(){document.addEventListener("selectionchange",O(this,qe,OT).bind(this),{signal:this._signal})},MT=function(){if(c(this,Ec))return;k(this,Ec,new AbortController);const e=this.combinedSignal(c(this,Ec));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},DT=function(){var e;(e=c(this,Ec))==null||e.abort(),k(this,Ec,null)},wS=function(){if(c(this,Cc))return;k(this,Cc,new AbortController);const e=this.combinedSignal(c(this,Cc));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},LT=function(){var e;(e=c(this,Cc))==null||e.abort(),k(this,Cc,null)},FT=function(){if(c(this,xc))return;k(this,xc,new AbortController);const e=this.combinedSignal(c(this,xc));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},BT=function(){var e;(e=c(this,xc))==null||e.abort(),k(this,xc,null)},$T=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},ns=function(e){Object.entries(e).some(([n,r])=>c(this,ay)[n]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(c(this,ay),e)}),c(this,Wn)===Et.HIGHLIGHT&&e.hasSelectedEditor===!1&&O(this,qe,Ma).call(this,[[Dt.HIGHLIGHT_FREE,!0]]))},Ma=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},UT=async function(){if(!c(this,kc)){k(this,kc,!0);const e=[];for(const t of c(this,sr).values())e.push(t.enable());await Promise.all(e);for(const t of c(this,In).values())t.enable()}},zT=function(){if(this.unselectAll(),c(this,kc)){k(this,kc,!1);for(const e of c(this,sr).values())e.disable();for(const e of c(this,In).values())e.disable()}},xS=function(e){const t=c(this,sr).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},HT=function(){let e=null;for(e of c(this,Xt));return e},gm=function(){if(c(this,In).size===0)return!0;if(c(this,In).size===1)for(const e of c(this,In).values())return e.isEmpty();return!1},_S=function(e){for(const t of c(this,Xt))t.unselect();c(this,Xt).clear();for(const t of e)t.isEmpty()||(c(this,Xt).add(t),t.select());O(this,qe,ns).call(this,{hasSelectedEditor:this.hasSelection})},Re(Tf,"TRANSLATE_SMALL",1),Re(Tf,"TRANSLATE_BIG",10);let bh=Tf;var hr,Do,Gi,Zf,Lo,Ms,ep,Fo,ws,za,ad,Bo,Ic,oo,mm,jb;const rs=class rs{constructor(e){R(this,oo);R(this,hr,null);R(this,Do,!1);R(this,Gi,null);R(this,Zf,null);R(this,Lo,null);R(this,Ms,null);R(this,ep,!1);R(this,Fo,null);R(this,ws,null);R(this,za,null);R(this,ad,null);R(this,Bo,!1);k(this,ws,e),k(this,Bo,e._uiManager.useNewAltTextFlow),c(rs,Ic)||k(rs,Ic,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){rs._l10n??(rs._l10n=e)}async render(){const e=k(this,Gi,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=k(this,Zf,document.createElement("span"));e.append(t),c(this,Bo)?(e.classList.add("new"),e.setAttribute("data-l10n-id",c(rs,Ic).missing),t.setAttribute("data-l10n-id",c(rs,Ic)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=c(this,ws)._uiManager._signal;e.addEventListener("contextmenu",Ti,{signal:n}),e.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:n});const r=s=>{s.preventDefault(),c(this,ws)._uiManager.editAltText(c(this,ws)),c(this,Bo)&&c(this,ws)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:c(this,oo,mm)}})};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",s=>{s.target===e&&s.key==="Enter"&&(k(this,ep,!0),r(s))},{signal:n}),await O(this,oo,jb).call(this),e}finish(){c(this,Gi)&&(c(this,Gi).focus({focusVisible:c(this,ep)}),k(this,ep,!1))}isEmpty(){return c(this,Bo)?c(this,hr)===null:!c(this,hr)&&!c(this,Do)}hasData(){return c(this,Bo)?c(this,hr)!==null||!!c(this,za):this.isEmpty()}get guessedText(){return c(this,za)}async setGuessedText(e){c(this,hr)===null&&(k(this,za,e),k(this,ad,await rs._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),O(this,oo,jb).call(this))}toggleAltTextBadge(e=!1){var t;if(!c(this,Bo)||c(this,hr)){(t=c(this,Fo))==null||t.remove(),k(this,Fo,null);return}if(!c(this,Fo)){const n=k(this,Fo,document.createElement("div"));n.className="noAltTextBadge",c(this,ws).div.append(n)}c(this,Fo).classList.toggle("hidden",!e)}serialize(e){let t=c(this,hr);return!e&&c(this,za)===t&&(t=c(this,ad)),{altText:t,decorative:c(this,Do),guessedText:c(this,za),textWithDisclaimer:c(this,ad)}}get data(){return{altText:c(this,hr),decorative:c(this,Do)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:r,cancel:s=!1}){n&&(k(this,za,n),k(this,ad,r)),!(c(this,hr)===e&&c(this,Do)===t)&&(s||(k(this,hr,e),k(this,Do,t)),O(this,oo,jb).call(this))}toggle(e=!1){c(this,Gi)&&(!e&&c(this,Ms)&&(clearTimeout(c(this,Ms)),k(this,Ms,null)),c(this,Gi).disabled=!e)}shown(){c(this,ws)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:c(this,oo,mm)}})}destroy(){var e,t;(e=c(this,Gi))==null||e.remove(),k(this,Gi,null),k(this,Zf,null),k(this,Lo,null),(t=c(this,Fo))==null||t.remove(),k(this,Fo,null)}};hr=new WeakMap,Do=new WeakMap,Gi=new WeakMap,Zf=new WeakMap,Lo=new WeakMap,Ms=new WeakMap,ep=new WeakMap,Fo=new WeakMap,ws=new WeakMap,za=new WeakMap,ad=new WeakMap,Bo=new WeakMap,Ic=new WeakMap,oo=new WeakSet,mm=function(){return c(this,hr)&&"added"||c(this,hr)===null&&this.guessedText&&"review"||"missing"},jb=async function(){var r,s,o;const e=c(this,Gi);if(!e)return;if(c(this,Bo)){if(e.classList.toggle("done",!!c(this,hr)),e.setAttribute("data-l10n-id",c(rs,Ic)[c(this,oo,mm)]),(r=c(this,Zf))==null||r.setAttribute("data-l10n-id",c(rs,Ic)[`${c(this,oo,mm)}-label`]),!c(this,hr)){(s=c(this,Lo))==null||s.remove();return}}else{if(!c(this,hr)&&!c(this,Do)){e.classList.remove("done"),(o=c(this,Lo))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=c(this,Lo);if(!t){k(this,Lo,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${c(this,ws).id}`;const u=100,d=c(this,ws)._uiManager._signal;d.addEventListener("abort",()=>{clearTimeout(c(this,Ms)),k(this,Ms,null)},{once:!0}),e.addEventListener("mouseenter",()=>{k(this,Ms,setTimeout(()=>{k(this,Ms,null),c(this,Lo).classList.add("show"),c(this,ws)._reportTelemetry({action:"alt_text_tooltip"})},u))},{signal:d}),e.addEventListener("mouseleave",()=>{var f;c(this,Ms)&&(clearTimeout(c(this,Ms)),k(this,Ms,null)),(f=c(this,Lo))==null||f.classList.remove("show")},{signal:d})}c(this,Do)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=c(this,hr)),t.parentNode||e.append(t);const n=c(this,ws).getElementForAltText();n==null||n.setAttribute("aria-describedby",t.id)},R(rs,Ic,null),Re(rs,"_l10n",null);let xw=rs;var Cr,bi,ld,hn,uy,cd,Ki,ud,dd,hd,dy,SS;class lb{constructor(e){R(this,dy);R(this,Cr,null);R(this,bi,null);R(this,ld,!1);R(this,hn,null);R(this,uy,null);R(this,cd,null);R(this,Ki,null);R(this,ud,null);R(this,dd,!1);R(this,hd,null);k(this,hn,e)}renderForToolbar(){const e=k(this,bi,document.createElement("button"));return e.className="comment",O(this,dy,SS).call(this,e,!1)}renderForStandalone(){const e=k(this,Cr,document.createElement("button"));e.className="annotationCommentButton";const t=c(this,hn).commentButtonPosition;if(t){const{style:n}=e;n.insetInlineEnd=`calc(${100*(c(this,hn)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const r=c(this,hn).commentButtonColor;r&&(n.backgroundColor=r)}return O(this,dy,SS).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=c(this,Cr)??c(this,bi))==null||e.focus()},0)}onUpdatedColor(){if(!c(this,Cr))return;const e=c(this,hn).commentButtonColor;e&&(c(this,Cr).style.backgroundColor=e),c(this,hn)._uiManager.updatePopupColor(c(this,hn))}get commentButtonWidth(){var e;return(((e=c(this,Cr))==null?void 0:e.getBoundingClientRect().width)??0)/c(this,hn).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(c(this,hd))return c(this,hd);if(!c(this,Cr))return null;const{x:e,y:t,height:n}=c(this,Cr).getBoundingClientRect(),{x:r,y:s,width:o,height:u}=c(this,hn).parent.boundingClientRect;return[(e-r)/o,(t+n-s)/u]}set commentPopupPositionInLayer(e){k(this,hd,e)}hasDefaultPopupPosition(){return c(this,hd)===null}removeStandaloneCommentButton(){var e;(e=c(this,Cr))==null||e.remove(),k(this,Cr,null)}removeToolbarCommentButton(){var e;(e=c(this,bi))==null||e.remove(),k(this,bi,null)}setCommentButtonStates({selected:e,hasPopup:t}){c(this,Cr)&&(c(this,Cr).classList.toggle("selected",e),c(this,Cr).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let n,r;if(t)[n,r]=t;else{[n,r]=c(this,hn).commentButtonPosition;const{width:p,height:y,x:v,y:x}=c(this,hn);n=v+n*p,r=x+r*y}const s=c(this,hn).parent.boundingClientRect,{x:o,y:u,width:d,height:f}=s;c(this,hn)._uiManager.editComment(c(this,hn),o+n*d,u+r*f,{...e,parentDimensions:s})}finish(){c(this,bi)&&(c(this,bi).focus({focusVisible:c(this,ld)}),k(this,ld,!1))}isDeleted(){return c(this,dd)||c(this,Ki)===""}isEmpty(){return c(this,Ki)===null}hasBeenEdited(){return this.isDeleted()||c(this,Ki)!==c(this,uy)}serialize(){return this.data}get data(){return{text:c(this,Ki),richText:c(this,cd),date:c(this,ud),deleted:this.isDeleted()}}set data(e){if(e!==c(this,Ki)&&k(this,cd,null),e===null){k(this,Ki,""),k(this,dd,!0);return}k(this,Ki,e),k(this,ud,new Date),k(this,dd,!1)}setInitialText(e,t=null){k(this,uy,e),this.data=e,k(this,ud,null),k(this,cd,t)}shown(){}destroy(){var e,t;(e=c(this,bi))==null||e.remove(),k(this,bi,null),(t=c(this,Cr))==null||t.remove(),k(this,Cr,null),k(this,Ki,""),k(this,cd,null),k(this,ud,null),k(this,hn,null),k(this,ld,!1),k(this,dd,!1)}}Cr=new WeakMap,bi=new WeakMap,ld=new WeakMap,hn=new WeakMap,uy=new WeakMap,cd=new WeakMap,Ki=new WeakMap,ud=new WeakMap,dd=new WeakMap,hd=new WeakMap,dy=new WeakSet,SS=function(e,t){if(!c(this,hn)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[c(this,hn)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=c(this,hn)._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return e;e.addEventListener("contextmenu",Ti,{signal:n}),t&&(e.addEventListener("focusin",s=>{c(this,hn)._focusEventsAllowed=!1,Ln(s)},{capture:!0,signal:n}),e.addEventListener("focusout",s=>{c(this,hn)._focusEventsAllowed=!0,Ln(s)},{capture:!0,signal:n})),e.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:n});const r=s=>{s.preventDefault(),e===c(this,bi)?this.edit():c(this,hn).toggleComment(!0)};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",s=>{s.target===e&&s.key==="Enter"&&(k(this,ld,!0),r(s))},{signal:n}),e.addEventListener("pointerenter",()=>{c(this,hn).toggleComment(!1,!0)},{signal:n}),e.addEventListener("pointerleave",()=>{c(this,hn).toggleComment(!1,!1)},{signal:n}),e};var tp,fd,hy,fy,py,gy,my,Ha,pd,qa,gd,Va,du,qT,VT,WT;const kA=class kA{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:s=null,onPinchEnd:o=null,signal:u}){R(this,du);R(this,tp);R(this,fd,!1);R(this,hy,null);R(this,fy);R(this,py);R(this,gy);R(this,my);R(this,Ha,null);R(this,pd);R(this,qa,null);R(this,gd);R(this,Va,null);k(this,tp,e),k(this,hy,n),k(this,fy,t),k(this,py,r),k(this,gy,s),k(this,my,o),k(this,gd,new AbortController),k(this,pd,AbortSignal.any([u,c(this,gd).signal])),e.addEventListener("touchstart",O(this,du,qT).bind(this),{passive:!1,signal:c(this,pd)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ta.pixelRatio}destroy(){var e,t;(e=c(this,gd))==null||e.abort(),k(this,gd,null),(t=c(this,Ha))==null||t.abort(),k(this,Ha,null)}};tp=new WeakMap,fd=new WeakMap,hy=new WeakMap,fy=new WeakMap,py=new WeakMap,gy=new WeakMap,my=new WeakMap,Ha=new WeakMap,pd=new WeakMap,qa=new WeakMap,gd=new WeakMap,Va=new WeakMap,du=new WeakSet,qT=function(e){var r,s,o;if((r=c(this,fy))!=null&&r.call(this))return;if(e.touches.length===1){if(c(this,Ha))return;const u=k(this,Ha,new AbortController),d=AbortSignal.any([c(this,pd),u.signal]),f=c(this,tp),p={capture:!0,signal:d,passive:!1},y=v=>{var x;v.pointerType==="touch"&&((x=c(this,Ha))==null||x.abort(),k(this,Ha,null))};f.addEventListener("pointerdown",v=>{v.pointerType==="touch"&&(Ln(v),y(v))},p),f.addEventListener("pointerup",y,p),f.addEventListener("pointercancel",y,p);return}if(!c(this,Va)){k(this,Va,new AbortController);const u=AbortSignal.any([c(this,pd),c(this,Va).signal]),d=c(this,tp),f={signal:u,capture:!1,passive:!1};d.addEventListener("touchmove",O(this,du,VT).bind(this),f);const p=O(this,du,WT).bind(this);d.addEventListener("touchend",p,f),d.addEventListener("touchcancel",p,f),f.capture=!0,d.addEventListener("pointerdown",Ln,f),d.addEventListener("pointermove",Ln,f),d.addEventListener("pointercancel",Ln,f),d.addEventListener("pointerup",Ln,f),(s=c(this,py))==null||s.call(this)}if(Ln(e),e.touches.length!==2||(o=c(this,hy))!=null&&o.call(this)){k(this,qa,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),k(this,qa,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},VT=function(e){var F;if(!c(this,qa)||e.touches.length!==2)return;Ln(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:r,screenY:s}=t,{screenX:o,screenY:u}=n,d=c(this,qa),{touch0X:f,touch0Y:p,touch1X:y,touch1Y:v}=d,x=y-f,S=v-p,E=o-r,T=u-s,N=Math.hypot(E,T)||1,L=Math.hypot(x,S)||1;if(!c(this,fd)&&Math.abs(L-N)<=kA.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=r,d.touch0Y=s,d.touch1X=o,d.touch1Y=u,!c(this,fd)){k(this,fd,!0);return}const j=[(r+o)/2,(s+u)/2];(F=c(this,gy))==null||F.call(this,j,L,N)},WT=function(e){var t;e.touches.length>=2||(c(this,Va)&&(c(this,Va).abort(),k(this,Va,null),(t=c(this,my))==null||t.call(this)),c(this,qa)&&(Ln(e),k(this,qa,null),k(this,fd,!1)))};let _w=kA;var md,Xi,xn,sn,Wa,np,Oc,yy,Tr,yd,Ga,wi,jc,vy,vd,Ds,by,bd,Ka,$o,rp,sp,xi,wd,wy,Gw,ft,ES,xy,AS,Mb,GT,KT,kS,Db,CS,XT,YT,JT,TS,QT,NS,ZT,eN,tN,PS,ym;const St=class St{constructor(e){R(this,ft);R(this,md,null);R(this,Xi,null);R(this,xn,null);R(this,sn,null);R(this,Wa,null);R(this,np,!1);R(this,Oc,null);R(this,yy,"");R(this,Tr,null);R(this,yd,null);R(this,Ga,null);R(this,wi,null);R(this,jc,null);R(this,vy,"");R(this,vd,!1);R(this,Ds,null);R(this,by,!1);R(this,bd,!1);R(this,Ka,!1);R(this,$o,null);R(this,rp,0);R(this,sp,0);R(this,xi,null);R(this,wd,null);Re(this,"isSelected",!1);Re(this,"_isCopy",!1);Re(this,"_editToolbar",null);Re(this,"_initialOptions",Object.create(null));Re(this,"_initialData",null);Re(this,"_isVisible",!0);Re(this,"_uiManager",null);Re(this,"_focusEventsAllowed",!0);R(this,wy,!1);R(this,Gw,St._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:s,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[s,o];const[u,d]=this.parentDimensions;this.x=e.x/u,this.y=e.y/d,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=St.prototype._resizeWithKeyboard,t=bh.TRANSLATE_SMALL,n=bh.TRANSLATE_BIG;return xt(this,"_resizerKeyboardManager",new q0([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],St.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return xt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new hj({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(St._l10n??(St._l10n=e),St._l10nResizer||(St._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),St._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);St._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){ln("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return c(this,wy)}set _isDraggable(e){var t;k(this,wy,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=c(this,Gw)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(O(this,ft,ym).call(this),(t=c(this,wi))==null||t.remove(),k(this,wi,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(c(this,vd)?k(this,vd,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){const[s,o]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/s,this.y=(t+r)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,r]=this.parentDimensions;this.setAt(e*n,t*r,this.width*n,this.height*r),this._onTranslated()}translate(e,t){O(this,ft,ES).call(this,this.parentDimensions,e,t)}translateInPage(e,t){c(this,Ds)||k(this,Ds,[this.x,this.y,this.width,this.height]),O(this,ft,ES).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){c(this,Ds)||k(this,Ds,[this.x,this.y,this.width,this.height]);const{div:n,parentDimensions:[r,s]}=this;if(this.x+=e/r,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:y,y:v}=this.div.getBoundingClientRect();this.parent.findNewParent(this,y,v)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:u}=this;const[d,f]=this.getBaseTranslation();o+=d,u+=f;const{style:p}=n;p.left=`${(100*o).toFixed(2)}%`,p.top=`${(100*u).toFixed(2)}%`,this._onTranslating(o,u),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!c(this,Ds)&&(c(this,Ds)[0]!==this.x||c(this,Ds)[1]!==this.y)}get _hasBeenResized(){return!!c(this,Ds)&&(c(this,Ds)[2]!==this.width||c(this,Ds)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=St,r=n/e,s=n/t;switch(this.rotation){case 90:return[-r,s];case 180:return[r,s];case 270:return[r,-s];default:return[-r,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,r]}=this;let{x:s,y:o,width:u,height:d}=this;if(u*=n,d*=r,s*=n,o*=r,this._mustFixPosition)switch(e){case 0:s=ls(s,0,n-u),o=ls(o,0,r-d);break;case 90:s=ls(s,0,n-d),o=ls(o,u,r);break;case 180:s=ls(s,u,n),o=ls(o,d,r);break;case 270:s=ls(s,d,n),o=ls(o,0,r-u);break}this.x=s/=n,this.y=o/=r;const[f,p]=this.getBaseTranslation();s+=f,o+=p,t.left=`${(100*s).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return O(n=St,xy,AS).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return O(n=St,xy,AS).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(){const{div:{style:e},width:t,height:n}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=c(this,xn))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||c(this,bd))return this._editToolbar;this._editToolbar=new gS(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=c(this,xn))==null||t.destroy()}addContainer(e){var n;const t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return c(this,xn)||(xw.initialize(St._l10n),k(this,xn,new xw(this)),c(this,md)&&(c(this,xn).data=c(this,md),k(this,md,null))),c(this,xn)}get altTextData(){var e;return(e=c(this,xn))==null?void 0:e.data}set altTextData(e){c(this,xn)&&(c(this,xn).data=e)}get guessedAltText(){var e;return(e=c(this,xn))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=c(this,xn))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=c(this,xn))==null?void 0:t.serialize(e)}hasAltText(){return!!c(this,xn)&&!c(this,xn).isEmpty()}hasAltTextData(){var e;return((e=c(this,xn))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=c(this,sn))==null||e.focusButton()}addCommentButton(){return this.canAddComment?c(this,sn)||k(this,sn,new lb(this)):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(c(this,Wa)){this._uiManager.isEditingMode()&&c(this,Wa).classList.remove("hidden");return}this.hasComment&&(k(this,Wa,c(this,sn).renderForStandalone()),this.div.append(c(this,Wa)))}}removeStandaloneCommentButton(){c(this,sn).removeStandaloneCommentButton(),k(this,Wa,null)}hideStandaloneCommentButton(){var e;(e=c(this,Wa))==null||e.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:n,deleted:r}}=c(this,sn);return{text:t,richText:e,date:n,deleted:r,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){c(this,sn)||k(this,sn,new lb(this)),c(this,sn).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:n}){if(!t||(c(this,sn)||k(this,sn,new lb(this)),c(this,sn).setInitialText(e,n),!this.annotationElementId))return;const r=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);r&&this.updateFromAnnotationLayer(r)}get hasEditedComment(){var e;return(e=c(this,sn))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=c(this,sn))==null?void 0:e.isDeleted()}get hasComment(){return!!c(this,sn)&&!c(this,sn).isEmpty()&&!c(this,sn).isDeleted()}async editComment(e){c(this,sn)||k(this,sn,new lb(this)),c(this,sn).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){c(this,sn).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,r]=e.rect,[s]=this.pageDimensions,[o]=this.pageTranslation,u=o+s+1,d=r-100,f=u+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[u,d,f,r]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){c(this,sn).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var o;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=c(this,np)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),O(this,ft,NS).call(this);const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[r,s]=this.getInitialTranslation();return this.translate(r,s),PT(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(c(this,wd)||k(this,wd,new _w({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:O(this,ft,XT).bind(this),onPinching:O(this,ft,YT).bind(this),onPinchEnd:O(this,ft,JT).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(o=this._uiManager._editorUndoBar)==null||o.hide(),e}pointerdown(e){const{isMac:t}=Mr.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(k(this,vd,!0),this._isDraggable){O(this,ft,QT).call(this,e);return}O(this,ft,TS).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){c(this,$o)&&clearTimeout(c(this,$o)),k(this,$o,setTimeout(()=>{var e;k(this,$o,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const r=this.parentScale,[s,o]=this.pageDimensions,[u,d]=this.pageTranslation,f=e/r,p=t/r,y=this.x*s,v=this.y*o,x=this.width*s,S=this.height*o;switch(n){case 0:return[y+f+u,o-v-p-S+d,y+f+x+u,o-v-p+d];case 90:return[y+p+u,o-v+f+d,y+p+S+u,o-v+f+x+d];case 180:return[y-f-x+u,o-v+p+d,y-f+u,o-v+p+S+d];case 270:return[y-p-S+u,o-v-f-x+d,y-p+u,o-v-f+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,r,s,o]=e,u=s-n,d=o-r;switch(this.rotation){case 0:return[n,t-o,u,d];case 90:return[n,t-r,d,u];case 180:return[s,t-r,u,d];case 270:return[s,t-o,d,u];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&St._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=c(this,sn))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:n,opacity:r,deleted:s,richText:o},uid:u,pageIndex:d,creationDate:f,modificationDate:p}=this;return{id:u,pageIndex:d,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:f,modificationDate:n||p,popupRef:!s,color:t,opacity:r}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),k(this,bd,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),k(this,bd,!1),!0):!1}isInEditMode(){return c(this,bd)}shouldGetKeyboardEvents(){return c(this,Ka)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:s,innerWidth:o}=window;return t<o&&r>0&&e<s&&n>0}rebuild(){O(this,ft,NS).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var n;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((n=this._initialData)==null?void 0:n.popupRef)||""}}static async deserialize(e,t,n){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});r.rotation=e.rotation,k(r,md,e.accessibilityData),r._isCopy=e.isCopy||!1;const[s,o]=r.pageDimensions,[u,d,f,p]=r.getRectInCurrentCoords(e.rect,o);return r.x=u/s,r.y=d/o,r.width=f/s,r.height=p/o,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t,n;if((e=c(this,jc))==null||e.abort(),k(this,jc,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),c(this,$o)&&(clearTimeout(c(this,$o)),k(this,$o,null)),O(this,ft,ym).call(this),this.removeEditToolbar(),c(this,xi)){for(const r of c(this,xi).values())clearTimeout(r);k(this,xi,null)}this.parent=null,(t=c(this,wd))==null||t.destroy(),k(this,wd,null),(n=c(this,wi))==null||n.remove(),k(this,wi,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(O(this,ft,GT).call(this),c(this,Tr).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[n,r,s,o]=this.getPDFRect();return[St._round(n+(s-n)*e),St._round(r+(o-r)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return c(this,sn).commentPopupPositionInLayer}set commentPopupPosition(e){c(this,sn).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return c(this,sn).hasDefaultPopupPosition()}get commentButtonWidth(){return c(this,sn).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){var t;(t=c(this,sn))==null||t.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),k(this,Ga,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=c(this,Tr).children;if(!c(this,Xi)){k(this,Xi,Array.from(t));const o=O(this,ft,ZT).bind(this),u=O(this,ft,eN).bind(this),d=this._uiManager._signal;for(const f of c(this,Xi)){const p=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",o,{signal:d}),f.addEventListener("blur",u,{signal:d}),f.addEventListener("focus",O(this,ft,tN).bind(this,p),{signal:d}),f.setAttribute("data-l10n-id",St._l10nResizer[p])}}const n=c(this,Xi)[0];let r=0;for(const o of t){if(o===n)break;r++}const s=(360-this.rotation+this.parentRotation)%360/90*(c(this,Xi).length/4);if(s!==r){if(s<r)for(let u=0;u<r-s;u++)c(this,Tr).append(c(this,Tr).firstElementChild);else if(s>r)for(let u=0;u<s-r;u++)c(this,Tr).firstElementChild.before(c(this,Tr).lastElementChild);let o=0;for(const u of t){const f=c(this,Xi)[o++].getAttribute("data-resizer-name");u.setAttribute("data-l10n-id",St._l10nResizer[f])}}O(this,ft,PS).call(this,0),k(this,Ka,!0),c(this,Tr).firstElementChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){c(this,Ka)&&O(this,ft,CS).call(this,c(this,vy),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){O(this,ft,ym).call(this),this.div.focus()}select(){var e,t,n;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var r,s;(r=this.div)!=null&&r.classList.contains("selectedEditor")&&((s=this._editToolbar)==null||s.show())});return}(t=this._editToolbar)==null||t.show(),(n=c(this,xn))==null||n.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,n,r,s;this.isSelected&&(this.isSelected=!1,(e=c(this,Tr))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(r=this._editToolbar)==null||r.hide(),(s=c(this,xn))==null||s.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return c(this,by)}set isEditing(e){k(this,by,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){c(this,xi)||k(this,xi,new Map);const{action:n}=e;let r=c(this,xi).get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),c(this,xi).delete(n),c(this,xi).size===0&&k(this,xi,null)},St._telemetryTimeout),c(this,xi).set(n,r);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),k(this,np,!1)}disable(){this.div&&(this.div.tabIndex=-1),k(this,np,!0)}updateFakeAnnotationElement(e){if(!c(this,wi)&&!this.deleted){k(this,wi,e.addFakeAnnotation(this));return}if(this.deleted){c(this,wi).remove(),k(this,wi,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&c(this,wi).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstElementChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};md=new WeakMap,Xi=new WeakMap,xn=new WeakMap,sn=new WeakMap,Wa=new WeakMap,np=new WeakMap,Oc=new WeakMap,yy=new WeakMap,Tr=new WeakMap,yd=new WeakMap,Ga=new WeakMap,wi=new WeakMap,jc=new WeakMap,vy=new WeakMap,vd=new WeakMap,Ds=new WeakMap,by=new WeakMap,bd=new WeakMap,Ka=new WeakMap,$o=new WeakMap,rp=new WeakMap,sp=new WeakMap,xi=new WeakMap,wd=new WeakMap,wy=new WeakMap,Gw=new WeakMap,ft=new WeakSet,ES=function([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},xy=new WeakSet,AS=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Mb=function(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},GT=function(){if(c(this,Tr))return;k(this,Tr,document.createElement("div")),c(this,Tr).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const r=document.createElement("div");c(this,Tr).append(r),r.classList.add("resizer",n),r.setAttribute("data-resizer-name",n),r.addEventListener("pointerdown",O(this,ft,KT).bind(this,n),{signal:t}),r.addEventListener("contextmenu",Ti,{signal:t}),r.tabIndex=-1}this.div.prepend(c(this,Tr))},KT=function(e,t){var p;t.preventDefault();const{isMac:n}=Mr.platform;if(t.button!==0||t.ctrlKey&&n)return;(p=c(this,xn))==null||p.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,k(this,yd,[t.screenX,t.screenY]);const s=new AbortController,o=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",O(this,ft,CS).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",Ln,{passive:!1,signal:o}),window.addEventListener("contextmenu",Ti,{signal:o}),k(this,Ga,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const u=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const f=()=>{var y;s.abort(),this.parent.togglePointerEvents(!0),(y=c(this,xn))==null||y.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=u,this.div.style.cursor=d,O(this,ft,Db).call(this)};window.addEventListener("pointerup",f,{signal:o}),window.addEventListener("blur",f,{signal:o})},kS=function(e,t,n,r){this.width=n,this.height=r,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},Db=function(){if(!c(this,Ga))return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:r}=c(this,Ga);k(this,Ga,null);const s=this.x,o=this.y,u=this.width,d=this.height;s===e&&o===t&&u===n&&d===r||this.addCommands({cmd:O(this,ft,kS).bind(this,s,o,u,d),undo:O(this,ft,kS).bind(this,e,t,n,r),mustExec:!0})},CS=function(e,t){const[n,r]=this.parentDimensions,s=this.x,o=this.y,u=this.width,d=this.height,f=St.MIN_SIZE/n,p=St.MIN_SIZE/r,y=O(this,ft,Mb).call(this,this.rotation),v=(pe,fe)=>[y[0]*pe+y[2]*fe,y[1]*pe+y[3]*fe],x=O(this,ft,Mb).call(this,360-this.rotation),S=(pe,fe)=>[x[0]*pe+x[2]*fe,x[1]*pe+x[3]*fe];let E,T,N=!1,L=!1;switch(e){case"topLeft":N=!0,E=(pe,fe)=>[0,0],T=(pe,fe)=>[pe,fe];break;case"topMiddle":E=(pe,fe)=>[pe/2,0],T=(pe,fe)=>[pe/2,fe];break;case"topRight":N=!0,E=(pe,fe)=>[pe,0],T=(pe,fe)=>[0,fe];break;case"middleRight":L=!0,E=(pe,fe)=>[pe,fe/2],T=(pe,fe)=>[0,fe/2];break;case"bottomRight":N=!0,E=(pe,fe)=>[pe,fe],T=(pe,fe)=>[0,0];break;case"bottomMiddle":E=(pe,fe)=>[pe/2,fe],T=(pe,fe)=>[pe/2,0];break;case"bottomLeft":N=!0,E=(pe,fe)=>[0,fe],T=(pe,fe)=>[pe,0];break;case"middleLeft":L=!0,E=(pe,fe)=>[0,fe/2],T=(pe,fe)=>[pe,fe/2];break}const j=E(u,d),F=T(u,d);let B=v(...F);const $=St._round(s+B[0]),H=St._round(o+B[1]);let W=1,ae=1,me,ne;if(t.fromKeyboard)({deltaX:me,deltaY:ne}=t);else{const{screenX:pe,screenY:fe}=t,[Z,ke]=c(this,yd);[me,ne]=this.screenToPageTranslation(pe-Z,fe-ke),c(this,yd)[0]=pe,c(this,yd)[1]=fe}if([me,ne]=S(me/n,ne/r),N){const pe=Math.hypot(u,d);W=ae=Math.max(Math.min(Math.hypot(F[0]-j[0]-me,F[1]-j[1]-ne)/pe,1/u,1/d),f/u,p/d)}else L?W=ls(Math.abs(F[0]-j[0]-me),f,1)/u:ae=ls(Math.abs(F[1]-j[1]-ne),p,1)/d;const re=St._round(u*W),xe=St._round(d*ae);B=v(...T(re,xe));const ve=$-B[0],_e=H-B[1];c(this,Ds)||k(this,Ds,[this.x,this.y,this.width,this.height]),this.width=re,this.height=xe,this.x=ve,this.y=_e,this.setDims(),this.fixAndSetPosition(),this._onResizing()},XT=function(){var e;k(this,Ga,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=c(this,xn))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},YT=function(e,t,n){let s=.7*(n/t)+1-.7;if(s===1)return;const o=O(this,ft,Mb).call(this,this.rotation),u=($,H)=>[o[0]*$+o[2]*H,o[1]*$+o[3]*H],[d,f]=this.parentDimensions,p=this.x,y=this.y,v=this.width,x=this.height,S=St.MIN_SIZE/d,E=St.MIN_SIZE/f;s=Math.max(Math.min(s,1/v,1/x),S/v,E/x);const T=St._round(v*s),N=St._round(x*s);if(T===v&&N===x)return;c(this,Ds)||k(this,Ds,[p,y,v,x]);const L=u(v/2,x/2),j=St._round(p+L[0]),F=St._round(y+L[1]),B=u(T/2,N/2);this.x=j-B[0],this.y=F-B[1],this.width=T,this.height=N,this.setDims(),this.fixAndSetPosition(),this._onResizing()},JT=function(){var e;(e=c(this,xn))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),O(this,ft,Db).call(this)},TS=function(e){const{isMac:t}=Mr.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},QT=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const r=new AbortController,s=this._uiManager.combinedSignal(r),o={capture:!0,passive:!1,signal:s},u=f=>{r.abort(),k(this,Oc,null),k(this,vd,!1),this._uiManager.endDragSession()||O(this,ft,TS).call(this,f),n&&this._onStopDragging()};t&&(k(this,rp,e.clientX),k(this,sp,e.clientY),k(this,Oc,e.pointerId),k(this,yy,e.pointerType),window.addEventListener("pointermove",f=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:p,clientY:y,pointerId:v}=f;if(v!==c(this,Oc)){Ln(f);return}const[x,S]=this.screenToPageTranslation(p-c(this,rp),y-c(this,sp));k(this,rp,p),k(this,sp,y),this._uiManager.dragSelectedEditors(x,S)},o),window.addEventListener("touchmove",Ln,o),window.addEventListener("pointerdown",f=>{f.pointerType===c(this,yy)&&(c(this,wd)||f.isPrimary)&&u(f),Ln(f)},o));const d=f=>{if(!c(this,Oc)||c(this,Oc)===f.pointerId){u(f);return}Ln(f)};window.addEventListener("pointerup",d,{signal:s}),window.addEventListener("blur",d,{signal:s})},NS=function(){if(c(this,jc)||!this.div)return;k(this,jc,new AbortController);const e=this._uiManager.combinedSignal(c(this,jc));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},ZT=function(e){St._resizerKeyboardManager.exec(this,e)},eN=function(e){var t;c(this,Ka)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==c(this,Tr)&&O(this,ft,ym).call(this)},tN=function(e){k(this,vy,c(this,Ka)?e:"")},PS=function(e){if(c(this,Xi))for(const t of c(this,Xi))t.tabIndex=e},ym=function(){k(this,Ka,!1),O(this,ft,PS).call(this,-1),O(this,ft,Db).call(this)},R(St,xy),Re(St,"_l10n",null),Re(St,"_l10nResizer",null),Re(St,"_borderLineWidth",-1),Re(St,"_colorManager",new vS),Re(St,"_zIndex",1),Re(St,"_telemetryTimeout",1e3);let fn=St;class hj extends fn{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const rC=3285377520,di=4294901760,No=65535;class nN{constructor(e){this.h1=e?e&4294967295:rC,this.h2=e?e&4294967295:rC}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let E=0,T=e.length;E<T;E++){const N=e.charCodeAt(E);N<=255?t[n++]=N:(t[n++]=N>>>8,t[n++]=N&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=n>>2,s=n-r*4,o=new Uint32Array(t.buffer,0,r);let u=0,d=0,f=this.h1,p=this.h2;const y=3432918353,v=461845907,x=y&No,S=v&No;for(let E=0;E<r;E++)E&1?(u=o[E],u=u*y&di|u*x&No,u=u<<15|u>>>17,u=u*v&di|u*S&No,f^=u,f=f<<13|f>>>19,f=f*5+3864292196):(d=o[E],d=d*y&di|d*x&No,d=d<<15|d>>>17,d=d*v&di|d*S&No,p^=d,p=p<<13|p>>>19,p=p*5+3864292196);switch(u=0,s){case 3:u^=t[r*4+2]<<16;case 2:u^=t[r*4+1]<<8;case 1:u^=t[r*4],u=u*y&di|u*x&No,u=u<<15|u>>>17,u=u*v&di|u*S&No,r&1?f^=u:p^=u}this.h1=f,this.h2=p}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&di|e*36045&No,t=t*4283543511&di|((t<<16|e>>>16)*2950163797&di)>>>16,e^=t>>>1,e=e*444984403&di|e*60499&No,t=t*3301882366&di|((t<<16|e>>>16)*3120437893&di)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const RS=Object.freeze({map:null,hash:"",transfer:void 0});var xd,_d,Xa,Nr,Kw,rN;class oA{constructor(){R(this,Kw);R(this,xd,!1);R(this,_d,null);R(this,Xa,null);R(this,Nr,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=c(this,Nr).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return c(this,Nr).get(e)}remove(e){const t=c(this,Nr).get(e);if(t!==void 0&&(t instanceof fn&&c(this,Xa).delete(t.annotationElementId),c(this,Nr).delete(e),c(this,Nr).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of c(this,Nr).values())if(n instanceof fn)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=c(this,Nr).get(e);let r=!1;if(n!==void 0)for(const[s,o]of Object.entries(t))n[s]!==o&&(r=!0,n[s]=o);else r=!0,c(this,Nr).set(e,t);r&&O(this,Kw,rN).call(this),t instanceof fn&&((c(this,Xa)||k(this,Xa,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return c(this,Nr).has(e)}get size(){return c(this,Nr).size}resetModified(){c(this,xd)&&(k(this,xd,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new sN(this)}get serializable(){if(c(this,Nr).size===0)return RS;const e=new Map,t=new nN,n=[],r=Object.create(null);let s=!1;for(const[o,u]of c(this,Nr)){const d=u instanceof fn?u.serialize(!1,r):u;d&&(e.set(o,d),t.update(`${o}:${JSON.stringify(d)}`),s||(s=!!d.bitmap))}if(s)for(const o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:RS}get editorStats(){let e=null;const t=new Map;let n=0,r=0;for(const s of c(this,Nr).values()){if(!(s instanceof fn)){s.popup&&(s.popup.deleted?r+=1:n+=1);continue}s.isCommentDeleted?r+=1:s.hasEditedComment&&(n+=1);const o=s.telemetryFinalData;if(!o)continue;const{type:u}=o;t.has(u)||t.set(u,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));const d=e[u]||(e[u]=new Map);for(const[f,p]of Object.entries(o)){if(f==="type")continue;let y=d.get(f);y||(y=new Map,d.set(f,y));const v=y.get(p)??0;y.set(p,v+1)}}if((r>0||n>0)&&(e||(e=Object.create(null)),e.comments={deleted:r,edited:n}),!e)return null;for(const[s,o]of t)e[s]=o.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){k(this,_d,null)}updateEditor(e,t){var r;const n=(r=c(this,Xa))==null?void 0:r.get(e);return n?(n.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=c(this,Xa))==null?void 0:t.get(e))||null}get modifiedIds(){if(c(this,_d))return c(this,_d);const e=[];if(c(this,Xa))for(const t of c(this,Xa).values())t.serialize()&&e.push(t.annotationElementId);return k(this,_d,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return c(this,Nr).entries()}}xd=new WeakMap,_d=new WeakMap,Xa=new WeakMap,Nr=new WeakMap,Kw=new WeakSet,rN=function(){c(this,xd)||(k(this,xd,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var _y;class sN extends oA{constructor(t){super();R(this,_y);const{map:n,hash:r,transfer:s}=t.serializable,o=structuredClone(n,s?{transfer:s}:null);k(this,_y,{map:o,hash:r,transfer:s})}get print(){ln("Should not call PrintAnnotationStorage.print")}get serializable(){return c(this,_y)}get modifiedIds(){return xt(this,"modifiedIds",{ids:new Set,hash:""})}}_y=new WeakMap;var ip;class fj{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){R(this,ip,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),c(this,ip).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||c(this,ip).has(e.loadedName))){if(Lt(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:s,style:o}=e,u=new FontFace(r,s,o);this.addNativeFontFace(u);try{await u.load(),c(this,ip).add(r),n==null||n(e)}catch{wt(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(u)}return}ln("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(r){throw wt(`Failed to load font '${n.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return xt(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return xt(this,"isSyncFontLoadingSupported",as||Mr.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Lt(!r.done,"completeRequest() cannot be called twice."),r.done=!0;n.length>0&&n[0].done;){const s=n.shift();setTimeout(s.callback,0)}}const{loadingRequests:n}=this,r={done:!1,complete:t,callback:e};return n.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return xt(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(F,B){return F.charCodeAt(B)<<24|F.charCodeAt(B+1)<<16|F.charCodeAt(B+2)<<8|F.charCodeAt(B+3)&255}function r(F,B,$,H){const W=F.substring(0,B),ae=F.substring(B+$);return W+H+ae}let s,o;const u=this._document.createElement("canvas");u.width=1,u.height=1;const d=u.getContext("2d");let f=0;function p(F,B){if(++f>30){wt("Load test font never loaded."),B();return}if(d.font="30px "+F,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){B();return}setTimeout(p.bind(null,F,B))}const y=`lt${Date.now()}${this.loadTestFontId++}`;let v=this._loadTestFont;v=r(v,976,y.length,y);const S=16,E=1482184792;let T=n(v,S);for(s=0,o=y.length-3;s<o;s+=4)T=T-E+n(y,s)|0;s<y.length&&(T=T-E+n(y+"XXX",s)|0),v=r(v,S,4,GO(T));const N=`url(data:font/opentype;base64,${btoa(v)});`,L=`@font-face {font-family:"${y}";src:${N}}`;this.insertRule(L);const j=this._document.createElement("div");j.style.visibility="hidden",j.style.width=j.style.height="10px",j.style.position="absolute",j.style.top=j.style.left="0px";for(const F of[e.loadedName,y]){const B=this._document.createElement("span");B.textContent="Hi",B.style.fontFamily=F,j.append(B)}this._document.body.append(j),p(y,()=>{j.remove(),t.complete()})}}ip=new WeakMap;var Zt;class pj{constructor(e,t=null,n,r){R(this,Zt);this.compiledGlyphs=Object.create(null),k(this,Zt,e),this._inspectFont=t,n&&Object.assign(this,n),r&&(this.charProcOperatorList=r)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${xT(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let r;try{r=e.get(n)}catch(o){wt(`getPathGenerator - ignoring character: "${o}".`)}const s=ET(r);return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=s}get black(){return c(this,Zt).black}get bold(){return c(this,Zt).bold}get disableFontFace(){return c(this,Zt).disableFontFace??!1}set disableFontFace(e){xt(this,"disableFontFace",!!e)}get fontExtraProperties(){return c(this,Zt).fontExtraProperties??!1}get isInvalidPDFjsFont(){return c(this,Zt).isInvalidPDFjsFont}get isType3Font(){return c(this,Zt).isType3Font}get italic(){return c(this,Zt).italic}get missingFile(){return c(this,Zt).missingFile}get remeasure(){return c(this,Zt).remeasure}get vertical(){return c(this,Zt).vertical}get ascent(){return c(this,Zt).ascent}get defaultWidth(){return c(this,Zt).defaultWidth}get descent(){return c(this,Zt).descent}get bbox(){return c(this,Zt).bbox}set bbox(e){xt(this,"bbox",e)}get fontMatrix(){return c(this,Zt).fontMatrix}get fallbackName(){return c(this,Zt).fallbackName}get loadedName(){return c(this,Zt).loadedName}get mimetype(){return c(this,Zt).mimetype}get name(){return c(this,Zt).name}get data(){return c(this,Zt).data}clearData(){c(this,Zt).clearData()}get cssFontInfo(){return c(this,Zt).cssFontInfo}get systemFontInfo(){return c(this,Zt).systemFontInfo}get defaultVMetrics(){return c(this,Zt).defaultVMetrics}}Zt=new WeakMap;var op,ap,Sy,lp,Lb;const Nf=class Nf{constructor(e){R(this,lp);R(this,op);R(this,ap);R(this,Sy);k(this,op,e),k(this,ap,new DataView(c(this,op))),k(this,Sy,new TextDecoder)}static write(e){const t=new TextEncoder,n={};let r=0;for(const f of Nf.strings){const p=t.encode(e[f]);n[f]=p,r+=4+p.length}const s=new ArrayBuffer(r),o=new Uint8Array(s),u=new DataView(s);let d=0;for(const f of Nf.strings){const p=n[f],y=p.length;u.setUint32(d,y),o.set(p,d+4),d+=4+y}return Lt(d===s.byteLength,"CssFontInfo.write: Buffer overflow"),s}get fontFamily(){return O(this,lp,Lb).call(this,0)}get fontWeight(){return O(this,lp,Lb).call(this,1)}get italicAngle(){return O(this,lp,Lb).call(this,2)}};op=new WeakMap,ap=new WeakMap,Sy=new WeakMap,lp=new WeakSet,Lb=function(e){Lt(e<Nf.strings.length,"Invalid string index");let t=0;for(let r=0;r<e;r++)t+=c(this,ap).getUint32(t)+4;const n=c(this,ap).getUint32(t);return c(this,Sy).decode(new Uint8Array(c(this,op),t+4,n))},Re(Nf,"strings",["fontFamily","fontWeight","italicAngle"]);let Sw=Nf;var Mc,Uo,Sd,Ed,vm;const Pf=class Pf{constructor(e){R(this,Ed);R(this,Mc);R(this,Uo);R(this,Sd);k(this,Mc,e),k(this,Uo,new DataView(c(this,Mc))),k(this,Sd,new TextDecoder)}static write(e){const t=new TextEncoder,n={};let r=0;for(const v of Pf.strings){const x=t.encode(e[v]);n[v]=x,r+=4+x.length}r+=4;let s,o,u=1+r;e.style&&(s=t.encode(e.style.style),o=t.encode(e.style.weight),u+=4+s.length+4+o.length);const d=new ArrayBuffer(u),f=new Uint8Array(d),p=new DataView(d);let y=0;p.setUint8(y++,e.guessFallback?1:0),p.setUint32(y,0),y+=4,r=0;for(const v of Pf.strings){const x=n[v],S=x.length;r+=4+S,p.setUint32(y,S),f.set(x,y+4),y+=4+S}return p.setUint32(y-r-4,r),e.style&&(p.setUint32(y,s.length),f.set(s,y+4),y+=4+s.length,p.setUint32(y,o.length),f.set(o,y+4),y+=4+o.length),Lt(y<=d.byteLength,"SubstitionInfo.write: Buffer overflow"),d.transferToFixedLength(y)}get guessFallback(){return c(this,Uo).getUint8(0)!==0}get css(){return O(this,Ed,vm).call(this,0)}get loadedName(){return O(this,Ed,vm).call(this,1)}get baseFontName(){return O(this,Ed,vm).call(this,2)}get src(){return O(this,Ed,vm).call(this,3)}get style(){let e=1;e+=4+c(this,Uo).getUint32(e);const t=c(this,Uo).getUint32(e),n=c(this,Sd).decode(new Uint8Array(c(this,Mc),e+4,t));e+=4+t;const r=c(this,Uo).getUint32(e),s=c(this,Sd).decode(new Uint8Array(c(this,Mc),e+4,r));return{style:n,weight:s}}};Mc=new WeakMap,Uo=new WeakMap,Sd=new WeakMap,Ed=new WeakSet,vm=function(e){Lt(e<Pf.strings.length,"Invalid string index");let t=5;for(let r=0;r<e;r++)t+=c(this,Uo).getUint32(t)+4;const n=c(this,Uo).getUint32(t);return c(this,Sd).decode(new Uint8Array(c(this,Mc),t+4,n))},Re(Pf,"strings",["css","loadedName","baseFontName","src"]);let Ew=Pf;var cp,up,dp,hp,Ls,zo,Ey,en,Dn,Hi,Fb,bm;const At=class At{constructor({data:e,extra:t}){R(this,Dn);R(this,zo);R(this,Ey);R(this,en);k(this,zo,e),k(this,Ey,new TextDecoder),k(this,en,new DataView(c(this,zo))),t&&Object.assign(this,t)}get black(){return O(this,Dn,Hi).call(this,0)}get bold(){return O(this,Dn,Hi).call(this,1)}get disableFontFace(){return O(this,Dn,Hi).call(this,2)}get fontExtraProperties(){return O(this,Dn,Hi).call(this,3)}get isInvalidPDFjsFont(){return O(this,Dn,Hi).call(this,4)}get isType3Font(){return O(this,Dn,Hi).call(this,5)}get italic(){return O(this,Dn,Hi).call(this,6)}get missingFile(){return O(this,Dn,Hi).call(this,7)}get remeasure(){return O(this,Dn,Hi).call(this,8)}get vertical(){return O(this,Dn,Hi).call(this,9)}get ascent(){return O(this,Dn,Fb).call(this,0)}get defaultWidth(){return O(this,Dn,Fb).call(this,1)}get descent(){return O(this,Dn,Fb).call(this,2)}get bbox(){let e=c(At,up);if(c(this,en).getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<4;r++)n.push(c(this,en).getInt16(e,!0)),e+=2;return n}get fontMatrix(){let e=c(At,dp);if(c(this,en).getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<6;r++)n.push(c(this,en).getFloat64(e,!0)),e+=8;return n}get defaultVMetrics(){let e=c(At,hp);if(c(this,en).getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<3;r++)n.push(c(this,en).getInt16(e,!0)),e+=2;return n}get fallbackName(){return O(this,Dn,bm).call(this,0)}get loadedName(){return O(this,Dn,bm).call(this,1)}get mimetype(){return O(this,Dn,bm).call(this,2)}get name(){return O(this,Dn,bm).call(this,3)}get data(){let e=c(At,Ls);const t=c(this,en).getUint32(e);e+=4+t;const n=c(this,en).getUint32(e);e+=4+n;const r=c(this,en).getUint32(e);e+=4+r;const s=c(this,en).getUint32(e);if(s!==0)return new Uint8Array(c(this,zo),e+4,s)}clearData(){let e=c(At,Ls);const t=c(this,en).getUint32(e);e+=4+t;const n=c(this,en).getUint32(e);e+=4+n;const r=c(this,en).getUint32(e);e+=4+r;const s=c(this,en).getUint32(e);new Uint8Array(c(this,zo),e+4,s).fill(0),c(this,en).setUint32(e,0)}get cssFontInfo(){let e=c(At,Ls);const t=c(this,en).getUint32(e);e+=4+t;const n=c(this,en).getUint32(e);e+=4+n;const r=c(this,en).getUint32(e);if(r===0)return null;const s=new Uint8Array(r);return s.set(new Uint8Array(c(this,zo),e+4,r)),new Sw(s.buffer)}get systemFontInfo(){let e=c(At,Ls);const t=c(this,en).getUint32(e);e+=4+t;const n=c(this,en).getUint32(e);if(n===0)return null;const r=new Uint8Array(n);return r.set(new Uint8Array(c(this,zo),e+4,n)),new Ew(r.buffer)}static write(e){const t=e.systemFontInfo?Ew.write(e.systemFontInfo):null,n=e.cssFontInfo?Sw.write(e.cssFontInfo):null,r=new TextEncoder,s={};let o=0;for(const E of At.strings)s[E]=r.encode(e[E]),o+=4+s[E].length;const u=c(At,Ls)+4+o+4+(t?t.byteLength:0)+4+(n?n.byteLength:0)+4+(e.data?e.data.length:0),d=new ArrayBuffer(u),f=new Uint8Array(d),p=new DataView(d);let y=0;const v=At.bools.length;let x=0,S=0;for(let E=0;E<v;E++){const T=e[At.bools[E]];x|=(T===void 0?0:T?2:1)<<S,S+=2,(S===8||E===v-1)&&(p.setUint8(y++,x),x=0,S=0)}Lt(y===c(At,cp),"FontInfo.write: Boolean properties offset mismatch");for(const E of At.numbers)p.setFloat64(y,e[E]),y+=8;if(Lt(y===c(At,up),"FontInfo.write: Number properties offset mismatch"),e.bbox){p.setUint8(y++,4);for(const E of e.bbox)p.setInt16(y,E,!0),y+=2}else p.setUint8(y++,0),y+=8;if(Lt(y===c(At,dp),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){p.setUint8(y++,6);for(const E of e.fontMatrix)p.setFloat64(y,E,!0),y+=8}else p.setUint8(y++,0),y+=48;if(Lt(y===c(At,hp),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){p.setUint8(y++,1);for(const E of e.defaultVMetrics)p.setInt16(y,E,!0),y+=2}else p.setUint8(y++,0),y+=6;Lt(y===c(At,Ls),"FontInfo.write: DefaultVMetrics properties offset mismatch"),p.setUint32(c(At,Ls),0),y+=4;for(const E of At.strings){const T=s[E],N=T.length;p.setUint32(y,N),f.set(T,y+4),y+=4+N}if(p.setUint32(c(At,Ls),y-c(At,Ls)-4),!t)p.setUint32(y,0),y+=4;else{const E=t.byteLength;p.setUint32(y,E),Lt(y+4+E<=d.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),f.set(new Uint8Array(t),y+4),y+=4+E}if(!n)p.setUint32(y,0),y+=4;else{const E=n.byteLength;p.setUint32(y,E),Lt(y+4+E<=d.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),f.set(new Uint8Array(n),y+4),y+=4+E}return e.data===void 0?(p.setUint32(y,0),y+=4):(p.setUint32(y,e.data.length),f.set(e.data,y+4),y+=4+e.data.length),Lt(y<=d.byteLength,"FontInfo.write: Buffer overflow"),d.transferToFixedLength(y)}};cp=new WeakMap,up=new WeakMap,dp=new WeakMap,hp=new WeakMap,Ls=new WeakMap,zo=new WeakMap,Ey=new WeakMap,en=new WeakMap,Dn=new WeakSet,Hi=function(e){Lt(e<At.bools.length,"Invalid boolean index");const t=Math.floor(e/4),n=e*2%8,r=c(this,en).getUint8(t)>>n&3;return r===0?void 0:r===2},Fb=function(e){return Lt(e<At.numbers.length,"Invalid number index"),c(this,en).getFloat64(c(At,cp)+e*8)},bm=function(e){Lt(e<At.strings.length,"Invalid string index");let t=c(At,Ls)+4;for(let s=0;s<e;s++)t+=c(this,en).getUint32(t)+4;const n=c(this,en).getUint32(t),r=new Uint8Array(n);return r.set(new Uint8Array(c(this,zo),t+4,n)),c(this,Ey).decode(r)},Re(At,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),Re(At,"numbers",["ascent","defaultWidth","descent"]),Re(At,"strings",["fallbackName","loadedName","mimetype","name"]),R(At,cp,Math.ceil(At.bools.length*2/8)),R(At,up,c(At,cp)+At.numbers.length*8),R(At,dp,c(At,up)+1+8),R(At,hp,c(At,dp)+1+48),R(At,Ls,c(At,hp)+1+6);let IS=At;var Ay,ky,Cy,Ty,Ny,Py,Ry,Iy;const dn=class dn{constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,n=null,r=[],s=[],o=[],u=[],d=null,f=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,n=e[2],o=e[3],t===1?r.push(...e[4],...e[5]):r.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,d=e[1],r=e[2],s=e[3],u=e[4]||[],n=e[6],f=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const p=Math.floor(r.length/2),y=Math.floor(s.length/3),v=o.length,x=u.length;let S=0;for(const B of u)S+=1,S=Math.ceil(S/4)*4,S+=4+B.coords.length*4,S+=4+B.colors.length*4,B.verticesPerRow!==void 0&&(S+=4);const E=20+p*8+y*3+v*8+(n?16:0)+(f?3:0)+S,T=new ArrayBuffer(E),N=new DataView(T),L=new Uint8Array(T);N.setUint8(c(dn,Ay),t),N.setUint8(c(dn,ky),n?1:0),N.setUint8(c(dn,Cy),f?1:0),N.setUint8(c(dn,Ty),d),N.setUint32(c(dn,Ny),p,!0),N.setUint32(c(dn,Py),y,!0),N.setUint32(c(dn,Ry),v,!0),N.setUint32(c(dn,Iy),x,!0);let j=20;new Float32Array(T,j,p*2).set(r),j+=p*8,L.set(s,j),j+=y*3;for(const[B,$]of o)N.setFloat32(j,B,!0),j+=4,N.setUint32(j,parseInt($.slice(1),16),!0),j+=4;if(n)for(const B of n)N.setFloat32(j,B,!0),j+=4;f&&(L.set(f,j),j+=3);for(let B=0;B<u.length;B++){const $=u[B];N.setUint8(j,$.type),j+=1,j=Math.ceil(j/4)*4,N.setUint32(j,$.coords.length,!0),j+=4,new Int32Array(T,j,$.coords.length).set($.coords),j+=$.coords.length*4,N.setUint32(j,$.colors.length,!0),j+=4,new Int32Array(T,j,$.colors.length).set($.colors),j+=$.colors.length*4,$.verticesPerRow!==void 0&&(N.setUint32(j,$.verticesPerRow,!0),j+=4)}return T}getIR(){const e=this.view,t=this.data[c(dn,Ay)],n=!!this.data[c(dn,ky)],r=!!this.data[c(dn,Cy)],s=e.getUint32(c(dn,Ny),!0),o=e.getUint32(c(dn,Py),!0),u=e.getUint32(c(dn,Ry),!0),d=e.getUint32(c(dn,Iy),!0);let f=20;const p=new Float32Array(this.buffer,f,s*2);f+=s*8;const y=new Uint8Array(this.buffer,f,o*3);f+=o*3;const v=[];for(let T=0;T<u;++T){const N=e.getFloat32(f,!0);f+=4;const L=e.getUint32(f,!0);f+=4,v.push([N,`#${L.toString(16).padStart(6,"0")}`])}let x=null;if(n){x=[];for(let T=0;T<4;++T)x.push(e.getFloat32(f,!0)),f+=4}let S=null;r&&(S=new Uint8Array(this.buffer,f,3),f+=3);const E=[];for(let T=0;T<d;++T){const N=e.getUint8(f);f+=1,f=Math.ceil(f/4)*4;const L=e.getUint32(f,!0);f+=4;const j=new Int32Array(this.buffer,f,L);f+=L*4;const F=e.getUint32(f,!0);f+=4;const B=new Int32Array(this.buffer,f,F);f+=F*4;const $={type:N,coords:j,colors:B};N===uS.LATTICE&&($.verticesPerRow=e.getUint32(f,!0),f+=4),E.push($)}if(t===1)return["RadialAxial","axial",x,v,Array.from(p.slice(0,2)),Array.from(p.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",x,v,[p[0],p[1]],[p[3],p[4]],p[2],p[5]];if(t===3){const T=this.data[c(dn,Ty)];let N=null;if(p.length>0){let L=p[0],j=p[0],F=p[1],B=p[1];for(let $=0;$<p.length;$+=2){const H=p[$],W=p[$+1];L=L>H?H:L,F=F>W?W:F,j=j<H?H:j,B=B<W?W:B}N=[L,F,j,B]}return["Mesh",T,p,y,E,N,x,S]}throw new Error(`Unsupported pattern kind: ${t}`)}};Ay=new WeakMap,ky=new WeakMap,Cy=new WeakMap,Ty=new WeakMap,Ny=new WeakMap,Py=new WeakMap,Ry=new WeakMap,Iy=new WeakMap,R(dn,Ay,0),R(dn,ky,1),R(dn,Cy,2),R(dn,Ty,3),R(dn,Ny,4),R(dn,Py,8),R(dn,Ry,12),R(dn,Iy,16);let OS=dn;function gj(a){if(a instanceof URL)return a.href;if(typeof a=="string"){if(as)return a;const e=URL.parse(a,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function mj(a){if(as&&typeof Buffer<"u"&&a instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength)return a;if(typeof a=="string")return $0(a);if(a instanceof ArrayBuffer||ArrayBuffer.isView(a)||typeof a=="object"&&!isNaN(a==null?void 0:a.length))return new Uint8Array(a);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function cb(a){if(typeof a!="string")return null;if(a.endsWith("/"))return a;throw new Error(`Invalid factory url: "${a}" must include trailing slash.`)}const jS=a=>typeof a=="object"&&Number.isInteger(a==null?void 0:a.num)&&a.num>=0&&Number.isInteger(a==null?void 0:a.gen)&&a.gen>=0,yj=a=>typeof a=="object"&&typeof(a==null?void 0:a.name)=="string",vj=QO.bind(null,jS,yj);var Ya,Xw;class bj{constructor(){R(this,Ya,new Map);R(this,Xw,Promise.resolve())}postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};c(this,Xw).then(()=>{for(const[r]of c(this,Ya))r.call(this,n)})}addEventListener(e,t,n=null){let r=null;if((n==null?void 0:n.signal)instanceof AbortSignal){const{signal:s}=n;if(s.aborted){wt("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);r=()=>s.removeEventListener("abort",o),s.addEventListener("abort",o)}c(this,Ya).set(t,r)}removeEventListener(e,t){const n=c(this,Ya).get(t);n==null||n(),c(this,Ya).delete(t)}terminate(){for(const[,e]of c(this,Ya))e==null||e();c(this,Ya).clear()}}Ya=new WeakMap,Xw=new WeakMap;const ub={DATA:1,ERROR:2},Hn={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function sC(){}function ys(a){if(a instanceof cu||a instanceof dS||a instanceof Yk||a instanceof bw||a instanceof q_)return a;switch(a instanceof Error||typeof a=="object"&&a!==null||ln('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),a.name){case"AbortException":return new cu(a.message);case"InvalidPDFException":return new dS(a.message);case"PasswordException":return new Yk(a.message,a.code);case"ResponseException":return new bw(a.message,a.status,a.missing);case"UnknownErrorException":return new q_(a.message,a.details)}return new q_(a.message,a.toString())}var fp,Ci,iN,oN,aN,Bb;class wm{constructor(e,t,n){R(this,Ci);R(this,fp,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",O(this,Ci,iN).bind(this),{signal:c(this,fp).signal})}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const r=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[r]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(o){s.reject(o)}return s.promise}sendWithStream(e,t,n,r){const s=this.streamId++,o=this.sourceName,u=this.targetName,d=this.comObj;return new ReadableStream({start:f=>{const p=Promise.withResolvers();return this.streamControllers[s]={controller:f,startCall:p,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:o,targetName:u,action:e,streamId:s,data:t,desiredSize:f.desiredSize},r),p.promise},pull:f=>{const p=Promise.withResolvers();return this.streamControllers[s].pullCall=p,d.postMessage({sourceName:o,targetName:u,stream:Hn.PULL,streamId:s,desiredSize:f.desiredSize}),p.promise},cancel:f=>{Lt(f instanceof Error,"cancel must have a valid reason");const p=Promise.withResolvers();return this.streamControllers[s].cancelCall=p,this.streamControllers[s].isClosed=!0,d.postMessage({sourceName:o,targetName:u,stream:Hn.CANCEL,streamId:s,reason:ys(f)}),p.promise}},n)}destroy(){var e;(e=c(this,fp))==null||e.abort(),k(this,fp,null)}}fp=new WeakMap,Ci=new WeakSet,iN=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){O(this,Ci,aN).call(this,e);return}if(e.callback){const n=e.callbackId,r=this.callbackCapabilities[n];if(!r)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===ub.DATA)r.resolve(e.data);else if(e.callback===ub.ERROR)r.reject(ys(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,r=e.sourceName,s=this.comObj;Promise.try(t,e.data).then(function(o){s.postMessage({sourceName:n,targetName:r,callback:ub.DATA,callbackId:e.callbackId,data:o})},function(o){s.postMessage({sourceName:n,targetName:r,callback:ub.ERROR,callbackId:e.callbackId,reason:ys(o)})});return}if(e.streamId){O(this,Ci,oN).call(this,e);return}t(e.data)},oN=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,s=this.comObj,o=this,u=this.actionHandler[e.action],d={enqueue(f,p=1,y){if(this.isCancelled)return;const v=this.desiredSize;this.desiredSize-=p,v>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:n,targetName:r,stream:Hn.ENQUEUE,streamId:t,chunk:f},y)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:r,stream:Hn.CLOSE,streamId:t}),delete o.streamSinks[t])},error(f){Lt(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:r,stream:Hn.ERROR,streamId:t,reason:ys(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[t]=d,Promise.try(u,e.data,d).then(function(){s.postMessage({sourceName:n,targetName:r,stream:Hn.START_COMPLETE,streamId:t,success:!0})},function(f){s.postMessage({sourceName:n,targetName:r,stream:Hn.START_COMPLETE,streamId:t,reason:ys(f)})})},aN=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,s=this.comObj,o=this.streamControllers[t],u=this.streamSinks[t];switch(e.stream){case Hn.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(ys(e.reason));break;case Hn.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(ys(e.reason));break;case Hn.PULL:if(!u){s.postMessage({sourceName:n,targetName:r,stream:Hn.PULL_COMPLETE,streamId:t,success:!0});break}u.desiredSize<=0&&e.desiredSize>0&&u.sinkCapability.resolve(),u.desiredSize=e.desiredSize,Promise.try(u.onPull||sC).then(function(){s.postMessage({sourceName:n,targetName:r,stream:Hn.PULL_COMPLETE,streamId:t,success:!0})},function(f){s.postMessage({sourceName:n,targetName:r,stream:Hn.PULL_COMPLETE,streamId:t,reason:ys(f)})});break;case Hn.ENQUEUE:if(Lt(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Hn.CLOSE:if(Lt(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),O(this,Ci,Bb).call(this,o,t);break;case Hn.ERROR:Lt(o,"error should have stream controller"),o.controller.error(ys(e.reason)),O(this,Ci,Bb).call(this,o,t);break;case Hn.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(ys(e.reason)),O(this,Ci,Bb).call(this,o,t);break;case Hn.CANCEL:if(!u)break;const d=ys(e.reason);Promise.try(u.onCancel||sC,d).then(function(){s.postMessage({sourceName:n,targetName:r,stream:Hn.CANCEL_COMPLETE,streamId:t,success:!0})},function(f){s.postMessage({sourceName:n,targetName:r,stream:Hn.CANCEL_COMPLETE,streamId:t,reason:ys(f)})}),u.sinkCapability.reject(d),u.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Bb=async function(e,t){var n,r,s;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(r=e.pullCall)==null?void 0:r.promise,(s=e.cancelCall)==null?void 0:s.promise]),delete this.streamControllers[t]};var Oy;class lN{constructor({enableHWA:e=!1}){R(this,Oy,!1);k(this,Oy,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!c(this,Oy)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){ln("Abstract method `_createCanvas` called.")}}Oy=new WeakMap;class wj extends lN{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class cN{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){ln("Abstract method `_fetch` called.")}}class iC extends cN{async _fetch(e){const t=await U0(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):$0(t)}}class uN{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,r,s){return"none"}destroy(e=!1){}}var Ad,pp,Ja,Qa,Gr,kd,Cd,Ye,Hr,xm,yf,$b,vf,dN,MS,bf,_m,Sm,DS,Em;class xj extends uN{constructor({docId:t,ownerDocument:n=globalThis.document}){super();R(this,Ye);R(this,Ad);R(this,pp);R(this,Ja);R(this,Qa);R(this,Gr);R(this,kd);R(this,Cd,0);k(this,Qa,t),k(this,Gr,n)}addFilter(t){if(!t)return"none";let n=c(this,Ye,Hr).get(t);if(n)return n;const[r,s,o]=O(this,Ye,$b).call(this,t),u=t.length===1?r:`${r}${s}${o}`;if(n=c(this,Ye,Hr).get(u),n)return c(this,Ye,Hr).set(t,n),n;const d=`g_${c(this,Qa)}_transfer_map_${er(this,Cd)._++}`,f=O(this,Ye,vf).call(this,d);c(this,Ye,Hr).set(t,f),c(this,Ye,Hr).set(u,f);const p=O(this,Ye,bf).call(this,d);return O(this,Ye,Sm).call(this,r,s,o,p),f}addHCMFilter(t,n){var S;const r=`${t}-${n}`,s="base";let o=c(this,Ye,xm).get(s);if((o==null?void 0:o.key)===r||(o?((S=o.filter)==null||S.remove(),o.key=r,o.url="none",o.filter=null):(o={key:r,url:"none",filter:null},c(this,Ye,xm).set(s,o)),!t||!n))return o.url;const u=O(this,Ye,Em).call(this,t);t=Ze.makeHexColor(...u);const d=O(this,Ye,Em).call(this,n);if(n=Ze.makeHexColor(...d),c(this,Ye,yf).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return o.url;const f=new Array(256);for(let E=0;E<=255;E++){const T=E/255;f[E]=T<=.03928?T/12.92:((T+.055)/1.055)**2.4}const p=f.join(","),y=`g_${c(this,Qa)}_hcm_filter`,v=o.filter=O(this,Ye,bf).call(this,y);O(this,Ye,Sm).call(this,p,p,p,v),O(this,Ye,MS).call(this,v);const x=(E,T)=>{const N=u[E]/255,L=d[E]/255,j=new Array(T+1);for(let F=0;F<=T;F++)j[F]=N+F/T*(L-N);return j.join(",")};return O(this,Ye,Sm).call(this,x(0,5),x(1,5),x(2,5),v),o.url=O(this,Ye,vf).call(this,y),o.url}addAlphaFilter(t){let n=c(this,Ye,Hr).get(t);if(n)return n;const[r]=O(this,Ye,$b).call(this,[t]),s=`alpha_${r}`;if(n=c(this,Ye,Hr).get(s),n)return c(this,Ye,Hr).set(t,n),n;const o=`g_${c(this,Qa)}_alpha_map_${er(this,Cd)._++}`,u=O(this,Ye,vf).call(this,o);c(this,Ye,Hr).set(t,u),c(this,Ye,Hr).set(s,u);const d=O(this,Ye,bf).call(this,o);return O(this,Ye,DS).call(this,r,d),u}addLuminosityFilter(t){let n=c(this,Ye,Hr).get(t||"luminosity");if(n)return n;let r,s;if(t?([r]=O(this,Ye,$b).call(this,[t]),s=`luminosity_${r}`):s="luminosity",n=c(this,Ye,Hr).get(s),n)return c(this,Ye,Hr).set(t,n),n;const o=`g_${c(this,Qa)}_luminosity_map_${er(this,Cd)._++}`,u=O(this,Ye,vf).call(this,o);c(this,Ye,Hr).set(t,u),c(this,Ye,Hr).set(s,u);const d=O(this,Ye,bf).call(this,o);return O(this,Ye,dN).call(this,d),t&&O(this,Ye,DS).call(this,r,d),u}addHighlightHCMFilter(t,n,r,s,o){var L;const u=`${n}-${r}-${s}-${o}`;let d=c(this,Ye,xm).get(t);if((d==null?void 0:d.key)===u||(d?((L=d.filter)==null||L.remove(),d.key=u,d.url="none",d.filter=null):(d={key:u,url:"none",filter:null},c(this,Ye,xm).set(t,d)),!n||!r))return d.url;const[f,p]=[n,r].map(O(this,Ye,Em).bind(this));let y=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),v=Math.round(.2126*p[0]+.7152*p[1]+.0722*p[2]),[x,S]=[s,o].map(O(this,Ye,Em).bind(this));v<y&&([y,v,x,S]=[v,y,S,x]),c(this,Ye,yf).style.color="";const E=(j,F,B)=>{const $=new Array(256),H=(v-y)/B,W=j/255,ae=(F-j)/(255*B);let me=0;for(let ne=0;ne<=B;ne++){const re=Math.round(y+ne*H),xe=W+ne*ae;for(let ve=me;ve<=re;ve++)$[ve]=xe;me=re+1}for(let ne=me;ne<256;ne++)$[ne]=$[me-1];return $.join(",")},T=`g_${c(this,Qa)}_hcm_${t}_filter`,N=d.filter=O(this,Ye,bf).call(this,T);return O(this,Ye,MS).call(this,N),O(this,Ye,Sm).call(this,E(x[0],S[0],5),E(x[1],S[1],5),E(x[2],S[2],5),N),d.url=O(this,Ye,vf).call(this,T),d.url}destroy(t=!1){var n,r,s,o;t&&((n=c(this,kd))!=null&&n.size)||((r=c(this,Ja))==null||r.parentNode.parentNode.remove(),k(this,Ja,null),(s=c(this,pp))==null||s.clear(),k(this,pp,null),(o=c(this,kd))==null||o.clear(),k(this,kd,null),k(this,Cd,0))}}Ad=new WeakMap,pp=new WeakMap,Ja=new WeakMap,Qa=new WeakMap,Gr=new WeakMap,kd=new WeakMap,Cd=new WeakMap,Ye=new WeakSet,Hr=function(){return c(this,pp)||k(this,pp,new Map)},xm=function(){return c(this,kd)||k(this,kd,new Map)},yf=function(){if(!c(this,Ja)){const t=c(this,Gr).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const r=c(this,Gr).createElementNS(ja,"svg");r.setAttribute("width",0),r.setAttribute("height",0),k(this,Ja,c(this,Gr).createElementNS(ja,"defs")),t.append(r),r.append(c(this,Ja)),c(this,Gr).body.append(t)}return c(this,Ja)},$b=function(t){if(t.length===1){const f=t[0],p=new Array(256);for(let v=0;v<256;v++)p[v]=f[v]/255;const y=p.join(",");return[y,y,y]}const[n,r,s]=t,o=new Array(256),u=new Array(256),d=new Array(256);for(let f=0;f<256;f++)o[f]=n[f]/255,u[f]=r[f]/255,d[f]=s[f]/255;return[o.join(","),u.join(","),d.join(",")]},vf=function(t){if(c(this,Ad)===void 0){k(this,Ad,"");const n=c(this,Gr).URL;n!==c(this,Gr).baseURI&&(hx(n)?wt('#createUrl: ignore "data:"-URL for performance reasons.'):k(this,Ad,vT(n,"")))}return`url(${c(this,Ad)}#${t})`},dN=function(t){const n=c(this,Gr).createElementNS(ja,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},MS=function(t){const n=c(this,Gr).createElementNS(ja,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},bf=function(t){const n=c(this,Gr).createElementNS(ja,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),c(this,Ye,yf).append(n),n},_m=function(t,n,r){const s=c(this,Gr).createElementNS(ja,n);s.setAttribute("type","discrete"),s.setAttribute("tableValues",r),t.append(s)},Sm=function(t,n,r,s){const o=c(this,Gr).createElementNS(ja,"feComponentTransfer");s.append(o),O(this,Ye,_m).call(this,o,"feFuncR",t),O(this,Ye,_m).call(this,o,"feFuncG",n),O(this,Ye,_m).call(this,o,"feFuncB",r)},DS=function(t,n){const r=c(this,Gr).createElementNS(ja,"feComponentTransfer");n.append(r),O(this,Ye,_m).call(this,r,"feFuncA",t)},Em=function(t){return c(this,Ye,yf).style.color=t,H0(getComputedStyle(c(this,Ye,yf)).getPropertyValue("color"))};class hN{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){ln("Abstract method `_fetch` called.")}}class oC extends hN{async _fetch(e){const t=await U0(e,"arraybuffer");return new Uint8Array(t)}}class fN{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){ln("Abstract method `_fetch` called.")}}class aC extends fN{async _fetch(e){const t=await U0(e,"arraybuffer");return new Uint8Array(t)}}as&&wt("Please use the `legacy` build in Node.js environments.");async function aA(a){const t=await process.getBuiltinModule("fs").promises.readFile(a);return new Uint8Array(t)}class _j extends uN{}class Sj extends lN{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class Ej extends cN{async _fetch(e){return aA(e)}}class Aj extends hN{async _fetch(e){return aA(e)}}class kj extends fN{async _fetch(e){return aA(e)}}const lf="__forcedDependency",{floor:lC,ceil:cC}=Math;function db(a,e,t,n,r,s){a[e*4+0]=Math.min(a[e*4+0],t),a[e*4+1]=Math.min(a[e*4+1],n),a[e*4+2]=Math.max(a[e*4+2],r),a[e*4+3]=Math.max(a[e*4+3],s)}const LS=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var gp,Dc;class Cj{constructor(e,t){R(this,gp);R(this,Dc);k(this,gp,e),k(this,Dc,t)}get length(){return c(this,gp).length}isEmpty(e){return c(this,gp)[e]===LS}minX(e){return c(this,Dc)[e*4+0]/256}minY(e){return c(this,Dc)[e*4+1]/256}maxX(e){return(c(this,Dc)[e*4+2]+1)/256}maxY(e){return(c(this,Dc)[e*4+3]+1)/256}}gp=new WeakMap,Dc=new WeakMap;const hb=(a,e)=>{if(!a)return;let t=a.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},a.set(e,t)),t};var xs,_s,Td,Yi,Nd,Za,Yt,tn,el,Ss,jy,mp,Pd,Rd,tl,Kr,Ho,My,FS;class Tj{constructor(e,t,n=!1){R(this,My);R(this,xs,{__proto__:null});R(this,_s,{__proto__:null,transform:[],moveText:[],sameLineText:[],[lf]:[]});R(this,Td,new Map);R(this,Yi,[]);R(this,Nd,[]);R(this,Za,[[1,0,0,1,0,0]]);R(this,Yt,[-1/0,-1/0,1/0,1/0]);R(this,tn,new Float64Array([1/0,1/0,-1/0,-1/0]));R(this,el,-1);R(this,Ss,new Set);R(this,jy,new Map);R(this,mp,new Map);R(this,Pd);R(this,Rd);R(this,tl);R(this,Kr);R(this,Ho);k(this,Pd,e.width),k(this,Rd,e.height),O(this,My,FS).call(this,t),n&&k(this,Ho,new Map)}growOperationsCount(e){e>=c(this,Kr).length&&O(this,My,FS).call(this,e,c(this,Kr))}save(e){return k(this,xs,{__proto__:c(this,xs)}),k(this,_s,{__proto__:c(this,_s),transform:{__proto__:c(this,_s).transform},moveText:{__proto__:c(this,_s).moveText},sameLineText:{__proto__:c(this,_s).sameLineText},[lf]:{__proto__:c(this,_s)[lf]}}),k(this,Yt,{__proto__:c(this,Yt)}),c(this,Yi).push(e),this}restore(e){var r;const t=Object.getPrototypeOf(c(this,xs));if(t===null)return this;k(this,xs,t),k(this,_s,Object.getPrototypeOf(c(this,_s))),k(this,Yt,Object.getPrototypeOf(c(this,Yt)));const n=c(this,Yi).pop();return n!==void 0&&((r=hb(c(this,Ho),e))==null||r.dependencies.add(n),c(this,Kr)[e]=c(this,Kr)[n]),this}recordOpenMarker(e){return c(this,Yi).push(e),this}getOpenMarker(){return c(this,Yi).length===0?null:c(this,Yi).at(-1)}recordCloseMarker(e){var n;const t=c(this,Yi).pop();return t!==void 0&&((n=hb(c(this,Ho),e))==null||n.dependencies.add(t),c(this,Kr)[e]=c(this,Kr)[t]),this}beginMarkedContent(e){return c(this,Nd).push(e),this}endMarkedContent(e){var n;const t=c(this,Nd).pop();return t!==void 0&&((n=hb(c(this,Ho),e))==null||n.dependencies.add(t),c(this,Kr)[e]=c(this,Kr)[t]),this}pushBaseTransform(e){return c(this,Za).push(Ze.multiplyByDOMMatrix(c(this,Za).at(-1),e.getTransform())),this}popBaseTransform(){return c(this,Za).length>1&&c(this,Za).pop(),this}recordSimpleData(e,t){return c(this,xs)[e]=t,this}recordIncrementalData(e,t){return c(this,_s)[e].push(t),this}resetIncrementalData(e,t){return c(this,_s)[e].length=0,this}recordNamedData(e,t){return c(this,Td).set(e,t),this}recordSimpleDataFromNamed(e,t,n){c(this,xs)[e]=c(this,Td).get(t)??n}recordFutureForcedDependency(e,t){return this.recordIncrementalData(lf,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in c(this,xs)&&this.recordFutureForcedDependency(t,c(this,xs)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of c(this,Ss))this.recordFutureForcedDependency(lf,e);return this}resetBBox(e){return c(this,el)!==e&&(k(this,el,e),c(this,tn)[0]=1/0,c(this,tn)[1]=1/0,c(this,tn)[2]=-1/0,c(this,tn)[3]=-1/0),this}recordClipBox(e,t,n,r,s,o){const u=Ze.multiplyByDOMMatrix(c(this,Za).at(-1),t.getTransform()),d=[1/0,1/0,-1/0,-1/0];Ze.axialAlignedBoundingBox([n,s,r,o],u,d);const f=Ze.intersect(c(this,Yt),d);return f?(c(this,Yt)[0]=f[0],c(this,Yt)[1]=f[1],c(this,Yt)[2]=f[2],c(this,Yt)[3]=f[3]):(c(this,Yt)[0]=c(this,Yt)[1]=1/0,c(this,Yt)[2]=c(this,Yt)[3]=-1/0),this}recordBBox(e,t,n,r,s,o){const u=c(this,Yt);if(u[0]===1/0)return this;const d=Ze.multiplyByDOMMatrix(c(this,Za).at(-1),t.getTransform());if(u[0]===-1/0)return Ze.axialAlignedBoundingBox([n,s,r,o],d,c(this,tn)),this;const f=[1/0,1/0,-1/0,-1/0];return Ze.axialAlignedBoundingBox([n,s,r,o],d,f),c(this,tn)[0]=Math.min(c(this,tn)[0],Math.max(f[0],u[0])),c(this,tn)[1]=Math.min(c(this,tn)[1],Math.max(f[1],u[1])),c(this,tn)[2]=Math.max(c(this,tn)[2],Math.min(f[2],u[2])),c(this,tn)[3]=Math.max(c(this,tn)[3],Math.min(f[3],u[3])),this}recordCharacterBBox(e,t,n,r=1,s=0,o=0,u){const d=n.bbox;let f,p;if(d&&(f=d[2]!==d[0]&&d[3]!==d[1]&&c(this,mp).get(n),f!==!1&&(p=[0,0,0,0],Ze.axialAlignedBoundingBox(d,n.fontMatrix,p),(r!==1||s!==0||o!==0)&&Ze.scaleMinMax([r,0,0,-r,s,o],p),f)))return this.recordBBox(e,t,p[0],p[2],p[1],p[3]);if(!u)return this.recordFullPageBBox(e);const y=u();return d&&p&&f===void 0&&(f=p[0]<=s-y.actualBoundingBoxLeft&&p[2]>=s+y.actualBoundingBoxRight&&p[1]<=o-y.actualBoundingBoxAscent&&p[3]>=o+y.actualBoundingBoxDescent,c(this,mp).set(n,f),f)?this.recordBBox(e,t,p[0],p[2],p[1],p[3]):this.recordBBox(e,t,s-y.actualBoundingBoxLeft,s+y.actualBoundingBoxRight,o-y.actualBoundingBoxAscent,o+y.actualBoundingBoxDescent)}recordFullPageBBox(e){return c(this,tn)[0]=Math.max(0,c(this,Yt)[0]),c(this,tn)[1]=Math.max(0,c(this,Yt)[1]),c(this,tn)[2]=Math.min(c(this,Pd),c(this,Yt)[2]),c(this,tn)[3]=Math.min(c(this,Rd),c(this,Yt)[3]),this}getSimpleIndex(e){return c(this,xs)[e]}recordDependencies(e,t){const n=c(this,Ss),r=c(this,xs),s=c(this,_s);for(const o of t)o in c(this,xs)?n.add(r[o]):o in s&&s[o].forEach(n.add,n);return this}recordNamedDependency(e,t){return c(this,Td).has(t)&&c(this,Ss).add(c(this,Td).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[lf]),c(this,Ho)){const n=hb(c(this,Ho),e),{dependencies:r}=n;c(this,Ss).forEach(r.add,r),c(this,Yi).forEach(r.add,r),c(this,Nd).forEach(r.add,r),r.delete(e),n.isRenderingOperation=!0}if(c(this,el)===e){const n=lC(c(this,tn)[0]*256/c(this,Pd)),r=lC(c(this,tn)[1]*256/c(this,Rd)),s=cC(c(this,tn)[2]*256/c(this,Pd)),o=cC(c(this,tn)[3]*256/c(this,Rd));db(c(this,tl),e,n,r,s,o);for(const u of c(this,Ss))u!==e&&db(c(this,tl),u,n,r,s,o);for(const u of c(this,Yi))u!==e&&db(c(this,tl),u,n,r,s,o);for(const u of c(this,Nd))u!==e&&db(c(this,tl),u,n,r,s,o);t||(c(this,Ss).clear(),k(this,el,-1))}return this}recordShowTextOperation(e,t=!1){const n=Array.from(c(this,Ss));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const r of n)this.recordIncrementalData("sameLineText",r);return this}bboxToClipBoxDropOperation(e,t=!1){return c(this,el)===e&&(k(this,el,-1),c(this,Yt)[0]=Math.max(c(this,Yt)[0],c(this,tn)[0]),c(this,Yt)[1]=Math.max(c(this,Yt)[1],c(this,tn)[1]),c(this,Yt)[2]=Math.min(c(this,Yt)[2],c(this,tn)[2]),c(this,Yt)[3]=Math.min(c(this,Yt)[3],c(this,tn)[3]),t||c(this,Ss).clear()),this}_takePendingDependencies(){const e=c(this,Ss);return k(this,Ss,new Set),e}_extractOperation(e){const t=c(this,jy).get(e);return c(this,jy).delete(e),t}_pushPendingDependencies(e){for(const t of e)c(this,Ss).add(t)}take(){return c(this,mp).clear(),new Cj(c(this,Kr),c(this,tl))}takeDebugMetadata(){return c(this,Ho)}}xs=new WeakMap,_s=new WeakMap,Td=new WeakMap,Yi=new WeakMap,Nd=new WeakMap,Za=new WeakMap,Yt=new WeakMap,tn=new WeakMap,el=new WeakMap,Ss=new WeakMap,jy=new WeakMap,mp=new WeakMap,Pd=new WeakMap,Rd=new WeakMap,tl=new WeakMap,Kr=new WeakMap,Ho=new WeakMap,My=new WeakSet,FS=function(e,t){const n=new ArrayBuffer(e*4);k(this,tl,new Uint8ClampedArray(n)),k(this,Kr,new Uint32Array(n)),t&&t.length>0?(c(this,Kr).set(t),c(this,Kr).fill(LS,t.length)):c(this,Kr).fill(LS)};var on,On,Ji,yp,vp;const CA=class CA{constructor(e,t,n){R(this,on);R(this,On);R(this,Ji);R(this,yp,0);R(this,vp,0);if(e instanceof CA&&c(e,Ji)===!!n)return e;k(this,on,e),k(this,On,t),k(this,Ji,!!n)}growOperationsCount(){throw new Error("Unreachable")}save(e){return er(this,vp)._++,c(this,on).save(c(this,On)),this}restore(e){return c(this,vp)>0&&(c(this,on).restore(c(this,On)),er(this,vp)._--),this}recordOpenMarker(e){return er(this,yp)._++,this}getOpenMarker(){return c(this,yp)>0?c(this,On):c(this,on).getOpenMarker()}recordCloseMarker(e){return er(this,yp)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return c(this,on).pushBaseTransform(e),this}popBaseTransform(){return c(this,on).popBaseTransform(),this}recordSimpleData(e,t){return c(this,on).recordSimpleData(e,c(this,On)),this}recordIncrementalData(e,t){return c(this,on).recordIncrementalData(e,c(this,On)),this}resetIncrementalData(e,t){return c(this,on).resetIncrementalData(e,c(this,On)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,n){return c(this,on).recordSimpleDataFromNamed(e,t,c(this,On)),this}recordFutureForcedDependency(e,t){return c(this,on).recordFutureForcedDependency(e,c(this,On)),this}inheritSimpleDataAsFutureForcedDependencies(e){return c(this,on).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return c(this,on).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return c(this,Ji)||c(this,on).resetBBox(c(this,On)),this}recordClipBox(e,t,n,r,s,o){return c(this,Ji)||c(this,on).recordClipBox(c(this,On),t,n,r,s,o),this}recordBBox(e,t,n,r,s,o){return c(this,Ji)||c(this,on).recordBBox(c(this,On),t,n,r,s,o),this}recordCharacterBBox(e,t,n,r,s,o,u){return c(this,Ji)||c(this,on).recordCharacterBBox(c(this,On),t,n,r,s,o,u),this}recordFullPageBBox(e){return c(this,Ji)||c(this,on).recordFullPageBBox(c(this,On)),this}getSimpleIndex(e){return c(this,on).getSimpleIndex(e)}recordDependencies(e,t){return c(this,on).recordDependencies(c(this,On),t),this}recordNamedDependency(e,t){return c(this,on).recordNamedDependency(c(this,On),t),this}recordOperation(e){return c(this,on).recordOperation(c(this,On),!0),this}recordShowTextOperation(e){return c(this,on).recordShowTextOperation(c(this,On),!0),this}bboxToClipBoxDropOperation(e){return c(this,Ji)||c(this,on).bboxToClipBoxDropOperation(c(this,On),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};on=new WeakMap,On=new WeakMap,Ji=new WeakMap,yp=new WeakMap,vp=new WeakMap;let Aw=CA;const hi={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Ir={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function BS(a,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,n),a.clip(r)}class lA{isModifyingCurrentTransform(){return!1}getPattern(){ln("Abstract method `getPattern` called.")}}class Nj extends lA{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,r){let s;if(r===Ir.STROKE||r===Ir.FILL){const o=t.current.getClippedPathBoundingBox(r,Nn(e))||[0,0,0,0],u=Math.ceil(o[2]-o[0])||1,d=Math.ceil(o[3]-o[1])||1,f=t.cachedCanvases.getCanvas("pattern",u,d),p=f.context;p.clearRect(0,0,p.canvas.width,p.canvas.height),p.beginPath(),p.rect(0,0,p.canvas.width,p.canvas.height),p.translate(-o[0],-o[1]),n=Ze.transform(n,[1,0,0,1,o[0],o[1]]),p.transform(...t.baseTransform),this.matrix&&p.transform(...this.matrix),BS(p,this._bbox),p.fillStyle=this._createGradient(p),p.fill(),s=e.createPattern(f.canvas,"no-repeat");const y=new DOMMatrix(n);s.setTransform(y)}else BS(e,this._bbox),s=this._createGradient(e);return s}}function G_(a,e,t,n,r,s,o,u){const d=e.coords,f=e.colors,p=a.data,y=a.width*4;let v;d[t+1]>d[n+1]&&(v=t,t=n,n=v,v=s,s=o,o=v),d[n+1]>d[r+1]&&(v=n,n=r,r=v,v=o,o=u,u=v),d[t+1]>d[n+1]&&(v=t,t=n,n=v,v=s,s=o,o=v);const x=(d[t]+e.offsetX)*e.scaleX,S=(d[t+1]+e.offsetY)*e.scaleY,E=(d[n]+e.offsetX)*e.scaleX,T=(d[n+1]+e.offsetY)*e.scaleY,N=(d[r]+e.offsetX)*e.scaleX,L=(d[r+1]+e.offsetY)*e.scaleY;if(S>=L)return;const j=f[s],F=f[s+1],B=f[s+2],$=f[o],H=f[o+1],W=f[o+2],ae=f[u],me=f[u+1],ne=f[u+2],re=Math.round(S),xe=Math.round(L);let ve,_e,pe,fe,Z,ke,Q,z;for(let K=re;K<=xe;K++){if(K<T){const be=K<S?0:(S-K)/(S-T);ve=x-(x-E)*be,_e=j-(j-$)*be,pe=F-(F-H)*be,fe=B-(B-W)*be}else{let be;K>L?be=1:T===L?be=0:be=(T-K)/(T-L),ve=E-(E-N)*be,_e=$-($-ae)*be,pe=H-(H-me)*be,fe=W-(W-ne)*be}let Se;K<S?Se=0:K>L?Se=1:Se=(S-K)/(S-L),Z=x-(x-N)*Se,ke=j-(j-ae)*Se,Q=F-(F-me)*Se,z=B-(B-ne)*Se;const Pe=Math.round(Math.min(ve,Z)),Ve=Math.round(Math.max(ve,Z));let We=y*K+Pe*4;for(let be=Pe;be<=Ve;be++)Se=(ve-be)/(ve-Z),Se<0?Se=0:Se>1&&(Se=1),p[We++]=_e-(_e-ke)*Se|0,p[We++]=pe-(pe-Q)*Se|0,p[We++]=fe-(fe-z)*Se|0,p[We++]=255}}function Pj(a,e,t){const n=e.coords,r=e.colors;let s,o;switch(e.type){case uS.LATTICE:const u=e.verticesPerRow,d=Math.floor(n.length/u)-1,f=u-1;for(s=0;s<d;s++){let p=s*u;for(let y=0;y<f;y++,p++)G_(a,t,n[p],n[p+1],n[p+u],r[p],r[p+1],r[p+u]),G_(a,t,n[p+u+1],n[p+1],n[p+u],r[p+u+1],r[p+1],r[p+u])}break;case uS.TRIANGLES:for(s=0,o=n.length;s<o;s+=3)G_(a,t,n[s],n[s+1],n[s+2],r[s],r[s+1],r[s+2]);break;default:throw new Error("illegal figure")}}class Rj extends lA{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const u=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-u,p=Math.ceil(this._bounds[3])-d,y=Math.min(Math.ceil(Math.abs(f*e[0]*1.1)),3e3),v=Math.min(Math.ceil(Math.abs(p*e[1]*1.1)),3e3),x=f/y,S=p/v,E={coords:this._coords,colors:this._colors,offsetX:-u,offsetY:-d,scaleX:1/x,scaleY:1/S},T=y+4,N=v+4,L=n.getCanvas("mesh",T,N),j=L.context,F=j.createImageData(y,v);if(t){const $=F.data;for(let H=0,W=$.length;H<W;H+=4)$[H]=t[0],$[H+1]=t[1],$[H+2]=t[2],$[H+3]=255}for(const $ of this._figures)Pj(F,$,E);return j.putImageData(F,2,2),{canvas:L.canvas,offsetX:u-2*x,offsetY:d-2*S,scaleX:x,scaleY:S}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,r){BS(e,this._bbox);const s=new Float32Array(2);if(r===Ir.SHADING)Ze.singularValueDecompose2dScale(Nn(e),s);else if(this.matrix){Ze.singularValueDecompose2dScale(this.matrix,s);const[u,d]=s;Ze.singularValueDecompose2dScale(t.baseTransform,s),s[0]*=u,s[1]*=d}else Ze.singularValueDecompose2dScale(t.baseTransform,s);const o=this._createMeshCanvas(s,r===Ir.SHADING?null:this._background,t.cachedCanvases);return r!==Ir.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class Ij extends lA{getPattern(){return"hotpink"}}function Oj(a){switch(a[0]){case"RadialAxial":return new Nj(a);case"Mesh":return new Rj(a);case"Dummy":return new Ij}throw new Error(`Unknown IR type: ${a[0]}`)}const uC={COLORED:1,UNCOLORED:2},Yw=class Yw{constructor(e,t,n,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(e,t){var ke,Q;const{bbox:n,operatorList:r,paintType:s,tilingType:o,color:u,canvasGraphicsFactory:d}=this;let{xstep:f,ystep:p}=this;f=Math.abs(f),p=Math.abs(p),dx("TilingType: "+o);const y=n[0],v=n[1],x=n[2],S=n[3],E=x-y,T=S-v,N=new Float32Array(2);Ze.singularValueDecompose2dScale(this.matrix,N);const[L,j]=N;Ze.singularValueDecompose2dScale(this.baseTransform,N);const F=L*N[0],B=j*N[1];let $=E,H=T,W=!1,ae=!1;const me=Math.ceil(f*F),ne=Math.ceil(p*B),re=Math.ceil(E*F),xe=Math.ceil(T*B);me>=re?$=f:W=!0,ne>=xe?H=p:ae=!0;const ve=this.getSizeAndScale($,this.ctx.canvas.width,F),_e=this.getSizeAndScale(H,this.ctx.canvas.height,B),pe=e.cachedCanvases.getCanvas("pattern",ve.size,_e.size),fe=pe.context,Z=d.createCanvasGraphics(fe,t);if(Z.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(Z,s,u),fe.translate(-ve.scale*y,-_e.scale*v),Z.transform(0,ve.scale,0,0,_e.scale,0,0),fe.save(),(ke=Z.dependencyTracker)==null||ke.save(),this.clipBbox(Z,y,v,x,S),Z.baseTransform=Nn(Z.ctx),Z.executeOperatorList(r),Z.endDrawing(),(Q=Z.dependencyTracker)==null||Q.restore(),fe.restore(),W||ae){const z=pe.canvas;W&&($=f),ae&&(H=p);const K=this.getSizeAndScale($,this.ctx.canvas.width,F),Se=this.getSizeAndScale(H,this.ctx.canvas.height,B),Pe=K.size,Ve=Se.size,We=e.cachedCanvases.getCanvas("pattern-workaround",Pe,Ve),be=We.context,Te=W?Math.floor(E/f):0,Ee=ae?Math.floor(T/p):0;for(let at=0;at<=Te;at++)for(let bt=0;bt<=Ee;bt++)be.drawImage(z,Pe*at,Ve*bt,Pe,Ve,0,0,Pe,Ve);return{canvas:We.canvas,scaleX:K.scale,scaleY:Se.scale,offsetX:y,offsetY:v}}return{canvas:pe.canvas,scaleX:ve.scale,scaleY:_e.scale,offsetX:y,offsetY:v}}getSizeAndScale(e,t,n){const r=Math.max(Yw.MAX_PATTERN_SIZE,t);let s=Math.ceil(e*n);return s>=r?s=r:n=s/e,{scale:n,size:s}}clipBbox(e,t,n,r,s){const o=r-t,u=s-n;e.ctx.rect(t,n,o,u),Ze.axialAlignedBoundingBox([t,n,r,s],Nn(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const r=e.ctx,s=e.current;switch(t){case uC.COLORED:const{fillStyle:o,strokeStyle:u}=this.ctx;r.fillStyle=s.fillColor=o,r.strokeStyle=s.strokeColor=u;break;case uC.UNCOLORED:r.fillStyle=r.strokeStyle=n,s.fillColor=s.strokeColor=n;break;default:throw new WO(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,r,s){let o=n;r!==Ir.SHADING&&(o=Ze.transform(o,t.baseTransform),this.matrix&&(o=Ze.transform(o,this.matrix)));const u=this.createPatternCanvas(t,s);let d=new DOMMatrix(o);d=d.translate(u.offsetX,u.offsetY),d=d.scale(1/u.scaleX,1/u.scaleY);const f=e.createPattern(u.canvas,"repeat");return f.setTransform(d),f}};Re(Yw,"MAX_PATTERN_SIZE",3e3);let $S=Yw;function jj({src:a,srcPos:e=0,dest:t,width:n,height:r,nonBlackColor:s=4294967295,inverseDecode:o=!1}){const u=Mr.isLittleEndian?4278190080:255,[d,f]=o?[s,u]:[u,s],p=n>>3,y=n&7,v=a.length;t=new Uint32Array(t.buffer);let x=0;for(let S=0;S<r;S++){for(const T=e+p;e<T;e++){const N=e<v?a[e]:255;t[x++]=N&128?f:d,t[x++]=N&64?f:d,t[x++]=N&32?f:d,t[x++]=N&16?f:d,t[x++]=N&8?f:d,t[x++]=N&4?f:d,t[x++]=N&2?f:d,t[x++]=N&1?f:d}if(y===0)continue;const E=e<v?a[e++]:255;for(let T=0;T<y;T++)t[x++]=E&1<<7-T?f:d}return{srcPos:e,destPos:x}}const dC=16,hC=100,Mj=15,fC=10,Cs=16,K_=new DOMMatrix,Zs=new Float32Array(2),Cf=new Float32Array([1/0,1/0,-1/0,-1/0]);function Dj(a,e){if(a._removeMirroring)throw new Error("Context is already forwarding operations.");a.__originalSave=a.save,a.__originalRestore=a.restore,a.__originalRotate=a.rotate,a.__originalScale=a.scale,a.__originalTranslate=a.translate,a.__originalTransform=a.transform,a.__originalSetTransform=a.setTransform,a.__originalResetTransform=a.resetTransform,a.__originalClip=a.clip,a.__originalMoveTo=a.moveTo,a.__originalLineTo=a.lineTo,a.__originalBezierCurveTo=a.bezierCurveTo,a.__originalRect=a.rect,a.__originalClosePath=a.closePath,a.__originalBeginPath=a.beginPath,a._removeMirroring=()=>{a.save=a.__originalSave,a.restore=a.__originalRestore,a.rotate=a.__originalRotate,a.scale=a.__originalScale,a.translate=a.__originalTranslate,a.transform=a.__originalTransform,a.setTransform=a.__originalSetTransform,a.resetTransform=a.__originalResetTransform,a.clip=a.__originalClip,a.moveTo=a.__originalMoveTo,a.lineTo=a.__originalLineTo,a.bezierCurveTo=a.__originalBezierCurveTo,a.rect=a.__originalRect,a.closePath=a.__originalClosePath,a.beginPath=a.__originalBeginPath,delete a._removeMirroring},a.save=function(){e.save(),this.__originalSave()},a.restore=function(){e.restore(),this.__originalRestore()},a.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},a.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},a.transform=function(t,n,r,s,o,u){e.transform(t,n,r,s,o,u),this.__originalTransform(t,n,r,s,o,u)},a.setTransform=function(t,n,r,s,o,u){e.setTransform(t,n,r,s,o,u),this.__originalSetTransform(t,n,r,s,o,u)},a.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},a.rotate=function(t){e.rotate(t),this.__originalRotate(t)},a.clip=function(t){e.clip(t),this.__originalClip(t)},a.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},a.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},a.bezierCurveTo=function(t,n,r,s,o,u){e.bezierCurveTo(t,n,r,s,o,u),this.__originalBezierCurveTo(t,n,r,s,o,u)},a.rect=function(t,n,r,s){e.rect(t,n,r,s),this.__originalRect(t,n,r,s)},a.closePath=function(){e.closePath(),this.__originalClosePath()},a.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class Lj{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,n)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function fb(a,e,t,n,r,s,o,u,d,f){const[p,y,v,x,S,E]=Nn(a);if(y===0&&v===0){const L=o*p+S,j=Math.round(L),F=u*x+E,B=Math.round(F),$=(o+d)*p+S,H=Math.abs(Math.round($)-j)||1,W=(u+f)*x+E,ae=Math.abs(Math.round(W)-B)||1;return a.setTransform(Math.sign(p),0,0,Math.sign(x),j,B),a.drawImage(e,t,n,r,s,0,0,H,ae),a.setTransform(p,y,v,x,S,E),[H,ae]}if(p===0&&x===0){const L=u*v+S,j=Math.round(L),F=o*y+E,B=Math.round(F),$=(u+f)*v+S,H=Math.abs(Math.round($)-j)||1,W=(o+d)*y+E,ae=Math.abs(Math.round(W)-B)||1;return a.setTransform(0,Math.sign(y),Math.sign(v),0,j,B),a.drawImage(e,t,n,r,s,0,0,ae,H),a.setTransform(p,y,v,x,S,E),[ae,H]}a.drawImage(e,t,n,r,s,o,u,d,f);const T=Math.hypot(p,y),N=Math.hypot(v,x);return[T*d,N*f]}class pC{constructor(e,t,n){Re(this,"alphaIsShape",!1);Re(this,"fontSize",0);Re(this,"fontSizeScale",1);Re(this,"textMatrix",null);Re(this,"textMatrixScale",1);Re(this,"fontMatrix",cS);Re(this,"leading",0);Re(this,"x",0);Re(this,"y",0);Re(this,"lineX",0);Re(this,"lineY",0);Re(this,"charSpacing",0);Re(this,"wordSpacing",0);Re(this,"textHScale",1);Re(this,"textRenderingMode",Ar.FILL);Re(this,"textRise",0);Re(this,"fillColor","#000000");Re(this,"strokeColor","#000000");Re(this,"patternFill",!1);Re(this,"patternStroke",!1);Re(this,"fillAlpha",1);Re(this,"strokeAlpha",1);Re(this,"lineWidth",1);Re(this,"activeSMask",null);Re(this,"transferMaps","none");n==null||n(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Cf.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Ir.FILL,t=null){const n=this.minMax.slice();if(e===Ir.STROKE){t||ln("Stroke bounding box must include transform."),Ze.singularValueDecompose2dScale(t,Zs);const r=Zs[0]*this.lineWidth/2,s=Zs[1]*this.lineWidth/2;n[0]-=r,n[1]-=s,n[2]+=r,n[3]+=s}return n}updateClipFromPath(){const e=Ze.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Cf,0)}getClippedPathBoundingBox(e=Ir.FILL,t=null){return Ze.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function gC(a,e){if(e instanceof ImageData){a.putImageData(e,0,0);return}const t=e.height,n=e.width,r=t%Cs,s=(t-r)/Cs,o=r===0?s:s+1,u=a.createImageData(n,Cs);let d=0,f;const p=e.data,y=u.data;let v,x,S,E;if(e.kind===Pb.GRAYSCALE_1BPP){const T=p.byteLength,N=new Uint32Array(y.buffer,0,y.byteLength>>2),L=N.length,j=n+7>>3,F=4294967295,B=Mr.isLittleEndian?4278190080:255;for(v=0;v<o;v++){for(S=v<s?Cs:r,f=0,x=0;x<S;x++){const $=T-d;let H=0;const W=$>j?n:$*8-7,ae=W&-8;let me=0,ne=0;for(;H<ae;H+=8)ne=p[d++],N[f++]=ne&128?F:B,N[f++]=ne&64?F:B,N[f++]=ne&32?F:B,N[f++]=ne&16?F:B,N[f++]=ne&8?F:B,N[f++]=ne&4?F:B,N[f++]=ne&2?F:B,N[f++]=ne&1?F:B;for(;H<W;H++)me===0&&(ne=p[d++],me=128),N[f++]=ne&me?F:B,me>>=1}for(;f<L;)N[f++]=0;a.putImageData(u,0,v*Cs)}}else if(e.kind===Pb.RGBA_32BPP){for(x=0,E=n*Cs*4,v=0;v<s;v++)y.set(p.subarray(d,d+E)),d+=E,a.putImageData(u,0,x),x+=Cs;v<o&&(E=n*r*4,y.set(p.subarray(d,d+E)),a.putImageData(u,0,x))}else if(e.kind===Pb.RGB_24BPP)for(S=Cs,E=n*S,v=0;v<o;v++){for(v>=s&&(S=r,E=n*S),f=0,x=E;x--;)y[f++]=p[d++],y[f++]=p[d++],y[f++]=p[d++],y[f++]=255;a.putImageData(u,0,v*Cs)}else throw new Error(`bad image kind: ${e.kind}`)}function mC(a,e){if(e.bitmap){a.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,r=t%Cs,s=(t-r)/Cs,o=r===0?s:s+1,u=a.createImageData(n,Cs);let d=0;const f=e.data,p=u.data;for(let y=0;y<o;y++){const v=y<s?Cs:r;({srcPos:d}=jj({src:f,srcPos:d,dest:p,width:n,height:v,nonBlackColor:0})),a.putImageData(u,0,y*Cs)}}function sm(a,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)a[n]!==void 0&&(e[n]=a[n]);a.setLineDash!==void 0&&(e.setLineDash(a.getLineDash()),e.lineDashOffset=a.lineDashOffset)}function pb(a){a.strokeStyle=a.fillStyle="#000000",a.fillRule="nonzero",a.globalAlpha=1,a.lineWidth=1,a.lineCap="butt",a.lineJoin="miter",a.miterLimit=10,a.globalCompositeOperation="source-over",a.font="10px sans-serif",a.setLineDash!==void 0&&(a.setLineDash([]),a.lineDashOffset=0);const{filter:e}=a;e!=="none"&&e!==""&&(a.filter="none")}function yC(a,e){if(e)return!0;Ze.singularValueDecompose2dScale(a,Zs);const t=Math.fround(ta.pixelRatio*uu.PDF_TO_CSS_UNITS);return Zs[0]<=t&&Zs[1]<=t}const Fj=["butt","round","square"],Bj=["miter","round","bevel"],$j={},vC={};var ao,US,zS,HS;const TA=class TA{constructor(e,t,n,r,s,{optionalContentConfig:o,markedContentStack:u=null},d,f,p){R(this,ao);this.ctx=e,this.current=new pC(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=u||[],this.optionalContentConfig=o,this.cachedCanvases=new Lj(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=p??null}getObject(e,t,n=null){var r;return typeof t=="string"?((r=this.dependencyTracker)==null||r.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const s=this.ctx.canvas.width,o=this.ctx.canvas.height,u=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,s,o),this.ctx.fillStyle=u,n){const d=this.cachedCanvases.getCanvas("transparent",s,o);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...Nn(this.compositeCtx))}this.ctx.save(),pb(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Nn(this.ctx)}executeOperatorList(e,t,n,r,s){var N;const o=e.argsArray,u=e.fnArray;let d=t||0;const f=o.length;if(f===d)return d;const p=f-d>fC&&typeof n=="function",y=p?Date.now()+Mj:0;let v=0;const x=this.commonObjs,S=this.objs;let E,T;for(;;){if(r!==void 0&&d===r.nextBreakPoint)return r.breakIt(d,n),d;if(!s||s(d))if(E=u[d],T=o[d]??null,E!==Hm.dependency)T===null?this[E](d):this[E](d,...T);else for(const L of T){(N=this.dependencyTracker)==null||N.recordNamedData(L,d);const j=L.startsWith("g_")?x:S;if(!j.has(L))return j.get(L,n),d}if(d++,d===f)return d;if(p&&++v>fC){if(Date.now()>y)return n(),d;v=0}}}endDrawing(){O(this,ao,US).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),O(this,ao,zS).call(this)}_scaleImage(e,t){const n=e.width??e.displayWidth,r=e.height??e.displayHeight;let s=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),u=n,d=r,f="prescale1",p,y;for(;s>2&&u>1||o>2&&d>1;){let v=u,x=d;s>2&&u>1&&(v=u>=16384?Math.floor(u/2)-1||1:Math.ceil(u/2),s/=u/v),o>2&&d>1&&(x=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,o/=d/x),p=this.cachedCanvases.getCanvas(f,v,x),y=p.context,y.clearRect(0,0,v,x),y.drawImage(e,0,0,u,d,0,0,v,x),e=p.canvas,u=v,d=x,f=f==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:u,paintHeight:d}}_createMaskCanvas(e,t){var me,ne;const n=this.ctx,{width:r,height:s}=t,o=this.current.fillColor,u=this.current.patternFill,d=Nn(n);let f,p,y,v;if((t.bitmap||t.data)&&t.count>1){const re=t.bitmap||t.data.buffer;p=JSON.stringify(u?d:[d.slice(0,4),o]),f=this._cachedBitmapsMap.get(re),f||(f=new Map,this._cachedBitmapsMap.set(re,f));const xe=f.get(p);if(xe&&!u){const ve=Math.round(Math.min(d[0],d[2])+d[4]),_e=Math.round(Math.min(d[1],d[3])+d[5]);return(me=this.dependencyTracker)==null||me.recordDependencies(e,hi.transformAndFill),{canvas:xe,offsetX:ve,offsetY:_e}}y=xe}y||(v=this.cachedCanvases.getCanvas("maskCanvas",r,s),mC(v.context,t));let x=Ze.transform(d,[1/r,0,0,-1/s,0,0]);x=Ze.transform(x,[1,0,0,1,0,-s]);const S=Cf.slice();Ze.axialAlignedBoundingBox([0,0,r,s],x,S);const[E,T,N,L]=S,j=Math.round(N-E)||1,F=Math.round(L-T)||1,B=this.cachedCanvases.getCanvas("fillCanvas",j,F),$=B.context,H=E,W=T;$.translate(-H,-W),$.transform(...x),y||(y=this._scaleImage(v.canvas,To($)),y=y.img,f&&u&&f.set(p,y)),$.imageSmoothingEnabled=yC(Nn($),t.interpolate),fb($,y,0,0,y.width,y.height,0,0,r,s),$.globalCompositeOperation="source-in";const ae=Ze.transform(To($),[1,0,0,1,-H,-W]);return $.fillStyle=u?o.getPattern(n,this,ae,Ir.FILL,e):o,$.fillRect(0,0,r,s),f&&!u&&(this.cachedCanvases.delete("fillCanvas"),f.set(p,B.canvas)),(ne=this.dependencyTracker)==null||ne.recordDependencies(e,hi.transformAndFill),{canvas:B.canvas,offsetX:Math.round(H),offsetY:Math.round(W)}}setLineWidth(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineCap",e),this.ctx.lineCap=Fj[t]}setLineJoin(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineJoin",e),this.ctx.lineJoin=Bj[t]}setMiterLimit(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,n){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("dash",e);const r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(t),r.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var n,r,s,o,u;for(const[d,f]of t)switch(d){case"LW":this.setLineWidth(e,f);break;case"LC":this.setLineCap(e,f);break;case"LJ":this.setLineJoin(e,f);break;case"ML":this.setMiterLimit(e,f);break;case"D":this.setDash(e,f[0],f[1]);break;case"RI":this.setRenderingIntent(e,f);break;case"FL":this.setFlatness(e,f);break;case"Font":this.setFont(e,f[0],f[1]);break;case"CA":(n=this.dependencyTracker)==null||n.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=f;break;case"ca":(r=this.dependencyTracker)==null||r.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=f;break;case"BM":(s=this.dependencyTracker)==null||s.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=f;break;case"SMask":(o=this.dependencyTracker)==null||o.recordSimpleData("SMask",e),this.current.activeSMask=f?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(u=this.dependencyTracker)==null||u.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(f);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,n=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(r,t,n);this.suspendedCtx=this.ctx;const o=this.ctx=s.context;o.setTransform(this.suspendedCtx.getTransform()),sm(this.suspendedCtx,o),Dj(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),sm(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,r){const s=r[0],o=r[1],u=r[2]-s,d=r[3]-o;u===0||d===0||(this.genericComposeSMask(t.context,n,u,d,t.subtype,t.backdrop,t.transferMap,s,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,r,s,o,u,d,f,p,y){let v=e.canvas,x=d-p,S=f-y;if(o)if(x<0||S<0||x+n>v.width||S+r>v.height){const T=this.cachedCanvases.getCanvas("maskExtension",n,r),N=T.context;N.drawImage(v,-x,-S),N.globalCompositeOperation="destination-atop",N.fillStyle=o,N.fillRect(0,0,n,r),N.globalCompositeOperation="source-over",v=T.canvas,x=S=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const T=new Path2D;T.rect(x,S,n,r),e.clip(T),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(x,S,n,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),s==="Alpha"&&u?t.filter=this.filterFactory.addAlphaFilter(u):s==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(u));const E=new Path2D;E.rect(d,f,n,r),t.clip(E),t.globalCompositeOperation="destination-in",t.drawImage(v,x,S,n,r,d,f,n,r),t.restore()}save(e){var n;this.inSMaskMode&&sm(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(n=this.dependencyTracker)==null||n.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&sm(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,r,s,o,u){var d;(d=this.dependencyTracker)==null||d.recordIncrementalData("transform",e),this.ctx.transform(t,n,r,s,o,u),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,r){let[s]=n;if(!r){s||(s=n[0]=new Path2D),this[t](e,s);return}if(this.dependencyTracker!==null){const o=t===Hm.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,r[0]-o,r[2]+o,r[1]-o,r[3]+o).recordDependencies(e,["transform"])}s instanceof Path2D||(s=n[0]=ET(s)),Ze.axialAlignedBoundingBox(r,Nn(this.ctx),this.current.minMax),this[t](e,s),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,n=!0){var o;const r=this.ctx,s=this.current.strokeColor;if(r.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&(s!=null&&s.getPattern)){const u=s.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.strokeStyle=s.getPattern(r,this,To(r),Ir.STROKE,e),u){const d=new Path2D;d.addPath(t,r.getTransform().invertSelf().multiplySelf(u)),t=d}this.rescaleAndStroke(t,!1),r.restore()}else this.rescaleAndStroke(t,!0);(o=this.dependencyTracker)==null||o.recordDependencies(e,hi.stroke),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(Ir.STROKE,Nn(this.ctx))),r.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,n=!0){var f,p,y;const r=this.ctx,s=this.current.fillColor,o=this.current.patternFill;let u=!1;if(o){const v=s.isModifyingCurrentTransform()?r.getTransform():null;if((f=this.dependencyTracker)==null||f.save(e),r.save(),r.fillStyle=s.getPattern(r,this,To(r),Ir.FILL,e),v){const x=new Path2D;x.addPath(t,r.getTransform().invertSelf().multiplySelf(v)),t=x}u=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(r.fill(t,"evenodd"),this.pendingEOFill=!1):r.fill(t)),(p=this.dependencyTracker)==null||p.recordDependencies(e,hi.fill),u&&(r.restore(),(y=this.dependencyTracker)==null||y.restore(e)),n&&this.consumePath(e,t,d)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var n;this.ctx.fill(t),(n=this.dependencyTracker)==null||n.recordDependencies(e,hi.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=$j}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=vC}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:r}=this;t!==void 0&&r.recordFutureForcedDependency("textClip",r.getOpenMarker()).recordFutureForcedDependency("textClip",e),r.recordCloseMarker(e)}if(t!==void 0){const r=new Path2D,s=n.getTransform().invertSelf();for(const{transform:o,x:u,y:d,fontSize:f,path:p}of t)p&&r.addPath(p,new DOMMatrix(o).preMultiplySelf(s).translate(u,d).scale(f,-f));n.clip(r)}delete this.pendingTextPaths}setCharSpacing(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,n){var y,v;(y=this.dependencyTracker)==null||y.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const r=this.commonObjs.get(t),s=this.current;if(!r)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=r.fontMatrix||cS,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&wt("Invalid font matrix for font "+t),n<0?(n=-n,s.fontDirection=-1):s.fontDirection=1,this.current.font=r,this.current.fontSize=n,r.isType3Font)return;const o=r.loadedName||"sans-serif",u=((v=r.systemFontInfo)==null?void 0:v.css)||`"${o}", ${r.fallbackName}`;let d="normal";r.black?d="900":r.bold&&(d="bold");const f=r.italic?"italic":"normal";let p=n;n<dC?p=dC:n>hC&&(p=hC),this.current.fontSizeScale=n/p,this.ctx.font=`${f} ${d} ${p}px ${u}`}setTextRenderingMode(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,n){var r;(r=this.dependencyTracker)==null||r.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){var r;(r=this.dependencyTracker)==null||r.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,n,r,s,o){var N,L,j,F;const u=this.ctx,d=this.current,f=d.font,p=d.textRenderingMode,y=d.fontSize/d.fontSizeScale,v=p&Ar.FILL_STROKE_MASK,x=!!(p&Ar.ADD_TO_PATH_FLAG),S=d.patternFill&&!f.missingFile,E=d.patternStroke&&!f.missingFile;let T;if((f.disableFontFace||x||S||E)&&!f.missingFile&&(T=f.getPathGenerator(this.commonObjs,t)),T&&(f.disableFontFace||S||E)){u.save(),u.translate(n,r),u.scale(y,-y),(N=this.dependencyTracker)==null||N.recordCharacterBBox(e,u,f);let B;if(v===Ar.FILL||v===Ar.FILL_STROKE)if(s){B=u.getTransform(),u.setTransform(...s);const $=O(this,ao,HS).call(this,T,B,s);u.fill($)}else u.fill(T);if(v===Ar.STROKE||v===Ar.FILL_STROKE)if(o){B||(B=u.getTransform()),u.setTransform(...o);const{a:$,b:H,c:W,d:ae}=B,me=Ze.inverseTransform(o),ne=Ze.transform([$,H,W,ae,0,0],me);Ze.singularValueDecompose2dScale(ne,Zs),u.lineWidth*=Math.max(Zs[0],Zs[1])/y,u.stroke(O(this,ao,HS).call(this,T,B,o))}else u.lineWidth/=y,u.stroke(T);u.restore()}else(v===Ar.FILL||v===Ar.FILL_STROKE)&&(u.fillText(t,n,r),(L=this.dependencyTracker)==null||L.recordCharacterBBox(e,u,f,y,n,r,()=>u.measureText(t))),(v===Ar.STROKE||v===Ar.FILL_STROKE)&&(this.dependencyTracker&&((j=this.dependencyTracker)==null||j.recordCharacterBBox(e,u,f,y,n,r,()=>u.measureText(t)).recordDependencies(e,hi.stroke)),u.strokeText(t,n,r));x&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Nn(u),x:n,y:r,fontSize:y,path:T}),(F=this.dependencyTracker)==null||F.recordCharacterBBox(e,u,f,y,n,r))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){n=!0;break}return xt(this,"isFontSubpixelAAEnabled",n)}showText(e,t){var W,ae,me,ne;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,hi.showText).resetBBox(e),this.current.textRenderingMode&Ar.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,r=n.font;if(r.isType3Font){this.showType3Text(e,t),(W=this.dependencyTracker)==null||W.recordShowTextOperation(e);return}const s=n.fontSize;if(s===0){(ae=this.dependencyTracker)==null||ae.recordOperation(e);return}const o=this.ctx,u=n.fontSizeScale,d=n.charSpacing,f=n.wordSpacing,p=n.fontDirection,y=n.textHScale*p,v=t.length,x=r.vertical,S=x?1:-1,E=r.defaultVMetrics,T=s*n.fontMatrix[0],N=n.textRenderingMode===Ar.FILL&&!r.disableFontFace&&!n.patternFill;o.save(),n.textMatrix&&o.transform(...n.textMatrix),o.translate(n.x,n.y+n.textRise),p>0?o.scale(y,-1):o.scale(y,1);let L,j;if(n.patternFill){o.save();const re=n.fillColor.getPattern(o,this,To(o),Ir.FILL,e);L=Nn(o),o.restore(),o.fillStyle=re}if(n.patternStroke){o.save();const re=n.strokeColor.getPattern(o,this,To(o),Ir.STROKE,e);j=Nn(o),o.restore(),o.strokeStyle=re}let F=n.lineWidth;const B=n.textMatrixScale;if(B===0||F===0){const re=n.textRenderingMode&Ar.FILL_STROKE_MASK;(re===Ar.STROKE||re===Ar.FILL_STROKE)&&(F=this.getSinglePixelWidth())}else F/=B;if(u!==1&&(o.scale(u,u),F/=u),o.lineWidth=F,r.isInvalidPDFjsFont){const re=[];let xe=0;for(const _e of t)re.push(_e.unicode),xe+=_e.width;const ve=re.join("");if(o.fillText(ve,0,0),this.dependencyTracker!==null){const _e=o.measureText(ve);this.dependencyTracker.recordBBox(e,this.ctx,-_e.actualBoundingBoxLeft,_e.actualBoundingBoxRight,-_e.actualBoundingBoxAscent,_e.actualBoundingBoxDescent).recordShowTextOperation(e)}n.x+=xe*T*y,o.restore(),this.compose();return}let $=0,H;for(H=0;H<v;++H){const re=t[H];if(typeof re=="number"){$+=S*re*s/1e3;continue}let xe=!1;const ve=(re.isSpace?f:0)+d,_e=re.fontChar,pe=re.accent;let fe,Z,ke=re.width;if(x){const K=re.vmetric||E,Se=-(re.vmetric?K[1]:ke*.5)*T,Pe=K[2]*T;ke=K?-K[0]:ke,fe=Se/u,Z=($+Pe)/u}else fe=$/u,Z=0;let Q;if(r.remeasure&&ke>0){Q=o.measureText(_e);const K=Q.width*1e3/s*u;if(ke<K&&this.isFontSubpixelAAEnabled){const Se=ke/K;xe=!0,o.save(),o.scale(Se,1),fe/=Se}else ke!==K&&(fe+=(ke-K)/2e3*s/u)}if(this.contentVisible&&(re.isInFont||r.missingFile)){if(N&&!pe)o.fillText(_e,fe,Z),(me=this.dependencyTracker)==null||me.recordCharacterBBox(e,o,Q?{bbox:null}:r,s/u,fe,Z,()=>Q??o.measureText(_e));else if(this.paintChar(e,_e,fe,Z,L,j),pe){const K=fe+s*pe.offset.x/u,Se=Z-s*pe.offset.y/u;this.paintChar(e,pe.fontChar,K,Se,L,j)}}const z=x?ke*T-ve*p:ke*T+ve*p;$+=z,xe&&o.restore()}x?n.y-=$:n.x+=$*y,o.restore(),this.compose(),(ne=this.dependencyTracker)==null||ne.recordShowTextOperation(e)}showType3Text(e,t){const n=this.ctx,r=this.current,s=r.font,o=r.fontSize,u=r.fontDirection,d=s.vertical?1:-1,f=r.charSpacing,p=r.wordSpacing,y=r.textHScale*u,v=r.fontMatrix||cS,x=t.length,S=r.textRenderingMode===Ar.INVISIBLE;let E,T,N,L;if(S||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),r.textMatrix&&n.transform(...r.textMatrix),n.translate(r.x,r.y+r.textRise),n.scale(y,u);const j=this.dependencyTracker;for(this.dependencyTracker=j?new Aw(j,e):null,E=0;E<x;++E){if(T=t[E],typeof T=="number"){L=d*T*o/1e3,this.ctx.translate(L,0),r.x+=L*y;continue}const F=(T.isSpace?p:0)+f,B=s.charProcOperatorList[T.operatorListId];B?this.contentVisible&&(this.save(),n.scale(o,o),n.transform(...v),this.executeOperatorList(B),this.restore()):wt(`Type3 character "${T.operatorListId}" is not available.`);const $=[T.width,0];Ze.applyTransform($,v),N=$[0]*o+F,n.translate(N,0),r.x+=N*y}n.restore(),j&&(this.dependencyTracker=j)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,r,s,o,u){var f;const d=new Path2D;d.rect(r,s,o-r,u-s),this.ctx.clip(d),(f=this.dependencyTracker)==null||f.recordBBox(e,this.ctx,r,o,s,u).recordClipBox(e,this.ctx,r,o,s,u),this.endPath(e)}getColorN_Pattern(e,t){let n;if(t[0]==="TilingPattern"){const r=this.baseTransform||Nn(this.ctx),s={createCanvasGraphics:(o,u)=>new TA(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Aw(this.dependencyTracker,u,!0):null)};n=new $S(t,this.ctx,s,r)}else n=this._getPattern(e,t[1],t[2]);return n}setStrokeColorN(e,...t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,n=null){let r;return this.cachedPatterns.has(t)?r=this.cachedPatterns.get(t):(r=Oj(this.getObject(e,t)),this.cachedPatterns.set(t,r)),n&&(r.matrix=n),r}shadingFill(e,t){var o;if(!this.contentVisible)return;const n=this.ctx;this.save(e);const r=this._getPattern(e,t);n.fillStyle=r.getPattern(n,this,To(n),Ir.SHADING,e);const s=To(n);if(s){const{width:u,height:d}=n.canvas,f=Cf.slice();Ze.axialAlignedBoundingBox([0,0,u,d],s,f);const[p,y,v,x]=f;this.ctx.fillRect(p,y,v-p,x-y)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(o=this.dependencyTracker)==null||o.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,hi.transform).recordDependencies(e,hi.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){ln("Should not call beginInlineImage")}beginImageData(){ln("Should not call beginImageData")}paintFormXObjectBegin(e,t,n){var r;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Nn(this.ctx),n)){Ze.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[s,o,u,d]=n,f=new Path2D;f.rect(s,o,u-s,d-o),this.ctx.clip(f),(r=this.dependencyTracker)==null||r.recordClipBox(e,this.ctx,s,u,o,d),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var j;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;t.isolated||dx("TODO: Support non-isolated groups."),t.knockout&&wt("Knockout groups not supported.");const r=Nn(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=Cf.slice();Ze.axialAlignedBoundingBox(t.bbox,Nn(n),s);const o=[0,0,n.canvas.width,n.canvas.height];s=Ze.intersect(s,o)||[0,0,0,0];const u=Math.floor(s[0]),d=Math.floor(s[1]),f=Math.max(Math.ceil(s[2])-u,1),p=Math.max(Math.ceil(s[3])-d,1);this.current.startNewPathAndClipBox([0,0,f,p]);let y="groupAt"+this.groupLevel;t.smask&&(y+="_smask_"+this.smaskCounter++%2);const v=this.cachedCanvases.getCanvas(y,f,p),x=v.context;x.translate(-u,-d),x.transform(...r);let S=new Path2D;const[E,T,N,L]=t.bbox;if(S.rect(E,T,N-E,L-T),t.matrix){const F=new Path2D;F.addPath(S,new DOMMatrix(t.matrix)),S=F}x.clip(S),t.smask&&this.smaskStack.push({canvas:v.canvas,context:x,offsetX:u,offsetY:d,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(u,d),n.save()),sm(n,x),this.ctx=x,(j=this.dependencyTracker)==null||j.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){var s;if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,(s=this.dependencyTracker)==null||s.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=Nn(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...o);const u=Cf.slice();Ze.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o,u),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(u)}}beginAnnotation(e,t,n,r,s,o){if(O(this,ao,US).call(this),pb(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const u=n[2]-n[0],d=n[3]-n[1];if(o&&this.annotationCanvasMap){r=r.slice(),r[4]-=n[0],r[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=u,n[3]=d,Ze.singularValueDecompose2dScale(Nn(this.ctx),Zs);const{viewportScale:f}=this,p=Math.ceil(u*this.outputScaleX*f),y=Math.ceil(d*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(p,y);const{canvas:v,context:x}=this.annotationCanvas;this.annotationCanvasMap.set(t,v),this.annotationCanvas.savedCtx=this.ctx,this.ctx=x,this.ctx.save(),this.ctx.setTransform(Zs[0],0,0,-Zs[1],0,d*Zs[1]),pb(this.ctx)}else{pb(this.ctx),this.endPath(e);const f=new Path2D;f.rect(n[0],n[1],u,d),this.ctx.clip(f)}}this.current=new pC(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...r),this.transform(e,...s)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),O(this,ao,zS).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var u;if(!this.contentVisible)return;const n=t.count;t=this.getObject(e,t.data,t),t.count=n;const r=this.ctx,s=this._createMaskCanvas(e,t),o=s.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(o,s.offsetX,s.offsetY),(u=this.dependencyTracker)==null||u.resetBBox(e).recordBBox(e,this.ctx,s.offsetX,s.offsetX+o.width,s.offsetY,s.offsetY+o.height).recordOperation(e),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n,r=0,s=0,o,u){var y,v,x;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const d=this.ctx;d.save();const f=Nn(d);d.transform(n,r,s,o,0,0);const p=this._createMaskCanvas(e,t);d.setTransform(1,0,0,1,p.offsetX-f[4],p.offsetY-f[5]),(y=this.dependencyTracker)==null||y.resetBBox(e);for(let S=0,E=u.length;S<E;S+=2){const T=Ze.transform(f,[n,r,s,o,u[S],u[S+1]]);d.drawImage(p.canvas,T[4],T[5]),(v=this.dependencyTracker)==null||v.recordBBox(e,this.ctx,T[4],T[4]+p.canvas.width,T[5],T[5]+p.canvas.height)}d.restore(),this.compose(),(x=this.dependencyTracker)==null||x.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var o,u,d;if(!this.contentVisible)return;const n=this.ctx,r=this.current.fillColor,s=this.current.patternFill;(o=this.dependencyTracker)==null||o.resetBBox(e).recordDependencies(e,hi.transformAndFill);for(const f of t){const{data:p,width:y,height:v,transform:x}=f,S=this.cachedCanvases.getCanvas("maskCanvas",y,v),E=S.context;E.save();const T=this.getObject(e,p,f);mC(E,T),E.globalCompositeOperation="source-in",E.fillStyle=s?r.getPattern(E,this,To(n),Ir.FILL,e):r,E.fillRect(0,0,y,v),E.restore(),n.save(),n.transform(...x),n.scale(1,-1),fb(n,S.canvas,0,0,y,v,0,-1,1,1),(u=this.dependencyTracker)==null||u.recordBBox(e,n,0,y,0,v),n.restore()}this.compose(),(d=this.dependencyTracker)==null||d.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const n=this.getObject(e,t);if(!n){wt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,n)}paintImageXObjectRepeat(e,t,n,r,s){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){wt("Dependent image isn't ready yet");return}const u=o.width,d=o.height,f=[];for(let p=0,y=s.length;p<y;p+=2)f.push({transform:[n,0,0,r,s[p],s[p+1]],x:0,y:0,w:u,h:d});this.paintInlineImageXObjectGroup(e,o,f)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:r}=e,s=this.cachedCanvases.getCanvas("inlineImage",n,r),o=s.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",s.canvas}paintInlineImageXObject(e,t){var f;if(!this.contentVisible)return;const n=t.width,r=t.height,s=this.ctx;this.save(e);const{filter:o}=s;o!=="none"&&o!==""&&(s.filter="none"),s.scale(1/n,-1/r);let u;if(t.bitmap)u=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)u=t;else{const y=this.cachedCanvases.getCanvas("inlineImage",n,r).context;gC(y,t),u=this.applyTransferMapsToCanvas(y)}const d=this._scaleImage(u,To(s));s.imageSmoothingEnabled=yC(Nn(s),t.interpolate),(f=this.dependencyTracker)==null||f.resetBBox(e).recordBBox(e,s,0,n,-r,0).recordDependencies(e,hi.imageXObject).recordOperation(e),fb(s,d.img,0,0,d.paintWidth,d.paintHeight,0,-r,n,r),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){var o,u,d;if(!this.contentVisible)return;const r=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const f=t.width,p=t.height,v=this.cachedCanvases.getCanvas("inlineImage",f,p).context;gC(v,t),s=this.applyTransferMapsToCanvas(v)}(o=this.dependencyTracker)==null||o.resetBBox(e);for(const f of n)r.save(),r.transform(...f.transform),r.scale(1,-1),fb(r,s,f.x,f.y,f.w,f.h,0,-1,1,1),(u=this.dependencyTracker)==null||u.recordBBox(e,r,0,1,-1,0),r.restore();(d=this.dependencyTracker)==null||d.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,hi.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){var n;(n=this.dependencyTracker)==null||n.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){var r;(r=this.dependencyTracker)==null||r.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){var o,u;const r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const s=this.ctx;this.pendingClip?(r||(this.pendingClip===vC?s.clip(t,"evenodd"):s.clip(t)),this.pendingClip=null,(o=this.dependencyTracker)==null||o.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(u=this.dependencyTracker)==null||u.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Nn(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:r,d:s}=this.ctx.getTransform();let o,u;if(n===0&&r===0){const d=Math.abs(t),f=Math.abs(s);if(d===f)if(e===0)o=u=1/d;else{const p=d*e;o=u=p<1?1/p:1}else if(e===0)o=1/d,u=1/f;else{const p=d*e,y=f*e;o=p<1?1/p:1,u=y<1?1/y:1}}else{const d=Math.abs(t*s-n*r),f=Math.hypot(t,n),p=Math.hypot(r,s);if(e===0)o=p/d,u=f/d;else{const y=e*d;o=p>y?p/y:1,u=f>y?f/y:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=u}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:r}}=this,[s,o]=this.getScaleForStroking();if(s===o){n.lineWidth=(r||1)*s,n.stroke(e);return}const u=n.getLineDash();t&&n.save(),n.scale(s,o),K_.a=1/s,K_.d=1/o;const d=new Path2D;if(d.addPath(e,K_),u.length>0){const f=Math.max(s,o);n.setLineDash(u.map(p=>p/f)),n.lineDashOffset/=f}n.lineWidth=r||1,n.stroke(d),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};ao=new WeakSet,US=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},zS=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},HS=function(e,t,n){const r=new Path2D;return r.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),r};let Mf=TA;for(const a in Hm)Mf.prototype[a]!==void 0&&(Mf.prototype[Hm[a]]=Mf.prototype[a]);var Dy,Ly;class ea{static get workerPort(){return c(this,Dy)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");k(this,Dy,e)}static get workerSrc(){return c(this,Ly)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");k(this,Ly,e)}}Dy=new WeakMap,Ly=new WeakMap,R(ea,Dy,null),R(ea,Ly,"");var bp,Fy;class Uj{constructor({parsedData:e,rawData:t}){R(this,bp);R(this,Fy);k(this,bp,e),k(this,Fy,t)}getRaw(){return c(this,Fy)}get(e){return c(this,bp).get(e)??null}[Symbol.iterator](){return c(this,bp).entries()}}bp=new WeakMap,Fy=new WeakMap;const wf=Symbol("INTERNAL");var By,$y,Uy,wp;class zj{constructor(e,{name:t,intent:n,usage:r,rbGroups:s}){R(this,By,!1);R(this,$y,!1);R(this,Uy,!1);R(this,wp,!0);k(this,By,!!(e&Qs.DISPLAY)),k(this,$y,!!(e&Qs.PRINT)),this.name=t,this.intent=n,this.usage=r,this.rbGroups=s}get visible(){if(c(this,Uy))return c(this,wp);if(!c(this,wp))return!1;const{print:e,view:t}=this.usage;return c(this,By)?(t==null?void 0:t.viewState)!=="OFF":c(this,$y)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==wf&&ln("Internal method `_setVisible` called."),k(this,Uy,n),k(this,wp,t)}}By=new WeakMap,$y=new WeakMap,Uy=new WeakMap,wp=new WeakMap;var Lc,nn,xp,_p,zy,qS;class Hj{constructor(e,t=Qs.DISPLAY){R(this,zy);R(this,Lc,null);R(this,nn,new Map);R(this,xp,null);R(this,_p,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,k(this,_p,e.order);for(const n of e.groups)c(this,nn).set(n.id,new zj(t,n));if(e.baseState==="OFF")for(const n of c(this,nn).values())n._setVisible(wf,!1);for(const n of e.on)c(this,nn).get(n)._setVisible(wf,!0);for(const n of e.off)c(this,nn).get(n)._setVisible(wf,!1);k(this,xp,this.getHash())}}isVisible(e){if(c(this,nn).size===0)return!0;if(!e)return dx("Optional content group not defined."),!0;if(e.type==="OCG")return c(this,nn).has(e.id)?c(this,nn).get(e.id).visible:(wt(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return O(this,zy,qS).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!c(this,nn).has(t))return wt(`Optional content group not found: ${t}`),!0;if(c(this,nn).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!c(this,nn).has(t))return wt(`Optional content group not found: ${t}`),!0;if(!c(this,nn).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!c(this,nn).has(t))return wt(`Optional content group not found: ${t}`),!0;if(!c(this,nn).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!c(this,nn).has(t))return wt(`Optional content group not found: ${t}`),!0;if(c(this,nn).get(t).visible)return!1}return!0}return wt(`Unknown optional content policy ${e.policy}.`),!0}return wt(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var s;const r=c(this,nn).get(e);if(!r){wt(`Optional content group not found: ${e}`);return}if(n&&t&&r.rbGroups.length)for(const o of r.rbGroups)for(const u of o)u!==e&&((s=c(this,nn).get(u))==null||s._setVisible(wf,!1,!0));r._setVisible(wf,!!t,!0),k(this,Lc,null)}setOCGState({state:e,preserveRB:t}){let n;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":n=r;continue}const s=c(this,nn).get(r);if(s)switch(n){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!s.visible,t);break}}k(this,Lc,null)}get hasInitialVisibility(){return c(this,xp)===null||this.getHash()===c(this,xp)}getOrder(){return c(this,nn).size?c(this,_p)?c(this,_p).slice():[...c(this,nn).keys()]:null}getGroup(e){return c(this,nn).get(e)||null}getHash(){if(c(this,Lc)!==null)return c(this,Lc);const e=new nN;for(const[t,n]of c(this,nn))e.update(`${t}:${n.visible}`);return k(this,Lc,e.hexdigest())}[Symbol.iterator](){return c(this,nn).entries()}}Lc=new WeakMap,nn=new WeakMap,xp=new WeakMap,_p=new WeakMap,zy=new WeakSet,qS=function(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let r=1;r<t;r++){const s=e[r];let o;if(Array.isArray(s))o=O(this,zy,qS).call(this,s);else if(c(this,nn).has(s))o=c(this,nn).get(s).visible;else return wt(`Optional content group not found: ${s}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"};class qj{constructor(e,{disableRange:t=!1,disableStream:n=!1}){Lt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:s,progressiveDone:o,contentDispositionFilename:u}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=u,(s==null?void 0:s.length)>0){const d=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((d,f)=>{this._onReceiveData({begin:d,chunk:f})}),e.addProgressListener((d,f)=>{this._onProgress({loaded:d,total:f})}),e.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const r=this._rangeReaders.some(function(s){return s._begin!==e?!1:(s._enqueue(n),!0)});Lt(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,n,r,s;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(s=(r=this._fullRequestReader)==null?void 0:r.onProgress)==null||s.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Lt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Vj(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new Wj(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}}class Vj{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=iA(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Wj{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Gj(a){let e=!0,t=n("filename\\*","i").exec(a);if(t){t=t[1];let p=u(t);return p=unescape(p),p=d(p),p=f(p),s(p)}if(t=o(a),t){const p=f(t);return s(p)}if(t=n("filename","i").exec(a),t){t=t[1];let p=u(t);return p=f(p),s(p)}function n(p,y){return new RegExp("(?:^|;)\\s*"+p+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',y)}function r(p,y){if(p){if(!/^[\x00-\xFF]+$/.test(y))return y;try{const v=new TextDecoder(p,{fatal:!0}),x=$0(y);y=v.decode(x),e=!1}catch{}}return y}function s(p){return e&&/[\x80-\xff]/.test(p)&&(p=r("utf-8",p),e&&(p=r("iso-8859-1",p))),p}function o(p){const y=[];let v;const x=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(v=x.exec(p))!==null;){let[,E,T,N]=v;if(E=parseInt(E,10),E in y){if(E===0)break;continue}y[E]=[T,N]}const S=[];for(let E=0;E<y.length&&E in y;++E){let[T,N]=y[E];N=u(N),T&&(N=unescape(N),E===0&&(N=d(N))),S.push(N)}return S.join("")}function u(p){if(p.startsWith('"')){const y=p.slice(1).split('\\"');for(let v=0;v<y.length;++v){const x=y[v].indexOf('"');x!==-1&&(y[v]=y[v].slice(0,x),y.length=v+1),y[v]=y[v].replaceAll(/\\(.)/g,"$1")}p=y.join('"')}return p}function d(p){const y=p.indexOf("'");if(y===-1)return p;const v=p.slice(0,y),S=p.slice(y+1).replace(/^[^']*'/,"");return r(v,S)}function f(p){return!p.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(p)?p:p.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(y,v,x,S){if(x==="q"||x==="Q")return S=S.replaceAll("_"," "),S=S.replaceAll(/=([0-9a-fA-F]{2})/g,function(E,T){return String.fromCharCode(parseInt(T,16))}),r(v,S);try{S=atob(S)}catch{}return r(v,S)})}return""}function pN(a,e){const t=new Headers;if(!a||!e||typeof e!="object")return t;for(const n in e){const r=e[n];r!==void 0&&t.append(n,r)}return t}function fx(a){var e;return((e=URL.parse(a))==null?void 0:e.origin)??null}function gN({responseHeaders:a,isHttp:e,rangeChunkSize:t,disableRange:n}){const r={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(a.get("Content-Length"),10);return!Number.isInteger(s)||(r.suggestedLength=s,s<=2*t)||n||!e||a.get("Accept-Ranges")!=="bytes"||(a.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function mN(a){const e=a.get("Content-Disposition");if(e){let t=Gj(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(iA(t))return t}return null}function V0(a,e){return new bw(`Unexpected server response (${a}) while retrieving PDF "${e}".`,a,a===404||a===0&&e.startsWith("file:"))}function yN(a){return a===200||a===206}function vN(a,e,t){return{method:"GET",headers:a,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function bN(a){return a instanceof Uint8Array?a.buffer:a instanceof ArrayBuffer?a:(wt(`getArrayBuffer - unexpected data format: ${a}`),new Uint8Array(a).buffer)}class Kj{constructor(e){Re(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=pN(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Lt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Xj(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new Yj(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class Xj{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),r=t.url;fetch(r,vN(n,this._withCredentials,this._abortController)).then(s=>{if(e._responseOrigin=fx(s.url),!yN(s.status))throw V0(s.status,r);this._reader=s.body.getReader(),this._headersCapability.resolve();const o=s.headers,{allowRangeRequests:u,suggestedLength:d}=gN({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=u,this._contentLength=d||this._contentLength,this._filename=mN(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new cu("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:bN(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class Yj{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const s=new Headers(e.headers);s.append("Range",`bytes=${t}-${n-1}`);const o=r.url;fetch(o,vN(s,this._withCredentials,this._abortController)).then(u=>{const d=fx(u.url);if(d!==e._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${e._responseOrigin}".`);if(!yN(u.status))throw V0(u.status,o);this._readCapability.resolve(),this._reader=u.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:bN(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const X_=200,Y_=206;function Jj(a){const e=a.response;return typeof e!="string"?e:$0(e).buffer}class Qj{constructor({url:e,httpHeaders:t,withCredentials:n}){Re(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=pN(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[s,o]of this.headers)t.setRequestHeader(s,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=Y_):r.expectedStatus=X_,t.responseType="arraybuffer",Lt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var r;const n=this.pendingRequests[e];n&&((r=n.onProgress)==null||r.call(n,t))}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){n.onError(r.status);return}const s=r.status||X_;if(!(s===X_&&n.expectedStatus===Y_)&&s!==n.expectedStatus){n.onError(r.status);return}const u=Jj(r);if(s===Y_){const d=r.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);f?n.onDone({begin:parseInt(f[1],10),chunk:u}):(wt('Missing or invalid "Content-Range" header.'),n.onError(0))}else u?n.onDone({begin:0,chunk:u}):n.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Zj{constructor(e){this._source=e,this._manager=new Qj(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Lt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new eM(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new tM(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class eM{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=fx(t.responseURL);const n=t.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(u=>{const[d,...f]=u.split(": ");return[d,f.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:o}=gN({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=mN(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=V0(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class tM{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=fx((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=V0(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const nM=/^[a-z][a-z0-9\-+.]+:/i;function rM(a){if(nM.test(a))return new URL(a);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(a))}class sM{constructor(e){this.source=e,this.url=rM(e.url),Lt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Lt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new iM(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new oM(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class iM{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=V0(0,this._url.href)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new cu("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class oM{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const im=Symbol("INITIAL_DATA");var Fs,Hy,VS;class wN{constructor(){R(this,Hy);R(this,Fs,Object.create(null))}get(e,t=null){if(t){const r=O(this,Hy,VS).call(this,e);return r.promise.then(()=>t(r.data)),null}const n=c(this,Fs)[e];if(!n||n.data===im)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=c(this,Fs)[e];return!!t&&t.data!==im}delete(e){const t=c(this,Fs)[e];return!t||t.data===im?!1:(delete c(this,Fs)[e],!0)}resolve(e,t=null){const n=O(this,Hy,VS).call(this,e);n.data=t,n.resolve()}clear(){var e;for(const t in c(this,Fs)){const{data:n}=c(this,Fs)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}k(this,Fs,Object.create(null))}*[Symbol.iterator](){for(const e in c(this,Fs)){const{data:t}=c(this,Fs)[e];t!==im&&(yield[e,t])}}}Fs=new WeakMap,Hy=new WeakSet,VS=function(e){var t;return(t=c(this,Fs))[e]||(t[e]={...Promise.withResolvers(),data:im})};const aM=1e5,bC=30;var oT,Fc,Es,qy,Vy,Id,nl,Wy,Gy,Od,Sp,Ep,Bc,Ap,Ky,kp,jd,Xy,Yy,Cp,Md,Jy,$c,Tp,Al,xN,_N,WS,ni,Ub,GS,SN,EN;const nr=class nr{constructor({textContentSource:e,container:t,viewport:n}){R(this,Al);R(this,Fc,Promise.withResolvers());R(this,Es,null);R(this,qy,!1);R(this,Vy,!!((oT=globalThis.FontInspector)!=null&&oT.enabled));R(this,Id,null);R(this,nl,null);R(this,Wy,0);R(this,Gy,0);R(this,Od,null);R(this,Sp,null);R(this,Ep,0);R(this,Bc,0);R(this,Ap,Object.create(null));R(this,Ky,[]);R(this,kp,null);R(this,jd,[]);R(this,Xy,new WeakMap);R(this,Yy,null);var d;if(e instanceof ReadableStream)k(this,kp,e);else if(typeof e=="object")k(this,kp,new ReadableStream({start(f){f.enqueue(e),f.close()}}));else throw new Error('No "textContentSource" parameter specified.');k(this,Es,k(this,Sp,t)),k(this,Bc,n.scale*ta.pixelRatio),k(this,Ep,n.rotation),k(this,nl,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:s,pageX:o,pageY:u}=n.rawDims;k(this,Yy,[1,0,0,-1,-o,u+s]),k(this,Gy,r),k(this,Wy,s),O(d=nr,ni,SN).call(d),vh(t,n),c(this,Fc).promise.finally(()=>{c(nr,Tp).delete(this),k(this,nl,null),k(this,Ap,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Mr.platform;return xt(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{c(this,Od).read().then(({value:t,done:n})=>{if(n){c(this,Fc).resolve();return}c(this,Id)??k(this,Id,t.lang),Object.assign(c(this,Ap),t.styles),O(this,Al,xN).call(this,t.items),e()},c(this,Fc).reject)};return k(this,Od,c(this,kp).getReader()),c(nr,Tp).add(this),e(),c(this,Fc).promise}update({viewport:e,onBefore:t=null}){var s;const n=e.scale*ta.pixelRatio,r=e.rotation;if(r!==c(this,Ep)&&(t==null||t(),k(this,Ep,r),vh(c(this,Sp),{rotation:r})),n!==c(this,Bc)){t==null||t(),k(this,Bc,n);const o={div:null,properties:null,ctx:O(s=nr,ni,Ub).call(s,c(this,Id))};for(const u of c(this,jd))o.properties=c(this,Xy).get(u),o.div=u,O(this,Al,WS).call(this,o)}}cancel(){var t;const e=new cu("TextLayer task cancelled.");(t=c(this,Od))==null||t.cancel(e).catch(()=>{}),k(this,Od,null),c(this,Fc).reject(e)}get textDivs(){return c(this,jd)}get textContentItemsStr(){return c(this,Ky)}static cleanup(){if(!(c(this,Tp).size>0)){c(this,Cp).clear();for(const{canvas:e}of c(this,Md).values())e.remove();c(this,Md).clear()}}};Fc=new WeakMap,Es=new WeakMap,qy=new WeakMap,Vy=new WeakMap,Id=new WeakMap,nl=new WeakMap,Wy=new WeakMap,Gy=new WeakMap,Od=new WeakMap,Sp=new WeakMap,Ep=new WeakMap,Bc=new WeakMap,Ap=new WeakMap,Ky=new WeakMap,kp=new WeakMap,jd=new WeakMap,Xy=new WeakMap,Yy=new WeakMap,Cp=new WeakMap,Md=new WeakMap,Jy=new WeakMap,$c=new WeakMap,Tp=new WeakMap,Al=new WeakSet,xN=function(e){var r,s;if(c(this,qy))return;(s=c(this,nl)).ctx??(s.ctx=O(r=nr,ni,Ub).call(r,c(this,Id)));const t=c(this,jd),n=c(this,Ky);for(const o of e){if(t.length>aM){wt("Ignoring additional textDivs for performance reasons."),k(this,qy,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const u=c(this,Es);k(this,Es,document.createElement("span")),c(this,Es).classList.add("markedContent"),o.id&&c(this,Es).setAttribute("id",`${o.id}`),u.append(c(this,Es))}else o.type==="endMarkedContent"&&k(this,Es,c(this,Es).parentNode);continue}n.push(o.str),O(this,Al,_N).call(this,o)}},_N=function(e){var E;const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};c(this,jd).push(t);const r=Ze.transform(c(this,Yy),e.transform);let s=Math.atan2(r[1],r[0]);const o=c(this,Ap)[e.fontName];o.vertical&&(s+=Math.PI/2);let u=c(this,Vy)&&o.fontSubstitution||o.fontFamily;u=nr.fontFamilyMap.get(u)||u;const d=Math.hypot(r[2],r[3]),f=d*O(E=nr,ni,EN).call(E,u,o,c(this,Id));let p,y;s===0?(p=r[4],y=r[5]-f):(p=r[4]+f*Math.sin(s),y=r[5]-f*Math.cos(s));const v="calc(var(--total-scale-factor) *",x=t.style;c(this,Es)===c(this,Sp)?(x.left=`${(100*p/c(this,Gy)).toFixed(2)}%`,x.top=`${(100*y/c(this,Wy)).toFixed(2)}%`):(x.left=`${v}${p.toFixed(2)}px)`,x.top=`${v}${y.toFixed(2)}px)`),x.fontSize=`${v}${(c(nr,$c)*d).toFixed(2)}px)`,x.fontFamily=u,n.fontSize=d,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,c(this,Vy)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),s!==0&&(n.angle=s*(180/Math.PI));let S=!1;if(e.str.length>1)S=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const T=Math.abs(e.transform[0]),N=Math.abs(e.transform[3]);T!==N&&Math.max(T,N)/Math.min(T,N)>1.5&&(S=!0)}if(S&&(n.canvasWidth=o.vertical?e.height:e.width),c(this,Xy).set(t,n),c(this,nl).div=t,c(this,nl).properties=n,O(this,Al,WS).call(this,c(this,nl)),n.hasText&&c(this,Es).append(t),n.hasEOL){const T=document.createElement("br");T.setAttribute("role","presentation"),c(this,Es).append(T)}},WS=function(e){var u;const{div:t,properties:n,ctx:r}=e,{style:s}=t;let o="";if(c(nr,$c)>1&&(o=`scale(${1/c(nr,$c)})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:d}=s,{canvasWidth:f,fontSize:p}=n;O(u=nr,ni,GS).call(u,r,p*c(this,Bc),d);const{width:y}=r.measureText(t.textContent);y>0&&(o=`scaleX(${f*c(this,Bc)/y}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(s.transform=o)},ni=new WeakSet,Ub=function(e=null){let t=c(this,Md).get(e||(e=""));if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),c(this,Md).set(e,t),c(this,Jy).set(t,{size:0,family:""})}return t},GS=function(e,t,n){const r=c(this,Jy).get(e);t===r.size&&n===r.family||(e.font=`${t}px ${n}`,r.size=t,r.family=n)},SN=function(){if(c(this,$c)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),k(this,$c,e.getBoundingClientRect().height),e.remove()},EN=function(e,t,n){const r=c(this,Cp).get(e);if(r)return r;const s=O(this,ni,Ub).call(this,n);s.canvas.width=s.canvas.height=bC,O(this,ni,GS).call(this,s,bC,e);const o=s.measureText(""),u=o.fontBoundingBoxAscent,d=Math.abs(o.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let f=.8;return u?f=u/(u+d):(Mr.platform.isFirefox&&wt("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?f=t.ascent:t.descent&&(f=1+t.descent)),c(this,Cp).set(e,f),f},R(nr,ni),R(nr,Cp,new Map),R(nr,Md,new Map),R(nr,Jy,new WeakMap),R(nr,$c,null),R(nr,Tp,new Set);let Vm=nr;const lM=100;function cA(a={}){typeof a=="string"||a instanceof URL?a={url:a}:(a instanceof ArrayBuffer||ArrayBuffer.isView(a))&&(a={data:a});const e=new KS,{docId:t}=e,n=a.url?gj(a.url):null,r=a.data?mj(a.data):null,s=a.httpHeaders||null,o=a.withCredentials===!0,u=a.password??null,d=a.range instanceof AN?a.range:null,f=Number.isInteger(a.rangeChunkSize)&&a.rangeChunkSize>0?a.rangeChunkSize:2**16;let p=a.worker instanceof Wm?a.worker:null;const y=a.verbosity,v=typeof a.docBaseUrl=="string"&&!hx(a.docBaseUrl)?a.docBaseUrl:null,x=cb(a.cMapUrl),S=a.cMapPacked!==!1,E=a.CMapReaderFactory||(as?Ej:iC),T=cb(a.iccUrl),N=cb(a.standardFontDataUrl),L=a.StandardFontDataFactory||(as?Aj:oC),j=cb(a.wasmUrl),F=a.WasmFactory||(as?kj:aC),B=a.stopAtErrors!==!0,$=Number.isInteger(a.maxImageSize)&&a.maxImageSize>-1?a.maxImageSize:-1,H=a.isEvalSupported!==!1,W=typeof a.isOffscreenCanvasSupported=="boolean"?a.isOffscreenCanvasSupported:!as,ae=typeof a.isImageDecoderSupported=="boolean"?a.isImageDecoderSupported:!as&&(Mr.platform.isFirefox||!globalThis.chrome),me=Number.isInteger(a.canvasMaxAreaInBytes)?a.canvasMaxAreaInBytes:-1,ne=typeof a.disableFontFace=="boolean"?a.disableFontFace:as,re=a.fontExtraProperties===!0,xe=a.enableXfa===!0,ve=a.ownerDocument||globalThis.document,_e=a.disableRange===!0,pe=a.disableStream===!0,fe=a.disableAutoFetch===!0,Z=a.pdfBug===!0,ke=a.CanvasFactory||(as?Sj:wj),Q=a.FilterFactory||(as?_j:xj),z=a.enableHWA===!0,K=a.useWasm!==!1,Se=d?d.length:a.length??NaN,Pe=typeof a.useSystemFonts=="boolean"?a.useSystemFonts:!as&&!ne,Ve=typeof a.useWorkerFetch=="boolean"?a.useWorkerFetch:!!(E===iC&&L===oC&&F===aC&&x&&N&&j&&hm(x,document.baseURI)&&hm(N,document.baseURI)&&hm(j,document.baseURI)),We=null;HO(y);const be={canvasFactory:new ke({ownerDocument:ve,enableHWA:z}),filterFactory:new Q({docId:t,ownerDocument:ve}),cMapReaderFactory:Ve?null:new E({baseUrl:x,isCompressed:S}),standardFontDataFactory:Ve?null:new L({baseUrl:N}),wasmFactory:Ve?null:new F({baseUrl:j})};p||(p=Wm.create({verbosity:y,port:ea.workerPort}),e._worker=p);const Te={docId:t,apiVersion:"5.4.449",data:r,password:u,disableAutoFetch:fe,rangeChunkSize:f,length:Se,docBaseUrl:v,enableXfa:xe,evaluatorOptions:{maxImageSize:$,disableFontFace:ne,ignoreErrors:B,isEvalSupported:H,isOffscreenCanvasSupported:W,isImageDecoderSupported:ae,canvasMaxAreaInBytes:me,fontExtraProperties:re,useSystemFonts:Pe,useWasm:K,useWorkerFetch:Ve,cMapUrl:x,iccUrl:T,standardFontDataUrl:N,wasmUrl:j}},Ee={ownerDocument:ve,pdfBug:Z,styleElement:We,loadingParams:{disableAutoFetch:fe,enableXfa:xe}};return p.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const at=p.messageHandler.sendWithPromise("GetDocRequest",Te,r?[r.buffer]:null);let bt;if(d)bt=new qj(d,{disableRange:_e,disableStream:pe});else if(!r){if(!n)throw new Error("getDocument - no `url` parameter provided.");const tt=hm(n)?Kj:as?sM:Zj;bt=new tt({url:n,length:Se,httpHeaders:s,withCredentials:o,rangeChunkSize:f,disableRange:_e,disableStream:pe})}return at.then(tt=>{if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const Ht=new wm(t,tt,p.port),Le=new dM(Ht,e,bt,Ee,be,z);e._transport=Le,Ht.send("Ready",null)})}).catch(e._capability.reject),e}var Jw;const Qw=class Qw{constructor(){Re(this,"_capability",Promise.withResolvers());Re(this,"_transport",null);Re(this,"_worker",null);Re(this,"docId",`d${er(Qw,Jw)._++}`);Re(this,"destroyed",!1);Re(this,"onPassword",null);Re(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,n,r;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(s){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,s}this._transport=null,(r=this._worker)==null||r.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Jw=new WeakMap,R(Qw,Jw,0);let KS=Qw;var Dd,Qy,Zy,e0,t0;class AN{constructor(e,t,n=!1,r=null){R(this,Dd,Promise.withResolvers());R(this,Qy,[]);R(this,Zy,[]);R(this,e0,[]);R(this,t0,[]);this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r}addRangeListener(e){c(this,t0).push(e)}addProgressListener(e){c(this,e0).push(e)}addProgressiveReadListener(e){c(this,Zy).push(e)}addProgressiveDoneListener(e){c(this,Qy).push(e)}onDataRange(e,t){for(const n of c(this,t0))n(e,t)}onDataProgress(e,t){c(this,Dd).promise.then(()=>{for(const n of c(this,e0))n(e,t)})}onDataProgressiveRead(e){c(this,Dd).promise.then(()=>{for(const t of c(this,Zy))t(e)})}onDataProgressiveDone(){c(this,Dd).promise.then(()=>{for(const e of c(this,Qy))e()})}transportReady(){c(this,Dd).resolve()}requestDataRange(e,t){ln("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}Dd=new WeakMap,Qy=new WeakMap,Zy=new WeakMap,e0=new WeakMap,t0=new WeakMap;class cM{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return xt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(e){return this._transport.extractPages(e)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var rl,Ld,Am;class uM{constructor(e,t,n,r=!1){R(this,Ld);R(this,rl,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=r?new Qk:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new wN,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:s=!1}={}){return new z0({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:s})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return xt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:n,intent:r="display",annotationMode:s=pc.ENABLE,transform:o=null,background:u=null,optionalContentConfigPromise:d=null,annotationCanvasMap:f=null,pageColors:p=null,printAnnotationStorage:y=null,isEditing:v=!1,recordOperations:x=!1,operationsFilter:S=null}){var ae,me,ne;(ae=this._stats)==null||ae.time("Overall");const E=this._transport.getRenderingIntent(r,s,y,v),{renderingIntent:T,cacheKey:N}=E;k(this,rl,!1),d||(d=this._transport.getOptionalContentConfig(T));let L=this._intentStates.get(N);L||(L=Object.create(null),this._intentStates.set(N,L)),L.streamReaderCancelTimeout&&(clearTimeout(L.streamReaderCancelTimeout),L.streamReaderCancelTimeout=null);const j=!!(T&Qs.PRINT);L.displayReadyCapability||(L.displayReadyCapability=Promise.withResolvers(),L.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(me=this._stats)==null||me.time("Page Request"),this._pumpOperatorList(E));const F=!!(this._pdfBug&&((ne=globalThis.StepperManager)!=null&&ne.enabled)),B=!this.recordedBBoxes&&(x||F),$=re=>{var xe,ve;if(L.renderTasks.delete(H),B){const _e=(xe=H.gfx)==null?void 0:xe.dependencyTracker.take();_e&&(H.stepper&&H.stepper.setOperatorBBoxes(_e,H.gfx.dependencyTracker.takeDebugMetadata()),x&&(this.recordedBBoxes=_e))}j&&k(this,rl,!0),O(this,Ld,Am).call(this),re?(H.capability.reject(re),this._abortOperatorList({intentState:L,reason:re instanceof Error?re:new Error(re)})):H.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(ve=globalThis.Stats)!=null&&ve.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},H=new XS({callback:$,params:{canvas:t,canvasContext:e,dependencyTracker:B?new Tj(t,L.operatorList.length,F):null,viewport:n,transform:o,background:u},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:L.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!j,pdfBug:this._pdfBug,pageColors:p,enableHWA:this._transport.enableHWA,operationsFilter:S});(L.renderTasks||(L.renderTasks=new Set)).add(H);const W=H.task;return Promise.all([L.displayReadyCapability.promise,d]).then(([re,xe])=>{var ve;if(this.destroyed){$();return}if((ve=this._stats)==null||ve.time("Rendering"),!(xe.renderingIntent&T))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");H.initializeGraphics({transparency:re,optionalContentConfig:xe}),H.operatorListChanged()}).catch($),W}getOperatorList({intent:e="display",annotationMode:t=pc.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){var f;function s(){u.operatorList.lastChunk&&(u.opListReadCapability.resolve(u.operatorList),u.renderTasks.delete(d))}const o=this._transport.getRenderingIntent(e,t,n,r,!0);let u=this._intentStates.get(o.cacheKey);u||(u=Object.create(null),this._intentStates.set(o.cacheKey,u));let d;return u.opListReadCapability||(d=Object.create(null),d.operatorListChanged=s,u.opListReadCapability=Promise.withResolvers(),(u.renderTasks||(u.renderTasks=new Set)).add(d),u.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(f=this._stats)==null||f.time("Page Request"),this._pumpOperatorList(o)),u.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>qm.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,r){function s(){o.read().then(function({value:d,done:f}){if(f){n(u);return}u.lang??(u.lang=d.lang),Object.assign(u.styles,d.styles),u.items.push(...d.items),s()},r)}const o=t.getReader(),u={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),k(this,rl,!1),Promise.all(e)}cleanup(e=!1){k(this,rl,!0);const t=O(this,Ld,Am).call(this);return e&&t&&this._stats&&(this._stats=new Qk),t}_startRenderPage(e,t){var r,s;const n=this._intentStates.get(t);n&&((r=this._stats)==null||r.timeEnd("Page Request"),(s=n.displayReadyCapability)==null||s.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&O(this,Ld,Am).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:r}){const{map:s,transfer:o}=n,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:s,modifiedIds:r},o).getReader(),f=this._intentStates.get(t);f.streamReader=d;const p=()=>{d.read().then(({value:y,done:v})=>{if(v){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(y,f),p())},y=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const v of f.renderTasks)v.operatorListChanged();O(this,Ld,Am).call(this)}if(f.displayReadyCapability)f.displayReadyCapability.reject(y);else if(f.opListReadCapability)f.opListReadCapability.reject(y);else throw y}})};p()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof sA){let r=lM;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new cu(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,s]of this._intentStates)if(s===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}rl=new WeakMap,Ld=new WeakSet,Am=function(){if(!c(this,rl)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),k(this,rl,!1),!0};var Uc,Qi,sl,Fd,Zw,Bd,$d,cs,zb,kN,CN,km,Np,Hb;const wn=class wn{constructor({name:e=null,port:t=null,verbosity:n=qO()}={}){R(this,cs);R(this,Uc,Promise.withResolvers());R(this,Qi,null);R(this,sl,null);R(this,Fd,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(c(wn,$d).has(t))throw new Error("Cannot use more than one PDFWorker per port.");c(wn,$d).set(t,this),O(this,cs,kN).call(this,t)}else O(this,cs,CN).call(this)}get promise(){return c(this,Uc).promise}get port(){return c(this,sl)}get messageHandler(){return c(this,Qi)}destroy(){var e,t;this.destroyed=!0,(e=c(this,Fd))==null||e.terminate(),k(this,Fd,null),c(wn,$d).delete(c(this,sl)),k(this,sl,null),(t=c(this,Qi))==null||t.destroy(),k(this,Qi,null)}static create(e){const t=c(this,$d).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new wn(e)}static get workerSrc(){if(ea.workerSrc)return ea.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return xt(this,"_setupFakeWorkerGlobal",(async()=>c(this,Np,Hb)?c(this,Np,Hb):(await import(this.workerSrc)).WorkerMessageHandler)())}};Uc=new WeakMap,Qi=new WeakMap,sl=new WeakMap,Fd=new WeakMap,Zw=new WeakMap,Bd=new WeakMap,$d=new WeakMap,cs=new WeakSet,zb=function(){c(this,Uc).resolve(),c(this,Qi).send("configure",{verbosity:this.verbosity})},kN=function(e){k(this,sl,e),k(this,Qi,new wm("main","worker",e)),c(this,Qi).on("ready",()=>{}),O(this,cs,zb).call(this)},CN=function(){if(c(wn,Bd)||c(wn,Np,Hb)){O(this,cs,km).call(this);return}let{workerSrc:e}=wn;try{wn._isSameOrigin(window.location,e)||(e=wn._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new wm("main","worker",t),r=()=>{s.abort(),n.destroy(),t.terminate(),this.destroyed?c(this,Uc).reject(new Error("Worker was destroyed")):O(this,cs,km).call(this)},s=new AbortController;t.addEventListener("error",()=>{c(this,Fd)||r()},{signal:s.signal}),n.on("test",u=>{if(s.abort(),this.destroyed||!u){r();return}k(this,Qi,n),k(this,sl,t),k(this,Fd,t),O(this,cs,zb).call(this)}),n.on("ready",u=>{if(s.abort(),this.destroyed){r();return}try{o()}catch{O(this,cs,km).call(this)}});const o=()=>{const u=new Uint8Array;n.send("test",u,[u.buffer])};o();return}catch{dx("The worker has been disabled.")}O(this,cs,km).call(this)},km=function(){c(wn,Bd)||(wt("Setting up fake worker."),k(wn,Bd,!0)),wn._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){c(this,Uc).reject(new Error("Worker was destroyed"));return}const t=new bj;k(this,sl,t);const n=`fake${er(wn,Zw)._++}`,r=new wm(n+"_worker",n,t);e.setup(r,t),k(this,Qi,new wm(n,n+"_worker",t)),O(this,cs,zb).call(this)}).catch(e=>{c(this,Uc).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Np=new WeakSet,Hb=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},R(wn,Np),R(wn,Zw,0),R(wn,Bd,!1),R(wn,$d,new WeakMap),as&&(k(wn,Bd,!0),ea.workerSrc||(ea.workerSrc="./pdf.worker.mjs")),wn._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!(n!=null&&n.origin)||n.origin==="null")return!1;const r=new URL(t,n);return n.origin===r.origin},wn._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},wn.fromPort=e=>{if(nj("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return wn.create(e)};let Wm=wn;var il,qo,Pp,Rp,ol,Ud,Cm;class dM{constructor(e,t,n,r,s,o){R(this,Ud);R(this,il,new Map);R(this,qo,new Map);R(this,Pp,new Map);R(this,Rp,new Map);R(this,ol,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new wN,this.fontLoader=new fj({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}get annotationStorage(){return xt(this,"annotationStorage",new oA)}getRenderingIntent(e,t=pc.ENABLE,n=null,r=!1,s=!1){let o=Qs.DISPLAY,u=RS;switch(e){case"any":o=Qs.ANY;break;case"display":break;case"print":o=Qs.PRINT;break;default:wt(`getRenderingIntent - invalid intent: ${e}`)}const d=o&Qs.PRINT&&n instanceof sN?n:this.annotationStorage;switch(t){case pc.DISABLE:o+=Qs.ANNOTATIONS_DISABLE;break;case pc.ENABLE:break;case pc.ENABLE_FORMS:o+=Qs.ANNOTATIONS_FORMS;break;case pc.ENABLE_STORAGE:o+=Qs.ANNOTATIONS_STORAGE,u=d.serializable;break;default:wt(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(o+=Qs.IS_EDITING),s&&(o+=Qs.OPLIST);const{ids:f,hash:p}=d.modifiedIds,y=[o,u.hash,p];return{renderingIntent:o,cacheKey:y.join("_"),annotationStorageSerializable:u,modifiedIds:f}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=c(this,ol))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of c(this,qo).values())e.push(r._destroy());c(this,qo).clear(),c(this,Pp).clear(),c(this,Rp).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var r,s;this.commonObjs.clear(),this.fontLoader.clear(),c(this,il).clear(),this.filterFactory.destroy(),Vm.cleanup(),(r=this._networkStream)==null||r.cancelAllRequests(new cu("Worker was terminated.")),(s=this.messageHandler)==null||s.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{Lt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},r.onPull=()=>{this._fullReader.read().then(function({value:s,done:o}){if(o){r.close();return}Lt(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{r.error(s)})},r.onCancel=s=>{this._fullReader.cancel(s),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{var u;await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:s,contentLength:o}=this._fullReader;return(!r||!s)&&(this._lastProgress&&((u=t.onProgress)==null||u.call(t,this._lastProgress)),this._fullReader.onProgress=d=>{var f;(f=t.onProgress)==null||f.call(t,{loaded:d.loaded,total:d.total})}),{isStreamingSupported:r,isRangeSupported:s,contentLength:o}}),e.on("GetRangeReader",(n,r)=>{Lt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(n.begin,n.end);if(!s){r.close();return}r.onPull=()=>{s.read().then(function({value:o,done:u}){if(u){r.close();return}Lt(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{r.error(o)})},r.onCancel=o=>{s.cancel(o),r.ready.catch(u=>{if(!this.destroyed)throw u})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new cM(n,this))}),e.on("DocException",n=>{t._capability.reject(ys(n))}),e.on("PasswordRequest",n=>{k(this,ol,Promise.withResolvers());try{if(!t.onPassword)throw ys(n);const r=s=>{s instanceof Error?c(this,ol).reject(s):c(this,ol).resolve({password:s})};t.onPassword(r,n.code)}catch(r){c(this,ol).reject(r)}return c(this,ol).promise}),e.on("DataLoaded",n=>{var r;(r=t.onProgress)==null||r.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;c(this,qo).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,s])=>{var o;if(this.destroyed||this.commonObjs.has(n))return null;switch(r){case"Font":if("error"in s){const v=s.error;wt(`Error during font loading: ${v}`),this.commonObjs.resolve(n,v);break}const u=new IS(s),d=this._params.pdfBug&&((o=globalThis.FontInspector)!=null&&o.enabled)?(v,x)=>globalThis.FontInspector.fontAdded(v,x):null,f=new pj(u,d,s.extra,s.charProcOperatorList);this.fontLoader.bind(f).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!f.fontExtraProperties&&f.data&&f.clearData(),this.commonObjs.resolve(n,f)});break;case"CopyLocalImage":const{imageRef:p}=s;Lt(p,"The imageRef must be defined.");for(const v of c(this,qo).values())for(const[,x]of v.objs)if((x==null?void 0:x.ref)===p)return x.dataLen?(this.commonObjs.resolve(n,structuredClone(x)),x.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(n,s);break;case"Pattern":const y=new OS(s);this.commonObjs.resolve(n,y.getIR());break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([n,r,s,o])=>{var d;if(this.destroyed)return;const u=c(this,qo).get(r);if(!u.objs.has(n)){if(u._intentStates.size===0){(d=o==null?void 0:o.bitmap)==null||d.close();return}switch(s){case"Image":case"Pattern":u.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${s}`)}}}),e.on("DocProgress",n=>{var r;this.destroyed||(r=t.onProgress)==null||r.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[n.type];if(!r)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;this.annotationStorage.size<=0&&wt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((n=this._fullReader)==null?void 0:n.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}extractPages(e){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:e})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=c(this,Pp).get(t);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&c(this,Rp).set(s.refStr,e);const o=new uM(t,s,this,this._params.pdfBug);return c(this,qo).set(t,o),o});return c(this,Pp).set(t,r),r}getPageIndex(e){return jS(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return O(this,Ud,Cm).call(this,"GetFieldObjects")}hasJSActions(){return O(this,Ud,Cm).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return O(this,Ud,Cm).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return O(this,Ud,Cm).call(this,"GetOptionalContentConfig").then(t=>new Hj(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=c(this,il).get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(r=>{var s,o;return{info:r[0],metadata:r[1]?new Uj(r[1]):null,contentDispositionFilename:((s=this._fullReader)==null?void 0:s.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null,hasStructTree:r[2]}});return c(this,il).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of c(this,qo).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),c(this,il).clear(),this.filterFactory.destroy(!0),Vm.cleanup()}}cachedPageNumber(e){if(!jS(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return c(this,Rp).get(t)??null}}il=new WeakMap,qo=new WeakMap,Pp=new WeakMap,Rp=new WeakMap,ol=new WeakMap,Ud=new WeakSet,Cm=function(e,t=null){const n=c(this,il).get(e);if(n)return n;const r=this.messageHandler.sendWithPromise(e,t);return c(this,il).set(e,r),r};var zc;class hM{constructor(e){R(this,zc,null);Re(this,"onContinue",null);Re(this,"onError",null);k(this,zc,e)}get promise(){return c(this,zc).capability.promise}cancel(e=0){c(this,zc).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=c(this,zc).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=c(this,zc);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}zc=new WeakMap;var Hc,zd;const Qu=class Qu{constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:s,operatorList:o,pageIndex:u,canvasFactory:d,filterFactory:f,useRequestAnimationFrame:p=!1,pdfBug:y=!1,pageColors:v=null,enableHWA:x=!1,operationsFilter:S=null}){R(this,Hc,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=u,this.canvasFactory=d,this.filterFactory=f,this._pdfBug=y,this.pageColors=v,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=p===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new hM(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=x,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=S}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var d,f;if(this.cancelled)return;if(this._canvas){if(c(Qu,zd).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");c(Qu,zd).add(this._canvas)}this._pdfBug&&((d=globalThis.StepperManager)!=null&&d.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:r,background:s,dependencyTracker:o}=this.params,u=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Mf(u,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:r,viewport:n,transparency:e,background:s}),this.operatorListIdx=0,this.graphicsReady=!0,(f=this.graphicsReadyCallback)==null||f.call(this)}cancel(e=null,t=0){var n,r,s;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),c(this,Hc)&&(window.cancelAnimationFrame(c(this,Hc)),k(this,Hc,null)),c(Qu,zd).delete(this._canvas),e||(e=new sA(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(s=(r=this.task).onError)==null||s.call(r,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?k(this,Hc,window.requestAnimationFrame(()=>{k(this,Hc,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),c(Qu,zd).delete(this._canvas),this.callback())))}};Hc=new WeakMap,zd=new WeakMap,R(Qu,zd,new WeakSet);let XS=Qu;const fM="5.4.449",pM="f44e5f0e6";var Bs,Hd,Ip,ir,n0,Op,al,r0,qc,Zi,s0,rn,YS,JS,QS,Hu,TN,hc;const bs=class bs{constructor({editor:e=null,uiManager:t=null}){R(this,rn);R(this,Bs,null);R(this,Hd,null);R(this,Ip);R(this,ir,null);R(this,n0,!1);R(this,Op,!1);R(this,al,null);R(this,r0);R(this,qc,null);R(this,Zi,null);var n,r;e?(k(this,Op,!1),k(this,al,e)):k(this,Op,!0),k(this,Zi,(e==null?void 0:e._uiManager)||t),k(this,r0,c(this,Zi)._eventBus),k(this,Ip,((n=e==null?void 0:e.color)==null?void 0:n.toUpperCase())||((r=c(this,Zi))==null?void 0:r.highlightColors.values().next().value)||"#FFFF98"),c(bs,s0)||k(bs,s0,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return xt(this,"_keyboardManager",new q0([[["Escape","mac+Escape"],bs.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],bs.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],bs.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],bs.prototype._moveToPrevious],[["Home","mac+Home"],bs.prototype._moveToBeginning],[["End","mac+End"],bs.prototype._moveToEnd]]))}renderButton(){const e=k(this,Bs,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",c(this,al)&&(e.ariaControls=`${c(this,al).id}_colorpicker_dropdown`);const t=c(this,Zi)._signal;e.addEventListener("click",O(this,rn,Hu).bind(this),{signal:t}),e.addEventListener("keydown",O(this,rn,QS).bind(this),{signal:t});const n=k(this,Hd,document.createElement("span"));return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=c(this,Ip),e.append(n),e}renderMainDropdown(){const e=k(this,ir,O(this,rn,YS).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===c(this,Bs)){O(this,rn,Hu).call(this,e);return}const t=e.target.getAttribute("data-color");t&&O(this,rn,JS).call(this,t,e)}_moveToNext(e){var t,n;if(!c(this,rn,hc)){O(this,rn,Hu).call(this,e);return}if(e.target===c(this,Bs)){(t=c(this,ir).firstElementChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=c(this,ir))==null?void 0:t.firstElementChild)||e.target===c(this,Bs)){c(this,rn,hc)&&this._hideDropdownFromKeyboard();return}c(this,rn,hc)||O(this,rn,Hu).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!c(this,rn,hc)){O(this,rn,Hu).call(this,e);return}(t=c(this,ir).firstElementChild)==null||t.focus()}_moveToEnd(e){var t;if(!c(this,rn,hc)){O(this,rn,Hu).call(this,e);return}(t=c(this,ir).lastElementChild)==null||t.focus()}hideDropdown(){var e,t;(e=c(this,ir))==null||e.classList.add("hidden"),c(this,Bs).ariaExpanded="false",(t=c(this,qc))==null||t.abort(),k(this,qc,null)}_hideDropdownFromKeyboard(){var e;if(!c(this,Op)){if(!c(this,rn,hc)){(e=c(this,al))==null||e.unselect();return}this.hideDropdown(),c(this,Bs).focus({preventScroll:!0,focusVisible:c(this,n0)})}}updateColor(e){if(c(this,Hd)&&(c(this,Hd).style.backgroundColor=e),!c(this,ir))return;const t=c(this,Zi).highlightColors.values();for(const n of c(this,ir).children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=c(this,Bs))==null||e.remove(),k(this,Bs,null),k(this,Hd,null),(t=c(this,ir))==null||t.remove(),k(this,ir,null)}};Bs=new WeakMap,Hd=new WeakMap,Ip=new WeakMap,ir=new WeakMap,n0=new WeakMap,Op=new WeakMap,al=new WeakMap,r0=new WeakMap,qc=new WeakMap,Zi=new WeakMap,s0=new WeakMap,rn=new WeakSet,YS=function(){const e=document.createElement("div"),t=c(this,Zi)._signal;e.addEventListener("contextmenu",Ti,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),c(this,al)&&(e.id=`${c(this,al).id}_colorpicker_dropdown`);for(const[n,r]of c(this,Zi).highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",r),s.title=n,s.setAttribute("data-l10n-id",c(bs,s0)[n]);const o=document.createElement("span");s.append(o),o.className="swatch",o.style.backgroundColor=r,s.ariaSelected=r===c(this,Ip),s.addEventListener("click",O(this,rn,JS).bind(this,r),{signal:t}),e.append(s)}return e.addEventListener("keydown",O(this,rn,QS).bind(this),{signal:t}),e},JS=function(e,t){t.stopPropagation(),c(this,r0).dispatch("switchannotationeditorparams",{source:this,type:Dt.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},QS=function(e){bs._keyboardManager.exec(this,e)},Hu=function(e){if(c(this,rn,hc)){this.hideDropdown();return}if(k(this,n0,e.detail===0),c(this,qc)||(k(this,qc,new AbortController),window.addEventListener("pointerdown",O(this,rn,TN).bind(this),{signal:c(this,Zi).combinedSignal(c(this,qc))})),c(this,Bs).ariaExpanded="true",c(this,ir)){c(this,ir).classList.remove("hidden");return}const t=k(this,ir,O(this,rn,YS).call(this));c(this,Bs).append(t)},TN=function(e){var t;(t=c(this,ir))!=null&&t.contains(e.target)||this.hideDropdown()},hc=function(){return c(this,ir)&&!c(this,ir).classList.contains("hidden")},R(bs,s0,null);let kw=bs;var Vo,i0,jp,o0;const Zu=class Zu{constructor(e){R(this,Vo,null);R(this,i0,null);R(this,jp,null);k(this,i0,e),k(this,jp,e._uiManager),c(Zu,o0)||k(Zu,o0,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(c(this,Vo))return c(this,Vo);const{editorType:e,colorType:t,color:n}=c(this,i0),r=k(this,Vo,document.createElement("input"));return r.type="color",r.value=n||"#000000",r.className="basicColorPicker",r.tabIndex=0,r.setAttribute("data-l10n-id",c(Zu,o0)[e]),r.addEventListener("input",()=>{c(this,jp).updateParams(t,r.value)},{signal:c(this,jp)._signal}),r}update(e){c(this,Vo)&&(c(this,Vo).value=e)}destroy(){var e;(e=c(this,Vo))==null||e.remove(),k(this,Vo,null)}hideDropdown(){}};Vo=new WeakMap,i0=new WeakMap,jp=new WeakMap,o0=new WeakMap,R(Zu,o0,null);let Cw=Zu;function wC(a){return Math.floor(Math.max(0,Math.min(1,a))*255).toString(16).padStart(2,"0")}function om(a){return Math.max(0,Math.min(255,255*a))}class xC{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=om(e),[e,e,e]}static G_HTML([e]){const t=wC(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(om)}static RGB_HTML(e){return`#${e.map(wC).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[om(1-Math.min(1,e+r)),om(1-Math.min(1,n+r)),om(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const r=1-e,s=1-t,o=1-n,u=Math.min(r,s,o);return["CMYK",r,s,o,u]}}class gM{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){ln("Abstract method `_createSVG` called.")}}class Tw extends gM{_createSVG(e){return document.createElementNS(ja,e)}}const mM=9,wh=new WeakSet,yM=new Date().getTimezoneOffset()*60*1e3;class J_{static create(e){switch(e.data.annotationType){case qn.LINK:return new uA(e);case qn.TEXT:return new bM(e);case qn.WIDGET:switch(e.data.fieldType){case"Tx":return new wM(e);case"Btn":return e.data.radioButton?new RN(e):e.data.checkBox?new _M(e):new SM(e);case"Ch":return new EM(e);case"Sig":return new xM(e)}return new _h(e);case qn.POPUP:return new eE(e);case qn.FREETEXT:return new DN(e);case qn.LINE:return new kM(e);case qn.SQUARE:return new CM(e);case qn.CIRCLE:return new TM(e);case qn.POLYLINE:return new LN(e);case qn.CARET:return new PM(e);case qn.INK:return new dA(e);case qn.POLYGON:return new NM(e);case qn.HIGHLIGHT:return new FN(e);case qn.UNDERLINE:return new RM(e);case qn.SQUIGGLY:return new IM(e);case qn.STRIKEOUT:return new OM(e);case qn.STAMP:return new BN(e);case qn.FILEATTACHMENT:return new jM(e);default:return new Pn(e)}}}var qd,Mp,_i,a0,ZS;const NA=class NA{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){R(this,a0);R(this,qd,null);R(this,Mp,!1);R(this,_i,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return NA._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var n;const{data:e}=this,t=(n=this.annotationStorage)==null?void 0:n.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var u;const e=(u=this.annotationStorage)==null?void 0:u.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:n,rect:r}=this.data;let s=-1/0,o=-1/0;if((t==null?void 0:t.length)>=8){for(let d=0;d<t.length;d+=8)t[d+1]>o?(o=t[d+1],s=t[d+2]):t[d+1]===o&&(s=Math.max(s,t[d+2]));return[s,o]}if((n==null?void 0:n.length)>=1){for(const d of n)for(let f=0,p=d.length;f<p;f+=2)d[f+1]>o?(o=d[f+1],s=d[f]):d[f+1]===o&&(s=Math.max(s,d[f]));if(s!==1/0)return[s,o]}return r?[r[2],r[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:s,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-s)/n,e[1]=100*(e[1]-o)/r,e}get commentText(){var t,n,r;const{data:e}=this;return((n=(t=this.annotationStorage.getRawValue(`${zm}${e.id}`))==null?void 0:t.popup)==null?void 0:n.contents)||((r=e.contentsObj)==null?void 0:r.str)||""}set commentText(e){const{data:t}=this,n={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:n})||this.annotationStorage.setValue(`${zm}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=c(this,_i))==null?void 0:e.popup)||this.popup)==null||t.remove(),k(this,_i,this.popup=null)}updateEdited(e){var s;if(!this.container)return;e.rect&&(c(this,qd)||k(this,qd,{rect:this.data.rect.slice(0)}));const{rect:t,popup:n}=e;t&&O(this,a0,ZS).call(this,t);let r=((s=c(this,_i))==null?void 0:s.popup)||this.popup;!r&&(n!=null&&n.text)&&(this._createPopup(n),r=c(this,_i).popup),r&&(r.updateEdited(e),n!=null&&n.deleted&&(r.remove(),k(this,_i,null),this.popup=null))}resetEdited(){var e;c(this,qd)&&(O(this,a0,ZS).call(this,c(this,qd).rect),(e=c(this,_i))==null||e.popup.resetEdited(),k(this,qd,null))}_createContainer(e){const{data:t,parent:{page:n,viewport:r}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),!(this instanceof _h)&&!(this instanceof uA)&&(s.tabIndex=0);const{style:o}=s;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof eE){const{rotation:E}=t;return!t.hasOwnCanvas&&E!==0&&this.setRotation(E,s),s}const{width:u,height:d}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const E=t.borderStyle.horizontalCornerRadius,T=t.borderStyle.verticalCornerRadius;if(E>0||T>0){const L=`calc(${E}px * var(--total-scale-factor)) / calc(${T}px * var(--total-scale-factor))`;o.borderRadius=L}else if(this instanceof RN){const L=`calc(${u}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;o.borderRadius=L}switch(t.borderStyle.style){case gf.SOLID:o.borderStyle="solid";break;case gf.DASHED:o.borderStyle="dashed";break;case gf.BEVELED:wt("Unimplemented border style: beveled");break;case gf.INSET:wt("Unimplemented border style: inset");break;case gf.UNDERLINE:o.borderBottomStyle="solid";break}const N=t.borderColor||null;N?(k(this,Mp,!0),o.borderColor=Ze.makeHexColor(N[0]|0,N[1]|0,N[2]|0)):o.borderWidth=0}const f=Ze.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:p,pageHeight:y,pageX:v,pageY:x}=r.rawDims;o.left=`${100*(f[0]-v)/p}%`,o.top=`${100*(f[1]-x)/y}%`;const{rotation:S}=t;return t.hasOwnCanvas||S===0?(o.width=`${100*u/p}%`,o.height=`${100*d/y}%`):this.setRotation(S,s),s}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims;let{width:s,height:o}=this;e%180!==0&&([s,o]=[o,s]),t.style.width=`${100*s/n}%`,t.style.height=`${100*o/r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,r)=>{const s=r.detail[t],o=s[0],u=s.slice(1);r.target.style[n]=xC[`${o}_HTML`](u),this.annotationStorage.setValue(this.data.id,{[n]:xC[`${o}_rgb`](u)})};return xt(this,"_commonActions",{display:t=>{const{display:n}=t.detail,r=n%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const r of Object.keys(t.detail)){const s=e[r]||n[r];s==null||s(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[r,s]of Object.entries(t)){const o=n[r];if(o){const u={detail:{[r]:s},target:e};o(u),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,r,s]=this.data.rect.map(E=>Math.fround(E));if(e.length===8){const[E,T,N,L]=e.subarray(2,6);if(r===E&&s===T&&t===N&&n===L)return}const{style:o}=this.container;let u;if(c(this,Mp)){const{borderColor:E,borderWidth:T}=o;o.borderWidth=0,u=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${E}" stroke-width="${T}">`],this.container.classList.add("hasBorder")}const d=r-t,f=s-n,{svgFactory:p}=this,y=p.createElement("svg");y.classList.add("quadrilateralsContainer"),y.setAttribute("width",0),y.setAttribute("height",0),y.role="none";const v=p.createElement("defs");y.append(v);const x=p.createElement("clipPath"),S=`clippath_${this.data.id}`;x.setAttribute("id",S),x.setAttribute("clipPathUnits","objectBoundingBox"),v.append(x);for(let E=2,T=e.length;E<T;E+=8){const N=e[E],L=e[E+1],j=e[E+2],F=e[E+3],B=p.createElement("rect"),$=(j-t)/d,H=(s-L)/f,W=(N-j)/d,ae=(L-F)/f;B.setAttribute("x",$),B.setAttribute("y",H),B.setAttribute("width",W),B.setAttribute("height",ae),x.append(B),u==null||u.push(`<rect vector-effect="non-scaling-stroke" x="${$}" y="${H}" width="${W}" height="${ae}"/>`)}c(this,Mp)&&(u.push("</g></svg>')"),o.backgroundImage=u.join("")),this.container.append(y),this.container.style.clipPath=`url(#${S})`}_createPopup(e=null){const{data:t}=this;let n,r;e?(n={str:e.text},r=e.date):(n=t.contentsObj,r=t.modificationDate),k(this,_i,new eE({data:{color:t.color,titleObj:t.titleObj,modificationDate:r,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}))}get hasPopupElement(){return!!(c(this,_i)||this.popup||this.data.popupRef)}get extraPopupElement(){return c(this,_i)}render(){ln("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:s,id:o,exportValues:u}of r){if(s===-1||o===t)continue;const d=typeof u=="string"?u:null,f=document.querySelector(`[data-element-id="${o}"]`);if(f&&!wh.has(f)){wt(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:d,domElement:f})}return n}for(const r of document.getElementsByName(e)){const{exportValue:s}=r,o=r.getAttribute("data-element-id");o!==t&&wh.has(r)&&n.push({id:o,exportValue:s,domElement:r})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};qd=new WeakMap,Mp=new WeakMap,_i=new WeakMap,a0=new WeakSet,ZS=function(e){const{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:o,pageX:u,pageY:d}}}}=this;n==null||n.splice(0,4,...e),t.left=`${100*(e[0]-u)/s}%`,t.top=`${100*(o-e[3]+d)/o}%`,r===0?(t.width=`${100*(e[2]-e[0])/s}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(r)};let Pn=NA;class vM extends Pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}var ei,qu,NN,PN;class uA extends Pn{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});R(this,ei);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:n}=this,r=document.createElement("a");r.setAttribute("data-element-id",t.id);let s=!1;return t.url?(n.addLinkAttributes(r,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(r,t.action,t.overlaidText),s=!0):t.attachment?(O(this,ei,NN).call(this,r,t.attachment,t.overlaidText,t.attachmentDest),s=!0):t.setOCGState?(O(this,ei,PN).call(this,r,t.setOCGState,t.overlaidText),s=!0):t.dest?(this._bindLink(r,t.dest,t.overlaidText),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,t),s=!0),t.resetForm?(this._bindResetFormAction(r,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(r,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&(this.contentElement=r,this.container.append(r)),this.container}_bindLink(t,n,r=""){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&O(this,ei,qu).call(this),r&&(t.title=r)}_bindNamedAction(t,n,r=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),r&&(t.title=r),O(this,ei,qu).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(n.actions)){const o=r.get(s);o&&(t[o]=()=>{var u;return(u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:s}}),!1})}n.overlaidText&&(t.title=n.overlaidText),t.onclick||(t.onclick=()=>!1),O(this,ei,qu).call(this)}_bindResetFormAction(t,n){const r=t.onclick;if(r||(t.href=this.linkService.getAnchorUrl("")),O(this,ei,qu).call(this),!this._fieldObjects){wt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(t.onclick=()=>!1);return}t.onclick=()=>{var y;r==null||r();const{fields:s,refs:o,include:u}=n,d=[];if(s.length!==0||o.length!==0){const v=new Set(o);for(const x of s){const S=this._fieldObjects[x]||[];for(const{id:E}of S)v.add(E)}for(const x of Object.values(this._fieldObjects))for(const S of x)v.has(S.id)===u&&d.push(S)}else for(const v of Object.values(this._fieldObjects))d.push(...v);const f=this.annotationStorage,p=[];for(const v of d){const{id:x}=v;switch(p.push(x),v.type){case"text":{const E=v.defaultValue||"";f.setValue(x,{value:E});break}case"checkbox":case"radiobutton":{const E=v.defaultValue===v.exportValues;f.setValue(x,{value:E});break}case"combobox":case"listbox":{const E=v.defaultValue||"";f.setValue(x,{value:E});break}default:continue}const S=document.querySelector(`[data-element-id="${x}"]`);if(S){if(!wh.has(S)){wt(`_bindResetFormAction - element not allowed: ${x}`);continue}}else continue;S.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((y=this.linkService.eventBus)==null||y.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:p,name:"ResetForm"}})),!1}}}ei=new WeakSet,qu=function(){this.container.setAttribute("data-internal-link","")},NN=function(t,n,r="",s=null){t.href=this.linkService.getAnchorUrl(""),n.description?t.title=n.description:r&&(t.title=r),t.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(n.content,n.filename,s),!1},O(this,ei,qu).call(this)},PN=function(t,n,r=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),r&&(t.title=r),O(this,ei,qu).call(this)};class bM extends Pn{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class _h extends Pn{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Mr.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,s){n.includes("mouse")?e.addEventListener(n,o=>{var u;(u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:s(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{var u;if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}s&&((u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:s(o)}}))})}_setEventListeners(e,t,n,r){var s,o,u;for(const[d,f]of n)(f==="Action"||(s=this.data.actions)!=null&&s[f])&&((f==="Focus"||f==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,d,f,r),f==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):f==="Blur"&&!((u=this.data.actions)!=null&&u.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Ze.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||mM,s=e.style;let o;const u=2,d=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-u),p=Math.round(f/(H_*r))||1,y=f/p;o=Math.min(r,d(y/H_))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-u);o=Math.min(r,d(f/H_))}s.fontSize=`calc(${o}px * var(--total-scale-factor))`,s.color=Ze.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class wM extends _h{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){const s=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),s.setValue(o.id,{[r]:n})}render(){var r,s;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let u=o.value||"";const d=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;d&&u.length>d&&(u=u.slice(0,d));let f=o.formattedValue||((r=this.data.textContent)==null?void 0:r.join(`
`))||null;f&&this.data.comb&&(f=f.replaceAll(/\s+/g,""));const p={userValue:u,formattedValue:f,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=f??u,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",f??u),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),wh.add(n),this.contentElement=n,n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:y,datetimeType:v,timeStep:x}=this.data,S=!!v&&this.enableScripting;y&&(n.title=y),this._setRequired(n,this.data.required),d&&(n.maxLength=d),n.addEventListener("input",T=>{e.setValue(t,{value:T.target.value}),this.setPropertyOnSiblings(n,"value",T.target.value,"value"),p.formattedValue=null}),n.addEventListener("resetform",T=>{const N=this.data.defaultFieldValue??"";n.value=p.userValue=N,p.formattedValue=null});let E=T=>{const{formattedValue:N}=p;N!=null&&(T.target.value=N),T.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",N=>{var j;if(p.focused)return;const{target:L}=N;if(S&&(L.type=v,x&&(L.step=x)),p.userValue){const F=p.userValue;if(S)if(v==="time"){const B=new Date(F),$=[B.getHours(),B.getMinutes(),B.getSeconds()];L.value=$.map(H=>H.toString().padStart(2,"0")).join(":")}else L.value=new Date(F-yM).toISOString().split(v==="date"?"T":".",1)[0];else L.value=F}p.lastCommittedValue=L.value,p.commitKey=1,(j=this.data.actions)!=null&&j.Focus||(p.focused=!0)}),n.addEventListener("updatefromsandbox",N=>{this.showElementAndHideCanvas(N.target);const L={value(j){p.userValue=j.detail.value??"",S||e.setValue(t,{value:p.userValue.toString()}),j.target.value=p.userValue},formattedValue(j){const{formattedValue:F}=j.detail;p.formattedValue=F,F!=null&&j.target!==document.activeElement&&(j.target.value=F);const B={formattedValue:F};S&&(B.value=F),e.setValue(t,B)},selRange(j){j.target.setSelectionRange(...j.detail.selRange)},charLimit:j=>{var H;const{charLimit:F}=j.detail,{target:B}=j;if(F===0){B.removeAttribute("maxLength");return}B.setAttribute("maxLength",F);let $=p.userValue;!$||$.length<=F||($=$.slice(0,F),B.value=p.userValue=$,e.setValue(t,{value:$}),(H=this.linkService.eventBus)==null||H.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:$,willCommit:!0,commitKey:1,selStart:B.selectionStart,selEnd:B.selectionEnd}}))}};this._dispatchEventFromSandbox(L,N)}),n.addEventListener("keydown",N=>{var F;p.commitKey=1;let L=-1;if(N.key==="Escape"?L=0:N.key==="Enter"&&!this.data.multiLine?L=2:N.key==="Tab"&&(p.commitKey=3),L===-1)return;const{value:j}=N.target;p.lastCommittedValue!==j&&(p.lastCommittedValue=j,p.userValue=j,(F=this.linkService.eventBus)==null||F.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:j,willCommit:!0,commitKey:L,selStart:N.target.selectionStart,selEnd:N.target.selectionEnd}}))});const T=E;E=null,n.addEventListener("blur",N=>{var F,B;if(!p.focused||!N.relatedTarget)return;(F=this.data.actions)!=null&&F.Blur||(p.focused=!1);const{target:L}=N;let{value:j}=L;if(S){if(j&&v==="time"){const $=j.split(":").map(H=>parseInt(H,10));j=new Date(2e3,0,1,$[0],$[1],$[2]||0).valueOf(),L.step=""}else j.includes("T")||(j=`${j}T00:00`),j=new Date(j).valueOf();L.type="text"}p.userValue=j,p.lastCommittedValue!==j&&((B=this.linkService.eventBus)==null||B.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:j,willCommit:!0,commitKey:p.commitKey,selStart:N.target.selectionStart,selEnd:N.target.selectionEnd}})),T(N)}),(s=this.data.actions)!=null&&s.Keystroke&&n.addEventListener("beforeinput",N=>{var ae;p.lastCommittedValue=null;const{data:L,target:j}=N,{value:F,selectionStart:B,selectionEnd:$}=j;let H=B,W=$;switch(N.inputType){case"deleteWordBackward":{const me=F.substring(0,B).match(/\w*[^\w]*$/);me&&(H-=me[0].length);break}case"deleteWordForward":{const me=F.substring(B).match(/^[^\w]*\w*/);me&&(W+=me[0].length);break}case"deleteContentBackward":B===$&&(H-=1);break;case"deleteContentForward":B===$&&(W+=1);break}N.preventDefault(),(ae=this.linkService.eventBus)==null||ae.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:F,change:L||"",willCommit:!1,selStart:H,selEnd:W}})}),this._setEventListeners(n,p,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],N=>N.target.value)}if(E&&n.addEventListener("blur",E),this.data.comb){const N=(this.data.rect[2]-this.data.rect[0])/d;n.classList.add("comb"),n.style.letterSpacing=`calc(${N}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class xM extends _h{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class _M extends _h{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return wh.add(s),s.setAttribute("data-element-id",n),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,r&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=0,s.addEventListener("change",o=>{const{name:u,checked:d}=o.target;for(const f of this._getElementsByName(u,n)){const p=d&&f.exportValue===t.exportValue;f.domElement&&(f.domElement.checked=p),e.setValue(f.id,{value:p})}e.setValue(n,{value:d})}),s.addEventListener("resetform",o=>{const u=t.defaultFieldValue||"Off";o.target.checked=u===t.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",o=>{const u={value(d){d.target.checked=d.detail.value!=="Off",e.setValue(n,{value:d.target.checked})}};this._dispatchEventFromSandbox(u,o)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class RN extends _h{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(const o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});const s=document.createElement("input");if(wh.add(s),s.setAttribute("data-element-id",n),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,r&&s.setAttribute("checked",!0),s.tabIndex=0,s.addEventListener("change",o=>{const{name:u,checked:d}=o.target;for(const f of this._getElementsByName(u,n))e.setValue(f.id,{value:!1});e.setValue(n,{value:d})}),s.addEventListener("resetform",o=>{const u=t.defaultFieldValue;o.target.checked=u!=null&&u===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;s.addEventListener("updatefromsandbox",u=>{const d={value:f=>{const p=o===f.detail.value;for(const y of this._getElementsByName(f.target.name)){const v=p&&y.id===n;y.domElement&&(y.domElement.checked=v),e.setValue(y.id,{value:v})}}};this._dispatchEventFromSandbox(d,u)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],u=>u.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class SM extends uA{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class EM extends _h{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");wh.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",p=>{const y=this.data.defaultFieldValue;for(const v of r.options)v.selected=v.value===y});for(const p of this.data.options){const y=document.createElement("option");y.textContent=p.displayValue,y.value=p.exportValue,n.value.includes(p.exportValue)&&(y.setAttribute("selected",!0),s=!1),r.append(y)}let o=null;if(s){const p=document.createElement("option");p.value=" ",p.setAttribute("hidden",!0),p.setAttribute("selected",!0),r.prepend(p),o=()=>{p.remove(),r.removeEventListener("input",o),o=null},r.addEventListener("input",o)}const u=p=>{const y=p?"value":"textContent",{options:v,multiple:x}=r;return x?Array.prototype.filter.call(v,S=>S.selected).map(S=>S[y]):v.selectedIndex===-1?null:v[v.selectedIndex][y]};let d=u(!1);const f=p=>{const y=p.target.options;return Array.prototype.map.call(y,v=>({displayValue:v.textContent,exportValue:v.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",p=>{const y={value(v){o==null||o();const x=v.detail.value,S=new Set(Array.isArray(x)?x:[x]);for(const E of r.options)E.selected=S.has(E.value);e.setValue(t,{value:u(!0)}),d=u(!1)},multipleSelection(v){r.multiple=!0},remove(v){const x=r.options,S=v.detail.remove;x[S].selected=!1,r.remove(S),x.length>0&&Array.prototype.findIndex.call(x,T=>T.selected)===-1&&(x[0].selected=!0),e.setValue(t,{value:u(!0),items:f(v)}),d=u(!1)},clear(v){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),d=u(!1)},insert(v){const{index:x,displayValue:S,exportValue:E}=v.detail.insert,T=r.children[x],N=document.createElement("option");N.textContent=S,N.value=E,T?T.before(N):r.append(N),e.setValue(t,{value:u(!0),items:f(v)}),d=u(!1)},items(v){const{items:x}=v.detail;for(;r.length!==0;)r.remove(0);for(const S of x){const{displayValue:E,exportValue:T}=S,N=document.createElement("option");N.textContent=E,N.value=T,r.append(N)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:u(!0),items:f(v)}),d=u(!1)},indices(v){const x=new Set(v.detail.indices);for(const S of v.target.options)S.selected=x.has(S.index);e.setValue(t,{value:u(!0)}),d=u(!1)},editable(v){v.target.disabled=!v.detail.editable}};this._dispatchEventFromSandbox(y,p)}),r.addEventListener("input",p=>{var x;const y=u(!0),v=u(!1);e.setValue(t,{value:y}),p.preventDefault(),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:d,change:v,changeEx:y,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],p=>p.target.value)):r.addEventListener("input",function(p){e.setValue(t,{value:u(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}var l0,tE;class eE extends Pn{constructor(t){const{data:n,elements:r,parent:s}=t,o=!!s._commentManager;super(t,{isRenderable:!o&&Pn._hasPopupData(n)});R(this,l0);if(this.elements=r,o&&Pn._hasPopupData(n)){const u=this.popup=O(this,l0,tE).call(this);for(const d of r)d.popup=u}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const n=this.popup=O(this,l0,tE).call(this),r=[];for(const s of this.elements)s.popup=n,s.container.ariaHasPopup="dialog",r.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",r.map(s=>`${kf}${s}`).join(",")),this.container}}l0=new WeakSet,tE=function(){return new AM({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var $s,Vc,ex,tx,Dp,Lp,jn,Wo,Wc,Vd,Fp,Bp,Go,Us,ll,cl,Mn,ul,Gc,c0,dl,$p,Wd,Kc,fr,Xc,Tt,qb,nE,rE,sE,Vb,iE,IN,ON,jN,MN,Wb,Gb,oE;class AM{constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:s,contentsObj:o,richText:u,parent:d,rect:f,parentRect:p,open:y,commentManager:v=null}){R(this,Tt);R(this,$s,null);R(this,Vc,O(this,Tt,jN).bind(this));R(this,ex,O(this,Tt,oE).bind(this));R(this,tx,O(this,Tt,Gb).bind(this));R(this,Dp,O(this,Tt,Wb).bind(this));R(this,Lp,null);R(this,jn,null);R(this,Wo,null);R(this,Wc,null);R(this,Vd,null);R(this,Fp,null);R(this,Bp,null);R(this,Go,!1);R(this,Us,null);R(this,ll,null);R(this,cl,null);R(this,Mn,null);R(this,ul,null);R(this,Gc,null);R(this,c0,null);R(this,dl,null);R(this,$p,null);R(this,Wd,null);R(this,Kc,!1);R(this,fr,null);R(this,Xc,null);k(this,jn,e),k(this,$p,r),k(this,Wo,o),k(this,dl,u),k(this,Fp,d),k(this,Lp,t),k(this,c0,f),k(this,Bp,p),k(this,Vd,n),k(this,$s,v),k(this,fr,n[0]),k(this,Wc,ww.toDateObject(s)),this.trigger=n.flatMap(x=>x.getElementsToTriggerPopup()),v||(O(this,Tt,qb).call(this),c(this,jn).hidden=!0,y&&O(this,Tt,Wb).call(this))}renderCommentButton(){if(c(this,Mn)){c(this,Mn).parentNode||c(this,fr).container.after(c(this,Mn));return}if(c(this,ul)||O(this,Tt,nE).call(this),!c(this,ul))return;const{signal:e}=k(this,ll,new AbortController),t=c(this,fr).hasOwnCommentButton,n=()=>{c(this,$s).toggleCommentPopup(this,!0,void 0,!t)},r=()=>{c(this,$s).toggleCommentPopup(this,!1,!0,!t)},s=()=>{c(this,$s).toggleCommentPopup(this,!1,!1)};if(t){k(this,Mn,c(this,fr).container);for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",c(this,Vc),{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",r,{signal:e}),o.addEventListener("pointerleave",s,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=k(this,Mn,document.createElement("button"));o.className="annotationCommentButton";const u=c(this,fr).container;o.style.zIndex=u.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),O(this,Tt,sE).call(this),O(this,Tt,rE).call(this),o.addEventListener("keydown",c(this,Vc),{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",r,{signal:e}),o.addEventListener("pointerleave",s,{signal:e}),u.after(o)}}get commentButtonColor(){const{color:e,opacity:t}=c(this,fr).commentData;return e?c(this,Fp)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=c(this,Mn))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:n,creationDate:r,modificationDate:s}=c(this,fr).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:n,creationDate:r,modificationDate:s}}get elementBeforePopup(){return c(this,Mn)}get comment(){return c(this,Xc)||k(this,Xc,c(this,fr).commentText),c(this,Xc)}set comment(e){e!==this.comment&&(c(this,fr).commentText=k(this,Xc,e))}focus(){var e;(e=c(this,fr).container)==null||e.focus()}get parentBoundingClientRect(){return c(this,fr).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){c(this,Mn)&&(c(this,Mn).classList.toggle("selected",e),c(this,Mn).ariaExpanded=t)}setSelectedCommentButton(e){c(this,Mn).classList.toggle("selected",e)}get commentPopupPosition(){if(c(this,Gc))return c(this,Gc);const{x:e,y:t,height:n}=c(this,Mn).getBoundingClientRect(),{x:r,y:s,width:o,height:u}=c(this,fr).layer.getBoundingClientRect();return[(e-r)/o,(t+n-s)/u]}set commentPopupPosition(e){k(this,Gc,e)}hasDefaultPopupPosition(){return c(this,Gc)===null}get commentButtonPosition(){return c(this,ul)}get commentButtonWidth(){return c(this,Mn).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,n]=c(this,Gc)||this.commentButtonPosition.map(f=>f/100),r=this.parentBoundingClientRect,{x:s,y:o,width:u,height:d}=r;c(this,$s).showDialog(null,this,s+t*u,o+n*d,{...e,parentDimensions:r})}render(){var n,r;if(c(this,Us))return;const e=k(this,Us,document.createElement("div"));if(e.className="popup",c(this,Lp)){const s=e.style.outlineColor=Ze.makeHexColor(...c(this,Lp));e.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const t=document.createElement("span");if(t.className="header",(n=c(this,$p))!=null&&n.str){const s=document.createElement("span");s.className="title",t.append(s),{dir:s.dir,str:s.textContent}=c(this,$p)}if(e.append(t),c(this,Wc)){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:c(this,Wc).valueOf()})),s.dateTime=c(this,Wc).toISOString(),t.append(s)}ST({html:c(this,Tt,Vb)||c(this,Wo).str,dir:(r=c(this,Wo))==null?void 0:r.dir,className:"popupContent"},e),c(this,jn).append(e)}updateEdited({rect:e,popup:t,deleted:n}){var r;if(c(this,$s)){n?(this.remove(),k(this,Xc,null)):t&&(t.deleted?this.remove():(O(this,Tt,sE).call(this),k(this,Xc,t.text))),e&&(k(this,ul,null),O(this,Tt,nE).call(this),O(this,Tt,rE).call(this));return}if(n||t!=null&&t.deleted){this.remove();return}O(this,Tt,qb).call(this),c(this,Wd)||k(this,Wd,{contentsObj:c(this,Wo),richText:c(this,dl)}),e&&k(this,cl,null),t&&t.text&&(k(this,dl,O(this,Tt,ON).call(this,t.text)),k(this,Wc,ww.toDateObject(t.date)),k(this,Wo,null)),(r=c(this,Us))==null||r.remove(),k(this,Us,null)}resetEdited(){var e;c(this,Wd)&&({contentsObj:er(this,Wo)._,richText:er(this,dl)._}=c(this,Wd),k(this,Wd,null),(e=c(this,Us))==null||e.remove(),k(this,Us,null),k(this,cl,null))}remove(){var e,t,n;if((e=c(this,ll))==null||e.abort(),k(this,ll,null),(t=c(this,Us))==null||t.remove(),k(this,Us,null),k(this,Kc,!1),k(this,Go,!1),(n=c(this,Mn))==null||n.remove(),k(this,Mn,null),this.trigger)for(const r of this.trigger)r.classList.remove("popupTriggerArea")}forceHide(){k(this,Kc,this.isVisible),c(this,Kc)&&(c(this,jn).hidden=!0)}maybeShow(){c(this,$s)||(O(this,Tt,qb).call(this),c(this,Kc)&&(c(this,Us)||O(this,Tt,Gb).call(this),k(this,Kc,!1),c(this,jn).hidden=!1))}get isVisible(){return c(this,$s)?!1:c(this,jn).hidden===!1}}$s=new WeakMap,Vc=new WeakMap,ex=new WeakMap,tx=new WeakMap,Dp=new WeakMap,Lp=new WeakMap,jn=new WeakMap,Wo=new WeakMap,Wc=new WeakMap,Vd=new WeakMap,Fp=new WeakMap,Bp=new WeakMap,Go=new WeakMap,Us=new WeakMap,ll=new WeakMap,cl=new WeakMap,Mn=new WeakMap,ul=new WeakMap,Gc=new WeakMap,c0=new WeakMap,dl=new WeakMap,$p=new WeakMap,Wd=new WeakMap,Kc=new WeakMap,fr=new WeakMap,Xc=new WeakMap,Tt=new WeakSet,qb=function(){var t;if(c(this,ll))return;k(this,ll,new AbortController);const{signal:e}=c(this,ll);for(const n of this.trigger)n.addEventListener("click",c(this,Dp),{signal:e}),n.addEventListener("pointerenter",c(this,tx),{signal:e}),n.addEventListener("pointerleave",c(this,ex),{signal:e}),n.classList.add("popupTriggerArea");for(const n of c(this,Vd))(t=n.container)==null||t.addEventListener("keydown",c(this,Vc),{signal:e})},nE=function(){const e=c(this,Vd).find(t=>t.hasCommentButton);e&&k(this,ul,e._normalizePoint(e.commentButtonPosition))},rE=function(){if(c(this,fr).extraPopupElement&&!c(this,fr).editor)return;c(this,Mn)||this.renderCommentButton();const[e,t]=c(this,ul),{style:n}=c(this,Mn);n.left=`calc(${e}%)`,n.top=`calc(${t}% - var(--comment-button-dim))`},sE=function(){c(this,fr).extraPopupElement||(c(this,Mn)||this.renderCommentButton(),c(this,Mn).style.backgroundColor=this.commentButtonColor||"")},Vb=function(){const e=c(this,dl),t=c(this,Wo);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&c(this,dl).html||null},iE=function(){var e,t,n;return((n=(t=(e=c(this,Tt,Vb))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},IN=function(){var e,t,n;return((n=(t=(e=c(this,Tt,Vb))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},ON=function(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:c(this,Tt,IN),fontSize:c(this,Tt,iE)?`calc(${c(this,Tt,iE)}px * var(--total-scale-factor))`:""}};for(const s of e.split(`
`))t.push({name:"span",value:s,attributes:r});return n},jN=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&c(this,Go))&&O(this,Tt,Wb).call(this)},MN=function(){if(c(this,cl)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:s}}}=c(this,Fp);let o=!!c(this,Bp),u=o?c(this,Bp):c(this,c0);for(const S of c(this,Vd))if(!u||Ze.intersect(S.data.rect,u)!==null){u=S.data.rect,o=!0;break}const d=Ze.normalizeRect([u[0],e[3]-u[1]+e[1],u[2],e[3]-u[3]+e[1]]),p=o?u[2]-u[0]+5:0,y=d[0]+p,v=d[1];k(this,cl,[100*(y-r)/t,100*(v-s)/n]);const{style:x}=c(this,jn);x.left=`${c(this,cl)[0]}%`,x.top=`${c(this,cl)[1]}%`},Wb=function(){if(c(this,$s)){c(this,$s).toggleCommentPopup(this,!1);return}k(this,Go,!c(this,Go)),c(this,Go)?(O(this,Tt,Gb).call(this),c(this,jn).addEventListener("click",c(this,Dp)),c(this,jn).addEventListener("keydown",c(this,Vc))):(O(this,Tt,oE).call(this),c(this,jn).removeEventListener("click",c(this,Dp)),c(this,jn).removeEventListener("keydown",c(this,Vc)))},Gb=function(){c(this,Us)||this.render(),this.isVisible?c(this,Go)&&c(this,jn).classList.add("focused"):(O(this,Tt,MN).call(this),c(this,jn).hidden=!1,c(this,jn).style.zIndex=parseInt(c(this,jn).style.zIndex)+1e3)},oE=function(){c(this,jn).classList.remove("focused"),!(c(this,Go)||!this.isVisible)&&(c(this,jn).hidden=!0,c(this,jn).style.zIndex=parseInt(c(this,jn).style.zIndex)-1e3)};class DN extends Pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Et.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var u0;class kM extends Pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});R(this,u0,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:n,height:r}=this,s=this.svgFactory.create(n,r,!0),o=k(this,u0,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return c(this,u0)}addHighlightArea(){this.container.classList.add("highlightArea")}}u0=new WeakMap;var d0;class CM extends Pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});R(this,d0,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:n,height:r}=this,s=this.svgFactory.create(n,r,!0),o=t.borderStyle.width,u=k(this,d0,this.svgFactory.createElement("svg:rect"));return u.setAttribute("x",o/2),u.setAttribute("y",o/2),u.setAttribute("width",n-o),u.setAttribute("height",r-o),u.setAttribute("stroke-width",o||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),s.append(u),this.container.append(s),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return c(this,d0)}addHighlightArea(){this.container.classList.add("highlightArea")}}d0=new WeakMap;var h0;class TM extends Pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});R(this,h0,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:n,height:r}=this,s=this.svgFactory.create(n,r,!0),o=t.borderStyle.width,u=k(this,h0,this.svgFactory.createElement("svg:ellipse"));return u.setAttribute("cx",n/2),u.setAttribute("cy",r/2),u.setAttribute("rx",n/2-o/2),u.setAttribute("ry",r/2-o/2),u.setAttribute("stroke-width",o||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),s.append(u),this.container.append(s),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return c(this,h0)}addHighlightArea(){this.container.classList.add("highlightArea")}}h0=new WeakMap;var f0;class LN extends Pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});R(this,f0,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:n,borderStyle:r,popupRef:s},width:o,height:u}=this;if(!n)return this.container;const d=this.svgFactory.create(o,u,!0);let f=[];for(let y=0,v=n.length;y<v;y+=2){const x=n[y]-t[0],S=t[3]-n[y+1];f.push(`${x},${S}`)}f=f.join(" ");const p=k(this,f0,this.svgFactory.createElement(this.svgElementName));return p.setAttribute("points",f),p.setAttribute("stroke-width",r.width||1),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),d.append(p),this.container.append(d),!s&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return c(this,f0)}addHighlightArea(){this.container.classList.add("highlightArea")}}f0=new WeakMap;class NM extends LN{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class PM extends Pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}var p0,Gd,g0,aE;class dA extends Pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});R(this,g0);R(this,p0,null);R(this,Gd,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Et.HIGHLIGHT:Et.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:n,inkLists:r,borderStyle:s,popupRef:o}}=this,{transform:u,width:d,height:f}=O(this,g0,aE).call(this,n,t),p=this.svgFactory.create(d,f,!0),y=k(this,p0,this.svgFactory.createElement("svg:g"));p.append(y),y.setAttribute("stroke-width",s.width||1),y.setAttribute("stroke-linecap","round"),y.setAttribute("stroke-linejoin","round"),y.setAttribute("stroke-miterlimit",10),y.setAttribute("stroke","transparent"),y.setAttribute("fill","transparent"),y.setAttribute("transform",u);for(let v=0,x=r.length;v<x;v++){const S=this.svgFactory.createElement(this.svgElementName);c(this,Gd).push(S),S.setAttribute("points",r[v].join(",")),y.append(S)}return!o&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(p),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:n,points:r,rect:s}=t,o=c(this,p0);if(n>=0&&o.setAttribute("stroke-width",n||1),r)for(let u=0,d=c(this,Gd).length;u<d;u++)c(this,Gd)[u].setAttribute("points",r[u].join(","));if(s){const{transform:u,width:d,height:f}=O(this,g0,aE).call(this,this.data.rotation,s);o.parentElement.setAttribute("viewBox",`0 0 ${d} ${f}`),o.setAttribute("transform",u)}}getElementsToTriggerPopup(){return c(this,Gd)}addHighlightArea(){this.container.classList.add("highlightArea")}}p0=new WeakMap,Gd=new WeakMap,g0=new WeakSet,aE=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};class FN extends Pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Et.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class RM extends Pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class IM extends Pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class OM extends Pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class BN extends Pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Et.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var m0,y0,lE;class jM extends Pn{constructor(t){var r;super(t,{isRenderable:!0});R(this,y0);R(this,m0,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,(r=this.linkService.eventBus)==null||r.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:n}=this;let r;n.hasAppearance||n.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),r.addEventListener("dblclick",O(this,y0,lE).bind(this)),k(this,m0,r);const{isMac:s}=Mr.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(s?o.metaKey:o.ctrlKey)&&O(this,y0,lE).call(this)}),!n.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):r.classList.add("popupTriggerArea"),t.append(r),t}getElementsToTriggerPopup(){return c(this,m0)}addHighlightArea(){this.container.classList.add("highlightArea")}}m0=new WeakMap,y0=new WeakSet,lE=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Kd,Xd,Up,Yc,v0,Yd,zs,b0,_l,Kb,uE;const PA=class PA{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:s,viewport:o,structTreeLayer:u,commentManager:d,linkService:f,annotationStorage:p}){R(this,_l);R(this,Kd,null);R(this,Xd,null);R(this,Up,null);R(this,Yc,new Map);R(this,v0,null);R(this,Yd,null);R(this,zs,[]);R(this,b0,!1);this.div=e,k(this,Kd,t),k(this,Xd,n),k(this,v0,u||null),k(this,Yd,f||null),k(this,Up,p||new oA),this.page=s,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=r,this._commentManager=d||null}hasEditableAnnotations(){return c(this,Yc).size>0}async render(e){var u;const{annotations:t}=e,n=this.div;vh(n,this.viewport);const r=new Map,s=[],o={data:null,layer:n,linkService:c(this,Yd),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Tw,annotationStorage:c(this,Up),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const d of t){if(d.noHTML)continue;const f=d.annotationType===qn.POPUP;if(f){const v=r.get(d.id);if(!v)continue;if(!this._commentManager){s.push(d);continue}o.elements=v}else if(d.rect[2]===d.rect[0]||d.rect[3]===d.rect[1])continue;o.data=d;const p=J_.create(o);if(!p.isRenderable)continue;if(!f&&(c(this,zs).push(p),d.popupRef)){const v=r.get(d.popupRef);v?v.push(p):r.set(d.popupRef,[p])}const y=p.render();d.hidden&&(y.style.visibility="hidden"),p._isEditable&&(c(this,Yc).set(p.data.id,p),(u=this._annotationEditorUIManager)==null||u.renderAnnotationElement(p))}await O(this,_l,Kb).call(this);for(const d of s){const f=o.elements=r.get(d.id);o.data=d;const p=J_.create(o);if(!p.isRenderable)continue;const y=p.render();p.contentElement.id=`${kf}${d.id}`,d.hidden&&(y.style.visibility="hidden"),f.at(-1).container.after(y)}O(this,_l,uE).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:c(this,Yd),svgFactory:new Tw,parent:this};for(const n of e){n.borderStyle||(n.borderStyle=PA._defaultBorderStyle),t.data=n;const r=J_.create(t);r.isRenderable&&(r.render(),r.contentElement.id=`${kf}${n.id}`,c(this,zs).push(r))}await O(this,_l,Kb).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,vh(t,{rotation:e.rotation}),O(this,_l,uE).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(c(this,Yc).values())}getEditableAnnotation(e){return c(this,Yc).get(e)}addFakeAnnotation(e){const{div:t}=this,{id:n,rotation:r}=e,s=new vM({data:{id:n,rect:e.getPDFRect(),rotation:r},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:c(this,Yd),annotationStorage:c(this,Up)});return s.render(),s.contentElement.id=`${kf}${n}`,s.createOrUpdatePopup(),c(this,zs).push(s),s}removeAnnotation(e){var r;const t=c(this,zs).findIndex(s=>s.data.id===e);if(t<0)return;const[n]=c(this,zs).splice(t,1);(r=c(this,Kd))==null||r.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);O(this,_l,Kb).call(this)}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return xt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:gf.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};Kd=new WeakMap,Xd=new WeakMap,Up=new WeakMap,Yc=new WeakMap,v0=new WeakMap,Yd=new WeakMap,zs=new WeakMap,b0=new WeakMap,_l=new WeakSet,Kb=async function(){var n,r,s;if(c(this,zs).length===0)return;this.div.replaceChildren();const e=[];if(!c(this,b0)){k(this,b0,!0);for(const{contentElement:o,data:{id:u}}of c(this,zs)){const d=o.id=`${kf}${u}`;e.push((n=c(this,v0))==null?void 0:n.getAriaAttributes(d).then(f=>{if(f)for(const[p,y]of f)o.setAttribute(p,y)}))}}c(this,zs).sort(({data:{rect:[o,u,d,f]}},{data:{rect:[p,y,v,x]}})=>{if(o===d&&u===f)return 1;if(p===v&&y===x)return-1;const S=f,E=u,T=(u+f)/2,N=x,L=y,j=(y+x)/2;if(T>=N&&j<=E)return-1;if(j>=S&&T<=L)return 1;const F=(o+d)/2,B=(p+v)/2;return F-B});const t=document.createDocumentFragment();for(const o of c(this,zs))t.append(o.container),this._commentManager?(s=((r=o.extraPopupElement)==null?void 0:r.popup)||o.popup)==null||s.renderCommentButton():o.extraPopupElement&&t.append(o.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),c(this,Kd))for(const o of c(this,zs))c(this,Kd).addPointerInTextLayer(o.contentElement,!1)},uE=function(){var t;if(!c(this,Xd))return;const e=this.div;for(const[n,r]of c(this,Xd)){const s=e.querySelector(`[data-annotation-id="${n}"]`);if(!s)continue;r.className="annotationContent";const{firstChild:o}=s;o?o.nodeName==="CANVAS"?o.replaceWith(r):o.classList.contains("annotationContent")?o.after(r):o.before(r):s.append(r);const u=c(this,Yc).get(n);u&&(u._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(n,s.id,r),u._hasNoCanvas=!1):u.canvas=r)}c(this,Xd).clear()};let cE=PA;const gb=/\r\n?|\n/g;var Hs,w0,Jd,qs,Kn,$N,UN,zN,Xb,Sl,Yb,Jb,HN,hE,qN;const yn=class yn extends fn{constructor(t){super({...t,name:"freeTextEditor"});R(this,Kn);R(this,Hs,"");R(this,w0,`${this.id}-editor`);R(this,Jd,null);R(this,qs);Re(this,"_colorPicker",null);this.color=t.color||yn._defaultColor||fn._defaultLineColor,k(this,qs,t.fontSize||yn._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static get _keyboardManager(){const t=yn.prototype,n=o=>o.isEmpty(),r=bh.TRANSLATE_SMALL,s=bh.TRANSLATE_BIG;return xt(this,"_keyboardManager",new q0([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:n}]]))}static initialize(t,n){fn.initialize(t,n);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case Dt.FREETEXT_SIZE:yn._defaultFontSize=n;break;case Dt.FREETEXT_COLOR:yn._defaultColor=n;break}}updateParams(t,n){switch(t){case Dt.FREETEXT_SIZE:O(this,Kn,$N).call(this,n);break;case Dt.FREETEXT_COLOR:O(this,Kn,UN).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Dt.FREETEXT_SIZE,yn._defaultFontSize],[Dt.FREETEXT_COLOR,yn._defaultColor||fn._defaultLineColor]]}get propertiesToUpdate(){return[[Dt.FREETEXT_SIZE,c(this,qs)],[Dt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new Cw(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Dt.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){const t=this.parentScale;return[-yn._internalPadding*t,-(yn._internalPadding+c(this,qs))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),k(this,Jd,new AbortController);const t=this._uiManager.combinedSignal(c(this,Jd));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",c(this,w0)),this._isDraggable=!0,(t=c(this,Jd))==null||t.abort(),k(this,Jd,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=c(this,Hs),n=k(this,Hs,O(this,Kn,zN).call(this).trimEnd());if(t===n)return;const r=s=>{if(k(this,Hs,s),!s){this.remove();return}O(this,Kn,Jb).call(this),this._uiManager.rebuild(this),O(this,Kn,Xb).call(this)};this.addCommands({cmd:()=>{r(n)},undo:()=>{r(t)},mustExec:!1}),O(this,Kn,Xb).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){yn._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,n;(this._isCopy||this.annotationElementId)&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",c(this,w0)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${c(this,qs)}px * var(--total-scale-factor))`,r.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[s,o]=this.parentDimensions;if(this.annotationElementId){const{position:u}=this._initialData;let[d,f]=this.getInitialTranslation();[d,f]=this.pageTranslationToScreen(d,f);const[p,y]=this.pageDimensions,[v,x]=this.pageTranslation;let S,E;switch(this.rotation){case 0:S=t+(u[0]-v)/p,E=n+this.height-(u[1]-x)/y;break;case 90:S=t+(u[0]-v)/p,E=n-(u[1]-x)/y,[d,f]=[f,-d];break;case 180:S=t-this.width+(u[0]-v)/p,E=n-(u[1]-x)/y,[d,f]=[-d,-f];break;case 270:S=t+(u[0]-v-this.height*y)/p,E=n+(u[1]-x-this.width*p)/y,[d,f]=[-f,d];break}this.setAt(S*s,E*o,d,f)}else this._moveAfterPaste(t,n);O(this,Kn,Jb).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var S,E,T;const n=t.clipboardData||window.clipboardData,{types:r}=n;if(r.length===1&&r[0]==="text/plain")return;t.preventDefault();const s=O(S=yn,Sl,hE).call(S,n.getData("text")||"").replaceAll(gb,`
`);if(!s)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const u=o.getRangeAt(0);if(!s.includes(`
`)){u.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:d,startOffset:f}=u,p=[],y=[];if(d.nodeType===Node.TEXT_NODE){const N=d.parentElement;if(y.push(d.nodeValue.slice(f).replaceAll(gb,"")),N!==this.editorDiv){let L=p;for(const j of this.editorDiv.childNodes){if(j===N){L=y;continue}L.push(O(E=yn,Sl,Yb).call(E,j))}}p.push(d.nodeValue.slice(0,f).replaceAll(gb,""))}else if(d===this.editorDiv){let N=p,L=0;for(const j of this.editorDiv.childNodes)L++===f&&(N=y),N.push(O(T=yn,Sl,Yb).call(T,j))}k(this,Hs,`${p.join(`
`)}${s}${y.join(`
`)}`),O(this,Kn,Jb).call(this);const v=new Range;let x=Math.sumPrecise(p.map(N=>N.length));for(const{firstChild:N}of this.editorDiv.childNodes)if(N.nodeType===Node.TEXT_NODE){const L=N.nodeValue.length;if(x<=L){v.setStart(N,x),v.setEnd(N,x);break}x-=L}o.removeAllRanges(),o.addRange(v)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=yn._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,n,r){var u;let s=null;if(t instanceof DN){const{data:{defaultAppearanceData:{fontSize:d,fontColor:f},rect:p,rotation:y,id:v,popupRef:x,richText:S,contentsObj:E,creationDate:T,modificationDate:N},textContent:L,textPosition:j,parent:{page:{pageNumber:F}}}=t;if(!L||L.length===0)return null;s=t={annotationType:Et.FREETEXT,color:Array.from(f),fontSize:d,value:L.join(`
`),position:j,pageIndex:F-1,rect:p.slice(0),rotation:y,annotationElementId:v,id:v,deleted:!1,popupRef:x,comment:(E==null?void 0:E.str)||null,richText:S,creationDate:T,modificationDate:N}}const o=await super.deserialize(t,n,r);return k(o,qs,t.fontSize),o.color=Ze.makeHexColor(...t.color),k(o,Hs,O(u=yn,Sl,hE).call(u,t.value)),o._initialData=s,t.comment&&o.setCommentData(t),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=fn._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),r=Object.assign(super.serialize(t),{color:n,fontSize:c(this,qs),value:O(this,Kn,HN).call(this)});return this.addComment(r),t?(r.isCopy=!0,r):this.annotationElementId&&!O(this,Kn,qN).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){const n=super.renderAnnotationElement(t);if(!n)return null;const{style:r}=n;r.fontSize=`calc(${c(this,qs)}px * var(--total-scale-factor))`,r.color=this.color,n.replaceChildren();for(const s of c(this,Hs).split(`
`)){const o=document.createElement("div");o.append(s?document.createTextNode(s):document.createElement("br")),n.append(o)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:c(this,Hs)}}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Hs=new WeakMap,w0=new WeakMap,Jd=new WeakMap,qs=new WeakMap,Kn=new WeakSet,$N=function(t){const n=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-c(this,qs))*this.parentScale),k(this,qs,s),O(this,Kn,Xb).call(this)},r=c(this,qs);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Dt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},UN=function(t){const n=s=>{this.color=s,this.onUpdatedColor()},r=this.color;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Dt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},zN=function(){var r;const t=[];this.editorDiv.normalize();let n=null;for(const s of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(O(r=yn,Sl,Yb).call(r,s)),n=s);return t.join(`
`)},Xb=function(){const[t,n]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:s,div:o}=this,u=o.style.display,d=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",s.div.append(this.div),r=o.getBoundingClientRect(),o.remove(),o.style.display=u,o.classList.toggle("hidden",d)}this.rotation%180===this.parentRotation%180?(this.width=r.width/t,this.height=r.height/n):(this.width=r.height/t,this.height=r.width/n),this.fixAndSetPosition()},Sl=new WeakSet,Yb=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(gb,"")},Jb=function(){if(this.editorDiv.replaceChildren(),!!c(this,Hs))for(const t of c(this,Hs).split(`
`)){const n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},HN=function(){return c(this,Hs).replaceAll(""," ")},hE=function(t){return t.replaceAll(" ","")},qN=function(t){const{value:n,fontSize:r,color:s,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==n||t.fontSize!==r||t.color.some((u,d)=>u!==s[d])||t.pageIndex!==o},R(yn,Sl),Re(yn,"_freeTextDefaultContent",""),Re(yn,"_internalPadding",0),Re(yn,"_defaultColor",null),Re(yn,"_defaultFontSize",10),Re(yn,"_type","freetext"),Re(yn,"_editorType",Et.FREETEXT);let dE=yn;class Je{toSVGPath(){ln("Abstract method `toSVGPath` must be implemented.")}get box(){ln("Abstract getter `box` must be implemented.")}serialize(e,t){ln("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,r,s,o){o||(o=new Float32Array(e.length));for(let u=0,d=e.length;u<d;u+=2)o[u]=t+e[u]*r,o[u+1]=n+e[u+1]*s;return o}static _rescaleAndSwap(e,t,n,r,s,o){o||(o=new Float32Array(e.length));for(let u=0,d=e.length;u<d;u+=2)o[u]=t+e[u+1]*r,o[u+1]=n+e[u]*s;return o}static _translate(e,t,n,r){r||(r=new Float32Array(e.length));for(let s=0,o=e.length;s<o;s+=2)r[s]=t+e[s],r[s+1]=n+e[s+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,r,s){switch(s){case 90:return[1-t/n,e/r];case 180:return[1-e/n,1-t/r];case 270:return[t/n,1-e/r];default:return[e/n,t/r]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,r,s,o){return[(e+5*n)/6,(t+5*r)/6,(5*n+s)/6,(5*r+o)/6,(n+s)/2,(r+o)/2]}}Re(Je,"PRECISION",1e-4);var Vs,eo,zp,Hp,Ko,It,Qd,Zd,x0,_0,qp,Vp,Jc,S0,nx,rx,or,Tm,VN,WN,GN,KN,XN,YN;const Fa=class Fa{constructor({x:e,y:t},n,r,s,o,u=0){R(this,or);R(this,Vs);R(this,eo,[]);R(this,zp);R(this,Hp);R(this,Ko,[]);R(this,It,new Float32Array(18));R(this,Qd);R(this,Zd);R(this,x0);R(this,_0);R(this,qp);R(this,Vp);R(this,Jc,[]);k(this,Vs,n),k(this,Vp,s*r),k(this,Hp,o),c(this,It).set([NaN,NaN,NaN,NaN,e,t],6),k(this,zp,u),k(this,_0,c(Fa,S0)*r),k(this,x0,c(Fa,rx)*r),k(this,qp,r),c(this,Jc).push(e,t)}isEmpty(){return isNaN(c(this,It)[8])}add({x:e,y:t}){var ae;k(this,Qd,e),k(this,Zd,t);const[n,r,s,o]=c(this,Vs);let[u,d,f,p]=c(this,It).subarray(8,12);const y=e-f,v=t-p,x=Math.hypot(y,v);if(x<c(this,x0))return!1;const S=x-c(this,_0),E=S/x,T=E*y,N=E*v;let L=u,j=d;u=f,d=p,f+=T,p+=N,(ae=c(this,Jc))==null||ae.push(e,t);const F=-N/S,B=T/S,$=F*c(this,Vp),H=B*c(this,Vp);return c(this,It).set(c(this,It).subarray(2,8),0),c(this,It).set([f+$,p+H],4),c(this,It).set(c(this,It).subarray(14,18),12),c(this,It).set([f-$,p-H],16),isNaN(c(this,It)[6])?(c(this,Ko).length===0&&(c(this,It).set([u+$,d+H],2),c(this,Ko).push(NaN,NaN,NaN,NaN,(u+$-n)/s,(d+H-r)/o),c(this,It).set([u-$,d-H],14),c(this,eo).push(NaN,NaN,NaN,NaN,(u-$-n)/s,(d-H-r)/o)),c(this,It).set([L,j,u,d,f,p],6),!this.isEmpty()):(c(this,It).set([L,j,u,d,f,p],6),Math.abs(Math.atan2(j-d,L-u)-Math.atan2(N,T))<Math.PI/2?([u,d,f,p]=c(this,It).subarray(2,6),c(this,Ko).push(NaN,NaN,NaN,NaN,((u+f)/2-n)/s,((d+p)/2-r)/o),[u,d,L,j]=c(this,It).subarray(14,18),c(this,eo).push(NaN,NaN,NaN,NaN,((L+u)/2-n)/s,((j+d)/2-r)/o),!0):([L,j,u,d,f,p]=c(this,It).subarray(0,6),c(this,Ko).push(((L+5*u)/6-n)/s,((j+5*d)/6-r)/o,((5*u+f)/6-n)/s,((5*d+p)/6-r)/o,((u+f)/2-n)/s,((d+p)/2-r)/o),[f,p,u,d,L,j]=c(this,It).subarray(12,18),c(this,eo).push(((L+5*u)/6-n)/s,((j+5*d)/6-r)/o,((5*u+f)/6-n)/s,((5*d+p)/6-r)/o,((u+f)/2-n)/s,((d+p)/2-r)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=c(this,Ko),t=c(this,eo);if(isNaN(c(this,It)[6])&&!this.isEmpty())return O(this,or,VN).call(this);const n=[];n.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?n.push(`L${e[r+4]} ${e[r+5]}`):n.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);O(this,or,GN).call(this,n);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?n.push(`L${t[r+4]} ${t[r+5]}`):n.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return O(this,or,WN).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,r,s,o){return new JN(e,t,n,r,s,o)}getOutlines(){var y;const e=c(this,Ko),t=c(this,eo),n=c(this,It),[r,s,o,u]=c(this,Vs),d=new Float32Array((((y=c(this,Jc))==null?void 0:y.length)??0)+2);for(let v=0,x=d.length-2;v<x;v+=2)d[v]=(c(this,Jc)[v]-r)/o,d[v+1]=(c(this,Jc)[v+1]-s)/u;if(d[d.length-2]=(c(this,Qd)-r)/o,d[d.length-1]=(c(this,Zd)-s)/u,isNaN(n[6])&&!this.isEmpty())return O(this,or,KN).call(this,d);const f=new Float32Array(c(this,Ko).length+24+c(this,eo).length);let p=e.length;for(let v=0;v<p;v+=2){if(isNaN(e[v])){f[v]=f[v+1]=NaN;continue}f[v]=e[v],f[v+1]=e[v+1]}p=O(this,or,YN).call(this,f,p);for(let v=t.length-6;v>=6;v-=6)for(let x=0;x<6;x+=2){if(isNaN(t[v+x])){f[p]=f[p+1]=NaN,p+=2;continue}f[p]=t[v+x],f[p+1]=t[v+x+1],p+=2}return O(this,or,XN).call(this,f,p),this.newFreeDrawOutline(f,d,c(this,Vs),c(this,qp),c(this,zp),c(this,Hp))}};Vs=new WeakMap,eo=new WeakMap,zp=new WeakMap,Hp=new WeakMap,Ko=new WeakMap,It=new WeakMap,Qd=new WeakMap,Zd=new WeakMap,x0=new WeakMap,_0=new WeakMap,qp=new WeakMap,Vp=new WeakMap,Jc=new WeakMap,S0=new WeakMap,nx=new WeakMap,rx=new WeakMap,or=new WeakSet,Tm=function(){const e=c(this,It).subarray(4,6),t=c(this,It).subarray(16,18),[n,r,s,o]=c(this,Vs);return[(c(this,Qd)+(e[0]-t[0])/2-n)/s,(c(this,Zd)+(e[1]-t[1])/2-r)/o,(c(this,Qd)+(t[0]-e[0])/2-n)/s,(c(this,Zd)+(t[1]-e[1])/2-r)/o]},VN=function(){const[e,t,n,r]=c(this,Vs),[s,o,u,d]=O(this,or,Tm).call(this);return`M${(c(this,It)[2]-e)/n} ${(c(this,It)[3]-t)/r} L${(c(this,It)[4]-e)/n} ${(c(this,It)[5]-t)/r} L${s} ${o} L${u} ${d} L${(c(this,It)[16]-e)/n} ${(c(this,It)[17]-t)/r} L${(c(this,It)[14]-e)/n} ${(c(this,It)[15]-t)/r} Z`},WN=function(e){const t=c(this,eo);e.push(`L${t[4]} ${t[5]} Z`)},GN=function(e){const[t,n,r,s]=c(this,Vs),o=c(this,It).subarray(4,6),u=c(this,It).subarray(16,18),[d,f,p,y]=O(this,or,Tm).call(this);e.push(`L${(o[0]-t)/r} ${(o[1]-n)/s} L${d} ${f} L${p} ${y} L${(u[0]-t)/r} ${(u[1]-n)/s}`)},KN=function(e){const t=c(this,It),[n,r,s,o]=c(this,Vs),[u,d,f,p]=O(this,or,Tm).call(this),y=new Float32Array(36);return y.set([NaN,NaN,NaN,NaN,(t[2]-n)/s,(t[3]-r)/o,NaN,NaN,NaN,NaN,(t[4]-n)/s,(t[5]-r)/o,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(t[16]-n)/s,(t[17]-r)/o,NaN,NaN,NaN,NaN,(t[14]-n)/s,(t[15]-r)/o],0),this.newFreeDrawOutline(y,e,c(this,Vs),c(this,qp),c(this,zp),c(this,Hp))},XN=function(e,t){const n=c(this,eo);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},YN=function(e,t){const n=c(this,It).subarray(4,6),r=c(this,It).subarray(16,18),[s,o,u,d]=c(this,Vs),[f,p,y,v]=O(this,or,Tm).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-s)/u,(n[1]-o)/d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,y,v,NaN,NaN,NaN,NaN,(r[0]-s)/u,(r[1]-o)/d],t),t+=24},R(Fa,S0,8),R(Fa,nx,2),R(Fa,rx,c(Fa,S0)+c(Fa,nx));let Nw=Fa;var Wp,eh,hl,E0,Ws,A0,$n,sx,QN;class JN extends Je{constructor(t,n,r,s,o,u){super();R(this,sx);R(this,Wp);R(this,eh,new Float32Array(4));R(this,hl);R(this,E0);R(this,Ws);R(this,A0);R(this,$n);k(this,$n,t),k(this,Ws,n),k(this,Wp,r),k(this,A0,s),k(this,hl,o),k(this,E0,u),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],O(this,sx,QN).call(this,u);const[d,f,p,y]=c(this,eh);for(let v=0,x=t.length;v<x;v+=2)t[v]=(t[v]-d)/p,t[v+1]=(t[v+1]-f)/y;for(let v=0,x=n.length;v<x;v+=2)n[v]=(n[v]-d)/p,n[v+1]=(n[v+1]-f)/y}toSVGPath(){const t=[`M${c(this,$n)[4]} ${c(this,$n)[5]}`];for(let n=6,r=c(this,$n).length;n<r;n+=6){if(isNaN(c(this,$n)[n])){t.push(`L${c(this,$n)[n+4]} ${c(this,$n)[n+5]}`);continue}t.push(`C${c(this,$n)[n]} ${c(this,$n)[n+1]} ${c(this,$n)[n+2]} ${c(this,$n)[n+3]} ${c(this,$n)[n+4]} ${c(this,$n)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,r,s],o){const u=r-t,d=s-n;let f,p;switch(o){case 0:f=Je._rescale(c(this,$n),t,s,u,-d),p=Je._rescale(c(this,Ws),t,s,u,-d);break;case 90:f=Je._rescaleAndSwap(c(this,$n),t,n,u,d),p=Je._rescaleAndSwap(c(this,Ws),t,n,u,d);break;case 180:f=Je._rescale(c(this,$n),r,n,-u,d),p=Je._rescale(c(this,Ws),r,n,-u,d);break;case 270:f=Je._rescaleAndSwap(c(this,$n),r,s,-u,-d),p=Je._rescaleAndSwap(c(this,Ws),r,s,-u,-d);break}return{outline:Array.from(f),points:[Array.from(p)]}}get box(){return c(this,eh)}newOutliner(t,n,r,s,o,u=0){return new Nw(t,n,r,s,o,u)}getNewOutline(t,n){const[r,s,o,u]=c(this,eh),[d,f,p,y]=c(this,Wp),v=o*p,x=u*y,S=r*p+d,E=s*y+f,T=this.newOutliner({x:c(this,Ws)[0]*v+S,y:c(this,Ws)[1]*x+E},c(this,Wp),c(this,A0),t,c(this,E0),n??c(this,hl));for(let N=2;N<c(this,Ws).length;N+=2)T.add({x:c(this,Ws)[N]*v+S,y:c(this,Ws)[N+1]*x+E});return T.getOutlines()}}Wp=new WeakMap,eh=new WeakMap,hl=new WeakMap,E0=new WeakMap,Ws=new WeakMap,A0=new WeakMap,$n=new WeakMap,sx=new WeakSet,QN=function(t){const n=c(this,$n);let r=n[4],s=n[5];const o=[r,s,r,s];let u=r,d=s,f=r,p=s;const y=t?Math.max:Math.min,v=new Float32Array(4);for(let S=6,E=n.length;S<E;S+=6){const T=n[S+4],N=n[S+5];isNaN(n[S])?(Ze.pointBoundingBox(T,N,o),d>N?(u=T,d=N):d===N&&(u=y(u,T)),p<N?(f=T,p=N):p===N&&(f=y(f,T))):(v[0]=v[1]=1/0,v[2]=v[3]=-1/0,Ze.bezierBoundingBox(r,s,...n.slice(S,S+6),v),Ze.rectBoundingBox(v[0],v[1],v[2],v[3],o),d>v[1]?(u=v[0],d=v[1]):d===v[1]&&(u=y(u,v[0])),p<v[3]?(f=v[2],p=v[3]):p===v[3]&&(f=y(f,v[2]))),r=T,s=N}const x=c(this,eh);x[0]=o[0]-c(this,hl),x[1]=o[1]-c(this,hl),x[2]=o[2]-o[0]+2*c(this,hl),x[3]=o[3]-o[1]+2*c(this,hl),this.firstPoint=[u,d],this.lastPoint=[f,p]};var k0,C0,T0,Qc,to,us,ZN,Qb,eP,tP,pE;class fE{constructor(e,t=0,n=0,r=!0){R(this,us);R(this,k0);R(this,C0);R(this,T0);R(this,Qc,[]);R(this,to,[]);const s=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:E,y:T,width:N,height:L}of e){const j=Math.floor((E-t)/o)*o,F=Math.ceil((E+N+t)/o)*o,B=Math.floor((T-t)/o)*o,$=Math.ceil((T+L+t)/o)*o,H=[j,B,$,!0],W=[F,B,$,!1];c(this,Qc).push(H,W),Ze.rectBoundingBox(j,B,F,$,s)}const u=s[2]-s[0]+2*n,d=s[3]-s[1]+2*n,f=s[0]-n,p=s[1]-n;let y=r?-1/0:1/0,v=1/0;const x=c(this,Qc).at(r?-1:-2),S=[x[0],x[2]];for(const E of c(this,Qc)){const[T,N,L,j]=E;!j&&r?N<v?(v=N,y=T):N===v&&(y=Math.max(y,T)):j&&!r&&(N<v?(v=N,y=T):N===v&&(y=Math.min(y,T))),E[0]=(T-f)/u,E[1]=(N-p)/d,E[2]=(L-p)/d}k(this,k0,new Float32Array([f,p,u,d])),k(this,C0,[y,v]),k(this,T0,S)}getOutlines(){c(this,Qc).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of c(this,Qc))t[3]?(e.push(...O(this,us,pE).call(this,t)),O(this,us,eP).call(this,t)):(O(this,us,tP).call(this,t),e.push(...O(this,us,pE).call(this,t)));return O(this,us,ZN).call(this,e)}}k0=new WeakMap,C0=new WeakMap,T0=new WeakMap,Qc=new WeakMap,to=new WeakMap,us=new WeakSet,ZN=function(e){const t=[],n=new Set;for(const o of e){const[u,d,f]=o;t.push([u,d,o],[u,f,o])}t.sort((o,u)=>o[1]-u[1]||o[0]-u[0]);for(let o=0,u=t.length;o<u;o+=2){const d=t[o][2],f=t[o+1][2];d.push(f),f.push(d),n.add(d),n.add(f)}const r=[];let s;for(;n.size>0;){const o=n.values().next().value;let[u,d,f,p,y]=o;n.delete(o);let v=u,x=d;for(s=[u,f],r.push(s);;){let S;if(n.has(p))S=p;else if(n.has(y))S=y;else break;n.delete(S),[u,d,f,p,y]=S,v!==u&&(s.push(v,x,u,x===d?d:f),v=u),x=x===d?f:d}s.push(v,x)}return new MM(r,c(this,k0),c(this,C0),c(this,T0))},Qb=function(e){const t=c(this,to);let n=0,r=t.length-1;for(;n<=r;){const s=n+r>>1,o=t[s][0];if(o===e)return s;o<e?n=s+1:r=s-1}return r+1},eP=function([,e,t]){const n=O(this,us,Qb).call(this,e);c(this,to).splice(n,0,[e,t])},tP=function([,e,t]){const n=O(this,us,Qb).call(this,e);for(let r=n;r<c(this,to).length;r++){const[s,o]=c(this,to)[r];if(s!==e)break;if(s===e&&o===t){c(this,to).splice(r,1);return}}for(let r=n-1;r>=0;r--){const[s,o]=c(this,to)[r];if(s!==e)break;if(s===e&&o===t){c(this,to).splice(r,1);return}}},pE=function(e){const[t,n,r]=e,s=[[t,n,r]],o=O(this,us,Qb).call(this,r);for(let u=0;u<o;u++){const[d,f]=c(this,to)[u];for(let p=0,y=s.length;p<y;p++){const[,v,x]=s[p];if(!(f<=v||x<=d)){if(v>=d){if(x>f)s[p][1]=f;else{if(y===1)return[];s.splice(p,1),p--,y--}continue}s[p][2]=d,x>f&&s.push([t,f,x])}}}return s};var N0,Gp;class MM extends Je{constructor(t,n,r,s){super();R(this,N0);R(this,Gp);k(this,Gp,t),k(this,N0,n),this.firstPoint=r,this.lastPoint=s}toSVGPath(){const t=[];for(const n of c(this,Gp)){let[r,s]=n;t.push(`M${r} ${s}`);for(let o=2;o<n.length;o+=2){const u=n[o],d=n[o+1];u===r?(t.push(`V${d}`),s=d):d===s&&(t.push(`H${u}`),r=u)}t.push("Z")}return t.join(" ")}serialize([t,n,r,s],o){const u=[],d=r-t,f=s-n;for(const p of c(this,Gp)){const y=new Array(p.length);for(let v=0;v<p.length;v+=2)y[v]=t+p[v]*d,y[v+1]=s-p[v+1]*f;u.push(y)}return u}get box(){return c(this,N0)}get classNamesForOutlining(){return["highlightOutline"]}}N0=new WeakMap,Gp=new WeakMap;class gE extends Nw{newFreeDrawOutline(e,t,n,r,s,o){return new DM(e,t,n,r,s,o)}}class DM extends JN{newOutliner(e,t,n,r,s,o=0){return new gE(e,t,n,r,s,o)}}var Kp,P0,fl,th,R0,As,I0,O0,nh,Gs,Ks,Pr,Xp,Yp,Xr,Jp,Si,j0,Ct,mE,Zb,nP,rP,sP,yE,Vu,ki,xf,iP,ew,tw,oP,aP,lP,cP,uP;const Vt=class Vt extends fn{constructor(t){super({...t,name:"highlightEditor"});R(this,Ct);R(this,Kp,null);R(this,P0,0);R(this,fl);R(this,th,null);R(this,R0,null);R(this,As,null);R(this,I0,null);R(this,O0,0);R(this,nh,null);R(this,Gs,null);R(this,Ks,null);R(this,Pr,!1);R(this,Xp,null);R(this,Yp,null);R(this,Xr,null);R(this,Jp,"");R(this,Si);R(this,j0,"");this.color=t.color||Vt._defaultColor,k(this,Si,t.thickness||Vt._defaultThickness),this.opacity=t.opacity||Vt._defaultOpacity,k(this,fl,t.boxes||null),k(this,j0,t.methodOfCreation||""),k(this,Jp,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(k(this,Pr,!0),O(this,Ct,Zb).call(this,t),O(this,Ct,Vu).call(this)):c(this,fl)&&(k(this,Kp,t.anchorNode),k(this,P0,t.anchorOffset),k(this,I0,t.focusNode),k(this,O0,t.focusOffset),O(this,Ct,mE).call(this),O(this,Ct,Vu).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=Vt.prototype;return xt(this,"_keyboardManager",new q0([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:c(this,Pr)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:c(this,Si),methodOfCreation:c(this,j0)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var r;fn.initialize(t,n),Vt._defaultColor||(Vt._defaultColor=((r=n.highlightColors)==null?void 0:r.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case Dt.HIGHLIGHT_COLOR:Vt._defaultColor=n;break;case Dt.HIGHLIGHT_THICKNESS:Vt._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return c(this,Yp)}get commentButtonPosition(){return c(this,Xp)}updateParams(t,n){switch(t){case Dt.HIGHLIGHT_COLOR:O(this,Ct,nP).call(this,n);break;case Dt.HIGHLIGHT_THICKNESS:O(this,Ct,rP).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Dt.HIGHLIGHT_COLOR,Vt._defaultColor],[Dt.HIGHLIGHT_THICKNESS,Vt._defaultThickness]]}get propertiesToUpdate(){return[[Dt.HIGHLIGHT_COLOR,this.color||Vt._defaultColor],[Dt.HIGHLIGHT_THICKNESS,c(this,Si)||Vt._defaultThickness],[Dt.HIGHLIGHT_FREE,c(this,Pr)]]}onUpdatedColor(){var t,n;(t=this.parent)==null||t.drawLayer.updateProperties(c(this,Ks),{root:{fill:this.color,"fill-opacity":this.opacity}}),(n=c(this,R0))==null||n.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",k(this,R0,new kw({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(O(this,Ct,tw).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,O(this,Ct,tw).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){O(this,Ct,yE).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(O(this,Ct,Vu).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?O(this,Ct,yE).call(this):t&&(O(this,Ct,Vu).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var s,o,u;const{drawLayer:n}=this.parent;let r;c(this,Pr)?(t=(t-this.rotation+360)%360,r=O(s=Vt,ki,xf).call(s,c(this,Gs).box,t)):r=O(o=Vt,ki,xf).call(o,[this.x,this.y,this.width,this.height],t),n.updateProperties(c(this,Ks),{bbox:r,root:{"data-main-rotation":t}}),n.updateProperties(c(this,Xr),{bbox:O(u=Vt,ki,xf).call(u,c(this,As).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();c(this,Jp)&&(t.setAttribute("aria-label",c(this,Jp)),t.setAttribute("role","mark")),c(this,Pr)?t.classList.add("free"):this.div.addEventListener("keydown",O(this,Ct,iP).bind(this),{signal:this._uiManager._signal});const n=k(this,nh,document.createElement("div"));return t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=c(this,th),this.setDims(),PT(this,c(this,nh),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(c(this,Xr),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(c(this,Xr),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:O(this,Ct,ew).call(this,!0);break;case 1:case 3:O(this,Ct,ew).call(this,!1);break}}select(){var t;super.select(),c(this,Xr)&&((t=this.parent)==null||t.drawLayer.updateProperties(c(this,Xr),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),c(this,Xr)&&((t=this.parent)==null||t.drawLayer.updateProperties(c(this,Xr),{rootClass:{selected:!1}}),c(this,Pr)||O(this,Ct,ew).call(this,!1))}get _mustFixPosition(){return!c(this,Pr)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(c(this,Ks),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(c(this,Xr),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:r,x:s,y:o}){const{x:u,y:d,width:f,height:p}=r.getBoundingClientRect(),y=new AbortController,v=t.combinedSignal(y),x=S=>{y.abort(),O(this,ki,cP).call(this,t,S)};window.addEventListener("blur",x,{signal:v}),window.addEventListener("pointerup",x,{signal:v}),window.addEventListener("pointerdown",Ln,{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",Ti,{signal:v}),r.addEventListener("pointermove",O(this,ki,lP).bind(this,t),{signal:v}),this._freeHighlight=new gE({x:s,y:o},[u,d,f,p],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,r){var E,T,N,L;let s=null;if(t instanceof FN){const{data:{quadPoints:j,rect:F,rotation:B,id:$,color:H,opacity:W,popupRef:ae,richText:me,contentsObj:ne,creationDate:re,modificationDate:xe},parent:{page:{pageNumber:ve}}}=t;s=t={annotationType:Et.HIGHLIGHT,color:Array.from(H),opacity:W,quadPoints:j,boxes:null,pageIndex:ve-1,rect:F.slice(0),rotation:B,annotationElementId:$,id:$,deleted:!1,popupRef:ae,richText:me,comment:(ne==null?void 0:ne.str)||null,creationDate:re,modificationDate:xe}}else if(t instanceof dA){const{data:{inkLists:j,rect:F,rotation:B,id:$,color:H,borderStyle:{rawWidth:W},popupRef:ae,richText:me,contentsObj:ne,creationDate:re,modificationDate:xe},parent:{page:{pageNumber:ve}}}=t;s=t={annotationType:Et.HIGHLIGHT,color:Array.from(H),thickness:W,inkLists:j,boxes:null,pageIndex:ve-1,rect:F.slice(0),rotation:B,annotationElementId:$,id:$,deleted:!1,popupRef:ae,richText:me,comment:(ne==null?void 0:ne.str)||null,creationDate:re,modificationDate:xe}}const{color:o,quadPoints:u,inkLists:d,opacity:f}=t,p=await super.deserialize(t,n,r);p.color=Ze.makeHexColor(...o),p.opacity=f||1,d&&k(p,Si,t.thickness),p._initialData=s,t.comment&&p.setCommentData(t);const[y,v]=p.pageDimensions,[x,S]=p.pageTranslation;if(u){const j=k(p,fl,[]);for(let F=0;F<u.length;F+=8)j.push({x:(u[F]-x)/y,y:1-(u[F+1]-S)/v,width:(u[F+2]-u[F])/y,height:(u[F+1]-u[F+5])/v});O(E=p,Ct,mE).call(E),O(T=p,Ct,Vu).call(T),p.rotate(p.rotation)}else if(d){k(p,Pr,!0);const j=d[0],F={x:j[0]-x,y:v-(j[1]-S)},B=new gE(F,[0,0,y,v],1,c(p,Si)/2,!0,.001);for(let W=0,ae=j.length;W<ae;W+=2)F.x=j[W]-x,F.y=v-(j[W+1]-S),B.add(F);const{id:$,clipPathId:H}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:p.color,"fill-opacity":p._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:B.toSVGPath()}},!0,!0);O(N=p,Ct,Zb).call(N,{highlightOutlines:B.getOutlines(),highlightId:$,clipPathId:H}),O(L=p,Ct,Vu).call(L),p.rotate(p.parentRotation)}return p}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const n=fn._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),r=super.serialize(t);return Object.assign(r,{color:n,opacity:this.opacity,thickness:c(this,Si),quadPoints:O(this,Ct,oP).call(this),outlines:O(this,Ct,aP).call(this,r.rect)}),this.addComment(r),this.annotationElementId&&!O(this,Ct,uP).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};Kp=new WeakMap,P0=new WeakMap,fl=new WeakMap,th=new WeakMap,R0=new WeakMap,As=new WeakMap,I0=new WeakMap,O0=new WeakMap,nh=new WeakMap,Gs=new WeakMap,Ks=new WeakMap,Pr=new WeakMap,Xp=new WeakMap,Yp=new WeakMap,Xr=new WeakMap,Jp=new WeakMap,Si=new WeakMap,j0=new WeakMap,Ct=new WeakSet,mE=function(){const t=new fE(c(this,fl),.001);k(this,Gs,t.getOutlines()),[this.x,this.y,this.width,this.height]=c(this,Gs).box;const n=new fE(c(this,fl),.0025,.001,this._uiManager.direction==="ltr");k(this,As,n.getOutlines());const{firstPoint:r}=c(this,Gs);k(this,Xp,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height]);const{lastPoint:s}=c(this,As);k(this,Yp,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},Zb=function({highlightOutlines:t,highlightId:n,clipPathId:r}){var v,x;if(k(this,Gs,t),k(this,As,t.getNewOutline(c(this,Si)/2+1.5,.0025)),n>=0)k(this,Ks,n),k(this,th,r),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),k(this,Xr,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:c(this,As).box,path:{d:c(this,As).toSVGPath()}},!0));else if(this.parent){const S=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(c(this,Ks),{bbox:O(v=Vt,ki,xf).call(v,c(this,Gs).box,(S-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(c(this,Xr),{bbox:O(x=Vt,ki,xf).call(x,c(this,As).box,S),path:{d:c(this,As).toSVGPath()}})}const[o,u,d,f]=t.box;switch(this.rotation){case 0:this.x=o,this.y=u,this.width=d,this.height=f;break;case 90:{const[S,E]=this.parentDimensions;this.x=u,this.y=1-o,this.width=d*E/S,this.height=f*S/E;break}case 180:this.x=1-o,this.y=1-u,this.width=d,this.height=f;break;case 270:{const[S,E]=this.parentDimensions;this.x=1-u,this.y=o,this.width=d*E/S,this.height=f*S/E;break}}const{firstPoint:p}=t;k(this,Xp,[(p[0]-o)/d,(p[1]-u)/f]);const{lastPoint:y}=c(this,As);k(this,Yp,[(y[0]-o)/d,(y[1]-u)/f])},nP=function(t){const n=(o,u)=>{this.color=o,this.opacity=u,this.onUpdatedColor()},r=this.color,s=this.opacity;this.addCommands({cmd:n.bind(this,t,Vt._defaultOpacity),undo:n.bind(this,r,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Dt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},rP=function(t){const n=c(this,Si),r=s=>{k(this,Si,s),O(this,Ct,sP).call(this,s)};this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Dt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},sP=function(t){c(this,Pr)&&(O(this,Ct,Zb).call(this,{highlightOutlines:c(this,Gs).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())},yE=function(){c(this,Ks)===null||!this.parent||(this.parent.drawLayer.remove(c(this,Ks)),k(this,Ks,null),this.parent.drawLayer.remove(c(this,Xr)),k(this,Xr,null))},Vu=function(t=this.parent){c(this,Ks)===null&&({id:er(this,Ks)._,clipPathId:er(this,th)._}=t.drawLayer.draw({bbox:c(this,Gs).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:c(this,Pr)},path:{d:c(this,Gs).toSVGPath()}},!1,!0),k(this,Xr,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:c(this,Pr)},bbox:c(this,As).box,path:{d:c(this,As).toSVGPath()}},c(this,Pr))),c(this,nh)&&(c(this,nh).style.clipPath=c(this,th)))},ki=new WeakSet,xf=function([t,n,r,s],o){switch(o){case 90:return[1-n-s,t,s,r];case 180:return[1-t-r,1-n-s,r,s];case 270:return[n,1-t-r,s,r]}return[t,n,r,s]},iP=function(t){Vt._keyboardManager.exec(this,t)},ew=function(t){if(!c(this,Kp))return;const n=window.getSelection();t?n.setPosition(c(this,Kp),c(this,P0)):n.setPosition(c(this,I0),c(this,O0))},tw=function(){return c(this,Pr)?this.rotation:0},oP=function(){if(c(this,Pr))return null;const[t,n]=this.pageDimensions,[r,s]=this.pageTranslation,o=c(this,fl),u=new Float32Array(o.length*8);let d=0;for(const{x:f,y:p,width:y,height:v}of o){const x=f*t+r,S=(1-p)*n+s;u[d]=u[d+4]=x,u[d+1]=u[d+3]=S,u[d+2]=u[d+6]=x+y*t,u[d+5]=u[d+7]=S-v*n,d+=8}return u},aP=function(t){return c(this,Gs).serialize(t,O(this,Ct,tw).call(this))},lP=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},cP=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},uP=function(t){const{color:n}=this._initialData;return this.hasEditedComment||t.color.some((r,s)=>r!==n[s])},R(Vt,ki),Re(Vt,"_defaultColor",null),Re(Vt,"_defaultOpacity",1),Re(Vt,"_defaultThickness",12),Re(Vt,"_type","highlight"),Re(Vt,"_editorType",Et.HIGHLIGHT),Re(Vt,"_freeHighlightId",-1),Re(Vt,"_freeHighlight",null),Re(Vt,"_freeHighlightClipId","");let Pw=Vt;var rh;class dP{constructor(){R(this,rh,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){c(this,rh)[e]=t}toSVGProperties(){const e=c(this,rh);return k(this,rh,Object.create(null)),{root:e}}reset(){k(this,rh,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){ln("Not implemented")}}rh=new WeakMap;var Xs,Qp,pr,sh,ih,$t,vE,bE,wE,Nm,hP,nw,Pm,_f;const jt=class jt extends fn{constructor(t){super(t);R(this,$t);R(this,Xs,null);R(this,Qp);Re(this,"_colorPicker",null);Re(this,"_drawId",null);k(this,Qp,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(O(this,$t,vE).call(this,t),O(this,$t,Nm).call(this))}static _mergeSVGProperties(t,n){const r=new Set(Object.keys(t));for(const[s,o]of Object.entries(n))r.has(s)?Object.assign(t[s],o):t[s]=o;return t}static getDefaultDrawingOptions(t){ln("Not implemented")}static get typesMap(){ln("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){const r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,n),this._currentParent&&(c(jt,pr).updateProperty(r,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){const r=this.constructor.typesMap.get(t);r&&this._updateProperty(t,r,n)}static get defaultPropertiesToUpdate(){const t=[],n=this._defaultDrawingOptions;for(const[r,s]of this.typesMap)t.push([r,n[s]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:n}=this;for(const[r,s]of this.constructor.typesMap)t.push([r,n[s]]);return t}_updateProperty(t,n,r){const s=this._drawingOptions,o=s[n],u=d=>{var p;s.updateProperty(n,d);const f=c(this,Xs).updateProperty(n,d);f&&O(this,$t,Pm).call(this,f),(p=this.parent)==null||p.drawLayer.updateProperties(this._drawId,s.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:u.bind(this,r),undo:u.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,jt._mergeSVGProperties(c(this,Xs).getPathResizingSVGProperties(O(this,$t,nw).call(this)),{bbox:O(this,$t,_f).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,jt._mergeSVGProperties(c(this,Xs).getPathResizedSVGProperties(O(this,$t,nw).call(this)),{bbox:O(this,$t,_f).call(this)}))}_onTranslating(t,n){var r;(r=this.parent)==null||r.drawLayer.updateProperties(this._drawId,{bbox:O(this,$t,_f).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,jt._mergeSVGProperties(c(this,Xs).getPathTranslatedSVGProperties(O(this,$t,nw).call(this),this.parentDimensions),{bbox:O(this,$t,_f).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,c(this,Qp)&&(k(this,Qp,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){O(this,$t,wE).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(O(this,$t,Nm).call(this),O(this,$t,Pm).call(this,c(this,Xs).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),O(this,$t,wE).call(this)):t&&(this._uiManager.addShouldRescale(this),O(this,$t,Nm).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,jt._mergeSVGProperties({bbox:O(this,$t,_f).call(this)},c(this,Xs).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&O(this,$t,Pm).call(this,c(this,Xs).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,n;this._isCopy&&(t=this.x,n=this.y);const r=super.render();r.classList.add("draw");const s=document.createElement("div");return r.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,n),r}static createDrawerInstance(t,n,r,s,o){ln("Not implemented")}static startDrawing(t,n,r,s){var T;const{target:o,offsetX:u,offsetY:d,pointerId:f,pointerType:p}=s;if(qr.isInitializedAndDifferentPointerType(p))return;const{viewport:{rotation:y}}=t,{width:v,height:x}=o.getBoundingClientRect(),S=k(jt,sh,new AbortController),E=t.combinedSignal(S);if(qr.setPointer(p,f),window.addEventListener("pointerup",N=>{qr.isSamePointerIdOrRemove(N.pointerId)&&this._endDraw(N)},{signal:E}),window.addEventListener("pointercancel",N=>{qr.isSamePointerIdOrRemove(N.pointerId)&&this._currentParent.endDrawingSession()},{signal:E}),window.addEventListener("pointerdown",N=>{qr.isSamePointerType(N.pointerType)&&(qr.initializeAndAddPointerId(N.pointerId),c(jt,pr).isCancellable()&&(c(jt,pr).removeLastElement(),c(jt,pr).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:E}),window.addEventListener("contextmenu",Ti,{signal:E}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:E}),o.addEventListener("touchmove",N=>{qr.isSameTimeStamp(N.timeStamp)&&Ln(N)},{signal:E}),t.toggleDrawing(),(T=n._editorUndoBar)==null||T.hide(),c(jt,pr)){t.drawLayer.updateProperties(this._currentDrawId,c(jt,pr).startNew(u,d,v,x,y));return}n.updateUIForDefaultProperties(this),k(jt,pr,this.createDrawerInstance(u,d,v,x,y)),k(jt,ih,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(c(jt,ih).toSVGProperties(),c(jt,pr).defaultSVGProperties),!0,!1)}static _drawMove(t){if(qr.isSameTimeStamp(t.timeStamp),!c(jt,pr))return;const{offsetX:n,offsetY:r,pointerId:s}=t;if(qr.isSamePointerId(s)){if(qr.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,c(jt,pr).add(n,r)),qr.setTimeStamp(t.timeStamp),Ln(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,k(jt,pr,null),k(jt,ih,null),qr.clearPointerType(),qr.clearTimeStamp()),c(jt,sh)&&(c(jt,sh).abort(),k(jt,sh,null),qr.clearPointerIds())}static _endDraw(t){const n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===n.div&&n.drawLayer.updateProperties(this._currentDrawId,c(jt,pr).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const r=c(jt,pr),s=this._currentDrawId,o=r.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(s,r.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(s,r.removeLastElement())},mustExec:!1,type:Dt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(Dt.DRAW_STEP),!c(jt,pr).isEmpty()){const{pageDimensions:[r,s],scale:o}=n,u=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:c(jt,pr).getOutlines(r*o,s*o,o,this._INNER_MARGIN),drawingOptions:c(jt,ih),mustBeCommitted:!t});return this._cleanup(!0),u}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,r,s,o,u){ln("Not implemented")}static async deserialize(t,n,r){var y,v;const{rawDims:{pageWidth:s,pageHeight:o,pageX:u,pageY:d}}=n.viewport,f=this.deserializeDraw(u,d,s,o,this._INNER_MARGIN,t),p=await super.deserialize(t,n,r);return p.createDrawingOptions(t),O(y=p,$t,vE).call(y,{drawOutlines:f}),O(v=p,$t,Nm).call(v),p.onScaleChanging(),p.rotate(),p}serializeDraw(t){const[n,r]=this.pageTranslation,[s,o]=this.pageDimensions;return c(this,Xs).serialize([n,r,s,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};Xs=new WeakMap,Qp=new WeakMap,pr=new WeakMap,sh=new WeakMap,ih=new WeakMap,$t=new WeakSet,vE=function({drawOutlines:t,drawId:n,drawingOptions:r}){k(this,Xs,t),this._drawingOptions||(this._drawingOptions=r),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=O(this,$t,bE).call(this,t,this.parent),O(this,$t,Pm).call(this,t.box)},bE=function(t,n){const{id:r}=n.drawLayer.draw(jt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r},wE=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Nm=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=O(this,$t,bE).call(this,c(this,Xs),t)}},hP=function([t,n,r,s]){const{parentDimensions:[o,u],rotation:d}=this;switch(d){case 90:return[n,1-t,r*(u/o),s*(o/u)];case 180:return[1-t,1-n,r,s];case 270:return[1-n,t,r*(u/o),s*(o/u)];default:return[t,n,r,s]}},nw=function(){const{x:t,y:n,width:r,height:s,parentDimensions:[o,u],rotation:d}=this;switch(d){case 90:return[1-n,t,r*(o/u),s*(u/o)];case 180:return[1-t,1-n,r,s];case 270:return[n,1-t,r*(o/u),s*(u/o)];default:return[t,n,r,s]}},Pm=function(t){[this.x,this.y,this.width,this.height]=O(this,$t,hP).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},_f=function(){const{x:t,y:n,width:r,height:s,rotation:o,parentRotation:u,parentDimensions:[d,f]}=this;switch((o*4+u)/90){case 1:return[1-n-s,t,s,r];case 2:return[1-t-r,1-n-s,r,s];case 3:return[n,1-t-r,s,r];case 4:return[t,n-r*(d/f),s*(f/d),r*(d/f)];case 5:return[1-n,t,r*(d/f),s*(f/d)];case 6:return[1-t-s*(f/d),1-n,s*(f/d),r*(d/f)];case 7:return[n-r*(d/f),1-t-s*(f/d),r*(d/f),s*(f/d)];case 8:return[t-r,n-s,r,s];case 9:return[1-n,t-r,s,r];case 10:return[1-t,1-n,r,s];case 11:return[n-s,1-t,s,r];case 12:return[t-s*(f/d),n,s*(f/d),r*(d/f)];case 13:return[1-n-r*(d/f),t-s*(f/d),r*(d/f),s*(f/d)];case 14:return[1-t,1-n-r*(d/f),s*(f/d),r*(d/f)];case 15:return[n,1-t,r*(d/f),s*(f/d)];default:return[t,n,r,s]}},Re(jt,"_currentDrawId",-1),Re(jt,"_currentParent",null),R(jt,pr,null),R(jt,sh,null),R(jt,ih,null),Re(jt,"_INNER_MARGIN",3);let Rw=jt;var Xo,gr,mr,oh,Zp,ss,Rr,Ei,ah,lh,ch,eg,rw;class LM{constructor(e,t,n,r,s,o){R(this,eg);R(this,Xo,new Float64Array(6));R(this,gr);R(this,mr);R(this,oh);R(this,Zp);R(this,ss);R(this,Rr,"");R(this,Ei,0);R(this,ah,new W0);R(this,lh);R(this,ch);k(this,lh,n),k(this,ch,r),k(this,oh,s),k(this,Zp,o),[e,t]=O(this,eg,rw).call(this,e,t);const u=k(this,gr,[NaN,NaN,NaN,NaN,e,t]);k(this,ss,[e,t]),k(this,mr,[{line:u,points:c(this,ss)}]),c(this,Xo).set(u,0)}updateProperty(e,t){e==="stroke-width"&&k(this,Zp,t)}isEmpty(){return!c(this,mr)||c(this,mr).length===0}isCancellable(){return c(this,ss).length<=10}add(e,t){[e,t]=O(this,eg,rw).call(this,e,t);const[n,r,s,o]=c(this,Xo).subarray(2,6),u=e-s,d=t-o;return Math.hypot(c(this,lh)*u,c(this,ch)*d)<=2?null:(c(this,ss).push(e,t),isNaN(n)?(c(this,Xo).set([s,o,e,t],2),c(this,gr).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(c(this,Xo)[0])&&c(this,gr).splice(6,6),c(this,Xo).set([n,r,s,o,e,t],0),c(this,gr).push(...Je.createBezierPoints(n,r,s,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(c(this,ss).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,r,s){k(this,lh,n),k(this,ch,r),k(this,oh,s),[e,t]=O(this,eg,rw).call(this,e,t);const o=k(this,gr,[NaN,NaN,NaN,NaN,e,t]);k(this,ss,[e,t]);const u=c(this,mr).at(-1);return u&&(u.line=new Float32Array(u.line),u.points=new Float32Array(u.points)),c(this,mr).push({line:o,points:c(this,ss)}),c(this,Xo).set(o,0),k(this,Ei,0),this.toSVGPath(),null}getLastElement(){return c(this,mr).at(-1)}setLastElement(e){return c(this,mr)?(c(this,mr).push(e),k(this,gr,e.line),k(this,ss,e.points),k(this,Ei,0),{path:{d:this.toSVGPath()}}):c(this,ah).setLastElement(e)}removeLastElement(){if(!c(this,mr))return c(this,ah).removeLastElement();c(this,mr).pop(),k(this,Rr,"");for(let e=0,t=c(this,mr).length;e<t;e++){const{line:n,points:r}=c(this,mr)[e];k(this,gr,n),k(this,ss,r),k(this,Ei,0),this.toSVGPath()}return{path:{d:c(this,Rr)}}}toSVGPath(){const e=Je.svgRound(c(this,gr)[4]),t=Je.svgRound(c(this,gr)[5]);if(c(this,ss).length===2)return k(this,Rr,`${c(this,Rr)} M ${e} ${t} Z`),c(this,Rr);if(c(this,ss).length<=6){const r=c(this,Rr).lastIndexOf("M");k(this,Rr,`${c(this,Rr).slice(0,r)} M ${e} ${t}`),k(this,Ei,6)}if(c(this,ss).length===4){const r=Je.svgRound(c(this,gr)[10]),s=Je.svgRound(c(this,gr)[11]);return k(this,Rr,`${c(this,Rr)} L ${r} ${s}`),k(this,Ei,12),c(this,Rr)}const n=[];c(this,Ei)===0&&(n.push(`M ${e} ${t}`),k(this,Ei,6));for(let r=c(this,Ei),s=c(this,gr).length;r<s;r+=6){const[o,u,d,f,p,y]=c(this,gr).slice(r,r+6).map(Je.svgRound);n.push(`C${o} ${u} ${d} ${f} ${p} ${y}`)}return k(this,Rr,c(this,Rr)+n.join(" ")),k(this,Ei,c(this,gr).length),c(this,Rr)}getOutlines(e,t,n,r){const s=c(this,mr).at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),c(this,ah).build(c(this,mr),e,t,n,c(this,oh),c(this,Zp),r),k(this,Xo,null),k(this,gr,null),k(this,mr,null),k(this,Rr,null),c(this,ah)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Xo=new WeakMap,gr=new WeakMap,mr=new WeakMap,oh=new WeakMap,Zp=new WeakMap,ss=new WeakMap,Rr=new WeakMap,Ei=new WeakMap,ah=new WeakMap,lh=new WeakMap,ch=new WeakMap,eg=new WeakSet,rw=function(e,t){return Je._normalizePoint(e,t,c(this,lh),c(this,ch),c(this,oh))};var is,M0,D0,Ys,Yo,Jo,tg,ng,uh,Or,Da,fP,pP,gP;class W0 extends Je{constructor(){super(...arguments);R(this,Or);R(this,is);R(this,M0,0);R(this,D0);R(this,Ys);R(this,Yo);R(this,Jo);R(this,tg);R(this,ng);R(this,uh)}build(t,n,r,s,o,u,d){k(this,Yo,n),k(this,Jo,r),k(this,tg,s),k(this,ng,o),k(this,uh,u),k(this,D0,d??0),k(this,Ys,t),O(this,Or,pP).call(this)}get thickness(){return c(this,uh)}setLastElement(t){return c(this,Ys).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return c(this,Ys).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:n}of c(this,Ys)){if(t.push(`M${Je.svgRound(n[4])} ${Je.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12&&isNaN(n[6])){t.push(`L${Je.svgRound(n[10])} ${Je.svgRound(n[11])}`);continue}for(let r=6,s=n.length;r<s;r+=6){const[o,u,d,f,p,y]=n.subarray(r,r+6).map(Je.svgRound);t.push(`C${o} ${u} ${d} ${f} ${p} ${y}`)}}return t.join("")}serialize([t,n,r,s],o){const u=[],d=[],[f,p,y,v]=O(this,Or,fP).call(this);let x,S,E,T,N,L,j,F,B;switch(c(this,ng)){case 0:B=Je._rescale,x=t,S=n+s,E=r,T=-s,N=t+f*r,L=n+(1-p-v)*s,j=t+(f+y)*r,F=n+(1-p)*s;break;case 90:B=Je._rescaleAndSwap,x=t,S=n,E=r,T=s,N=t+p*r,L=n+f*s,j=t+(p+v)*r,F=n+(f+y)*s;break;case 180:B=Je._rescale,x=t+r,S=n,E=-r,T=s,N=t+(1-f-y)*r,L=n+p*s,j=t+(1-f)*r,F=n+(p+v)*s;break;case 270:B=Je._rescaleAndSwap,x=t+r,S=n+s,E=-r,T=-s,N=t+(1-p-v)*r,L=n+(1-f-y)*s,j=t+(1-p)*r,F=n+(1-f)*s;break}for(const{line:$,points:H}of c(this,Ys))u.push(B($,x,S,E,T,o?new Array($.length):null)),d.push(B(H,x,S,E,T,o?new Array(H.length):null));return{lines:u,points:d,rect:[N,L,j,F]}}static deserialize(t,n,r,s,o,{paths:{lines:u,points:d},rotation:f,thickness:p}){const y=[];let v,x,S,E,T;switch(f){case 0:T=Je._rescale,v=-t/r,x=n/s+1,S=1/r,E=-1/s;break;case 90:T=Je._rescaleAndSwap,v=-n/s,x=-t/r,S=1/s,E=1/r;break;case 180:T=Je._rescale,v=t/r+1,x=-n/s,S=-1/r,E=1/s;break;case 270:T=Je._rescaleAndSwap,v=n/s+1,x=t/r+1,S=-1/s,E=-1/r;break}if(!u){u=[];for(const L of d){const j=L.length;if(j===2){u.push(new Float32Array([NaN,NaN,NaN,NaN,L[0],L[1]]));continue}if(j===4){u.push(new Float32Array([NaN,NaN,NaN,NaN,L[0],L[1],NaN,NaN,NaN,NaN,L[2],L[3]]));continue}const F=new Float32Array(3*(j-2));u.push(F);let[B,$,H,W]=L.subarray(0,4);F.set([NaN,NaN,NaN,NaN,B,$],0);for(let ae=4;ae<j;ae+=2){const me=L[ae],ne=L[ae+1];F.set(Je.createBezierPoints(B,$,H,W,me,ne),(ae-2)*3),[B,$,H,W]=[H,W,me,ne]}}}for(let L=0,j=u.length;L<j;L++)y.push({line:T(u[L].map(F=>F??NaN),v,x,S,E),points:T(d[L].map(F=>F??NaN),v,x,S,E)});const N=new this.prototype.constructor;return N.build(y,r,s,1,f,p,o),N}get box(){return c(this,is)}updateProperty(t,n){return t==="stroke-width"?O(this,Or,gP).call(this,n):null}updateParentDimensions([t,n],r){const[s,o]=O(this,Or,Da).call(this);k(this,Yo,t),k(this,Jo,n),k(this,tg,r);const[u,d]=O(this,Or,Da).call(this),f=u-s,p=d-o,y=c(this,is);return y[0]-=f,y[1]-=p,y[2]+=2*f,y[3]+=2*p,y}updateRotation(t){return k(this,M0,t),{path:{transform:this.rotationTransform}}}get viewBox(){return c(this,is).map(Je.svgRound).join(" ")}get defaultProperties(){const[t,n]=c(this,is);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Je.svgRound(t)} ${Je.svgRound(n)}`}}}get rotationTransform(){const[,,t,n]=c(this,is);let r=0,s=0,o=0,u=0,d=0,f=0;switch(c(this,M0)){case 90:s=n/t,o=-t/n,d=t;break;case 180:r=-1,u=-1,d=t,f=n;break;case 270:s=-n/t,o=t/n,f=n;break;default:return""}return`matrix(${r} ${s} ${o} ${u} ${Je.svgRound(d)} ${Je.svgRound(f)})`}getPathResizingSVGProperties([t,n,r,s]){const[o,u]=O(this,Or,Da).call(this),[d,f,p,y]=c(this,is);if(Math.abs(p-o)<=Je.PRECISION||Math.abs(y-u)<=Je.PRECISION){const T=t+r/2-(d+p/2),N=n+s/2-(f+y/2);return{path:{"transform-origin":`${Je.svgRound(t)} ${Je.svgRound(n)}`,transform:`${this.rotationTransform} translate(${T} ${N})`}}}const v=(r-2*o)/(p-2*o),x=(s-2*u)/(y-2*u),S=p/r,E=y/s;return{path:{"transform-origin":`${Je.svgRound(d)} ${Je.svgRound(f)}`,transform:`${this.rotationTransform} scale(${S} ${E}) translate(${Je.svgRound(o)} ${Je.svgRound(u)}) scale(${v} ${x}) translate(${Je.svgRound(-o)} ${Je.svgRound(-u)})`}}}getPathResizedSVGProperties([t,n,r,s]){const[o,u]=O(this,Or,Da).call(this),d=c(this,is),[f,p,y,v]=d;if(d[0]=t,d[1]=n,d[2]=r,d[3]=s,Math.abs(y-o)<=Je.PRECISION||Math.abs(v-u)<=Je.PRECISION){const N=t+r/2-(f+y/2),L=n+s/2-(p+v/2);for(const{line:j,points:F}of c(this,Ys))Je._translate(j,N,L,j),Je._translate(F,N,L,F);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Je.svgRound(t)} ${Je.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const x=(r-2*o)/(y-2*o),S=(s-2*u)/(v-2*u),E=-x*(f+o)+t+o,T=-S*(p+u)+n+u;if(x!==1||S!==1||E!==0||T!==0)for(const{line:N,points:L}of c(this,Ys))Je._rescale(N,E,T,x,S,N),Je._rescale(L,E,T,x,S,L);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Je.svgRound(t)} ${Je.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],r){const[s,o]=r,u=c(this,is),d=t-u[0],f=n-u[1];if(c(this,Yo)===s&&c(this,Jo)===o)for(const{line:p,points:y}of c(this,Ys))Je._translate(p,d,f,p),Je._translate(y,d,f,y);else{const p=c(this,Yo)/s,y=c(this,Jo)/o;k(this,Yo,s),k(this,Jo,o);for(const{line:v,points:x}of c(this,Ys))Je._rescale(v,d,f,p,y,v),Je._rescale(x,d,f,p,y,x);u[2]*=p,u[3]*=y}return u[0]=t,u[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Je.svgRound(t)} ${Je.svgRound(n)}`}}}get defaultSVGProperties(){const t=c(this,is);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Je.svgRound(t[0])} ${Je.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}is=new WeakMap,M0=new WeakMap,D0=new WeakMap,Ys=new WeakMap,Yo=new WeakMap,Jo=new WeakMap,tg=new WeakMap,ng=new WeakMap,uh=new WeakMap,Or=new WeakSet,Da=function(t=c(this,uh)){const n=c(this,D0)+t/2*c(this,tg);return c(this,ng)%180===0?[n/c(this,Yo),n/c(this,Jo)]:[n/c(this,Jo),n/c(this,Yo)]},fP=function(){const[t,n,r,s]=c(this,is),[o,u]=O(this,Or,Da).call(this,0);return[t+o,n+u,r-2*o,s-2*u]},pP=function(){const t=k(this,is,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:s}of c(this,Ys)){if(s.length<=12){for(let d=4,f=s.length;d<f;d+=6)Ze.pointBoundingBox(s[d],s[d+1],t);continue}let o=s[4],u=s[5];for(let d=6,f=s.length;d<f;d+=6){const[p,y,v,x,S,E]=s.subarray(d,d+6);Ze.bezierBoundingBox(o,u,p,y,v,x,S,E,t),o=S,u=E}}const[n,r]=O(this,Or,Da).call(this);t[0]=ls(t[0]-n,0,1),t[1]=ls(t[1]-r,0,1),t[2]=ls(t[2]+n,0,1),t[3]=ls(t[3]+r,0,1),t[2]-=t[0],t[3]-=t[1]},gP=function(t){const[n,r]=O(this,Or,Da).call(this);k(this,uh,t);const[s,o]=O(this,Or,Da).call(this),[u,d]=[s-n,o-r],f=c(this,is);return f[0]-=u,f[1]-=d,f[2]+=2*u,f[3]+=2*d,f};class px extends dP{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:fn._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new px(this._viewParameters);return e.updateAll(this),e}}var ix,mP;const Rf=class Rf extends Rw{constructor(t){super({...t,name:"inkEditor"});R(this,ix);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,n){fn.initialize(t,n),this._defaultDrawingOptions=new px(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return xt(this,"typesMap",new Map([[Dt.INK_THICKNESS,"stroke-width"],[Dt.INK_COLOR,"stroke"],[Dt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,r,s,o){return new LM(t,n,r,s,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,r,s,o,u){return W0.deserialize(t,n,r,s,o,u)}static async deserialize(t,n,r){let s=null;if(t instanceof dA){const{data:{inkLists:u,rect:d,rotation:f,id:p,color:y,opacity:v,borderStyle:{rawWidth:x},popupRef:S,richText:E,contentsObj:T,creationDate:N,modificationDate:L},parent:{page:{pageNumber:j}}}=t;s=t={annotationType:Et.INK,color:Array.from(y),thickness:x,opacity:v,paths:{points:u},boxes:null,pageIndex:j-1,rect:d.slice(0),rotation:f,annotationElementId:p,id:p,deleted:!1,popupRef:S,richText:E,comment:(T==null?void 0:T.str)||null,creationDate:N,modificationDate:L}}const o=await super.deserialize(t,n,r);return o._initialData=s,t.comment&&o.setCommentData(t),o}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new Cw(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Dt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:n,parent:r}=this;n.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:r}){this._drawingOptions=Rf.getDefaultDrawingOptions({stroke:Ze.makeHexColor(...t),"stroke-width":n,"stroke-opacity":r})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:n,points:r}=this.serializeDraw(t),{_drawingOptions:{stroke:s,"stroke-opacity":o,"stroke-width":u}}=this,d=Object.assign(super.serialize(t),{color:fn._colorManager.convert(s),opacity:o,thickness:u,paths:{lines:n,points:r}});return this.addComment(d),t?(d.isCopy=!0,d):this.annotationElementId&&!O(this,ix,mP).call(this,d)?null:(d.id=this.annotationElementId,d)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:n,rect:r}=this.serializeDraw(!1);return t.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:n,popup:this.comment}),null}};ix=new WeakSet,mP=function(t){const{color:n,thickness:r,opacity:s,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((u,d)=>u!==n[d])||t.thickness!==r||t.opacity!==s||t.pageIndex!==o},Re(Rf,"_type","ink"),Re(Rf,"_editorType",Et.INK),Re(Rf,"_defaultDrawingOptions",null);let xE=Rf;class _E extends W0{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const mb=8,am=3;var dh,Kt,SE,no,yP,vP,EE,sw,bP,wP,xP,AE,kE,_P;class bl{static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:r},s,o,u,d){let f=new OffscreenCanvas(1,1),p=f.getContext("2d",{alpha:!1});const y=200,v=p.font=`${n} ${r} ${y}px ${t}`,{actualBoundingBoxLeft:x,actualBoundingBoxRight:S,actualBoundingBoxAscent:E,actualBoundingBoxDescent:T,fontBoundingBoxAscent:N,fontBoundingBoxDescent:L,width:j}=p.measureText(e),F=1.5,B=Math.ceil(Math.max(Math.abs(x)+Math.abs(S)||0,j)*F),$=Math.ceil(Math.max(Math.abs(E)+Math.abs(T)||y,Math.abs(N)+Math.abs(L)||y)*F);f=new OffscreenCanvas(B,$),p=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),p.font=v,p.filter="grayscale(1)",p.fillStyle="white",p.fillRect(0,0,B,$),p.fillStyle="black",p.fillText(e,B*(F-1)/2,$*(3-F)/2);const H=O(this,Kt,AE).call(this,p.getImageData(0,0,B,$).data),W=O(this,Kt,xP).call(this,H),ae=O(this,Kt,kE).call(this,W),me=O(this,Kt,EE).call(this,H,B,$,ae);return this.processDrawnLines({lines:{curves:me,width:B,height:$},pageWidth:s,pageHeight:o,rotation:u,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(e,t,n,r,s){const[o,u,d]=O(this,Kt,_P).call(this,e),[f,p]=O(this,Kt,wP).call(this,o,u,d,Math.hypot(u,d)*c(this,dh).sigmaSFactor,c(this,dh).sigmaR,c(this,dh).kernelSize),y=O(this,Kt,kE).call(this,p),v=O(this,Kt,EE).call(this,f,u,d,y);return this.processDrawnLines({lines:{curves:v,width:u,height:d},pageWidth:t,pageHeight:n,rotation:r,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:s,mustSmooth:o,areContours:u}){r%180!==0&&([t,n]=[n,t]);const{curves:d,width:f,height:p}=e,y=e.thickness??0,v=[],x=Math.min(t/f,n/p),S=x/t,E=x/n,T=[];for(const{points:L}of d){const j=o?O(this,Kt,bP).call(this,L):L;if(!j)continue;T.push(j);const F=j.length,B=new Float32Array(F),$=new Float32Array(3*(F===2?2:F-2));if(v.push({line:$,points:B}),F===2){B[0]=j[0]*S,B[1]=j[1]*E,$.set([NaN,NaN,NaN,NaN,B[0],B[1]],0);continue}let[H,W,ae,me]=j;H*=S,W*=E,ae*=S,me*=E,B.set([H,W,ae,me],0),$.set([NaN,NaN,NaN,NaN,H,W],0);for(let ne=4;ne<F;ne+=2){const re=B[ne]=j[ne]*S,xe=B[ne+1]=j[ne+1]*E;$.set(Je.createBezierPoints(H,W,ae,me,re,xe),(ne-2)*3),[H,W,ae,me]=[ae,me,re,xe]}}if(v.length===0)return null;const N=u?new _E:new W0;return N.build(v,t,n,1,r,u?0:y,s),{outline:N,newCurves:T,areContours:u,thickness:y,width:f,height:p}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:r,height:s}){let o=1/0,u=-1/0,d=0;for(const j of e){d+=j.length;for(let F=2,B=j.length;F<B;F++){const $=j[F]-j[F-2];o=Math.min(o,$),u=Math.max(u,$)}}let f;o>=-128&&u<=127?f=Int8Array:o>=-32768&&u<=32767?f=Int16Array:f=Int32Array;const p=e.length,y=mb+am*p,v=new Uint32Array(y);let x=0;v[x++]=y*Uint32Array.BYTES_PER_ELEMENT+(d-2*p)*f.BYTES_PER_ELEMENT,v[x++]=0,v[x++]=r,v[x++]=s,v[x++]=t?0:1,v[x++]=Math.max(0,Math.floor(n??0)),v[x++]=p,v[x++]=f.BYTES_PER_ELEMENT;for(const j of e)v[x++]=j.length-2,v[x++]=j[0],v[x++]=j[1];const S=new CompressionStream("deflate-raw"),E=S.writable.getWriter();await E.ready,E.write(v);const T=f.prototype.constructor;for(const j of e){const F=new T(j.length-2);for(let B=2,$=j.length;B<$;B++)F[B-2]=j[B]-j[B-2];E.write(F)}E.close();const N=await new Response(S.readable).arrayBuffer(),L=new Uint8Array(N);return xT(L)}static async decompressSignature(e){try{const t=ZO(e),{readable:n,writable:r}=new DecompressionStream("deflate-raw"),s=r.getWriter();await s.ready,s.write(t).then(async()=>{await s.ready,await s.close()}).catch(()=>{});let o=null,u=0;for await(const j of n)o||(o=new Uint8Array(new Uint32Array(j.buffer,0,4)[0])),o.set(j,u),u+=j.length;const d=new Uint32Array(o.buffer,0,o.length>>2),f=d[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const p=d[2],y=d[3],v=d[4]===0,x=d[5],S=d[6],E=d[7],T=[],N=(mb+am*S)*Uint32Array.BYTES_PER_ELEMENT;let L;switch(E){case Int8Array.BYTES_PER_ELEMENT:L=new Int8Array(o.buffer,N);break;case Int16Array.BYTES_PER_ELEMENT:L=new Int16Array(o.buffer,N);break;case Int32Array.BYTES_PER_ELEMENT:L=new Int32Array(o.buffer,N);break}u=0;for(let j=0;j<S;j++){const F=d[am*j+mb],B=new Float32Array(F+2);T.push(B);for(let $=0;$<am-1;$++)B[$]=d[am*j+mb+$+1];for(let $=0;$<F;$++)B[$+2]=B[$]+L[u++]}return{areContours:v,thickness:x,outlines:T,width:p,height:y}}catch(t){return wt(`decompressSignature: ${t}`),null}}}dh=new WeakMap,Kt=new WeakSet,SE=function(e,t,n,r){return n-=e,r-=t,n===0?r>0?0:4:n===1?r+6:2-r},no=new WeakMap,yP=function(e,t,n,r,s,o,u){const d=O(this,Kt,SE).call(this,n,r,s,o);for(let f=0;f<8;f++){const p=(-f+d-u+16)%8,y=c(this,no)[2*p],v=c(this,no)[2*p+1];if(e[(n+y)*t+(r+v)]!==0)return p}return-1},vP=function(e,t,n,r,s,o,u){const d=O(this,Kt,SE).call(this,n,r,s,o);for(let f=0;f<8;f++){const p=(f+d+u+16)%8,y=c(this,no)[2*p],v=c(this,no)[2*p+1];if(e[(n+y)*t+(r+v)]!==0)return p}return-1},EE=function(e,t,n,r){const s=e.length,o=new Int32Array(s);for(let p=0;p<s;p++)o[p]=e[p]<=r?1:0;for(let p=1;p<n-1;p++)o[p*t]=o[p*t+t-1]=0;for(let p=0;p<t;p++)o[p]=o[t*n-1-p]=0;let u=1,d;const f=[];for(let p=1;p<n-1;p++){d=1;for(let y=1;y<t-1;y++){const v=p*t+y,x=o[v];if(x===0)continue;let S=p,E=y;if(x===1&&o[v-1]===0)u+=1,E-=1;else if(x>=1&&o[v+1]===0)u+=1,E+=1,x>1&&(d=x);else{x!==1&&(d=Math.abs(x));continue}const T=[y,p],N=E===y+1,L={isHole:N,points:T,id:u,parent:0};f.push(L);let j;for(const ne of f)if(ne.id===d){j=ne;break}j?j.isHole?L.parent=N?j.parent:d:L.parent=N?d:j.parent:L.parent=N?d:0;const F=O(this,Kt,yP).call(this,o,t,p,y,S,E,0);if(F===-1){o[v]=-u,o[v]!==1&&(d=Math.abs(o[v]));continue}let B=c(this,no)[2*F],$=c(this,no)[2*F+1];const H=p+B,W=y+$;S=H,E=W;let ae=p,me=y;for(;;){const ne=O(this,Kt,vP).call(this,o,t,ae,me,S,E,1);B=c(this,no)[2*ne],$=c(this,no)[2*ne+1];const re=ae+B,xe=me+$;T.push(xe,re);const ve=ae*t+me;if(o[ve+1]===0?o[ve]=-u:o[ve]===1&&(o[ve]=u),re===p&&xe===y&&ae===H&&me===W){o[v]!==1&&(d=Math.abs(o[v]));break}else S=ae,E=me,ae=re,me=xe}}}return f},sw=function(e,t,n,r){if(n-t<=4){for(let H=t;H<n-2;H+=2)r.push(e[H],e[H+1]);return}const s=e[t],o=e[t+1],u=e[n-4]-s,d=e[n-3]-o,f=Math.hypot(u,d),p=u/f,y=d/f,v=p*o-y*s,x=d/u,S=1/f,E=Math.atan(x),T=Math.cos(E),N=Math.sin(E),L=S*(Math.abs(T)+Math.abs(N)),j=S*(1-L+L**2),F=Math.max(Math.atan(Math.abs(N+T)*j),Math.atan(Math.abs(N-T)*j));let B=0,$=t;for(let H=t+2;H<n-2;H+=2){const W=Math.abs(v-p*e[H+1]+y*e[H]);W>B&&($=H,B=W)}B>(f*F)**2?(O(this,Kt,sw).call(this,e,t,$+2,r),O(this,Kt,sw).call(this,e,$,n,r)):r.push(s,o)},bP=function(e){const t=[],n=e.length;return O(this,Kt,sw).call(this,e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t},wP=function(e,t,n,r,s,o){const u=new Float32Array(o**2),d=-2*r**2,f=o>>1;for(let E=0;E<o;E++){const T=(E-f)**2;for(let N=0;N<o;N++)u[E*o+N]=Math.exp((T+(N-f)**2)/d)}const p=new Float32Array(256),y=-2*s**2;for(let E=0;E<256;E++)p[E]=Math.exp(E**2/y);const v=e.length,x=new Uint8Array(v),S=new Uint32Array(256);for(let E=0;E<n;E++)for(let T=0;T<t;T++){const N=E*t+T,L=e[N];let j=0,F=0;for(let $=0;$<o;$++){const H=E+$-f;if(!(H<0||H>=n))for(let W=0;W<o;W++){const ae=T+W-f;if(ae<0||ae>=t)continue;const me=e[H*t+ae],ne=u[$*o+W]*p[Math.abs(me-L)];j+=me*ne,F+=ne}}const B=x[N]=Math.round(j/F);S[B]++}return[x,S]},xP=function(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t},AE=function(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let r=-1/0,s=1/0;for(let u=0,d=n.length;u<d;u++){const f=n[u]=e[u<<2];r=Math.max(r,f),s=Math.min(s,f)}const o=255/(r-s);for(let u=0,d=n.length;u<d;u++)n[u]=(n[u]-s)*o;return n},kE=function(e){let t,n=-1/0,r=-1/0;const s=e.findIndex(d=>d!==0);let o=s,u=s;for(t=s;t<256;t++){const d=e[t];d>n&&(t-o>r&&(r=t-o,u=t-1),n=d,o=t)}for(t=u-1;t>=0&&!(e[t]>e[t+1]);t--);return t},_P=function(e){const t=e,{width:n,height:r}=e,{maxDim:s}=c(this,dh);let o=n,u=r;if(n>s||r>s){let v=n,x=r,S=Math.log2(Math.max(n,r)/s);const E=Math.floor(S);S=S===E?E-1:E;for(let N=0;N<S;N++){o=Math.ceil(v/2),u=Math.ceil(x/2);const L=new OffscreenCanvas(o,u);L.getContext("2d").drawImage(e,0,0,v,x,0,0,o,u),v=o,x=u,e!==t&&e.close(),e=L.transferToImageBitmap()}const T=Math.min(s/o,s/u);o=Math.round(o*T),u=Math.round(u*T)}const f=new OffscreenCanvas(o,u).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,o,u),f.filter="grayscale(1)",f.drawImage(e,0,0,e.width,e.height,0,0,o,u);const p=f.getImageData(0,0,o,u).data;return[O(this,Kt,AE).call(this,p),o,u]},R(bl,Kt),R(bl,dh,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),R(bl,no,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class hA extends dP{constructor(){super(),super.updateProperties({fill:fn._defaultLineColor,"stroke-width":0})}clone(){const e=new hA;return e.updateAll(this),e}}class fA extends px{constructor(e){super(e),super.updateProperties({stroke:fn._defaultLineColor,"stroke-width":1})}clone(){const e=new fA(this._viewParameters);return e.updateAll(this),e}}var Zc,Qo,eu,hh;const Os=class Os extends Rw{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});R(this,Zc,!1);R(this,Qo,null);R(this,eu,null);R(this,hh,null);this._willKeepAspectRatio=!0,k(this,eu,t.signatureData||null),k(this,Qo,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,n){fn.initialize(t,n),this._defaultDrawingOptions=new hA,this._defaultDrawnSignatureOptions=new fA(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!1}static get typesMap(){return xt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!c(this,Qo)}}static computeTelemetryFinalData(t){const n=t.get("hasDescription");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,n;const{_isCopy:r}=this;if(r&&(this._isCopy=!1,t=this.x,n=this.y),super.render(),this._drawId===null)if(c(this,eu)){const{lines:s,mustSmooth:o,areContours:u,description:d,uuid:f,heightInPage:p}=c(this,eu),{rawDims:{pageWidth:y,pageHeight:v},rotation:x}=this.parent.viewport,S=bl.processDrawnLines({lines:s,pageWidth:y,pageHeight:v,rotation:x,innerMargin:Os._INNER_MARGIN,mustSmooth:o,areContours:u});this.addSignature(S,p,d,f)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:c(this,Qo)||""}));return r&&(this._isCopy=!0,this._moveAfterPaste(t,n)),this.div}setUuid(t){k(this,hh,t),this.addEditToolbar()}getUuid(){return c(this,hh)}get description(){return c(this,Qo)}set description(t){k(this,Qo,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(n=>{n==null||n.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:n,thickness:r,width:s,height:o}=c(this,eu),u=Math.max(s,o),d=bl.processDrawnLines({lines:{curves:t.map(f=>({points:f})),thickness:r,width:s,height:o},pageWidth:u,pageHeight:u,rotation:0,innerMargin:0,mustSmooth:!1,areContours:n});return{areContours:n,outline:d.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,n,r,s){const{x:o,y:u}=this,{outline:d}=k(this,eu,t);k(this,Zc,d instanceof _E),this.description=r;let f;c(this,Zc)?f=Os.getDefaultDrawingOptions():(f=Os._defaultDrawnSignatureOptions.clone(),f.updateProperties({"stroke-width":d.thickness})),this._addOutlines({drawOutlines:d,drawingOptions:f});const[,p]=this.pageDimensions;let y=n/p;y=y>=1?.5:y,this.width*=y/this.height,this.width>=1&&(y*=.9/this.width,this.width=.9),this.height=y,this.setDims(),this.x=o,this.y=u,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!r}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:s}=this.parent.viewport;return bl.process(t,n,r,s,Os._INNER_MARGIN)}getFromText(t,n){const{rawDims:{pageWidth:r,pageHeight:s},rotation:o}=this.parent.viewport;return bl.extractContoursFromText(t,n,r,s,o,Os._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:s}=this.parent.viewport;return bl.processDrawnLines({lines:t,pageWidth:n,pageHeight:r,rotation:s,innerMargin:Os._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:n}){t?this._drawingOptions=Os.getDefaultDrawingOptions():(this._drawingOptions=Os._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:n,points:r}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":s}}=this,o=Object.assign(super.serialize(t),{isSignature:!0,areContours:c(this,Zc),color:[0,0,0],thickness:c(this,Zc)?0:s});return this.addComment(o),t?(o.paths={lines:n,points:r},o.uuid=c(this,hh),o.isCopy=!0):o.lines=n,c(this,Qo)&&(o.accessibilityData={type:"Figure",alt:c(this,Qo)}),o}static deserializeDraw(t,n,r,s,o,u){return u.areContours?_E.deserialize(t,n,r,s,o,u):W0.deserialize(t,n,r,s,o,u)}static async deserialize(t,n,r){var o;const s=await super.deserialize(t,n,r);return k(s,Zc,t.areContours),s.description=((o=t.accessibilityData)==null?void 0:o.alt)||"",k(s,hh,t.uuid),s}};Zc=new WeakMap,Qo=new WeakMap,eu=new WeakMap,hh=new WeakMap,Re(Os,"_type","signature"),Re(Os,"_editorType",Et.SIGNATURE),Re(Os,"_defaultDrawingOptions",null);let CE=Os;var _n,yr,tu,pl,nu,rg,gl,fh,Zo,Js,sg,Ut,Rm,Im,iw,ow,aw,NE,lw,SP;class TE extends fn{constructor(t){super({...t,name:"stampEditor"});R(this,Ut);R(this,_n,null);R(this,yr,null);R(this,tu,null);R(this,pl,null);R(this,nu,null);R(this,rg,"");R(this,gl,null);R(this,fh,!1);R(this,Zo,null);R(this,Js,!1);R(this,sg,!1);k(this,pl,t.bitmapUrl),k(this,nu,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,n){fn.initialize(t,n)}static isHandlingMimeForPasting(t){return fS.includes(t)}static paste(t,n){n.pasteEditor({mode:Et.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const n=t.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:o,height:u}=t||this.copyCanvas(null,null,!0).imageData,d=await r.guess({name:"altText",request:{data:s,width:o,height:u,channels:s.length/(o*u)}});if(!d)throw new Error("No response from the AI service.");if(d.error)throw new Error("Error from the AI service.");if(d.cancel)return null;if(!d.output)throw new Error("No valid response from the AI service.");const f=d.output;return await this.setGuessedAltText(f),n&&!this.hasAltTextData()&&(this.altTextData={alt:f,decorative:!1}),f}remove(){var t;c(this,yr)&&(k(this,_n,null),this._uiManager.imageManager.deleteId(c(this,yr)),(t=c(this,gl))==null||t.remove(),k(this,gl,null),c(this,Zo)&&(clearTimeout(c(this,Zo)),k(this,Zo,null))),super.remove()}rebuild(){if(!this.parent){c(this,yr)&&O(this,Ut,iw).call(this);return}super.rebuild(),this.div!==null&&(c(this,yr)&&c(this,gl)===null&&O(this,Ut,iw).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(c(this,tu)||c(this,_n)||c(this,pl)||c(this,nu)||c(this,yr)||c(this,fh))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;return this._isCopy&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.createAltText(),c(this,fh)||(c(this,_n)?O(this,Ut,ow).call(this):O(this,Ut,iw).call(this)),this._isCopy&&this._moveAfterPaste(t,n),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,n){const{id:r,bitmap:s}=this._uiManager.imageManager.getFromCanvas(t,n);n.remove(),r&&this._uiManager.imageManager.isValidId(r)&&(k(this,yr,r),s&&k(this,_n,s),k(this,fh,!1),O(this,Ut,ow).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;c(this,Zo)!==null&&clearTimeout(c(this,Zo)),k(this,Zo,setTimeout(()=>{k(this,Zo,null),O(this,Ut,NE).call(this)},200))}copyCanvas(t,n,r=!1){t||(t=224);const{width:s,height:o}=c(this,_n),u=new ta;let d=c(this,_n),f=s,p=o,y=null;if(n){if(s>n||o>n){const H=Math.min(n/s,n/o);f=Math.floor(s*H),p=Math.floor(o*H)}y=document.createElement("canvas");const x=y.width=Math.ceil(f*u.sx),S=y.height=Math.ceil(p*u.sy);c(this,Js)||(d=O(this,Ut,aw).call(this,x,S));const E=y.getContext("2d");E.filter=this._uiManager.hcmFilter;let T="white",N="#cfcfd8";this._uiManager.hcmFilter!=="none"?N="black":ij.isDarkMode&&(T="#8f8f9d",N="#42414d");const L=15,j=L*u.sx,F=L*u.sy,B=new OffscreenCanvas(j*2,F*2),$=B.getContext("2d");$.fillStyle=T,$.fillRect(0,0,j*2,F*2),$.fillStyle=N,$.fillRect(0,0,j,F),$.fillRect(j,F,j,F),E.fillStyle=E.createPattern(B,"repeat"),E.fillRect(0,0,x,S),E.drawImage(d,0,0,d.width,d.height,0,0,x,S)}let v=null;if(r){let x,S;if(u.symmetric&&d.width<t&&d.height<t)x=d.width,S=d.height;else if(d=c(this,_n),s>t||o>t){const N=Math.min(t/s,t/o);x=Math.floor(s*N),S=Math.floor(o*N),c(this,Js)||(d=O(this,Ut,aw).call(this,x,S))}const T=new OffscreenCanvas(x,S).getContext("2d",{willReadFrequently:!0});T.drawImage(d,0,0,d.width,d.height,0,0,x,S),v={width:x,height:S,data:T.getImageData(0,0,x,S).data}}return{canvas:y,width:f,height:p,imageData:v}}static async deserialize(t,n,r){var T;let s=null,o=!1;if(t instanceof BN){const{data:{rect:N,rotation:L,id:j,structParent:F,popupRef:B,richText:$,contentsObj:H,creationDate:W,modificationDate:ae},container:me,parent:{page:{pageNumber:ne}},canvas:re}=t;let xe,ve;re?(delete t.canvas,{id:xe,bitmap:ve}=r.imageManager.getFromCanvas(me.id,re),re.remove()):(o=!0,t._hasNoCanvas=!0);const _e=((T=await n._structTree.getAriaAttributes(`${kf}${j}`))==null?void 0:T.get("aria-label"))||"";s=t={annotationType:Et.STAMP,bitmapId:xe,bitmap:ve,pageIndex:ne-1,rect:N.slice(0),rotation:L,annotationElementId:j,id:j,deleted:!1,accessibilityData:{decorative:!1,altText:_e},isSvg:!1,structParent:F,popupRef:B,richText:$,comment:(H==null?void 0:H.str)||null,creationDate:W,modificationDate:ae}}const u=await super.deserialize(t,n,r),{rect:d,bitmap:f,bitmapUrl:p,bitmapId:y,isSvg:v,accessibilityData:x}=t;o?(r.addMissingCanvas(t.id,u),k(u,fh,!0)):y&&r.imageManager.isValidId(y)?(k(u,yr,y),f&&k(u,_n,f)):k(u,pl,p),k(u,Js,v);const[S,E]=u.pageDimensions;return u.width=(d[2]-d[0])/S,u.height=(d[3]-d[1])/E,x&&(u.altTextData=x),u._initialData=s,t.comment&&u.setCommentData(t),k(u,sg,!!s),u}serialize(t=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r=Object.assign(super.serialize(t),{bitmapId:c(this,yr),isSvg:c(this,Js)});if(this.addComment(r),t)return r.bitmapUrl=O(this,Ut,lw).call(this,!0),r.accessibilityData=this.serializeAltText(!0),r.isCopy=!0,r;const{decorative:s,altText:o}=this.serializeAltText(!1);if(!s&&o&&(r.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const d=O(this,Ut,SP).call(this,r);return d.isSame?null:(d.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1,r.id=this.annotationElementId,delete r.bitmapId,r)}if(n===null)return r;n.stamps||(n.stamps=new Map);const u=c(this,Js)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!n.stamps.has(c(this,yr)))n.stamps.set(c(this,yr),{area:u,serialized:r}),r.bitmap=O(this,Ut,lw).call(this,!1);else if(c(this,Js)){const d=n.stamps.get(c(this,yr));u>d.area&&(d.area=u,d.serialized.bitmap.close(),d.serialized.bitmap=O(this,Ut,lw).call(this,!1))}return r}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}_n=new WeakMap,yr=new WeakMap,tu=new WeakMap,pl=new WeakMap,nu=new WeakMap,rg=new WeakMap,gl=new WeakMap,fh=new WeakMap,Zo=new WeakMap,Js=new WeakMap,sg=new WeakMap,Ut=new WeakSet,Rm=function(t,n=!1){if(!t){this.remove();return}k(this,_n,t.bitmap),n||(k(this,yr,t.id),k(this,Js,t.isSvg)),t.file&&k(this,rg,t.file.name),O(this,Ut,ow).call(this)},Im=function(){if(k(this,tu,null),this._uiManager.enableWaiting(!1),!!c(this,gl)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&c(this,_n)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&c(this,_n)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},iw=function(){if(c(this,yr)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(c(this,yr)).then(r=>O(this,Ut,Rm).call(this,r,!0)).finally(()=>O(this,Ut,Im).call(this));return}if(c(this,pl)){const r=c(this,pl);k(this,pl,null),this._uiManager.enableWaiting(!0),k(this,tu,this._uiManager.imageManager.getFromUrl(r).then(s=>O(this,Ut,Rm).call(this,s)).finally(()=>O(this,Ut,Im).call(this)));return}if(c(this,nu)){const r=c(this,nu);k(this,nu,null),this._uiManager.enableWaiting(!0),k(this,tu,this._uiManager.imageManager.getFromFile(r).then(s=>O(this,Ut,Rm).call(this,s)).finally(()=>O(this,Ut,Im).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=fS.join(",");const n=this._uiManager._signal;k(this,tu,new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),O(this,Ut,Rm).call(this,s)}r()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),r()},{signal:n})}).finally(()=>O(this,Ut,Im).call(this))),t.click()},ow=function(){var f;const{div:t}=this;let{width:n,height:r}=c(this,_n);const[s,o]=this.pageDimensions,u=.75;if(this.width)n=this.width*s,r=this.height*o;else if(n>u*s||r>u*o){const p=Math.min(u*s/n,u*o/r);n*=p,r*=p}this._uiManager.enableWaiting(!1);const d=k(this,gl,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=n/s,this.height=r/o,this.setDims(),(f=this._initialOptions)!=null&&f.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),O(this,Ut,NE).call(this),c(this,sg)||(this.parent.addUndoableEditor(this),k(this,sg,!0)),this._reportTelemetry({action:"inserted_image"}),c(this,rg)&&this.div.setAttribute("aria-description",c(this,rg)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},aw=function(t,n){const{width:r,height:s}=c(this,_n);let o=r,u=s,d=c(this,_n);for(;o>2*t||u>2*n;){const f=o,p=u;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),u>2*n&&(u=u>=16384?Math.floor(u/2)-1:Math.ceil(u/2));const y=new OffscreenCanvas(o,u);y.getContext("2d").drawImage(d,0,0,f,p,0,0,o,u),d=y.transferToImageBitmap()}return d},NE=function(){const[t,n]=this.parentDimensions,{width:r,height:s}=this,o=new ta,u=Math.ceil(r*t*o.sx),d=Math.ceil(s*n*o.sy),f=c(this,gl);if(!f||f.width===u&&f.height===d)return;f.width=u,f.height=d;const p=c(this,Js)?c(this,_n):O(this,Ut,aw).call(this,u,d),y=f.getContext("2d");y.filter=this._uiManager.hcmFilter,y.drawImage(p,0,0,p.width,p.height,0,0,u,d)},lw=function(t){if(t){if(c(this,Js)){const s=this._uiManager.imageManager.getSvgUrl(c(this,yr));if(s)return s}const n=document.createElement("canvas");return{width:n.width,height:n.height}=c(this,_n),n.getContext("2d").drawImage(c(this,_n),0,0),n.toDataURL()}if(c(this,Js)){const[n,r]=this.pageDimensions,s=Math.round(this.width*n*uu.PDF_TO_CSS_UNITS),o=Math.round(this.height*r*uu.PDF_TO_CSS_UNITS),u=new OffscreenCanvas(s,o);return u.getContext("2d").drawImage(c(this,_n),0,0,c(this,_n).width,c(this,_n).height,0,0,s,o),u.transferToImageBitmap()}return structuredClone(c(this,_n))},SP=function(t){var u;const{pageIndex:n,accessibilityData:{altText:r}}=this._initialData,s=t.pageIndex===n,o=(((u=t.accessibilityData)==null?void 0:u.alt)||"")===r;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&s&&o,isSameAltText:o}},Re(TE,"_type","stamp"),Re(TE,"_editorType",Et.STAMP);var ph,ig,ru,su,ml,ks,iu,og,ag,ro,yl,vr,vl,ou,lg,lt,au,an,RE,EP,Po,IE,OE,cw;const Vi=class Vi{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:r,accessibilityManager:s,annotationLayer:o,drawLayer:u,textLayer:d,viewport:f,l10n:p}){R(this,an);R(this,ph);R(this,ig,!1);R(this,ru,null);R(this,su,null);R(this,ml,null);R(this,ks,new Map);R(this,iu,!1);R(this,og,!1);R(this,ag,!1);R(this,ro,null);R(this,yl,null);R(this,vr,null);R(this,vl,null);R(this,ou,null);R(this,lg,-1);R(this,lt);const y=[...c(Vi,au).values()];if(!Vi._initialized){Vi._initialized=!0;for(const v of y)v.initialize(p,e)}e.registerEditorTypes(y),k(this,lt,e),this.pageIndex=t,this.div=n,k(this,ph,s),k(this,ru,o),this.viewport=f,k(this,vr,d),this.drawLayer=u,this._structTree=r,c(this,lt).addLayer(this)}get isEmpty(){return c(this,ks).size===0}get isInvisible(){return this.isEmpty&&c(this,lt).getMode()===Et.NONE}updateToolbar(e){c(this,lt).updateToolbar(e)}updateMode(e=c(this,lt).getMode()){switch(O(this,an,cw).call(this),e){case Et.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Et.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Et.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===Et.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const n of c(Vi,au).values())t.toggle(`${n._type}Editing`,e===n._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=c(this,vr))==null?void 0:t.div)}setEditingState(e){c(this,lt).setEditingState(e)}addCommands(e){c(this,lt).addCommands(e)}cleanUndoStack(e){c(this,lt).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=c(this,ru))==null||t.togglePointerEvents(e)}async enable(){var n;k(this,ag,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(n=c(this,ou))==null||n.abort(),k(this,ou,null);const e=new Set;for(const r of c(this,an,RE))r.enableEditing(),r.show(!0),r.annotationElementId&&(c(this,lt).removeChangedExistingAnnotation(r),e.add(r.annotationElementId));const t=c(this,ru);if(t)for(const r of t.getEditableAnnotations()){if(r.hide(),c(this,lt).isDeletedAnnotationElement(r.data.id)||e.has(r.data.id))continue;const s=await this.deserialize(r);s&&(this.addOrRebuild(s),s.enableEditing())}k(this,ag,!1),c(this,lt)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var r;if(k(this,og,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),c(this,vr)&&!c(this,ou)){k(this,ou,new AbortController);const s=c(this,lt).combinedSignal(c(this,ou));c(this,vr).div.addEventListener("pointerdown",o=>{const{clientX:d,clientY:f,timeStamp:p}=o,y=c(this,lg);if(p-y>500){k(this,lg,p);return}k(this,lg,-1);const{classList:v}=this.div;v.toggle("getElements",!0);const x=document.elementsFromPoint(d,f);if(v.toggle("getElements",!1),!this.div.contains(x[0]))return;let S;const E=new RegExp(`^${zm}[0-9]+$`);for(const N of x)if(E.test(N.id)){S=N.id;break}if(!S)return;const T=c(this,ks).get(S);(T==null?void 0:T.annotationElementId)===null&&(o.stopPropagation(),o.preventDefault(),T.dblclick(o))},{signal:s,capture:!0})}const e=c(this,ru),t=[];if(e){const s=new Map,o=new Map;for(const d of c(this,an,RE)){if(d.disableEditing(),!d.annotationElementId){t.push(d);continue}if(d.serialize()!==null){s.set(d.annotationElementId,d);continue}else o.set(d.annotationElementId,d);(r=this.getEditableAnnotation(d.annotationElementId))==null||r.show(),d.remove()}const u=e.getEditableAnnotations();for(const d of u){const{id:f}=d.data;if(c(this,lt).isDeletedAnnotationElement(f)){d.updateEdited({deleted:!0});continue}let p=o.get(f);if(p){p.resetAnnotationElement(d),p.show(!1),d.show();continue}p=s.get(f),p&&(c(this,lt).addChangedExistingAnnotation(p),p.renderAnnotationElement(d)&&p.show(!1)),d.show()}}O(this,an,cw).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const s of c(Vi,au).values())n.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e==null||e.updateFakeAnnotations(t),k(this,og,!1)}getEditableAnnotation(e){var t;return((t=c(this,ru))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){c(this,lt).getActive()!==e&&c(this,lt).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=c(this,vr))!=null&&e.div&&!c(this,vl)){k(this,vl,new AbortController);const t=c(this,lt).combinedSignal(c(this,vl));c(this,vr).div.addEventListener("pointerdown",O(this,an,EP).bind(this),{signal:t}),c(this,vr).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=c(this,vr))!=null&&e.div&&c(this,vl)&&(c(this,vl).abort(),k(this,vl,null),c(this,vr).div.classList.remove("highlighting"))}enableClick(){if(c(this,su))return;k(this,su,new AbortController);const e=c(this,lt).combinedSignal(c(this,su));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=c(this,su))==null||e.abort(),k(this,su,null)}attach(e){c(this,ks).set(e.id,e);const{annotationElementId:t}=e;t&&c(this,lt).isDeletedAnnotationElement(t)&&c(this,lt).removeDeletedAnnotationElement(e)}detach(e){var t;c(this,ks).delete(e.id),(t=c(this,ph))==null||t.removePointerInTextLayer(e.contentDiv),!c(this,og)&&e.annotationElementId&&c(this,lt).addDeletedAnnotationElement(e)}remove(e){this.detach(e),c(this,lt).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(c(this,lt).addDeletedAnnotationElement(e),fn.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),c(this,lt).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!c(this,ag)),c(this,lt).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!c(this,ml)&&(e._focusEventsAllowed=!1,k(this,ml,setTimeout(()=>{k(this,ml,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:c(this,lt)._signal}),t.focus())},0))),e._structTreeParentId=(n=c(this,ph))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getEditorByUID(e){for(const t of c(this,ks).values())if(t.uid===e)return t;return null}getNextId(){return c(this,lt).getId()}combinedSignal(e){return c(this,lt).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=c(this,an,Po))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await c(this,lt).updateMode(e.mode);const{offsetX:n,offsetY:r}=O(this,an,OE).call(this),s=this.getNextId(),o=O(this,an,IE).call(this,{parent:this,id:s,x:n,y:r,uiManager:c(this,lt),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=c(Vi,au).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,c(this,lt)))||null}createAndAddNewEditor(e,t,n={}){const r=this.getNextId(),s=O(this,an,IE).call(this,{parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:c(this,lt),isCentered:t,...n});return s&&this.add(s),s}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(O(this,an,OE).call(this),!0,e)}setSelected(e){c(this,lt).setSelected(e)}toggleSelected(e){c(this,lt).toggleSelected(e)}unselect(e){c(this,lt).unselect(e)}pointerup(e){var r;const{isMac:t}=Mr.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!c(this,iu)||(k(this,iu,!1),(r=c(this,an,Po))!=null&&r.isDrawer&&c(this,an,Po).supportMultipleDrawings))return;if(!c(this,ig)){k(this,ig,!0);return}const n=c(this,lt).getMode();if(n===Et.STAMP||n===Et.SIGNATURE){c(this,lt).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var r;if(c(this,lt).getMode()===Et.HIGHLIGHT&&this.enableTextSelection(),c(this,iu)){k(this,iu,!1);return}const{isMac:t}=Mr.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(k(this,iu,!0),(r=c(this,an,Po))!=null&&r.isDrawer){this.startDrawingSession(e);return}const n=c(this,lt).getActive();k(this,ig,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),c(this,ro)){c(this,an,Po).startDrawing(this,c(this,lt),!1,e);return}c(this,lt).setCurrentDrawingSession(this),k(this,ro,new AbortController);const t=c(this,lt).combinedSignal(c(this,ro));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(k(this,yl,null),this.commitOrRemove())},{signal:t}),c(this,an,Po).startDrawing(this,c(this,lt),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&k(this,yl,t);return}c(this,yl)&&setTimeout(()=>{var t;(t=c(this,yl))==null||t.focus(),k(this,yl,null)},0)}endDrawingSession(e=!1){return c(this,ro)?(c(this,lt).setCurrentDrawingSession(null),c(this,ro).abort(),k(this,ro,null),k(this,yl,null),c(this,an,Po).endDrawing(e)):null}findNewParent(e,t,n){const r=c(this,lt).findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return c(this,ro)?(this.endDrawingSession(),!0):!1}onScaleChanging(){c(this,ro)&&c(this,an,Po).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=c(this,lt).getActive())==null?void 0:e.parent)===this&&(c(this,lt).commitOrRemove(),c(this,lt).setActiveEditor(null)),c(this,ml)&&(clearTimeout(c(this,ml)),k(this,ml,null));for(const n of c(this,ks).values())(t=c(this,ph))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,c(this,ks).clear(),c(this,lt).removeLayer(this)}render({viewport:e}){this.viewport=e,vh(this.div,e);for(const t of c(this,lt).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){c(this,lt).commitOrRemove(),O(this,an,cw).call(this);const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,vh(this.div,{rotation:n}),t!==n)for(const r of c(this,ks).values())r.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return c(this,lt).viewParameters.realScale}};ph=new WeakMap,ig=new WeakMap,ru=new WeakMap,su=new WeakMap,ml=new WeakMap,ks=new WeakMap,iu=new WeakMap,og=new WeakMap,ag=new WeakMap,ro=new WeakMap,yl=new WeakMap,vr=new WeakMap,vl=new WeakMap,ou=new WeakMap,lg=new WeakMap,lt=new WeakMap,au=new WeakMap,an=new WeakSet,RE=function(){return c(this,ks).size!==0?c(this,ks).values():c(this,lt).getEditors(this.pageIndex)},EP=function(e){c(this,lt).unselectAll();const{target:t}=e;if(t===c(this,vr).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&c(this,vr).div.contains(t)){const{isMac:n}=Mr.platform;if(e.button!==0||e.ctrlKey&&n)return;c(this,lt).showAllEditors("highlight",!0,!0),c(this,vr).div.classList.add("free"),this.toggleDrawing(),Pw.startHighlighting(this,c(this,lt).direction==="ltr",{target:c(this,vr).div,x:e.x,y:e.y}),c(this,vr).div.addEventListener("pointerup",()=>{c(this,vr).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:c(this,lt)._signal}),e.preventDefault()}},Po=function(){return c(Vi,au).get(c(this,lt).getMode())},IE=function(e){const t=c(this,an,Po);return t?new t.prototype.constructor(e):null},OE=function(){const{x:e,y:t,width:n,height:r}=this.boundingClientRect,s=Math.max(0,e),o=Math.max(0,t),u=Math.min(window.innerWidth,e+n),d=Math.min(window.innerHeight,t+r),f=(s+u)/2-e,p=(o+d)/2-t,[y,v]=this.viewport.rotation%180===0?[f,p]:[p,f];return{offsetX:y,offsetY:v}},cw=function(){for(const e of c(this,ks).values())e.isEmpty()&&e.remove()},Re(Vi,"_initialized",!1),R(Vi,au,new Map([dE,xE,TE,Pw,CE].map(e=>[e._editorType,e])));let PE=Vi;var so,os,gh,L0,ox,AP,na,ME,kP,DE;const rr=class rr{constructor({pageIndex:e}){R(this,na);R(this,so,null);R(this,os,new Map);R(this,gh,new Map);this.pageIndex=e}setParent(e){if(!c(this,so)){k(this,so,e);return}if(c(this,so)!==e){if(c(this,os).size>0)for(const t of c(this,os).values())t.remove(),e.append(t);k(this,so,e)}}static get _svgFactory(){return xt(this,"_svgFactory",new Tw)}draw(e,t=!1,n=!1){const r=er(rr,L0)._++,s=O(this,na,ME).call(this),o=rr._svgFactory.createElement("defs");s.append(o);const u=rr._svgFactory.createElement("path");o.append(u);const d=`path_p${this.pageIndex}_${r}`;u.setAttribute("id",d),u.setAttribute("vector-effect","non-scaling-stroke"),t&&c(this,gh).set(r,u);const f=n?O(this,na,kP).call(this,o,d):null,p=rr._svgFactory.createElement("use");return s.append(p),p.setAttribute("href",`#${d}`),this.updateProperties(s,e),c(this,os).set(r,s),{id:r,clipPathId:`url(#${f})`}}drawOutline(e,t){const n=er(rr,L0)._++,r=O(this,na,ME).call(this),s=rr._svgFactory.createElement("defs");r.append(s);const o=rr._svgFactory.createElement("path");s.append(o);const u=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",u),o.setAttribute("vector-effect","non-scaling-stroke");let d;if(t){const y=rr._svgFactory.createElement("mask");s.append(y),d=`mask_p${this.pageIndex}_${n}`,y.setAttribute("id",d),y.setAttribute("maskUnits","objectBoundingBox");const v=rr._svgFactory.createElement("rect");y.append(v),v.setAttribute("width","1"),v.setAttribute("height","1"),v.setAttribute("fill","white");const x=rr._svgFactory.createElement("use");y.append(x),x.setAttribute("href",`#${u}`),x.setAttribute("stroke","none"),x.setAttribute("fill","black"),x.setAttribute("fill-rule","nonzero"),x.classList.add("mask")}const f=rr._svgFactory.createElement("use");r.append(f),f.setAttribute("href",`#${u}`),d&&f.setAttribute("mask",`url(#${d})`);const p=f.cloneNode();return r.append(p),f.classList.add("mainOutline"),p.classList.add("secondaryOutline"),this.updateProperties(r,e),c(this,os).set(n,r),n}finalizeDraw(e,t){c(this,gh).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var d;if(!t)return;const{root:n,bbox:r,rootClass:s,path:o}=t,u=typeof e=="number"?c(this,os).get(e):e;if(u){if(n&&O(this,na,DE).call(this,u,n),r&&O(d=rr,ox,AP).call(d,u,r),s){const{classList:f}=u;for(const[p,y]of Object.entries(s))f.toggle(p,y)}if(o){const p=u.firstElementChild.firstElementChild;O(this,na,DE).call(this,p,o)}}}updateParent(e,t){if(t===this)return;const n=c(this,os).get(e);n&&(c(t,so).append(n),c(this,os).delete(e),c(t,os).set(e,n))}remove(e){c(this,gh).delete(e),c(this,so)!==null&&(c(this,os).get(e).remove(),c(this,os).delete(e))}destroy(){k(this,so,null);for(const e of c(this,os).values())e.remove();c(this,os).clear(),c(this,gh).clear()}};so=new WeakMap,os=new WeakMap,gh=new WeakMap,L0=new WeakMap,ox=new WeakSet,AP=function(e,[t,n,r,s]){const{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*r}%`,o.height=`${100*s}%`},na=new WeakSet,ME=function(){const e=rr._svgFactory.create(1,1,!0);return c(this,so).append(e),e.setAttribute("aria-hidden",!0),e},kP=function(e,t){const n=rr._svgFactory.createElement("clipPath");e.append(n);const r=`clip_${t}`;n.setAttribute("id",r),n.setAttribute("clipPathUnits","objectBoundingBox");const s=rr._svgFactory.createElement("use");return n.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),r},DE=function(e,t){for(const[n,r]of Object.entries(t))r===null?e.removeAttribute(n):e.setAttribute(n,r)},R(rr,ox),R(rr,L0,0);let jE=rr;globalThis._pdfjsTestingUtils={HighlightOutliner:fE};globalThis.pdfjsLib={AbortException:cu,AnnotationEditorLayer:PE,AnnotationEditorParamsType:Dt,AnnotationEditorType:Et,AnnotationEditorUIManager:bh,AnnotationLayer:cE,AnnotationMode:pc,AnnotationType:qn,applyOpacity:aj,build:pM,ColorPicker:kw,createValidAbsoluteUrl:yT,CSSConstants:oj,DOMSVGFactory:Tw,DrawLayer:jE,FeatureTest:Mr,fetchData:U0,findContrastColor:lj,getDocument:cA,getFilenameFromUrl:ej,getPdfFilenameFromUrl:tj,getRGB:H0,getUuid:wT,getXfaPageViewport:rj,GlobalWorkerOptions:ea,ImageKind:Pb,InvalidPDFException:dS,isDataScheme:hx,isPdfFile:iA,isValidExplicitDest:vj,MathClamp:ls,noContextMenu:Ti,normalizeUnicode:JO,OPS:Hm,OutputScale:ta,PasswordResponses:zO,PDFDataRangeTransport:AN,PDFDateString:ww,PDFWorker:Wm,PermissionFlag:UO,PixelsPerInch:uu,RenderingCancelledException:sA,renderRichText:ST,ResponseException:bw,setLayerDimensions:vh,shadow:xt,SignatureExtractor:bl,stopEvent:Ln,SupportedImageMimeTypes:fS,TextLayer:Vm,TouchManager:_w,updateUrlHash:vT,Util:Ze,VerbosityLevel:cx,version:fM,XfaLayer:_T};ea.workerSrc=new URL("/assets/pdf.worker.min-CXgfMxHN.mjs",import.meta.url).toString();async function CP(a,e={}){const{scale:t=2,format:n="image/webp",quality:r=.8}=e;try{console.log(" PDF:",a.name);const s=await a.arrayBuffer(),u=await cA({data:s}).promise;console.log(`PDF  ${u.numPages} `);const d=await u.getPage(1),f=d.getViewport({scale:t}),p=document.createElement("canvas"),y=p.getContext("2d");if(!y)throw new Error(" Canvas context");return p.width=f.width,p.height=f.height,await d.render({canvasContext:y,viewport:f,canvas:p}).promise,await new Promise((x,S)=>{p.toBlob(E=>{E?x(E):S(new Error("Canvas  Blob "))},n,r)})}catch(s){throw console.error("PDF :",s),new Error(s instanceof Error?`PDF ${s.message}`:"PDF ")}}async function FM(a,e={}){const{scale:t=2,format:n="image/webp",quality:r=.8}=e;try{console.log(" PDF:",a.name);const s=await a.arrayBuffer(),u=await cA({data:s}).promise;console.log(`PDF  ${u.numPages} `);const d=[];for(let f=1;f<=u.numPages;f+=1){const p=await u.getPage(f),y=p.getViewport({scale:t}),v=document.createElement("canvas"),x=v.getContext("2d");if(!x)throw new Error(" Canvas context");v.width=y.width,v.height=y.height,await p.render({canvasContext:x,viewport:y,canvas:v}).promise;const S=await new Promise((E,T)=>{v.toBlob(N=>{N?E(N):T(new Error("Canvas  Blob "))},n,r)});d.push(S)}return console.log(`PDF  ${d.length} `),d}catch(s){throw console.error("PDF :",s),new Error(s instanceof Error?`PDF ${s.message}`:"PDF ")}}function pA(a){var n;const e=a.type.toLowerCase();if(e==="application/pdf")return"pdf";if(e.startsWith("image/"))return"image";const t=(n=a.name.split(".").pop())==null?void 0:n.toLowerCase();return t==="pdf"?"pdf":["jpg","jpeg","png","gif","webp"].includes(t||"")?"image":"unknown"}async function TP(a){return new Promise((e,t)=>{const n=new FileReader;n.onload=r=>{var s;if((s=r.target)!=null&&s.result){const o=new Blob([r.target.result],{type:a.type});e(o)}else t(new Error(""))},n.onerror=()=>{t(new Error(""))},n.readAsArrayBuffer(a)})}function BM({onBack:a}){const[e,t]=ue.useState([]),[n,r]=ue.useState(""),[s,o]=ue.useState([]),[u,d]=ue.useState(""),[f,p]=ue.useState(1),[y,v]=ue.useState(null),[x,S]=ue.useState(null),[E,T]=ue.useState(!1),[N,L]=ue.useState(null),[j,F]=ue.useState(!0),[B,$]=ue.useState(!1),[H,W]=ue.useState(!1),[ae,me]=ue.useState(null),[ne,re]=ue.useState(!1),[xe,ve]=ue.useState(null),[_e,pe]=ue.useState(""),[fe,Z]=ue.useState(!1),[ke,Q]=ue.useState(null),[z,K]=ue.useState(null),[Se,Pe]=ue.useState(!1);ue.useEffect(()=>{(async()=>{F(!0);try{const Ke=await ze.classrooms.toArray();t(Ke),Ke.length>0&&!n&&r(Ke[0].id)}catch(Ke){console.error("",Ke),me("")}finally{F(!1)}})()},[n]),ue.useEffect(()=>{(async()=>{if(!n){o([]);return}$(!0);try{const Ke=await ze.assignments.where("classroomId").equals(n).toArray();o(Ke)}finally{$(!1)}})()},[n]);const Ve=()=>{d(""),p(1),v(null),S(null),me(null),L(null)},We=async Le=>{if(Le.preventDefault(),me(null),!n){me("");return}if(!u.trim()){me("");return}if(f<1||f>100){me(" 1-100 ");return}W(!0);try{const Ke={id:Dm(),classroomId:n,title:u.trim(),totalPages:f,answerKey:y||void 0};await ze.assignments.add(Ke),o(Mt=>[...Mt,Ke]),Ve(),re(!1)}catch(Ke){console.error("",Ke),me("")}finally{W(!1)}},be=Le=>{var Mt;const Ke=((Mt=Le.target.files)==null?void 0:Mt[0])||null;S(Ke),L(null)},Te=async()=>{if(!x){L(" PDF ");return}try{T(!0),L(null);const Le=pA(x);let Ke;if(Le==="image")Ke=await TP(x);else if(Le==="pdf")Ke=await CP(x,{scale:2,format:"image/webp",quality:.8});else{L(" PDF");return}const Mt=await $O(Ke);v(Mt)}catch(Le){console.error("AI ",Le),L("AI ")}finally{T(!1)}},Ee=Le=>{ve(Le.id),pe(Le.title)},at=async Le=>{const Ke=_e.trim();if(!Ke){ve(null),pe("");return}try{await ze.assignments.update(Le,{title:Ke}),o(Mt=>Mt.map(Nt=>Nt.id===Le?{...Nt,title:Ke}:Nt))}catch(Mt){console.error("",Mt)}finally{ve(null),pe("")}},bt=async Le=>{if(window.confirm(""))try{await ze.assignments.delete(Le),await ze.submissions.where("assignmentId").equals(Le).delete(),o(Mt=>Mt.filter(Nt=>Nt.id!==Le))}catch(Mt){console.error("",Mt)}},tt=Le=>{const Ke=Le.answerKey||{questions:[],totalScore:0};Q(Le),K(Ke),L(null),Z(!0)},Ht=async()=>{if(!(!ke||!z))try{Pe(!0),await ze.assignments.update(ke.id,{answerKey:z}),o(Le=>Le.map(Ke=>Ke.id===ke.id?{...Ke,answerKey:z}:Ke)),Z(!1),Q(null),K(null)}catch(Le){console.error("",Le),L("")}finally{Pe(!1)}};return j?w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx(ri,{className:"w-12 h-12 text-blue-600 mx-auto mb-4 animate-spin"}),w.jsx("p",{className:"text-gray-600",children:""})]})}):w.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[w.jsxs("div",{className:"max-w-5xl mx-auto pt-8",children:[a&&w.jsxs("button",{onClick:a,className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[w.jsx(kl,{className:"w-5 h-5"}),""]}),w.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6",children:w.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:w.jsx(wl,{className:"w-8 h-8 text-green-600"})}),w.jsxs("div",{children:[w.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:""}),w.jsx("p",{className:"text-sm text-gray-600",children:""})]})]}),w.jsx("button",{type:"button",onClick:()=>{Ve(),re(!0)},className:"inline-flex items-center justify-center w-10 h-10 rounded-full bg-green-600 text-white shadow hover:bg-green-700",title:"",children:w.jsx(Of,{className:"w-5 h-5"})})]})}),ae&&w.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-sm text-red-700 rounded-xl",children:ae}),e.length===0?w.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[w.jsx(lx,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:""}),w.jsx("p",{className:"text-gray-600 mb-6",children:""}),a&&w.jsx("button",{onClick:a,className:"px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors",children:""})]}):w.jsxs("div",{className:"bg-white rounded-2xl shadow-xl flex flex-col md:flex-row overflow-hidden",children:[w.jsxs("div",{className:"md:w-1/2 border-b md:border-b-0 md:border-r border-gray-200 p-4 md:p-6 max-h-[70vh] overflow-auto",children:[w.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("h2",{className:"text-sm font-semibold text-gray-700",children:""}),B&&w.jsx(ri,{className:"w-4 h-4 text-gray-400 animate-spin"})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("label",{className:"text-xs text-gray-600",children:""}),w.jsx("select",{value:n,onChange:Le=>r(Le.target.value),className:"px-3 py-2 rounded-lg border border-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:e.map(Le=>w.jsx("option",{value:Le.id,children:Le.name},Le.id))})]})]}),s.length===0&&!B&&w.jsx("p",{className:"text-sm text-gray-500",children:""}),w.jsx("div",{className:"space-y-2",children:s.map(Le=>w.jsxs("div",{className:"w-full px-3 py-3 rounded-xl border border-gray-200 bg-white hover:bg-gray-50 flex items-center justify-between gap-3",children:[w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsx("div",{className:"flex items-center gap-1",children:xe===Le.id?w.jsx("input",{autoFocus:!0,type:"text",value:_e,onChange:Ke=>pe(Ke.target.value),onBlur:()=>void at(Le.id),onKeyDown:Ke=>{Ke.key==="Enter"?at(Le.id):Ke.key==="Escape"&&(ve(null),pe(""))},className:"px-2 py-1 border border-green-300 rounded text-sm w-full max-w-[220px] focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:H}):w.jsxs(w.Fragment,{children:[w.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:Le.title}),w.jsx("button",{type:"button",onClick:()=>Ee(Le),className:"p-1 text-gray-400 hover:text-green-600",title:"",children:w.jsx(mw,{className:"w-3 h-3"})})]})}),w.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[" ",Le.totalPages,"   ",Le.answerKey?"":""]})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("button",{type:"button",onClick:()=>tt(Le),className:"p-1.5 rounded-full bg-white border border-gray-200 text-gray-600 hover:bg-gray-100",title:"",children:w.jsx(wl,{className:"w-4 h-4"})}),w.jsx("button",{type:"button",onClick:()=>void bt(Le.id),className:"p-1.5 rounded-full bg-white border border-gray-200 text-red-600 hover:bg-red-50",title:"",children:w.jsx(yw,{className:"w-4 h-4"})})]})]},Le.id))})]}),w.jsx("div",{className:"md:w-1/2 p-6 flex items-center justify-center",children:w.jsxs("div",{className:"text-sm text-gray-500 space-y-2",children:[w.jsx("p",{className:"font-semibold text-gray-700",children:""}),w.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[w.jsx("li",{children:""}),w.jsxs("li",{children:["",w.jsx("span",{className:"inline-flex items-center px-1",children:w.jsx(mw,{className:"w-3 h-3"})}),""]}),w.jsxs("li",{children:["",w.jsx("span",{className:"inline-flex items-center px-1",children:w.jsx(wl,{className:"w-3 h-3"})}),"",w.jsx("span",{className:"inline-flex items-center px-1",children:w.jsx(yw,{className:"w-3 h-3"})}),""]}),w.jsx("li",{children:" AI "})]})]})})]})]}),ne&&w.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:w.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[w.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:""}),w.jsx("p",{className:"text-xs text-gray-500",children:""})]}),w.jsx("button",{type:"button",onClick:()=>{re(!1),Ve()},className:"p-2 rounded-full hover:bg-gray-100 text-gray-500",children:w.jsx(Bm,{className:"w-4 h-4"})})]}),w.jsxs("form",{onSubmit:We,className:"px-4 py-4 space-y-6",children:[w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx("label",{htmlFor:"classroom",className:"block text-sm font-medium text-gray-700 mb-2",children:""}),w.jsx("select",{id:"classroom",value:n,onChange:Le=>r(Le.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-all bg-white",disabled:H,children:e.map(Le=>w.jsx("option",{value:Le.id,children:Le.name},Le.id))})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"assignmentTitle",className:"block text-sm font-medium text-gray-700 mb-2",children:""}),w.jsx("input",{id:"assignmentTitle",type:"text",value:u,onChange:Le=>d(Le.target.value),placeholder:" 1 ",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-all",disabled:H})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"totalPages",className:"block text-sm font-medium text-gray-700 mb-2",children:""}),w.jsxs("div",{className:"relative",children:[w.jsx("input",{id:"totalPages",type:"number",min:"1",max:"100",value:f,onChange:Le=>p(parseInt(Le.target.value||"1",10)||1),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-all",disabled:H}),w.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm",children:""})]})]})]}),w.jsxs("div",{className:"pt-4 border-t border-gray-200 space-y-3",children:[w.jsx("div",{className:"flex items-center justify-between",children:w.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:""})}),w.jsxs("div",{className:"space-y-2",children:[w.jsx("label",{className:"block text-sm font-medium text-gray-700",children:" PDF"}),w.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:be,disabled:H||E,className:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"}),w.jsx("button",{type:"button",onClick:Te,disabled:!x||H||E,className:"mt-2 inline-flex items-center px-3 py-2 rounded-lg bg-green-600 text-white text-sm hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:E?"AI ":" AI  AnswerKey"}),N&&w.jsx("p",{className:"text-sm text-red-600 mt-1",children:N})]}),y&&w.jsxs("div",{className:"mt-2 border border-gray-200 rounded-xl p-4 bg-gray-50",children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsx("span",{className:"text-sm font-semibold text-gray-800",children:""}),w.jsxs("span",{className:"text-xs text-gray-500",children:["",y.totalScore]})]}),w.jsx("div",{className:"space-y-2 max-h-48 overflow-auto pr-1",children:y.questions.map((Le,Ke)=>w.jsxs("div",{className:"grid grid-cols-[auto,1fr,auto] gap-2 items-center text-xs bg-white rounded-lg px-3 py-2 border border-gray-200",children:[w.jsx("input",{className:"w-14 px-1 py-1 border border-gray-300 rounded",value:Le.id,onChange:Mt=>{const Nt={...y,questions:[...y.questions]};Nt.questions[Ke]={...Nt.questions[Ke],id:Mt.target.value},v(Nt)}}),w.jsx("input",{className:"w-full px-2 py-1 border border-gray-300 rounded",value:Le.answer,onChange:Mt=>{const Nt={...y,questions:[...y.questions]};Nt.questions[Ke]={...Nt.questions[Ke],answer:Mt.target.value},v(Nt)}}),w.jsx("input",{type:"number",className:"w-16 px-1 py-1 border border-gray-300 rounded text-right",value:Le.maxScore,onChange:Mt=>{const Nt={...y,questions:[...y.questions]};Nt.questions[Ke]={...Nt.questions[Ke],maxScore:parseInt(Mt.target.value||"0",10)||0},Nt.totalScore=Nt.questions.reduce((Tl,ra)=>Tl+(ra.maxScore||0),0),v(Nt)}})]},Le.id))})]})]}),ae&&w.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-xl text-red-800 text-sm",children:ae}),w.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[w.jsx("button",{type:"button",onClick:()=>{re(!1),Ve()},className:"px-4 py-2 rounded-lg text-sm bg-white border border-gray-200 text-gray-700 hover:bg-gray-50",children:""}),w.jsx("button",{type:"submit",disabled:H||!u.trim(),className:"inline-flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-sm",children:H?w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),".."]}):w.jsxs(w.Fragment,{children:[w.jsx(Of,{className:"w-4 h-4"}),""]})})]})]})]})}),fe&&ke&&z&&w.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:w.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-xl max-h-[85vh] flex flex-col shadow-2xl",children:[w.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-sm font-semibold text-gray-900",children:""}),w.jsx("p",{className:"text-xs text-gray-500",children:ke.title})]}),w.jsx("button",{type:"button",onClick:()=>Z(!1),className:"p-1 rounded-full hover:bg-gray-100 text-gray-500",children:w.jsx(Bm,{className:"w-4 h-4"})})]}),w.jsxs("div",{className:"flex-1 overflow-auto px-4 py-3 space-y-3",children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsx("span",{className:"text-xs font-semibold text-gray-700",children:""}),w.jsx("input",{type:"number",className:"w-20 px-2 py-1 border border-gray-300 rounded text-xs text-right",value:z.totalScore,onChange:Le=>{const Ke=parseInt(Le.target.value||"0",10)||0;K({...z,totalScore:Ke})}})]}),w.jsxs("div",{className:"space-y-2 max-h-64 overflow-auto",children:[z.questions.map((Le,Ke)=>w.jsxs("div",{className:"grid grid-cols-[auto,1fr,auto] gap-2 items-center text-xs bg-gray-50 rounded-lg px-3 py-2 border border-gray-200",children:[w.jsx("input",{className:"w-14 px-1 py-1 border border-gray-300 rounded",value:Le.id,onChange:Mt=>{const Nt={...z,questions:[...z.questions]};Nt.questions[Ke]={...Nt.questions[Ke],id:Mt.target.value},K(Nt)}}),w.jsx("input",{className:"w-full px-2 py-1 border border-gray-300 rounded",value:Le.answer,onChange:Mt=>{const Nt={...z,questions:[...z.questions]};Nt.questions[Ke]={...Nt.questions[Ke],answer:Mt.target.value},K(Nt)}}),w.jsx("input",{type:"number",className:"w-16 px-1 py-1 border border-gray-300 rounded text-right",value:Le.maxScore,onChange:Mt=>{const Nt={...z,questions:[...z.questions]};Nt.questions[Ke]={...Nt.questions[Ke],maxScore:parseInt(Mt.target.value||"0",10)||0},Nt.totalScore=Nt.questions.reduce((Tl,ra)=>Tl+(ra.maxScore||0),0),K(Nt)}})]},Ke)),w.jsxs("button",{type:"button",onClick:()=>{const Le={...z,questions:[...z.questions,{id:`q${z.questions.length+1}`,answer:"",maxScore:1}]};Le.totalScore=Le.questions.reduce((Ke,Mt)=>Ke+(Mt.maxScore||0),0),K(Le)},className:"mt-1 inline-flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs bg-gray-100 text-gray-700 hover:bg-gray-200",children:[w.jsx(Of,{className:"w-3 h-3"}),""]})]}),N&&w.jsx("p",{className:"text-xs text-red-600",children:N})]}),w.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50 rounded-b-2xl flex justify-end gap-2",children:[w.jsx("button",{type:"button",onClick:()=>Z(!1),className:"px-3 py-1.5 rounded-lg text-xs bg-white border border-gray-300 text-gray-700 hover:bg-gray-50",children:""}),w.jsx("button",{type:"button",disabled:Se,onClick:()=>void Ht(),className:"px-4 py-1.5 rounded-lg text-xs bg-green-600 text-white hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:Se?"":""})]})]})})]})}function $M({onBack:a,onSelectAssignment:e}){var S;const[t,n]=ue.useState([]),[r,s]=ue.useState(!0),[o,u]=ue.useState(null),[d,f]=ue.useState(null),[p,y]=ue.useState(!1),[v,x]=ue.useState(null);return ue.useEffect(()=>{(async()=>{s(!0);try{const T=await ze.assignments.toArray(),N=await Promise.all(T.map(async L=>{const j=await ze.classrooms.get(L.classroomId),F=await ze.submissions.where("assignmentId").equals(L.id).count();return{...L,classroom:j,submissionCount:F}}));n(N)}catch(T){console.error(":",T)}finally{s(!1)}})()},[]),r?w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx(ri,{className:"w-12 h-12 text-purple-600 mx-auto mb-4 animate-spin"}),w.jsx("p",{className:"text-gray-600",children:""})]})}):w.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[w.jsxs("div",{className:"max-w-2xl mx-auto pt-8",children:[a&&w.jsxs("button",{onClick:a,className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[w.jsx(kl,{className:"w-5 h-5"}),""]}),w.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-6",children:w.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[w.jsx("div",{className:"p-3 bg-purple-100 rounded-xl",children:w.jsx(wl,{className:"w-8 h-8 text-purple-600"})}),w.jsxs("div",{children:[w.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"AI "}),w.jsx("p",{className:"text-sm text-gray-600",children:" AI "})]})]})}),t.length===0?w.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[w.jsx(wl,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:""}),w.jsx("p",{className:"text-gray-600 mb-6",children:" AI "})]}):w.jsx("div",{className:"space-y-3",children:t.map(E=>{var T;return w.jsx("div",{onClick:()=>{e==null||e(E.id)},className:"w-full bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-all text-left group cursor-pointer",children:w.jsxs("div",{className:"flex items-center justify-between gap-4",children:[w.jsxs("div",{className:"flex-1",children:[w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 group-hover:text-purple-600 transition-colors",children:E.title}),w.jsxs("p",{className:"text-sm text-gray-600",children:[((T=E.classroom)==null?void 0:T.name)||"","  "," ",E.totalPages," "]}),E.submissionCount!==void 0&&E.submissionCount>0&&w.jsxs("p",{className:"text-xs text-purple-600 font-medium mt-1",children:[" ",E.submissionCount," "]}),!E.answerKey&&w.jsx("p",{className:"text-xs text-red-500 mt-1",children:"AI "})]}),w.jsx("div",{className:"flex flex-col items-end gap-2",children:w.jsx("button",{type:"button",onClick:N=>{N.stopPropagation(),u(E),f(E.answerKey||{questions:[],totalScore:0}),x(null)},className:"px-3 py-1 rounded-full text-[11px] bg-gray-50 text-gray-700 border border-gray-200 hover:bg-gray-100",children:""})})]})},E.id)})})]}),o&&d&&w.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60",onClick:()=>u(null),children:w.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-xl max-h-[80vh] flex flex-col shadow-2xl",onClick:E=>E.stopPropagation(),children:[w.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-2xl",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-sm font-semibold text-gray-900",children:""}),w.jsxs("p",{className:"text-xs text-gray-500",children:[((S=o.classroom)==null?void 0:S.name)||""," "," ",o.title]})]}),w.jsx("button",{type:"button",onClick:()=>u(null),className:"p-1 rounded-full hover:bg-gray-100 text-gray-500",children:w.jsx(Bm,{className:"w-4 h-4"})})]}),w.jsxs("div",{className:"flex-1 overflow-auto px-4 py-3 space-y-3",children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsx("span",{className:"text-xs font-semibold text-gray-700",children:""}),w.jsx("input",{type:"number",className:"w-20 px-2 py-1 border border-gray-300 rounded text-xs text-right",value:d.totalScore,onChange:E=>{const T=Number.parseInt(E.target.value||"0",10)||0;f({...d,totalScore:T})}})]}),w.jsx("div",{className:"space-y-2 max-h-64 overflow-auto",children:d.questions.map((E,T)=>w.jsxs("div",{className:"grid grid-cols-[auto,1fr,auto] gap-2 items-center text-xs bg-gray-50 rounded-lg px-3 py-2 border border-gray-200",children:[w.jsx("input",{className:"w-14 px-1 py-1 border border-gray-300 rounded",value:E.id,onChange:N=>{const L={...d,questions:[...d.questions]};L.questions[T]={...L.questions[T],id:N.target.value},f(L)}}),w.jsx("input",{className:"w-full px-2 py-1 border border-gray-300 rounded",value:E.answer,onChange:N=>{const L={...d,questions:[...d.questions]};L.questions[T]={...L.questions[T],answer:N.target.value},f(L)}}),w.jsx("input",{type:"number",className:"w-16 px-1 py-1 border border-gray-300 rounded text-right",value:E.maxScore,onChange:N=>{const L={...d,questions:[...d.questions]};L.questions[T]={...L.questions[T],maxScore:Number.parseInt(N.target.value||"0",10)||0},L.totalScore=L.questions.reduce((j,F)=>j+(F.maxScore||0),0),f(L)}})]},T))}),w.jsxs("button",{type:"button",onClick:()=>{const E={...d,questions:[...d.questions,{id:`q${d.questions.length+1}`,answer:"",maxScore:1}]};E.totalScore=E.questions.reduce((T,N)=>T+(N.maxScore||0),0),f(E)},className:"mt-2 inline-flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs bg-gray-100 text-gray-700 hover:bg-gray-200",children:[w.jsx(Of,{className:"w-3 h-3"}),""]}),v&&w.jsx("p",{className:"text-xs text-red-600",children:v})]}),w.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50 rounded-b-2xl flex justify-end gap-2",children:[w.jsx("button",{type:"button",onClick:()=>u(null),className:"px-3 py-1.5 rounded-lg text-xs bg-white border border-gray-300 text-gray-700 hover:bg-gray-50",children:""}),w.jsx("button",{type:"button",disabled:p,onClick:async()=>{if(!(!o||!d))try{y(!0),await ze.assignments.update(o.id,{answerKey:d}),u(null),n(E=>E.map(T=>T.id===o.id?{...T,answerKey:d||void 0}:T))}catch(E){console.error(":",E),x("")}finally{y(!1)}},className:"px-4 py-1.5 rounded-lg text-xs bg-green-600 text-white hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:p?"":""})]})]})})]})}var Ra={},yb={},LE=function(a,e){return LE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])},LE(a,e)};function NP(a,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");LE(a,e);function t(){this.constructor=a}a.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Iw=function(){return Iw=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Iw.apply(this,arguments)};function dg(a,e){var t={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&e.indexOf(n)<0&&(t[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(a);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(a,n[r])&&(t[n[r]]=a[n[r]]);return t}function PP(a,e,t,n){var r=arguments.length,s=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,n);else for(var u=a.length-1;u>=0;u--)(o=a[u])&&(s=(r<3?o(s):r>3?o(e,t,s):o(e,t))||s);return r>3&&s&&Object.defineProperty(e,t,s),s}function RP(a,e){return function(t,n){e(t,n,a)}}function IP(a,e,t,n,r,s){function o(N){if(N!==void 0&&typeof N!="function")throw new TypeError("Function expected");return N}for(var u=n.kind,d=u==="getter"?"get":u==="setter"?"set":"value",f=!e&&a?n.static?a:a.prototype:null,p=e||(f?Object.getOwnPropertyDescriptor(f,n.name):{}),y,v=!1,x=t.length-1;x>=0;x--){var S={};for(var E in n)S[E]=E==="access"?{}:n[E];for(var E in n.access)S.access[E]=n.access[E];S.addInitializer=function(N){if(v)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(N||null))};var T=(0,t[x])(u==="accessor"?{get:p.get,set:p.set}:p[d],S);if(u==="accessor"){if(T===void 0)continue;if(T===null||typeof T!="object")throw new TypeError("Object expected");(y=o(T.get))&&(p.get=y),(y=o(T.set))&&(p.set=y),(y=o(T.init))&&r.unshift(y)}else(y=o(T))&&(u==="field"?r.unshift(y):p[d]=y)}f&&Object.defineProperty(f,n.name,p),v=!0}function OP(a,e,t){for(var n=arguments.length>2,r=0;r<e.length;r++)t=n?e[r].call(a,t):e[r].call(a);return n?t:void 0}function jP(a){return typeof a=="symbol"?a:"".concat(a)}function MP(a,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(a,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function DP(a,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,e)}function et(a,e,t,n){function r(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(p){try{f(n.next(p))}catch(y){o(y)}}function d(p){try{f(n.throw(p))}catch(y){o(y)}}function f(p){p.done?s(p.value):r(p.value).then(u,d)}f((n=n.apply(a,e||[])).next())})}function LP(a,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,r,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(f){return function(p){return d([f,p])}}function d(f){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,f[0]&&(t=0)),t;)try{if(n=1,r&&(s=f[0]&2?r.return:f[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,f[1])).done)return s;switch(r=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,r=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){t.label=f[1];break}if(f[0]===6&&t.label<s[1]){t.label=s[1],s=f;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(f);break}s[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(a,t)}catch(p){f=[6,p],r=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}var gx=Object.create?(function(a,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(a,n,r)}):(function(a,e,t,n){n===void 0&&(n=t),a[n]=e[t]});function FP(a,e){for(var t in a)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&gx(e,a,t)}function Ow(a){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&a[e],n=0;if(t)return t.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&n>=a.length&&(a=void 0),{value:a&&a[n++],done:!a}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function gA(a,e){var t=typeof Symbol=="function"&&a[Symbol.iterator];if(!t)return a;var n=t.call(a),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=n.next()).done;)s.push(r.value)}catch(u){o={error:u}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function BP(){for(var a=[],e=0;e<arguments.length;e++)a=a.concat(gA(arguments[e]));return a}function $P(){for(var a=0,e=0,t=arguments.length;e<t;e++)a+=arguments[e].length;for(var n=Array(a),r=0,e=0;e<t;e++)for(var s=arguments[e],o=0,u=s.length;o<u;o++,r++)n[r]=s[o];return n}function UP(a,e,t){if(t||arguments.length===2)for(var n=0,r=e.length,s;n<r;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return a.concat(s||Array.prototype.slice.call(e))}function cg(a){return this instanceof cg?(this.v=a,this):new cg(a)}function zP(a,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(a,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(x){return function(S){return Promise.resolve(S).then(x,y)}}function u(x,S){n[x]&&(r[x]=function(E){return new Promise(function(T,N){s.push([x,E,T,N])>1||d(x,E)})},S&&(r[x]=S(r[x])))}function d(x,S){try{f(n[x](S))}catch(E){v(s[0][3],E)}}function f(x){x.value instanceof cg?Promise.resolve(x.value.v).then(p,y):v(s[0][2],x)}function p(x){d("next",x)}function y(x){d("throw",x)}function v(x,S){x(S),s.shift(),s.length&&d(s[0][0],s[0][1])}}function HP(a){var e,t;return e={},n("next"),n("throw",function(r){throw r}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(r,s){e[r]=a[r]?function(o){return(t=!t)?{value:cg(a[r](o)),done:!1}:s?s(o):o}:s}}function qP(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=a[Symbol.asyncIterator],t;return e?e.call(a):(a=typeof Ow=="function"?Ow(a):a[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=a[s]&&function(o){return new Promise(function(u,d){o=a[s](o),r(u,d,o.done,o.value)})}}function r(s,o,u,d){Promise.resolve(d).then(function(f){s({value:f,done:u})},o)}}function VP(a,e){return Object.defineProperty?Object.defineProperty(a,"raw",{value:e}):a.raw=e,a}var UM=Object.create?(function(a,e){Object.defineProperty(a,"default",{enumerable:!0,value:e})}):function(a,e){a.default=e},FE=function(a){return FE=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},FE(a)};function WP(a){if(a&&a.__esModule)return a;var e={};if(a!=null)for(var t=FE(a),n=0;n<t.length;n++)t[n]!=="default"&&gx(e,a,t[n]);return UM(e,a),e}function GP(a){return a&&a.__esModule?a:{default:a}}function KP(a,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?a!==e||!n:!e.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(a):n?n.value:e.get(a)}function XP(a,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?a!==e||!r:!e.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(a,t):r?r.value=t:e.set(a,t),t}function YP(a,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof a=="function"?e===a:a.has(e)}function JP(a,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var n,r;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=e[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=e[Symbol.dispose],t&&(r=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");r&&(n=function(){try{r.call(this)}catch(s){return Promise.reject(s)}}),a.stack.push({value:e,dispose:n,async:t})}else t&&a.stack.push({async:!0});return e}var zM=typeof SuppressedError=="function"?SuppressedError:function(a,e,t){var n=new Error(t);return n.name="SuppressedError",n.error=a,n.suppressed=e,n};function QP(a){function e(s){a.error=a.hasError?new zM(s,a.error,"An error was suppressed during disposal."):s,a.hasError=!0}var t,n=0;function r(){for(;t=a.stack.pop();)try{if(!t.async&&n===1)return n=0,a.stack.push(t),Promise.resolve().then(r);if(t.dispose){var s=t.dispose.call(t.value);if(t.async)return n|=2,Promise.resolve(s).then(r,function(o){return e(o),r()})}else n|=1}catch(o){e(o)}if(n===1)return a.hasError?Promise.reject(a.error):Promise.resolve();if(a.hasError)throw a.error}return r()}function ZP(a,e){return typeof a=="string"&&/^\.\.?\//.test(a)?a.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,n,r,s,o){return n?e?".jsx":".js":r&&(!s||!o)?t:r+s+"."+o.toLowerCase()+"js"}):a}const HM={__extends:NP,__assign:Iw,__rest:dg,__decorate:PP,__param:RP,__esDecorate:IP,__runInitializers:OP,__propKey:jP,__setFunctionName:MP,__metadata:DP,__awaiter:et,__generator:LP,__createBinding:gx,__exportStar:FP,__values:Ow,__read:gA,__spread:BP,__spreadArrays:$P,__spreadArray:UP,__await:cg,__asyncGenerator:zP,__asyncDelegator:HP,__asyncValues:qP,__makeTemplateObject:VP,__importStar:WP,__importDefault:GP,__classPrivateFieldGet:KP,__classPrivateFieldSet:XP,__classPrivateFieldIn:YP,__addDisposableResource:JP,__disposeResources:QP,__rewriteRelativeImportExtension:ZP},qM=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:JP,get __assign(){return Iw},__asyncDelegator:HP,__asyncGenerator:zP,__asyncValues:qP,__await:cg,__awaiter:et,__classPrivateFieldGet:KP,__classPrivateFieldIn:YP,__classPrivateFieldSet:XP,__createBinding:gx,__decorate:PP,__disposeResources:QP,__esDecorate:IP,__exportStar:FP,__extends:NP,__generator:LP,__importDefault:GP,__importStar:WP,__makeTemplateObject:VP,__metadata:DP,__param:RP,__propKey:jP,__read:gA,__rest:dg,__rewriteRelativeImportExtension:ZP,__runInitializers:OP,__setFunctionName:MP,__spread:BP,__spreadArray:UP,__spreadArrays:$P,__values:Ow,default:HM},Symbol.toStringTag,{value:"Module"})),VM=a=>a?(...e)=>a(...e):(...e)=>fetch(...e);let mx=class extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}},eR=class extends mx{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}},BE=class extends mx{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}},$E=class extends mx{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}};var jw;(function(a){a.Any="any",a.ApNortheast1="ap-northeast-1",a.ApNortheast2="ap-northeast-2",a.ApSouth1="ap-south-1",a.ApSoutheast1="ap-southeast-1",a.ApSoutheast2="ap-southeast-2",a.CaCentral1="ca-central-1",a.EuCentral1="eu-central-1",a.EuWest1="eu-west-1",a.EuWest2="eu-west-2",a.EuWest3="eu-west-3",a.SaEast1="sa-east-1",a.UsEast1="us-east-1",a.UsWest1="us-west-1",a.UsWest2="us-west-2"})(jw||(jw={}));class WM{constructor(e,{headers:t={},customFetch:n,region:r=jw.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=VM(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return et(this,arguments,void 0,function*(t,n={}){var r;let s,o;try{const{headers:u,method:d,body:f,signal:p,timeout:y}=n;let v={},{region:x}=n;x||(x=this.region);const S=new URL(`${this.url}/${t}`);x&&x!=="any"&&(v["x-region"]=x,S.searchParams.set("forceFunctionRegion",x));let E;f&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&f instanceof Blob||f instanceof ArrayBuffer?(v["Content-Type"]="application/octet-stream",E=f):typeof f=="string"?(v["Content-Type"]="text/plain",E=f):typeof FormData<"u"&&f instanceof FormData?E=f:(v["Content-Type"]="application/json",E=JSON.stringify(f)):E=f;let T=p;y&&(o=new AbortController,s=setTimeout(()=>o.abort(),y),p?(T=o.signal,p.addEventListener("abort",()=>o.abort())):T=o.signal);const N=yield this.fetch(S.toString(),{method:d||"POST",headers:Object.assign(Object.assign(Object.assign({},v),this.headers),u),body:E,signal:T}).catch(B=>{throw new eR(B)}),L=N.headers.get("x-relay-error");if(L&&L==="true")throw new BE(N);if(!N.ok)throw new $E(N);let j=((r=N.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),F;return j==="application/json"?F=yield N.json():j==="application/octet-stream"||j==="application/pdf"?F=yield N.blob():j==="text/event-stream"?F=N:j==="multipart/form-data"?F=yield N.formData():F=yield N.text(),{data:F,error:null,response:N}}catch(u){return{data:null,error:u,response:u instanceof $E||u instanceof BE?u.context:void 0}}finally{s&&clearTimeout(s)}})}}const GM=Object.freeze(Object.defineProperty({__proto__:null,get FunctionRegion(){return jw},FunctionsClient:WM,FunctionsError:mx,FunctionsFetchError:eR,FunctionsHttpError:$E,FunctionsRelayError:BE},Symbol.toStringTag,{value:"Module"})),tR=F0(GM);var zr={};const hg=F0(qM);var vb={},bb={},wb={},xb={},_b={},Sb={},_C;function nR(){if(_C)return Sb;_C=1,Object.defineProperty(Sb,"__esModule",{value:!0});class a extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Sb.default=a,Sb}var SC;function rR(){if(SC)return _b;SC=1,Object.defineProperty(_b,"__esModule",{value:!0});const e=hg.__importDefault(nR());let t=class{constructor(r){var s,o;this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=new Headers(r.headers),this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=(s=r.shouldThrowOnError)!==null&&s!==void 0?s:!1,this.signal=r.signal,this.isMaybeSingle=(o=r.isMaybeSingle)!==null&&o!==void 0?o:!1,r.fetch?this.fetch=r.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,s){return this.headers=new Headers(this.headers),this.headers.set(r,s),this}then(r,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let u=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{var f,p,y,v;let x=null,S=null,E=null,T=d.status,N=d.statusText;if(d.ok){if(this.method!=="HEAD"){const B=await d.text();B===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((f=this.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?S=B:S=JSON.parse(B))}const j=(p=this.headers.get("Prefer"))===null||p===void 0?void 0:p.match(/count=(exact|planned|estimated)/),F=(y=d.headers.get("content-range"))===null||y===void 0?void 0:y.split("/");j&&F&&F.length>1&&(E=parseInt(F[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(S)&&(S.length>1?(x={code:"PGRST116",details:`Results contain ${S.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},S=null,E=null,T=406,N="Not Acceptable"):S.length===1?S=S[0]:S=null)}else{const j=await d.text();try{x=JSON.parse(j),Array.isArray(x)&&d.status===404&&(S=[],x=null,T=200,N="OK")}catch{d.status===404&&j===""?(T=204,N="No Content"):x={message:j}}if(x&&this.isMaybeSingle&&(!((v=x==null?void 0:x.details)===null||v===void 0)&&v.includes("0 rows"))&&(x=null,T=200,N="OK"),x&&this.shouldThrowOnError)throw new e.default(x)}return{error:x,data:S,count:E,status:T,statusText:N}});return this.shouldThrowOnError||(u=u.catch(d=>{var f,p,y,v,x,S;let E="";const T=d==null?void 0:d.cause;if(T){const N=(f=T==null?void 0:T.message)!==null&&f!==void 0?f:"",L=(p=T==null?void 0:T.code)!==null&&p!==void 0?p:"";E=`${(y=d==null?void 0:d.name)!==null&&y!==void 0?y:"FetchError"}: ${d==null?void 0:d.message}`,E+=`

Caused by: ${(v=T==null?void 0:T.name)!==null&&v!==void 0?v:"Error"}: ${N}`,L&&(E+=` (${L})`),T!=null&&T.stack&&(E+=`
${T.stack}`)}else E=(x=d==null?void 0:d.stack)!==null&&x!==void 0?x:"";return{error:{message:`${(S=d==null?void 0:d.name)!==null&&S!==void 0?S:"FetchError"}: ${d==null?void 0:d.message}`,details:E,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),u.then(r,s)}returns(){return this}overrideTypes(){return this}};return _b.default=t,_b}var EC;function sR(){if(EC)return xb;EC=1,Object.defineProperty(xb,"__esModule",{value:!0});const e=hg.__importDefault(rR());let t=class extends e.default{select(r){let s=!1;const o=(r??"*").split("").map(u=>/\s/.test(u)&&!s?"":(u==='"'&&(s=!s),u)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(r,{ascending:s=!0,nullsFirst:o,foreignTable:u,referencedTable:d=u}={}){const f=d?`${d}.order`:"order",p=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${p?`${p},`:""}${r}.${s?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:s,referencedTable:o=s}={}){const u=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(u,`${r}`),this}range(r,s,{foreignTable:o,referencedTable:u=o}={}){const d=typeof u>"u"?"offset":`${u}.offset`,f=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(d,`${r}`),this.url.searchParams.set(f,`${s-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:r=!1,verbose:s=!1,settings:o=!1,buffers:u=!1,wal:d=!1,format:f="text"}={}){var p;const y=[r?"analyze":null,s?"verbose":null,o?"settings":null,u?"buffers":null,d?"wal":null].filter(Boolean).join("|"),v=(p=this.headers.get("Accept"))!==null&&p!==void 0?p:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${v}"; options=${y};`),f==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(r){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${r}`),this}};return xb.default=t,xb}var AC;function mA(){if(AC)return wb;AC=1,Object.defineProperty(wb,"__esModule",{value:!0});const e=hg.__importDefault(sR()),t=new RegExp("[,()]");let n=class extends e.default{eq(s,o){return this.url.searchParams.append(s,`eq.${o}`),this}neq(s,o){return this.url.searchParams.append(s,`neq.${o}`),this}gt(s,o){return this.url.searchParams.append(s,`gt.${o}`),this}gte(s,o){return this.url.searchParams.append(s,`gte.${o}`),this}lt(s,o){return this.url.searchParams.append(s,`lt.${o}`),this}lte(s,o){return this.url.searchParams.append(s,`lte.${o}`),this}like(s,o){return this.url.searchParams.append(s,`like.${o}`),this}likeAllOf(s,o){return this.url.searchParams.append(s,`like(all).{${o.join(",")}}`),this}likeAnyOf(s,o){return this.url.searchParams.append(s,`like(any).{${o.join(",")}}`),this}ilike(s,o){return this.url.searchParams.append(s,`ilike.${o}`),this}ilikeAllOf(s,o){return this.url.searchParams.append(s,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(s,o){return this.url.searchParams.append(s,`ilike(any).{${o.join(",")}}`),this}regexMatch(s,o){return this.url.searchParams.append(s,`match.${o}`),this}regexIMatch(s,o){return this.url.searchParams.append(s,`imatch.${o}`),this}is(s,o){return this.url.searchParams.append(s,`is.${o}`),this}isDistinct(s,o){return this.url.searchParams.append(s,`isdistinct.${o}`),this}in(s,o){const u=Array.from(new Set(o)).map(d=>typeof d=="string"&&t.test(d)?`"${d}"`:`${d}`).join(",");return this.url.searchParams.append(s,`in.(${u})`),this}contains(s,o){return typeof o=="string"?this.url.searchParams.append(s,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(s,`cs.{${o.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(o)}`),this}containedBy(s,o){return typeof o=="string"?this.url.searchParams.append(s,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(s,`cd.{${o.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(o)}`),this}rangeGt(s,o){return this.url.searchParams.append(s,`sr.${o}`),this}rangeGte(s,o){return this.url.searchParams.append(s,`nxl.${o}`),this}rangeLt(s,o){return this.url.searchParams.append(s,`sl.${o}`),this}rangeLte(s,o){return this.url.searchParams.append(s,`nxr.${o}`),this}rangeAdjacent(s,o){return this.url.searchParams.append(s,`adj.${o}`),this}overlaps(s,o){return typeof o=="string"?this.url.searchParams.append(s,`ov.${o}`):this.url.searchParams.append(s,`ov.{${o.join(",")}}`),this}textSearch(s,o,{config:u,type:d}={}){let f="";d==="plain"?f="pl":d==="phrase"?f="ph":d==="websearch"&&(f="w");const p=u===void 0?"":`(${u})`;return this.url.searchParams.append(s,`${f}fts${p}.${o}`),this}match(s){return Object.entries(s).forEach(([o,u])=>{this.url.searchParams.append(o,`eq.${u}`)}),this}not(s,o,u){return this.url.searchParams.append(s,`not.${o}.${u}`),this}or(s,{foreignTable:o,referencedTable:u=o}={}){const d=u?`${u}.or`:"or";return this.url.searchParams.append(d,`(${s})`),this}filter(s,o,u){return this.url.searchParams.append(s,`${o}.${u}`),this}};return wb.default=n,wb}var kC;function iR(){if(kC)return bb;kC=1,Object.defineProperty(bb,"__esModule",{value:!0});const e=hg.__importDefault(mA());let t=class{constructor(r,{headers:s={},schema:o,fetch:u}){this.url=r,this.headers=new Headers(s),this.schema=o,this.fetch=u}select(r,s){const{head:o=!1,count:u}=s??{},d=o?"HEAD":"GET";let f=!1;const p=(r??"*").split("").map(y=>/\s/.test(y)&&!f?"":(y==='"'&&(f=!f),y)).join("");return this.url.searchParams.set("select",p),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(r,{count:s,defaultToNull:o=!0}={}){var u;const d="POST";if(s&&this.headers.append("Prefer",`count=${s}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const f=r.reduce((p,y)=>p.concat(Object.keys(y)),[]);if(f.length>0){const p=[...new Set(f)].map(y=>`"${y}"`);this.url.searchParams.set("columns",p.join(","))}}return new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}upsert(r,{onConflict:s,ignoreDuplicates:o=!1,count:u,defaultToNull:d=!0}={}){var f;const p="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),u&&this.headers.append("Prefer",`count=${u}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const y=r.reduce((v,x)=>v.concat(Object.keys(x)),[]);if(y.length>0){const v=[...new Set(y)].map(x=>`"${x}"`);this.url.searchParams.set("columns",v.join(","))}}return new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}update(r,{count:s}={}){var o;const u="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:r}={}){var s;const o="DELETE";return r&&this.headers.append("Prefer",`count=${r}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}};return bb.default=t,bb}var CC;function KM(){if(CC)return vb;CC=1,Object.defineProperty(vb,"__esModule",{value:!0});const a=hg,e=a.__importDefault(iR()),t=a.__importDefault(mA());let n=class oR{constructor(s,{headers:o={},schema:u,fetch:d}={}){this.url=s,this.headers=new Headers(o),this.schemaName=u,this.fetch=d}from(s){if(!s||typeof s!="string"||s.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const o=new URL(`${this.url}/${s}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(s){return new oR(this.url,{headers:this.headers,schema:s,fetch:this.fetch})}rpc(s,o={},{head:u=!1,get:d=!1,count:f}={}){var p;let y;const v=new URL(`${this.url}/rpc/${s}`);let x;u||d?(y=u?"HEAD":"GET",Object.entries(o).filter(([E,T])=>T!==void 0).map(([E,T])=>[E,Array.isArray(T)?`{${T.join(",")}}`:`${T}`]).forEach(([E,T])=>{v.searchParams.append(E,T)})):(y="POST",x=o);const S=new Headers(this.headers);return f&&S.set("Prefer",`count=${f}`),new t.default({method:y,url:v,headers:S,schema:this.schemaName,body:x,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}};return vb.default=n,vb}var TC;function aR(){if(TC)return zr;TC=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.PostgrestError=zr.PostgrestBuilder=zr.PostgrestTransformBuilder=zr.PostgrestFilterBuilder=zr.PostgrestQueryBuilder=zr.PostgrestClient=void 0;const a=hg,e=a.__importDefault(KM());zr.PostgrestClient=e.default;const t=a.__importDefault(iR());zr.PostgrestQueryBuilder=t.default;const n=a.__importDefault(mA());zr.PostgrestFilterBuilder=n.default;const r=a.__importDefault(sR());zr.PostgrestTransformBuilder=r.default;const s=a.__importDefault(rR());zr.PostgrestBuilder=s.default;const o=a.__importDefault(nR());return zr.PostgrestError=o.default,zr.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:r.default,PostgrestBuilder:s.default,PostgrestError:o.default},zr}class lR{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,r=parseInt(n.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const XM="2.87.1",YM=`realtime-js/${XM}`,cR="1.0.0",JM="2.0.0",NC=cR,UE=1e4,QM=1e3,ZM=100;var Xu;(function(a){a[a.connecting=0]="connecting",a[a.open=1]="open",a[a.closing=2]="closing",a[a.closed=3]="closed"})(Xu||(Xu={}));var Vn;(function(a){a.closed="closed",a.errored="errored",a.joined="joined",a.joining="joining",a.leaving="leaving"})(Vn||(Vn={}));var io;(function(a){a.close="phx_close",a.error="phx_error",a.join="phx_join",a.reply="phx_reply",a.leave="phx_leave",a.access_token="access_token"})(io||(io={}));var zE;(function(a){a.websocket="websocket"})(zE||(zE={}));var Yu;(function(a){a.Connecting="connecting",a.Open="open",a.Closing="closing",a.Closed="closed"})(Yu||(Yu={}));class eD{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const r=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(e){var t,n;const r=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:{},o=new TextEncoder().encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,t,n){var r,s;const o=e.topic,u=(r=e.ref)!==null&&r!==void 0?r:"",d=(s=e.join_ref)!==null&&s!==void 0?s:"",f=e.payload.event,p=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},y=Object.keys(p).length===0?"":JSON.stringify(p);if(d.length>255)throw new Error(`joinRef length ${d.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`ref length ${u.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`userEvent length ${f.length} exceeds maximum of 255`);if(y.length>255)throw new Error(`metadata length ${y.length} exceeds maximum of 255`);const v=this.USER_BROADCAST_PUSH_META_LENGTH+d.length+u.length+o.length+f.length+y.length,x=new ArrayBuffer(this.HEADER_LENGTH+v);let S=new DataView(x),E=0;S.setUint8(E++,this.KINDS.userBroadcastPush),S.setUint8(E++,d.length),S.setUint8(E++,u.length),S.setUint8(E++,o.length),S.setUint8(E++,f.length),S.setUint8(E++,y.length),S.setUint8(E++,t),Array.from(d,N=>S.setUint8(E++,N.charCodeAt(0))),Array.from(u,N=>S.setUint8(E++,N.charCodeAt(0))),Array.from(o,N=>S.setUint8(E++,N.charCodeAt(0))),Array.from(f,N=>S.setUint8(E++,N.charCodeAt(0))),Array.from(y,N=>S.setUint8(E++,N.charCodeAt(0)));var T=new Uint8Array(x.byteLength+n.byteLength);return T.set(new Uint8Array(x),0),T.set(new Uint8Array(n),x.byteLength),T.buffer}decode(e,t){if(this._isArrayBuffer(e)){let n=this._binaryDecode(e);return t(n)}if(typeof e=="string"){const n=JSON.parse(e),[r,s,o,u,d]=n;return t({join_ref:r,ref:s,topic:o,event:u,payload:d})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),r=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,r)}}_decodeUserBroadcast(e,t,n){const r=t.getUint8(1),s=t.getUint8(2),o=t.getUint8(3),u=t.getUint8(4);let d=this.HEADER_LENGTH+4;const f=n.decode(e.slice(d,d+r));d=d+r;const p=n.decode(e.slice(d,d+s));d=d+s;const y=n.decode(e.slice(d,d+o));d=d+o;const v=e.slice(d,e.byteLength),x=u===this.JSON_ENCODING?JSON.parse(n.decode(v)):v,S={type:this.BROADCAST_EVENT,event:p,payload:x};return o>0&&(S.meta=JSON.parse(y)),{join_ref:null,ref:null,topic:f,event:this.BROADCAST_EVENT,payload:S}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n)))}}class uR{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var un;(function(a){a.abstime="abstime",a.bool="bool",a.date="date",a.daterange="daterange",a.float4="float4",a.float8="float8",a.int2="int2",a.int4="int4",a.int4range="int4range",a.int8="int8",a.int8range="int8range",a.json="json",a.jsonb="jsonb",a.money="money",a.numeric="numeric",a.oid="oid",a.reltime="reltime",a.text="text",a.time="time",a.timestamp="timestamp",a.timestamptz="timestamptz",a.timetz="timetz",a.tsrange="tsrange",a.tstzrange="tstzrange"})(un||(un={}));const PC=(a,e,t={})=>{var n;const r=(n=t.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((s,o)=>(s[o]=tD(o,a,e,r),s),{}):{}},tD=(a,e,t,n)=>{const r=e.find(u=>u.name===a),s=r==null?void 0:r.type,o=t[a];return s&&!n.includes(s)?dR(s,o):HE(o)},dR=(a,e)=>{if(a.charAt(0)==="_"){const t=a.slice(1,a.length);return iD(e,t)}switch(a){case un.bool:return nD(e);case un.float4:case un.float8:case un.int2:case un.int4:case un.int8:case un.numeric:case un.oid:return rD(e);case un.json:case un.jsonb:return sD(e);case un.timestamp:return oD(e);case un.abstime:case un.date:case un.daterange:case un.int4range:case un.int8range:case un.money:case un.reltime:case un.text:case un.time:case un.timestamptz:case un.timetz:case un.tsrange:case un.tstzrange:return HE(e);default:return HE(e)}},HE=a=>a,nD=a=>{switch(a){case"t":return!0;case"f":return!1;default:return a}},rD=a=>{if(typeof a=="string"){const e=parseFloat(a);if(!Number.isNaN(e))return e}return a},sD=a=>{if(typeof a=="string")try{return JSON.parse(a)}catch(e){return console.log(`JSON parse error: ${e}`),a}return a},iD=(a,e)=>{if(typeof a!="string")return a;const t=a.length-1,n=a[t];if(a[0]==="{"&&n==="}"){let s;const o=a.slice(1,t);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(u=>dR(e,u))}return a},oD=a=>typeof a=="string"?a.replace(" ","T"):a,hR=a=>{const e=new URL(a);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Q_{constructor(e,t,n={},r=UE){this.channel=e,this.event=t,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var qE;(function(a){a.SYNC="sync",a.JOIN="join",a.LEAVE="leave"})(qE||(qE={}));let fR=class uw{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},r=>{const{onJoin:s,onLeave:o,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=uw.syncState(this.state,r,s,o),this.pendingDiffs.forEach(d=>{this.state=uw.syncDiff(this.state,d,s,o)}),this.pendingDiffs=[],u()}),this.channel._on(n.diff,{},r=>{const{onJoin:s,onLeave:o,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=uw.syncDiff(this.state,r,s,o),u())}),this.onJoin((r,s,o)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:s,newPresences:o})}),this.onLeave((r,s,o)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,r){const s=this.cloneDeep(e),o=this.transformState(t),u={},d={};return this.map(s,(f,p)=>{o[f]||(d[f]=p)}),this.map(o,(f,p)=>{const y=s[f];if(y){const v=p.map(T=>T.presence_ref),x=y.map(T=>T.presence_ref),S=p.filter(T=>x.indexOf(T.presence_ref)<0),E=y.filter(T=>v.indexOf(T.presence_ref)<0);S.length>0&&(u[f]=S),E.length>0&&(d[f]=E)}else u[f]=p}),this.syncDiff(s,{joins:u,leaves:d},n,r)}static syncDiff(e,t,n,r){const{joins:s,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(s,(u,d)=>{var f;const p=(f=e[u])!==null&&f!==void 0?f:[];if(e[u]=this.cloneDeep(d),p.length>0){const y=e[u].map(x=>x.presence_ref),v=p.filter(x=>y.indexOf(x.presence_ref)<0);e[u].unshift(...v)}n(u,p,d)}),this.map(o,(u,d)=>{let f=e[u];if(!f)return;const p=d.map(y=>y.presence_ref);f=f.filter(y=>p.indexOf(y.presence_ref)<0),e[u]=f,r(u,f,d),f.length===0&&delete e[u]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const r=e[n];return"metas"in r?t[n]=r.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[n]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var VE;(function(a){a.ALL="*",a.INSERT="INSERT",a.UPDATE="UPDATE",a.DELETE="DELETE"})(VE||(VE={}));var Df;(function(a){a.BROADCAST="broadcast",a.PRESENCE="presence",a.POSTGRES_CHANGES="postgres_changes",a.SYSTEM="system"})(Df||(Df={}));var Ro;(function(a){a.SUBSCRIBED="SUBSCRIBED",a.TIMED_OUT="TIMED_OUT",a.CLOSED="CLOSED",a.CHANNEL_ERROR="CHANNEL_ERROR"})(Ro||(Ro={}));const aD=Vn;let pR=class Om{constructor(e,t={config:{}},n){var r,s;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Vn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Q_(this,io.join,this.params,this.timeout),this.rejoinTimer=new uR(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Vn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Vn.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Vn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Vn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Vn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(io.reply,{},(o,u)=>{this._trigger(this._replyEventName(u),o)}),this.presence=new fR(this),this.broadcastEndpointURL=hR(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((s=(r=this.params.config)===null||r===void 0?void 0:r.broadcast)===null||s===void 0)&&s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var n,r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Vn.closed){const{config:{broadcast:o,presence:u,private:d}}=this.params,f=(r=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(x=>x.filter))!==null&&r!==void 0?r:[],p=!!this.bindings[Df.PRESENCE]&&this.bindings[Df.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,y={},v={broadcast:o,presence:Object.assign(Object.assign({},u),{enabled:p}),postgres_changes:f,private:d};this.socket.accessTokenValue&&(y.access_token=this.socket.accessTokenValue),this._onError(x=>e==null?void 0:e(Ro.CHANNEL_ERROR,x)),this._onClose(()=>e==null?void 0:e(Ro.CLOSED)),this.updateJoinPayload(Object.assign({config:v},y)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:x})=>{var S;if(this.socket._isManualToken()||this.socket.setAuth(),x===void 0){e==null||e(Ro.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,T=(S=E==null?void 0:E.length)!==null&&S!==void 0?S:0,N=[];for(let L=0;L<T;L++){const j=E[L],{filter:{event:F,schema:B,table:$,filter:H}}=j,W=x&&x[L];if(W&&W.event===F&&Om.isFilterValueEqual(W.schema,B)&&Om.isFilterValueEqual(W.table,$)&&Om.isFilterValueEqual(W.filter,H))N.push(Object.assign(Object.assign({},j),{id:W.id}));else{this.unsubscribe(),this.state=Vn.errored,e==null||e(Ro.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=N,e&&e(Ro.SUBSCRIBED);return}}).receive("error",x=>{this.state=Vn.errored,e==null||e(Ro.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(x).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ro.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Vn.joined&&e===Df.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,n)}async httpSend(e,t,n={}){var r;const s=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:s,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);if(u.status===202)return{success:!0};let d=u.statusText;try{const f=await u.json();d=f.error||f.message||d}catch{}return Promise.reject(new Error(d))}async send(e,t={}){var n,r;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:o}=e,d={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const f=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((r=f.body)===null||r===void 0?void 0:r.cancel()),f.ok?"ok":"error"}catch(f){return f.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var o,u,d;const f=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((d=(u=(o=this.params)===null||o===void 0?void 0:o.config)===null||u===void 0?void 0:u.broadcast)===null||d===void 0)&&d.ack)&&s("ok"),f.receive("ok",()=>s("ok")),f.receive("error",()=>s("error")),f.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Vn.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(io.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new Q_(this,io.leave,{},e),n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Vn.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const r=new AbortController,s=setTimeout(()=>r.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(s),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Q_(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>ZM){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var r,s;const o=e.toLocaleLowerCase(),{close:u,error:d,leave:f,join:p}=io;if(n&&[u,d,f,p].indexOf(o)>=0&&n!==this._joinRef())return;let v=this._onMessage(o,t,n);if(t&&!v)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(x=>{var S,E,T;return((S=x.filter)===null||S===void 0?void 0:S.event)==="*"||((T=(E=x.filter)===null||E===void 0?void 0:E.event)===null||T===void 0?void 0:T.toLocaleLowerCase())===o}).map(x=>x.callback(v,n)):(s=this.bindings[o])===null||s===void 0||s.filter(x=>{var S,E,T,N,L,j;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in x){const F=x.id,B=(S=x.filter)===null||S===void 0?void 0:S.event;return F&&((E=t.ids)===null||E===void 0?void 0:E.includes(F))&&(B==="*"||(B==null?void 0:B.toLocaleLowerCase())===((T=t.data)===null||T===void 0?void 0:T.type.toLocaleLowerCase()))}else{const F=(L=(N=x==null?void 0:x.filter)===null||N===void 0?void 0:N.event)===null||L===void 0?void 0:L.toLocaleLowerCase();return F==="*"||F===((j=t==null?void 0:t.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return x.type.toLocaleLowerCase()===o}).map(x=>{if(typeof v=="object"&&"ids"in v){const S=v.data,{schema:E,table:T,commit_timestamp:N,type:L,errors:j}=S;v=Object.assign(Object.assign({},{schema:E,table:T,commit_timestamp:N,eventType:L,new:{},old:{},errors:j}),this._getPayloadRecords(S))}x.callback(v,n)})}_isClosed(){return this.state===Vn.closed}_isJoined(){return this.state===Vn.joined}_isJoining(){return this.state===Vn.joining}_isLeaving(){return this.state===Vn.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const r=e.toLocaleLowerCase(),s={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(s):this.bindings[r]=[s],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(r=>{var s;return!(((s=r.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&Om.isEqual(r.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(io.close,{},e)}_onError(e){this._on(io.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Vn.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=PC(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=PC(e.columns,e.old_record)),t}};const Z_=()=>{},Eb={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},lD=[1e3,2e3,5e3,1e4],cD=1e4,uD=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;let dD=class{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=UE,this.transport=null,this.heartbeatIntervalMs=Eb.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Z_,this.ref=0,this.reconnectTimer=null,this.vsn=NC,this.logger=Z_,this.conn=null,this.sendBuffer=[],this.serializer=new eD,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>r?(...s)=>r(...s):(...s)=>fetch(...s),!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${zE.websocket}`,this.httpEndpoint=hR(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=lR.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Xu.connecting:return Yu.Connecting;case Xu.open:return Yu.Open;case Xu.closing:return Yu.Closing;default:return Yu.Closed}}isConnected(){return this.connectionState()===Yu.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,r=this.getChannels().find(s=>s.topic===n);if(r)return r;{const s=new pR(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:n,payload:r,ref:s}=e,o=()=>{this.encode(e,u=>{var d;(d=this.conn)===null||d===void 0||d.send(u)})};this.log("push",`${t} ${n} (${s})`,r),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(QM,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Eb.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(f){this.log("error","error in heartbeat callback",f)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:r,payload:s,ref:o}=t,u=o?`(${o})`:"",d=s.status||"";this.log("receive",`${d} ${n} ${r} ${u}`.trim(),s),this.channels.filter(f=>f._isMember(n)).forEach(f=>f._trigger(r,s,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Xu.open||this.conn.readyState===Xu.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(io.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${n}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([uD],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,n=!1;if(e)t=e,n=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(r){this.log("error","Error fetching access token from callback",r),t=this.accessTokenValue}else t=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:YM};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(io.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new uR(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Eb.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,r,s,o,u,d,f,p,y,v,x;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:UE,this.heartbeatIntervalMs=(r=e==null?void 0:e.heartbeatIntervalMs)!==null&&r!==void 0?r:Eb.HEARTBEAT_INTERVAL,this.worker=(s=e==null?void 0:e.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(u=e==null?void 0:e.heartbeatCallback)!==null&&u!==void 0?u:Z_,this.vsn=(d=e==null?void 0:e.vsn)!==null&&d!==void 0?d:NC,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=e==null?void 0:e.reconnectAfterMs)!==null&&f!==void 0?f:(S=>lD[S-1]||cD),this.vsn){case cR:this.encode=(p=e==null?void 0:e.encode)!==null&&p!==void 0?p:((S,E)=>E(JSON.stringify(S))),this.decode=(y=e==null?void 0:e.decode)!==null&&y!==void 0?y:((S,E)=>E(JSON.parse(S)));break;case JM:this.encode=(v=e==null?void 0:e.encode)!==null&&v!==void 0?v:this.serializer.encode.bind(this.serializer),this.decode=(x=e==null?void 0:e.decode)!==null&&x!==void 0?x:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}};const hD=Object.freeze(Object.defineProperty({__proto__:null,REALTIME_CHANNEL_STATES:aD,get REALTIME_LISTEN_TYPES(){return Df},get REALTIME_POSTGRES_CHANGES_LISTEN_EVENT(){return VE},get REALTIME_PRESENCE_LISTEN_EVENTS(){return qE},get REALTIME_SUBSCRIBE_STATES(){return Ro},RealtimeChannel:pR,RealtimeClient:dD,RealtimePresence:fR,WebSocketFactory:lR},Symbol.toStringTag,{value:"Module"})),gR=F0(hD);class G0 extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Sn(a){return typeof a=="object"&&a!==null&&"__isStorageError"in a}class mR extends G0{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Mw extends G0{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const yA=a=>a?(...e)=>a(...e):(...e)=>fetch(...e),fD=()=>Response,WE=a=>{if(Array.isArray(a))return a.map(t=>WE(t));if(typeof a=="function"||a!==Object(a))return a;const e={};return Object.entries(a).forEach(([t,n])=>{const r=t.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[r]=WE(n)}),e},pD=a=>{if(typeof a!="object"||a===null)return!1;const e=Object.getPrototypeOf(a);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)},gD=a=>!a||typeof a!="string"||a.length===0||a.length>100||a.trim()!==a||a.includes("/")||a.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(a),eS=a=>{var e;return a.msg||a.message||a.error_description||(typeof a.error=="string"?a.error:(e=a.error)===null||e===void 0?void 0:e.message)||JSON.stringify(a)},mD=(a,e,t)=>et(void 0,void 0,void 0,function*(){const n=yield fD();a instanceof n&&!(t!=null&&t.noResolveJson)?a.json().then(r=>{const s=a.status||500,o=(r==null?void 0:r.statusCode)||s+"";e(new mR(eS(r),s,o))}).catch(r=>{e(new Mw(eS(r),r))}):e(new Mw(eS(a),a))}),yD=(a,e,t,n)=>{const r={method:a,headers:(e==null?void 0:e.headers)||{}};return a==="GET"||!n?r:(pD(n)?(r.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r.body=JSON.stringify(n)):r.body=n,e!=null&&e.duplex&&(r.duplex=e.duplex),Object.assign(Object.assign({},r),t))};function K0(a,e,t,n,r,s){return et(this,void 0,void 0,function*(){return new Promise((o,u)=>{a(t,yD(e,n,r,s)).then(d=>{if(!d.ok)throw d;return n!=null&&n.noResolveJson?d:d.json()}).then(d=>o(d)).catch(d=>mD(d,u,n))})})}function Gm(a,e,t,n){return et(this,void 0,void 0,function*(){return K0(a,"GET",e,t,n)})}function Wi(a,e,t,n,r){return et(this,void 0,void 0,function*(){return K0(a,"POST",e,n,r,t)})}function GE(a,e,t,n,r){return et(this,void 0,void 0,function*(){return K0(a,"PUT",e,n,r,t)})}function vD(a,e,t,n){return et(this,void 0,void 0,function*(){return K0(a,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function vA(a,e,t,n,r){return et(this,void 0,void 0,function*(){return K0(a,"DELETE",e,n,r,t)})}class bD{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return et(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Sn(e))return{data:null,error:e};throw e}})}}var yR;class wD{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[yR]="BlobDownloadBuilder",this.promise=null}asStream(){return new bD(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return et(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Sn(e))return{data:null,error:e};throw e}})}}yR=Symbol.toStringTag;const xD={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},RC={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class _D{constructor(e,t={},n,r){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=yA(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,n,r){return et(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},RC),r);let u=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const d=o.metadata;typeof Blob<"u"&&n instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),d&&s.append("metadata",this.encodeMetadata(d)),s.append("",n)):typeof FormData<"u"&&n instanceof FormData?(s=n,s.has("cacheControl")||s.append("cacheControl",o.cacheControl),d&&!s.has("metadata")&&s.append("metadata",this.encodeMetadata(d))):(s=n,u["cache-control"]=`max-age=${o.cacheControl}`,u["content-type"]=o.contentType,d&&(u["x-metadata"]=this.toBase64(this.encodeMetadata(d))),(typeof ReadableStream<"u"&&s instanceof ReadableStream||s&&typeof s=="object"&&"pipe"in s&&typeof s.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(u=Object.assign(Object.assign({},u),r.headers));const f=this._removeEmptyFolders(t),p=this._getFinalPath(f),y=yield(e=="PUT"?GE:Wi)(this.fetch,`${this.url}/object/${p}`,s,Object.assign({headers:u},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:f,id:y.Id,fullPath:y.Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Sn(s))return{data:null,error:s};throw s}})}upload(e,t,n){return et(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,r){return et(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),u=new URL(this.url+`/object/upload/sign/${o}`);u.searchParams.set("token",t);try{let d;const f=Object.assign({upsert:RC.upsert},r),p=Object.assign(Object.assign({},this.headers),{"x-upsert":String(f.upsert)});typeof Blob<"u"&&n instanceof Blob?(d=new FormData,d.append("cacheControl",f.cacheControl),d.append("",n)):typeof FormData<"u"&&n instanceof FormData?(d=n,d.append("cacheControl",f.cacheControl)):(d=n,p["cache-control"]=`max-age=${f.cacheControl}`,p["content-type"]=f.contentType);const y=yield GE(this.fetch,u.toString(),d,{headers:p});return{data:{path:s,fullPath:y.Key},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Sn(d))return{data:null,error:d};throw d}})}createSignedUploadUrl(e,t){return et(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const r=Object.assign({},this.headers);t!=null&&t.upsert&&(r["x-upsert"]="true");const s=yield Wi(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:r}),o=new URL(this.url+s.url),u=o.searchParams.get("token");if(!u)throw new G0("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:u},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Sn(n))return{data:null,error:n};throw n}})}update(e,t,n){return et(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return et(this,void 0,void 0,function*(){try{return{data:yield Wi(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Sn(r))return{data:null,error:r};throw r}})}copy(e,t,n){return et(this,void 0,void 0,function*(){try{return{data:{path:(yield Wi(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Sn(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,n){return et(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),s=yield Wi(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Sn(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,n){return et(this,void 0,void 0,function*(){try{const r=yield Wi(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:r.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Sn(r))return{data:null,error:r};throw r}})}download(e,t){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=s?`?${s}`:"",u=this._getFinalPath(e),d=()=>Gm(this.fetch,`${this.url}/${r}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new wD(d,this.shouldThrowOnError)}info(e){return et(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield Gm(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:WE(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Sn(n))return{data:null,error:n};throw n}})}exists(e){return et(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield vD(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Sn(n)&&n instanceof Mw){const r=n.originalError;if([400,404].includes(r==null?void 0:r.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],s=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&r.push(s);const u=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",d=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});d!==""&&r.push(d);let f=r.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${n}${f}`)}}}remove(e){return et(this,void 0,void 0,function*(){try{return{data:yield vA(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Sn(t))return{data:null,error:t};throw t}})}list(e,t,n){return et(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},xD),t),{prefix:e||""});return{data:yield Wi(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Sn(r))return{data:null,error:r};throw r}})}listV2(e,t){return et(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield Wi(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Sn(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const vR="2.87.1",bR={"X-Client-Info":`storage-js/${vR}`};class SD{constructor(e,t={},n,r){this.shouldThrowOnError=!1;const s=new URL(e);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},bR),t),this.fetch=yA(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return et(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield Gm(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Sn(t))return{data:null,error:t};throw t}})}getBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield Gm(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Sn(t))return{data:null,error:t};throw t}})}createBucket(e){return et(this,arguments,void 0,function*(t,n={public:!1}){try{return{data:yield Wi(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Sn(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return et(this,void 0,void 0,function*(){try{return{data:yield GE(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Sn(n))return{data:null,error:n};throw n}})}emptyBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield Wi(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Sn(t))return{data:null,error:t};throw t}})}deleteBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield vA(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Sn(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}var Km=class extends Error{constructor(a,e){var t;super(a),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((t=e.icebergType)==null?void 0:t.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function ED(a,e,t){const n=new URL(e,a);if(t)for(const[r,s]of Object.entries(t))s!==void 0&&n.searchParams.set(r,s);return n.toString()}async function AD(a){return!a||a.type==="none"?{}:a.type==="bearer"?{Authorization:`Bearer ${a.token}`}:a.type==="header"?{[a.name]:a.value}:a.type==="custom"?await a.getHeaders():{}}function kD(a){const e=a.fetchImpl??globalThis.fetch;return{async request({method:t,path:n,query:r,body:s,headers:o}){const u=ED(a.baseUrl,n,r),d=await AD(a.auth),f=await e(u,{method:t,headers:{...s?{"Content-Type":"application/json"}:{},...d,...o},body:s?JSON.stringify(s):void 0}),p=await f.text(),y=(f.headers.get("content-type")||"").includes("application/json"),v=y&&p?JSON.parse(p):p;if(!f.ok){const x=y?v:void 0,S=x==null?void 0:x.error;throw new Km((S==null?void 0:S.message)??`Request failed with status ${f.status}`,{status:f.status,icebergType:S==null?void 0:S.type,icebergCode:S==null?void 0:S.code,details:x})}return{status:f.status,headers:f.headers,data:v}}}}function Ab(a){return a.join("")}var CD=class{constructor(a,e=""){this.client=a,this.prefix=e}async listNamespaces(a){const e=a?{parent:Ab(a.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(a,e){const t={namespace:a.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(a){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ab(a.namespace)}`})}async loadNamespaceMetadata(a){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ab(a.namespace)}`})).data.properties}}async namespaceExists(a){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ab(a.namespace)}`}),!0}catch(e){if(e instanceof Km&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(a,e){try{return await this.createNamespace(a,e)}catch(t){if(t instanceof Km&&t.status===409)return;throw t}}};function cf(a){return a.join("")}var TD=class{constructor(a,e="",t){this.client=a,this.prefix=e,this.accessDelegation=t}async listTables(a){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${cf(a.namespace)}/tables`})).data.identifiers}async createTable(a,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${cf(a.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(a,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${cf(a.namespace)}/tables/${a.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(a,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${cf(a.namespace)}/tables/${a.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(a){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${cf(a.namespace)}/tables/${a.name}`,headers:e})).data.metadata}async tableExists(a){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${cf(a.namespace)}/tables/${a.name}`,headers:e}),!0}catch(t){if(t instanceof Km&&t.status===404)return!1;throw t}}async createTableIfNotExists(a,e){try{return await this.createTable(a,e)}catch(t){if(t instanceof Km&&t.status===409)return await this.loadTable({namespace:a.namespace,name:e.name});throw t}}},ND=class{constructor(a){var n;let e="v1";a.catalogName&&(e+=`/${a.catalogName}`);const t=a.baseUrl.endsWith("/")?a.baseUrl:`${a.baseUrl}/`;this.client=kD({baseUrl:t,auth:a.auth,fetchImpl:a.fetch}),this.accessDelegation=(n=a.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new CD(this.client,e),this.tableOps=new TD(this.client,e,this.accessDelegation)}async listNamespaces(a){return this.namespaceOps.listNamespaces(a)}async createNamespace(a,e){return this.namespaceOps.createNamespace(a,e)}async dropNamespace(a){await this.namespaceOps.dropNamespace(a)}async loadNamespaceMetadata(a){return this.namespaceOps.loadNamespaceMetadata(a)}async listTables(a){return this.tableOps.listTables(a)}async createTable(a,e){return this.tableOps.createTable(a,e)}async updateTable(a,e){return this.tableOps.updateTable(a,e)}async dropTable(a,e){await this.tableOps.dropTable(a,e)}async loadTable(a){return this.tableOps.loadTable(a)}async namespaceExists(a){return this.namespaceOps.namespaceExists(a)}async tableExists(a){return this.tableOps.tableExists(a)}async createNamespaceIfNotExists(a,e){return this.namespaceOps.createNamespaceIfNotExists(a,e)}async createTableIfNotExists(a,e){return this.tableOps.createTableIfNotExists(a,e)}};class wR{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},bR),t),this.fetch=yA(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield Wi(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Sn(t))return{data:null,error:t};throw t}})}listBuckets(e){return et(this,void 0,void 0,function*(){try{const t=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&t.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&t.set("sortOrder",e.sortOrder),e!=null&&e.search&&t.set("search",e.search);const n=t.toString(),r=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`;return{data:yield Gm(this.fetch,r,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Sn(t))return{data:null,error:t};throw t}})}deleteBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield vA(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Sn(t))return{data:null,error:t};throw t}})}from(e){if(!gD(e))throw new G0("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new ND({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:()=>et(this,void 0,void 0,function*(){return this.headers})},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(t,{get(s,o){const u=s[o];return typeof u!="function"?u:(...d)=>et(this,void 0,void 0,function*(){try{return{data:yield u.apply(s,d),error:null}}catch(f){if(n)throw f;return{data:null,error:f}}})}})}}const bA={"X-Client-Info":`storage-js/${vR}`,"Content-Type":"application/json"};class wA extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Ts(a){return typeof a=="object"&&a!==null&&"__isStorageVectorsError"in a}class dw extends wA{constructor(e,t,n){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class xR extends wA{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var KE;(function(a){a.InternalError="InternalError",a.S3VectorConflictException="S3VectorConflictException",a.S3VectorNotFoundException="S3VectorNotFoundException",a.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",a.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",a.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(KE||(KE={}));const yx=a=>a?(...e)=>a(...e):(...e)=>fetch(...e),PD=()=>Response,_R=a=>{if(typeof a!="object"||a===null)return!1;const e=Object.getPrototypeOf(a);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)},RD=a=>Array.from(new Float32Array(a)),ID=(a,e)=>{if(e!==void 0&&a.float32.length!==e)throw new Error(`Vector dimension mismatch: expected ${e}, got ${a.float32.length}`)},IC=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),OD=(a,e,t)=>et(void 0,void 0,void 0,function*(){if(a&&typeof a=="object"&&"status"in a&&"ok"in a&&typeof a.status=="number"&&!(t!=null&&t.noResolveJson)){const r=a.status||500,s=a;if(typeof s.json=="function")s.json().then(o=>{const u=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||r+"";e(new dw(IC(o),r,u))}).catch(()=>{const o=r+"",u=s.statusText||`HTTP ${r} error`;e(new dw(u,r,o))});else{const o=r+"",u=s.statusText||`HTTP ${r} error`;e(new dw(u,r,o))}}else e(new xR(IC(a),a))}),jD=(a,e,t,n)=>{const r={method:a,headers:(e==null?void 0:e.headers)||{}};return n?(_R(n)?(r.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r.body=JSON.stringify(n)):r.body=n,Object.assign(Object.assign({},r),t)):r};function MD(a,e,t,n,r,s){return et(this,void 0,void 0,function*(){return new Promise((o,u)=>{a(t,jD(e,n,r,s)).then(d=>{if(!d.ok)throw d;if(n!=null&&n.noResolveJson)return d;const f=d.headers.get("content-type");return!f||!f.includes("application/json")?{}:d.json()}).then(d=>o(d)).catch(d=>OD(d,u,n))})})}function ti(a,e,t,n,r){return et(this,void 0,void 0,function*(){return MD(a,"POST",e,n,r,t)})}class SR{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},bA),t),this.fetch=yx(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return et(this,void 0,void 0,function*(){try{return{data:(yield ti(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}getIndex(e,t){return et(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ts(n))return{data:null,error:n};throw n}})}listIndexes(e){return et(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return et(this,void 0,void 0,function*(){try{return{data:(yield ti(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ts(n))return{data:null,error:n};throw n}})}}class ER{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},bA),t),this.fetch=yx(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return et(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield ti(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}getVectors(e){return et(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}listVectors(e){return et(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield ti(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}queryVectors(e){return et(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}deleteVectors(e){return et(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield ti(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}}class AR{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},bA),t),this.fetch=yx(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return et(this,void 0,void 0,function*(){try{return{data:(yield ti(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}getBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}listBuckets(){return et(this,arguments,void 0,function*(e={}){try{return{data:yield ti(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}deleteBucket(e){return et(this,void 0,void 0,function*(){try{return{data:(yield ti(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ts(t))return{data:null,error:t};throw t}})}}class kR extends AR{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new CR(this.url,this.headers,e,this.fetch)}createBucket(e){const t=Object.create(null,{createBucket:{get:()=>super.createBucket}});return et(this,void 0,void 0,function*(){return t.createBucket.call(this,e)})}getBucket(e){const t=Object.create(null,{getBucket:{get:()=>super.getBucket}});return et(this,void 0,void 0,function*(){return t.getBucket.call(this,e)})}listBuckets(){const e=Object.create(null,{listBuckets:{get:()=>super.listBuckets}});return et(this,arguments,void 0,function*(t={}){return e.listBuckets.call(this,t)})}deleteBucket(e){const t=Object.create(null,{deleteBucket:{get:()=>super.deleteBucket}});return et(this,void 0,void 0,function*(){return t.deleteBucket.call(this,e)})}}class CR extends SR{constructor(e,t,n,r){super(e,t,r),this.vectorBucketName=n}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return et(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return et(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return et(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return et(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new TR(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class TR extends ER{constructor(e,t,n,r,s){super(e,t,s),this.vectorBucketName=n,this.indexName=r}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return et(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return et(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return et(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return et(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return et(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class DD extends SD{constructor(e,t={},n,r){super(e,t,n,r)}from(e){return new _D(this.url,this.headers,e,this.fetch)}get vectors(){return new kR(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new wR(this.url+"/iceberg",this.headers,this.fetch)}}const LD=Object.freeze(Object.defineProperty({__proto__:null,StorageAnalyticsClient:wR,StorageApiError:mR,StorageClient:DD,StorageError:G0,StorageUnknownError:Mw,StorageVectorsApiError:dw,StorageVectorsClient:kR,StorageVectorsError:wA,get StorageVectorsErrorCode(){return KE},StorageVectorsUnknownError:xR,VectorBucketApi:AR,VectorBucketScope:CR,VectorDataApi:ER,VectorIndexApi:SR,VectorIndexScope:TR,isPlainObject:_R,isStorageError:Sn,isStorageVectorsError:Ts,normalizeToFloat32:RD,resolveFetch:yx,resolveResponse:PD,validateVectorDimension:ID},Symbol.toStringTag,{value:"Module"})),FD=F0(LD);var tS={},lm={},OC;function BD(){return OC||(OC=1,Object.defineProperty(lm,"__esModule",{value:!0}),lm.version=void 0,lm.version="2.87.1"),lm}var jC;function $D(){return jC||(jC=1,(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.DEFAULT_REALTIME_OPTIONS=a.DEFAULT_AUTH_OPTIONS=a.DEFAULT_DB_OPTIONS=a.DEFAULT_GLOBAL_OPTIONS=a.DEFAULT_HEADERS=void 0;const e=BD();let t="";typeof Deno<"u"?t="deno":typeof document<"u"?t="web":typeof navigator<"u"&&navigator.product==="ReactNative"?t="react-native":t="node",a.DEFAULT_HEADERS={"X-Client-Info":`supabase-js-${t}/${e.version}`},a.DEFAULT_GLOBAL_OPTIONS={headers:a.DEFAULT_HEADERS},a.DEFAULT_DB_OPTIONS={schema:"public"},a.DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},a.DEFAULT_REALTIME_OPTIONS={}})(tS)),tS}var nS={},MC;function UD(){return MC||(MC=1,(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.fetchWithAuth=a.resolveHeadersConstructor=a.resolveFetch=void 0;const e=r=>r?(...s)=>r(...s):(...s)=>fetch(...s);a.resolveFetch=e;const t=()=>Headers;a.resolveHeadersConstructor=t;const n=(r,s,o)=>{const u=(0,a.resolveFetch)(o),d=(0,a.resolveHeadersConstructor)();return async(f,p)=>{var y;const v=(y=await s())!==null&&y!==void 0?y:r;let x=new d(p==null?void 0:p.headers);return x.has("apikey")||x.set("apikey",r),x.has("Authorization")||x.set("Authorization",`Bearer ${v}`),u(f,Object.assign(Object.assign({},p),{headers:x}))}};a.fetchWithAuth=n})(nS)),nS}var Ia={},DC;function zD(){if(DC)return Ia;DC=1,Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.isBrowser=void 0,Ia.uuid=a,Ia.ensureTrailingSlash=e,Ia.applySettingDefaults=n,Ia.validateSupabaseUrl=r;function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){var o=Math.random()*16|0,u=s=="x"?o:o&3|8;return u.toString(16)})}function e(s){return s.endsWith("/")?s:s+"/"}const t=()=>typeof window<"u";Ia.isBrowser=t;function n(s,o){var u,d;const{db:f,auth:p,realtime:y,global:v}=s,{db:x,auth:S,realtime:E,global:T}=o,N={db:Object.assign(Object.assign({},x),f),auth:Object.assign(Object.assign({},S),p),realtime:Object.assign(Object.assign({},E),y),storage:{},global:Object.assign(Object.assign(Object.assign({},T),v),{headers:Object.assign(Object.assign({},(u=T==null?void 0:T.headers)!==null&&u!==void 0?u:{}),(d=v==null?void 0:v.headers)!==null&&d!==void 0?d:{})}),accessToken:async()=>""};return s.accessToken?N.accessToken=s.accessToken:delete N.accessToken,N}function r(s){const o=s==null?void 0:s.trim();if(!o)throw new Error("supabaseUrl is required.");if(!o.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(e(o))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}return Ia}var cm={};const NR="2.87.1",Sf=30*1e3,XE=3,rS=XE*Sf,HD="http://localhost:9999",qD="supabase.auth.token",VD={"X-Client-Info":`gotrue-js/${NR}`},YE="X-Supabase-Api-Version",PR={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},WD=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,GD=600*1e3;let ug=class extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}};function ut(a){return typeof a=="object"&&a!==null&&"__isAuthError"in a}let RR=class extends ug{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}};function IR(a){return ut(a)&&a.name==="AuthApiError"}let gc=class extends ug{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}},Cl=class extends ug{constructor(e,t,n,r){super(e,n,r),this.name=t,this.status=n}},vs=class extends Cl{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function OR(a){return ut(a)&&a.name==="AuthSessionMissingError"}let Wu=class extends Cl{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},jm=class extends Cl{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}},Mm=class extends Cl{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function jR(a){return ut(a)&&a.name==="AuthImplicitGrantRedirectError"}let JE=class extends Cl{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Dw=class extends Cl{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}};function hw(a){return ut(a)&&a.name==="AuthRetryableFetchError"}let QE=class extends Cl{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}};function KD(a){return ut(a)&&a.name==="AuthWeakPasswordError"}let Lw=class extends Cl{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}};const Fw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),LC=` 	
\r=`.split(""),XD=(()=>{const a=new Array(128);for(let e=0;e<a.length;e+=1)a[e]=-1;for(let e=0;e<LC.length;e+=1)a[LC[e].charCodeAt(0)]=-2;for(let e=0;e<Fw.length;e+=1)a[Fw[e].charCodeAt(0)]=e;return a})();function FC(a,e,t){if(a!==null)for(e.queue=e.queue<<8|a,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Fw[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Fw[n]),e.queuedBits-=6}}function MR(a,e,t){const n=XD[a];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(a)}"`)}}function BC(a){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},s=o=>{QD(o,n,t)};for(let o=0;o<a.length;o+=1)MR(a.charCodeAt(o),r,s);return e.join("")}function YD(a,e){if(a<=127){e(a);return}else if(a<=2047){e(192|a>>6),e(128|a&63);return}else if(a<=65535){e(224|a>>12),e(128|a>>6&63),e(128|a&63);return}else if(a<=1114111){e(240|a>>18),e(128|a>>12&63),e(128|a>>6&63),e(128|a&63);return}throw new Error(`Unrecognized Unicode codepoint: ${a.toString(16)}`)}function JD(a,e){for(let t=0;t<a.length;t+=1){let n=a.charCodeAt(t);if(n>55295&&n<=56319){const r=(n-55296)*1024&65535;n=(a.charCodeAt(t+1)-56320&65535|r)+65536,t+=1}YD(n,e)}}function QD(a,e,t){if(e.utf8seq===0){if(a<=127){t(a);return}for(let n=1;n<6;n+=1)if((a>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=a&31;else if(e.utf8seq===3)e.codepoint=a&15;else if(e.utf8seq===4)e.codepoint=a&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(a<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|a&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Lf(a){const e=[],t={queue:0,queuedBits:0},n=r=>{e.push(r)};for(let r=0;r<a.length;r+=1)MR(a.charCodeAt(r),t,n);return new Uint8Array(e)}function ZD(a){const e=[];return JD(a,t=>e.push(t)),new Uint8Array(e)}function ed(a){const e=[],t={queue:0,queuedBits:0},n=r=>{e.push(r)};return a.forEach(r=>FC(r,t,n)),FC(null,t,n),e.join("")}function eL(a){return Math.round(Date.now()/1e3)+a}function tL(){return Symbol("auth-callback")}const kr=()=>typeof window<"u"&&typeof document<"u",$u={tested:!1,writable:!1},DR=()=>{if(!kr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if($u.tested)return $u.writable;const a=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(a,a),globalThis.localStorage.removeItem(a),$u.tested=!0,$u.writable=!0}catch{$u.tested=!0,$u.writable=!1}return $u.writable};function nL(a){const e={},t=new URL(a);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,s)=>{e[s]=r})}catch{}return t.searchParams.forEach((n,r)=>{e[r]=n}),e}const LR=a=>a?(...e)=>a(...e):(...e)=>fetch(...e),rL=a=>typeof a=="object"&&a!==null&&"status"in a&&"ok"in a&&"json"in a&&typeof a.json=="function",Ef=async(a,e,t)=>{await a.setItem(e,JSON.stringify(t))},Uu=async(a,e)=>{const t=await a.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Er=async(a,e)=>{await a.removeItem(e)};class vx{constructor(){this.promise=new vx.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}vx.promiseConstructor=Promise;function sS(a){const e=a.split(".");if(e.length!==3)throw new Lw("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!WD.test(e[n]))throw new Lw("JWT not in base64url format");return{header:JSON.parse(BC(e[0])),payload:JSON.parse(BC(e[1])),signature:Lf(e[2]),raw:{header:e[0],payload:e[1]}}}async function sL(a){return await new Promise(e=>{setTimeout(()=>e(null),a)})}function iL(a,e){return new Promise((n,r)=>{(async()=>{for(let s=0;s<1/0;s++)try{const o=await a(s);if(!e(s,null,o)){n(o);return}}catch(o){if(!e(s,o)){r(o);return}}})()})}function oL(a){return("0"+a.toString(16)).substr(-2)}function aL(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let r="";for(let s=0;s<56;s++)r+=t.charAt(Math.floor(Math.random()*n));return r}return crypto.getRandomValues(e),Array.from(e,oL).join("")}async function lL(a){const t=new TextEncoder().encode(a),n=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(n);return Array.from(r).map(s=>String.fromCharCode(s)).join("")}async function cL(a){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),a;const t=await lL(a);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function uf(a,e,t=!1){const n=aL();let r=n;t&&(r+="/PASSWORD_RECOVERY"),await Ef(a,`${e}-code-verifier`,r);const s=await cL(n);return[s,n===s?"plain":"s256"]}const uL=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function dL(a){const e=a.headers.get(YE);if(!e||!e.match(uL))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function hL(a){if(!a)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(a<=e)throw new Error("JWT has expired")}function fL(a){switch(a){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const pL=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function df(a){if(!pL.test(a))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function iS(){const a={};return new Proxy(a,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function gL(a,e){return new Proxy(a,{get:(t,n,r)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const s=n.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)"||s==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,n,r)}return!e.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,n,r)}})}function $C(a){return JSON.parse(JSON.stringify(a))}const Gu=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),mL=[502,503,504];async function UC(a){var e;if(!rL(a))throw new Dw(Gu(a),0);if(mL.includes(a.status))throw new Dw(Gu(a),a.status);let t;try{t=await a.json()}catch(s){throw new gc(Gu(s),s)}let n;const r=dL(a);if(r&&r.getTime()>=PR["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new QE(Gu(t),a.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new vs}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new QE(Gu(t),a.status,t.weak_password.reasons);throw new RR(Gu(t),a.status||500,n)}const yL=(a,e,t,n)=>{const r={method:a,headers:(e==null?void 0:e.headers)||{}};return a==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(n),Object.assign(Object.assign({},r),t))};async function pt(a,e,t,n){var r;const s=Object.assign({},n==null?void 0:n.headers);s[YE]||(s[YE]=PR["2024-01-01"].name),n!=null&&n.jwt&&(s.Authorization=`Bearer ${n.jwt}`);const o=(r=n==null?void 0:n.query)!==null&&r!==void 0?r:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const u=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",d=await vL(a,e,t+u,{headers:s,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(d):{data:Object.assign({},d),error:null}}async function vL(a,e,t,n,r,s){const o=yL(e,n,r,s);let u;try{u=await a(t,Object.assign({},o))}catch(d){throw console.error(d),new Dw(Gu(d),0)}if(u.ok||await UC(u),n!=null&&n.noResolveJson)return u;try{return await u.json()}catch(d){await UC(d)}}function qi(a){var e;let t=null;xL(a)&&(t=Object.assign({},a),a.expires_at||(t.expires_at=eL(a.expires_in)));const n=(e=a.user)!==null&&e!==void 0?e:a;return{data:{session:t,user:n},error:null}}function zC(a){const e=qi(a);return!e.error&&a.weak_password&&typeof a.weak_password=="object"&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.message&&typeof a.weak_password.message=="string"&&a.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=a.weak_password),e}function mc(a){var e;return{data:{user:(e=a.user)!==null&&e!==void 0?e:a},error:null}}function bL(a){return{data:a,error:null}}function wL(a){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:r,verification_type:s}=a,o=dg(a,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:e,email_otp:t,hashed_token:n,redirect_to:r,verification_type:s},d=Object.assign({},o);return{data:{properties:u,user:d},error:null}}function HC(a){return a}function xL(a){return a.access_token&&a.refresh_token&&a.expires_in}const fw=["global","local","others"];let xA=class{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=LR(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=fw[0]){if(fw.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${fw.join(", ")}`);try{return await pt(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ut(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await pt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:mc})}catch(n){if(ut(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=dg(e,["options"]),r=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(r.new_email=n==null?void 0:n.newEmail,delete r.newEmail),await pt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:wL,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(ut(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await pt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:mc})}catch(t){if(ut(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,r,s,o,u,d;try{const f={nextPage:null,lastPage:0,total:0},p=await pt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(s=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:""},xform:HC});if(p.error)throw p.error;const y=await p.json(),v=(o=p.headers.get("x-total-count"))!==null&&o!==void 0?o:0,x=(d=(u=p.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&d!==void 0?d:[];return x.length>0&&(x.forEach(S=>{const E=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),T=JSON.parse(S.split(";")[1].split("=")[1]);f[`${T}Page`]=E}),f.total=parseInt(v)),{data:Object.assign(Object.assign({},y),f),error:null}}catch(f){if(ut(f))return{data:{users:[]},error:f};throw f}}async getUserById(e){df(e);try{return await pt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:mc})}catch(t){if(ut(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){df(e);try{return await pt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:mc})}catch(n){if(ut(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){df(e);try{return await pt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:mc})}catch(n){if(ut(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){df(e.userId);try{const{data:t,error:n}=await pt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:n}}catch(t){if(ut(t))return{data:null,error:t};throw t}}async _deleteFactor(e){df(e.userId),df(e.id);try{return{data:await pt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ut(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,r,s,o,u,d;try{const f={nextPage:null,lastPage:0,total:0},p=await pt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(s=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:""},xform:HC});if(p.error)throw p.error;const y=await p.json(),v=(o=p.headers.get("x-total-count"))!==null&&o!==void 0?o:0,x=(d=(u=p.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&d!==void 0?d:[];return x.length>0&&(x.forEach(S=>{const E=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),T=JSON.parse(S.split(";")[1].split("=")[1]);f[`${T}Page`]=E}),f.total=parseInt(v)),{data:Object.assign(Object.assign({},y),f),error:null}}catch(f){if(ut(f))return{data:{clients:[]},error:f};throw f}}async _createOAuthClient(e){try{return await pt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ut(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await pt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ut(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await pt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ut(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await pt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(ut(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await pt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ut(t))return{data:null,error:t};throw t}}};function qC(a={}){return{getItem:e=>a[e]||null,setItem:(e,t)=>{a[e]=t},removeItem:e=>{delete a[e]}}}const Ku={debug:!!(globalThis&&DR()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class _A extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}let FR=class extends _A{};class _L extends _A{}async function BR(a,e,t){Ku.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",a,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Ku.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",a)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(a,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async r=>{if(r){Ku.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",a,r.name);try{return await t()}finally{Ku.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",a,r.name)}}else{if(e===0)throw Ku.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",a),new FR(`Acquiring an exclusive Navigator LockManager lock "${a}" immediately failed`);if(Ku.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}const VC={};async function SL(a,e,t){var n;const r=(n=VC[a])!==null&&n!==void 0?n:Promise.resolve(),s=Promise.race([r.catch(()=>null),e>=0?new Promise((o,u)=>{setTimeout(()=>{u(new _L(`Acquring process lock with name "${a}" timed out`))},e)}):null].filter(o=>o)).catch(o=>{if(o&&o.isAcquireTimeout)throw o;return null}).then(async()=>await t());return VC[a]=s.catch(async o=>{if(o&&o.isAcquireTimeout)return await r,null;throw o}),await s}function EL(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function $R(a){if(!/^0x[a-fA-F0-9]{40}$/.test(a))throw new Error(`@supabase/auth-js: Address "${a}" is invalid.`);return a.toLowerCase()}function AL(a){return parseInt(a,16)}function kL(a){const e=new TextEncoder().encode(a);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function CL(a){var e;const{chainId:t,domain:n,expirationTime:r,issuedAt:s=new Date,nonce:o,notBefore:u,requestId:d,resources:f,scheme:p,uri:y,version:v}=a;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!y)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(v!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${v}`);if(!((e=a.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${a.statement}`)}const x=$R(a.address),S=p?`${p}://${n}`:n,E=a.statement?`${a.statement}
`:"",T=`${S} wants you to sign in with your Ethereum account:
${x}

${E}`;let N=`URI: ${y}
Version: ${v}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${s.toISOString()}`;if(r&&(N+=`
Expiration Time: ${r.toISOString()}`),u&&(N+=`
Not Before: ${u.toISOString()}`),d&&(N+=`
Request ID: ${d}`),f){let L=`
Resources:`;for(const j of f){if(!j||typeof j!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${j}`);L+=`
- ${j}`}N+=L}return`${T}
${N}`}class Gn extends Error{constructor({message:e,code:t,cause:n,name:r}){var s;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(s=r??(n instanceof Error?n.name:void 0))!==null&&s!==void 0?s:"Unknown Error",this.code=t}}class Bw extends Gn{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function TL({error:a,options:e}){var t,n,r;const{publicKey:s}=e;if(!s)throw Error("options was missing required publicKey property");if(a.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Gn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if(a.name==="ConstraintError"){if(((t=s.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Gn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:a});if(e.mediation==="conditional"&&((n=s.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Gn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:a});if(((r=s.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Gn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:a})}else{if(a.name==="InvalidStateError")return new Gn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:a});if(a.name==="NotAllowedError")return new Gn({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});if(a.name==="NotSupportedError")return s.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new Gn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:a}):new Gn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:a});if(a.name==="SecurityError"){const o=window.location.hostname;if(UR(o)){if(s.rp.id!==o)return new Gn({message:`The RP ID "${s.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else return new Gn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a})}else if(a.name==="TypeError"){if(s.user.id.byteLength<1||s.user.id.byteLength>64)return new Gn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:a})}else if(a.name==="UnknownError")return new Gn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a})}return new Gn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}function NL({error:a,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(a.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Gn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else{if(a.name==="NotAllowedError")return new Gn({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});if(a.name==="SecurityError"){const n=window.location.hostname;if(UR(n)){if(t.rpId!==n)return new Gn({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else return new Gn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a})}else if(a.name==="UnknownError")return new Gn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a})}return new Gn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}class PL{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const RL=new PL;function IL(a){if(!a)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(a);const{challenge:e,user:t,excludeCredentials:n}=a,r=dg(a,["challenge","user","excludeCredentials"]),s=Lf(e).buffer,o=Object.assign(Object.assign({},t),{id:Lf(t.id).buffer}),u=Object.assign(Object.assign({},r),{challenge:s,user:o});if(n&&n.length>0){u.excludeCredentials=new Array(n.length);for(let d=0;d<n.length;d++){const f=n[d];u.excludeCredentials[d]=Object.assign(Object.assign({},f),{id:Lf(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function OL(a){if(!a)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(a);const{challenge:e,allowCredentials:t}=a,n=dg(a,["challenge","allowCredentials"]),r=Lf(e).buffer,s=Object.assign(Object.assign({},n),{challenge:r});if(t&&t.length>0){s.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const u=t[o];s.allowCredentials[o]=Object.assign(Object.assign({},u),{id:Lf(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return s}function jL(a){var e;if("toJSON"in a&&typeof a.toJSON=="function")return a.toJSON();const t=a;return{id:a.id,rawId:a.id,response:{attestationObject:ed(new Uint8Array(a.response.attestationObject)),clientDataJSON:ed(new Uint8Array(a.response.clientDataJSON))},type:"public-key",clientExtensionResults:a.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function ML(a){var e;if("toJSON"in a&&typeof a.toJSON=="function")return a.toJSON();const t=a,n=a.getClientExtensionResults(),r=a.response;return{id:a.id,rawId:a.id,response:{authenticatorData:ed(new Uint8Array(r.authenticatorData)),clientDataJSON:ed(new Uint8Array(r.clientDataJSON)),signature:ed(new Uint8Array(r.signature)),userHandle:r.userHandle?ed(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function UR(a){return a==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(a)}function WC(){var a,e;return!!(kr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((a=navigator==null?void 0:navigator.credentials)===null||a===void 0?void 0:a.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function DL(a){try{const e=await navigator.credentials.create(a);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Bw("Browser returned unexpected credential type",e)}:{data:null,error:new Bw("Empty credential response",e)}}catch(e){return{data:null,error:TL({error:e,options:a})}}}async function LL(a){try{const e=await navigator.credentials.get(a);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Bw("Browser returned unexpected credential type",e)}:{data:null,error:new Bw("Empty credential response",e)}}catch(e){return{data:null,error:NL({error:e,options:a})}}}const FL={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},BL={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function $w(...a){const e=r=>r!==null&&typeof r=="object"&&!Array.isArray(r),t=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),n={};for(const r of a)if(r)for(const s in r){const o=r[s];if(o!==void 0)if(Array.isArray(o))n[s]=o;else if(t(o))n[s]=o;else if(e(o)){const u=n[s];e(u)?n[s]=$w(u,o):n[s]=$w(o)}else n[s]=o}return n}function $L(a,e){return $w(FL,a,e||{})}function UL(a,e){return $w(BL,a,e||{})}class zL{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:n,signal:r},s){try{const{data:o,error:u}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:u};const d=r??RL.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:f}=o.webauthn.credential_options.publicKey;f.name||(f.name=`${f.id}:${n}`),f.displayName||(f.displayName=f.name)}switch(o.webauthn.type){case"create":{const f=$L(o.webauthn.credential_options.publicKey,s==null?void 0:s.create),{data:p,error:y}=await DL({publicKey:f,signal:d});return p?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:p}},error:null}:{data:null,error:y}}case"request":{const f=UL(o.webauthn.credential_options.publicKey,s==null?void 0:s.request),{data:p,error:y}=await LL(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:f,signal:d}));return p?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:p}},error:null}:{data:null,error:y}}}}catch(o){return ut(o)?{data:null,error:o}:{data:null,error:new gc("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:n}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},s){if(!t)return{data:null,error:new ug("rpId is required for WebAuthn authentication")};try{if(!WC())return{data:null,error:new gc("Browser does not support WebAuthn",null)};const{data:o,error:u}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:n},signal:r},{request:s});if(!o)return{data:null,error:u};const{webauthn:d}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:d.type,rpId:t,rpOrigins:n,credential_response:d.credential_response}})}catch(o){return ut(o)?{data:null,error:o}:{data:null,error:new gc("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},s){if(!t)return{data:null,error:new ug("rpId is required for WebAuthn registration")};try{if(!WC())return{data:null,error:new gc("Browser does not support WebAuthn",null)};const{data:o,error:u}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(p=>{var y;return(y=p.data)===null||y===void 0?void 0:y.all.find(v=>v.factor_type==="webauthn"&&v.friendly_name===e&&v.status!=="unverified")}).then(p=>p?this.client.mfa.unenroll({factorId:p==null?void 0:p.id}):void 0),{data:null,error:u};const{data:d,error:f}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:n},signal:r},{create:s});return d?this._verify({factorId:o.id,challengeId:d.challengeId,webauthn:{rpId:t,rpOrigins:n,type:d.webauthn.type,credential_response:d.webauthn.credential_response}}):{data:null,error:f}}catch(o){return ut(o)?{data:null,error:o}:{data:null,error:new gc("Unexpected error in register",o)}}}}EL();const HL={url:HD,storageKey:qD,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:VD,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function GC(a,e,t){return await t()}const hf={};let SA=class ZE{get jwks(){var e,t;return(t=(e=hf[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){hf[this.storageKey]=Object.assign(Object.assign({},hf[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=hf[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){hf[this.storageKey]=Object.assign(Object.assign({},hf[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},HL),e);if(this.storageKey=s.storageKey,this.instanceID=(t=ZE.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,ZE.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.instanceID>0&&kr()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new xA({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=LR(s.fetch),this.lock=s.lock||GC,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,s.lock?this.lock=s.lock:this.persistSession&&kr()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=BR:this.lock=GC,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new zL(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:DR()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=qC(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=qC(this.memoryStorage)),kr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${NR}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},n="none";if(kr()&&(t=nL(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),kr()&&this.detectSessionInUrl&&n!=="none"){const{data:r,error:s}=await this._getSessionFromURL(t,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),jR(s)){const d=(e=s.details)===null||e===void 0?void 0:e.code;if(d==="identity_already_exists"||d==="identity_not_found"||d==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:o,redirectType:u}=r;return this._debug("#_initialize()","detected session in URL",o,"redirect type",u),await this._saveSession(o),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ut(t)?this._returnResult({error:t}):this._returnResult({error:new gc("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,r;try{const s=await pt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.captchaToken}},xform:qi}),{data:o,error:u}=s;if(u||!o)return this._returnResult({data:{user:null,session:null},error:u});const d=o.session,f=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:f,session:d},error:null})}catch(s){if(ut(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signUp(e){var t,n,r;try{let s;if("email"in e){const{email:p,password:y,options:v}=e;let x=null,S=null;this.flowType==="pkce"&&([x,S]=await uf(this.storage,this.storageKey)),s=await pt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:v==null?void 0:v.emailRedirectTo,body:{email:p,password:y,data:(t=v==null?void 0:v.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},code_challenge:x,code_challenge_method:S},xform:qi})}else if("phone"in e){const{phone:p,password:y,options:v}=e;s=await pt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:p,password:y,data:(n=v==null?void 0:v.data)!==null&&n!==void 0?n:{},channel:(r=v==null?void 0:v.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},xform:qi})}else throw new jm("You must provide either an email or phone number and a password");const{data:o,error:u}=s;if(u||!o)return await Er(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:u});const d=o.session,f=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:f,session:d},error:null})}catch(s){if(await Er(this.storage,`${this.storageKey}-code-verifier`),ut(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:o,options:u}=e;t=await pt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:zC})}else if("phone"in e){const{phone:s,password:o,options:u}=e;t=await pt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:zC})}else throw new jm("You must provide either an email or phone number and a password");const{data:n,error:r}=t;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!n||!n.session||!n.user){const s=new Wu;return this._returnResult({data:{user:null,session:null},error:s})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r})}catch(t){if(ut(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,r,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,r,s,o,u,d,f,p,y,v;let x,S;if("message"in e)x=e.message,S=e.signature;else{const{chain:E,wallet:T,statement:N,options:L}=e;let j;if(kr())if(typeof T=="object")j=T;else{const ae=window;if("ethereum"in ae&&typeof ae.ethereum=="object"&&"request"in ae.ethereum&&typeof ae.ethereum.request=="function")j=ae.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof T!="object"||!(L!=null&&L.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=T}const F=new URL((t=L==null?void 0:L.url)!==null&&t!==void 0?t:window.location.href),B=await j.request({method:"eth_requestAccounts"}).then(ae=>ae).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!B||B.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const $=$R(B[0]);let H=(n=L==null?void 0:L.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!H){const ae=await j.request({method:"eth_chainId"});H=AL(ae)}const W={domain:F.host,address:$,statement:N,uri:F.href,version:"1",chainId:H,nonce:(r=L==null?void 0:L.signInWithEthereum)===null||r===void 0?void 0:r.nonce,issuedAt:(o=(s=L==null?void 0:L.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(u=L==null?void 0:L.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(d=L==null?void 0:L.signInWithEthereum)===null||d===void 0?void 0:d.notBefore,requestId:(f=L==null?void 0:L.signInWithEthereum)===null||f===void 0?void 0:f.requestId,resources:(p=L==null?void 0:L.signInWithEthereum)===null||p===void 0?void 0:p.resources};x=CL(W),S=await j.request({method:"personal_sign",params:[kL(x),$]})}try{const{data:E,error:T}=await pt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:x,signature:S},!((y=e.options)===null||y===void 0)&&y.captchaToken?{gotrue_meta_security:{captcha_token:(v=e.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:qi});if(T)throw T;if(!E||!E.session||!E.user){const N=new Wu;return this._returnResult({data:{user:null,session:null},error:N})}return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),this._returnResult({data:Object.assign({},E),error:T})}catch(E){if(ut(E))return this._returnResult({data:{user:null,session:null},error:E});throw E}}async signInWithSolana(e){var t,n,r,s,o,u,d,f,p,y,v,x;let S,E;if("message"in e)S=e.message,E=e.signature;else{const{chain:T,wallet:N,statement:L,options:j}=e;let F;if(kr())if(typeof N=="object")F=N;else{const $=window;if("solana"in $&&typeof $.solana=="object"&&("signIn"in $.solana&&typeof $.solana.signIn=="function"||"signMessage"in $.solana&&typeof $.solana.signMessage=="function"))F=$.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!(j!=null&&j.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");F=N}const B=new URL((t=j==null?void 0:j.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in F&&F.signIn){const $=await F.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},j==null?void 0:j.signInWithSolana),{version:"1",domain:B.host,uri:B.href}),L?{statement:L}:null));let H;if(Array.isArray($)&&$[0]&&typeof $[0]=="object")H=$[0];else if($&&typeof $=="object"&&"signedMessage"in $&&"signature"in $)H=$;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in H&&"signature"in H&&(typeof H.signedMessage=="string"||H.signedMessage instanceof Uint8Array)&&H.signature instanceof Uint8Array)S=typeof H.signedMessage=="string"?H.signedMessage:new TextDecoder().decode(H.signedMessage),E=H.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in F)||typeof F.signMessage!="function"||!("publicKey"in F)||typeof F!="object"||!F.publicKey||!("toBase58"in F.publicKey)||typeof F.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");S=[`${B.host} wants you to sign in with your Solana account:`,F.publicKey.toBase58(),...L?["",L,""]:[""],"Version: 1",`URI: ${B.href}`,`Issued At: ${(r=(n=j==null?void 0:j.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((s=j==null?void 0:j.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${j.signInWithSolana.notBefore}`]:[],...!((o=j==null?void 0:j.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${j.signInWithSolana.expirationTime}`]:[],...!((u=j==null?void 0:j.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${j.signInWithSolana.chainId}`]:[],...!((d=j==null?void 0:j.signInWithSolana)===null||d===void 0)&&d.nonce?[`Nonce: ${j.signInWithSolana.nonce}`]:[],...!((f=j==null?void 0:j.signInWithSolana)===null||f===void 0)&&f.requestId?[`Request ID: ${j.signInWithSolana.requestId}`]:[],...!((y=(p=j==null?void 0:j.signInWithSolana)===null||p===void 0?void 0:p.resources)===null||y===void 0)&&y.length?["Resources",...j.signInWithSolana.resources.map(H=>`- ${H}`)]:[]].join(`
`);const $=await F.signMessage(new TextEncoder().encode(S),"utf8");if(!$||!($ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");E=$}}try{const{data:T,error:N}=await pt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:S,signature:ed(E)},!((v=e.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=e.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:qi});if(N)throw N;if(!T||!T.session||!T.user){const L=new Wu;return this._returnResult({data:{user:null,session:null},error:L})}return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",T.session)),this._returnResult({data:Object.assign({},T),error:N})}catch(T){if(ut(T))return this._returnResult({data:{user:null,session:null},error:T});throw T}}async _exchangeCodeForSession(e){const t=await Uu(this.storage,`${this.storageKey}-code-verifier`),[n,r]=(t??"").split("/");try{const{data:s,error:o}=await pt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:qi});if(await Er(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!s||!s.session||!s.user){const u=new Wu;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign(Object.assign({},s),{redirectType:r??null}),error:o})}catch(s){if(await Er(this.storage,`${this.storageKey}-code-verifier`),ut(s))return this._returnResult({data:{user:null,session:null,redirectType:null},error:s});throw s}}async signInWithIdToken(e){try{const{options:t,provider:n,token:r,access_token:s,nonce:o}=e,u=await pt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:r,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:qi}),{data:d,error:f}=u;if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!d||!d.session||!d.user){const p=new Wu;return this._returnResult({data:{user:null,session:null},error:p})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:d,error:f})}catch(t){if(ut(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,r,s,o;try{if("email"in e){const{email:u,options:d}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await uf(this.storage,this.storageKey));const{error:y}=await pt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},create_user:(n=d==null?void 0:d.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:p},redirectTo:d==null?void 0:d.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:y})}if("phone"in e){const{phone:u,options:d}=e,{data:f,error:p}=await pt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(r=d==null?void 0:d.data)!==null&&r!==void 0?r:{},create_user:(s=d==null?void 0:d.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},channel:(o=d==null?void 0:d.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:f==null?void 0:f.message_id},error:p})}throw new jm("You must provide either an email or phone number.")}catch(u){if(await Er(this.storage,`${this.storageKey}-code-verifier`),ut(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(e){var t,n;try{let r,s;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:u}=await pt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:r,xform:qi});if(u)throw u;if(!o)throw new Error("An error occurred on token verification.");const d=o.session,f=o.user;return d!=null&&d.access_token&&(await this._saveSession(d),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",d)),this._returnResult({data:{user:f,session:d},error:null})}catch(r){if(ut(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(e){var t,n,r,s,o;try{let u=null,d=null;this.flowType==="pkce"&&([u,d]=await uf(this.storage,this.storageKey));const f=await pt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((r=e==null?void 0:e.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:d}),headers:this.headers,xform:bL});return!((s=f.data)===null||s===void 0)&&s.url&&kr()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(f.data.url),this._returnResult(f)}catch(u){if(await Er(this.storage,`${this.storageKey}-code-verifier`),ut(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new vs;const{error:r}=await pt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(ut(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:r,options:s}=e,{error:o}=await pt(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:n,type:r,options:s}=e,{data:o,error:u}=await pt(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:u})}throw new jm("You must provide either an email or phone number and a type")}catch(t){if(ut(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Uu(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<rS:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await Uu(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=iS()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=gL(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(-1,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await pt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:mc}):await this._useSession(async t=>{var n,r,s;const{data:o,error:u}=t;if(u)throw u;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new vs}:await pt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0,xform:mc})})}catch(t){if(ut(t))return OR(t)&&(await this._removeSession(),await Er(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:r,error:s}=n;if(s)throw s;if(!r.session)throw new vs;const o=r.session;let u=null,d=null;this.flowType==="pkce"&&e.email!=null&&([u,d]=await uf(this.storage,this.storageKey));const{data:f,error:p}=await pt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:u,code_challenge_method:d}),jwt:o.access_token,xform:mc});if(p)throw p;return o.user=f.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(n){if(await Er(this.storage,`${this.storageKey}-code-verifier`),ut(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new vs;const t=Date.now()/1e3;let n=t,r=!0,s=null;const{payload:o}=sS(e.access_token);if(o.exp&&(n=o.exp,r=n<=t),r){const{data:u,error:d}=await this._callRefreshToken(e.refresh_token);if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!u)return{data:{user:null,session:null},error:null};s=u}else{const{data:u,error:d}=await this._getUser(e.access_token);if(d)throw d;s={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(t){if(ut(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:u}=t;if(u)throw u;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new vs;const{data:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(ut(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!kr())throw new Mm("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Mm(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new JE("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Mm("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new JE("No code detected.");const{data:L,error:j}=await this._exchangeCodeForSession(e.code);if(j)throw j;const F=new URL(window.location.href);return F.searchParams.delete("code"),window.history.replaceState(window.history.state,"",F.toString()),{data:{session:L.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:s,refresh_token:o,expires_in:u,expires_at:d,token_type:f}=e;if(!s||!u||!o||!f)throw new Mm("No session defined in URL");const p=Math.round(Date.now()/1e3),y=parseInt(u);let v=p+y;d&&(v=parseInt(d));const x=v-p;x*1e3<=Sf&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${x}s, should have been closer to ${y}s`);const S=v-y;p-S>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",S,v,p):p-S<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",S,v,p);const{data:E,error:T}=await this._getUser(s);if(T)throw T;const N={provider_token:n,provider_refresh_token:r,access_token:s,expires_in:y,expires_at:v,refresh_token:o,token_type:f,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:N,redirectType:e.type},error:null})}catch(n){if(ut(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Uu(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:r,error:s}=t;if(s)return this._returnResult({error:s});const o=(n=r.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:u}=await this.admin.signOut(o,e);if(u&&!(IR(u)&&(u.status===404||u.status===401||u.status===403)))return this._returnResult({error:u})}return e!=="others"&&(await this._removeSession(),await Er(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=tL(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,r;try{const{data:{session:s},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,t={}){let n=null,r=null;this.flowType==="pkce"&&([n,r]=await uf(this.storage,this.storageKey,!0));try{return await pt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(await Er(this.storage,`${this.storageKey}-code-verifier`),ut(s))return this._returnResult({data:null,error:s});throw s}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(ut(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:r}=await this._useSession(async s=>{var o,u,d,f,p;const{data:y,error:v}=s;if(v)throw v;const x=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(u=e.options)===null||u===void 0?void 0:u.scopes,queryParams:(d=e.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:!0});return await pt(this.fetch,"GET",x,{headers:this.headers,jwt:(p=(f=y.session)===null||f===void 0?void 0:f.access_token)!==null&&p!==void 0?p:void 0})});if(r)throw r;return kr()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:e.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(ut(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:r,data:{session:s}}=t;if(r)throw r;const{options:o,provider:u,token:d,access_token:f,nonce:p}=e,y=await pt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=s==null?void 0:s.access_token)!==null&&n!==void 0?n:void 0,body:{provider:u,id_token:d,access_token:f,nonce:p,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:qi}),{data:v,error:x}=y;return x?this._returnResult({data:{user:null,session:null},error:x}):!v||!v.session||!v.user?this._returnResult({data:{user:null,session:null},error:new Wu}):(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("USER_UPDATED",v.session)),this._returnResult({data:v,error:x}))}catch(r){if(await Er(this.storage,`${this.storageKey}-code-verifier`),ut(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,r;const{data:s,error:o}=t;if(o)throw o;return await pt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(ut(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await iL(async r=>(r>0&&await sL(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await pt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:qi})),(r,s)=>{const o=200*Math.pow(2,r);return s&&hw(s)&&Date.now()+o-n<Sf})}catch(n){if(this._debug(t,"error",n),ut(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),kr()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const r=await Uu(this.storage,this.storageKey);if(r&&this.userStorage){let o=await Uu(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:r.user},await Ef(this.userStorage,this.storageKey+"-user",o)),r.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:iS()}else if(r&&!r.user&&!r.user){const o=await Uu(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(r.user=o.user,await Er(this.storage,this.storageKey+"-user"),await Ef(this.storage,this.storageKey,r)):r.user=iS()}if(this._debug(n,"session from storage",r),!this._isValidSession(r)){this._debug(n,"session is not valid"),r!==null&&await this._removeSession();return}const s=((t=r.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<rS;if(this._debug(n,`session has${s?"":" not"} expired with margin of ${rS}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),hw(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:u}=await this._getUser(r.access_token);!u&&(o!=null&&o.user)?(r.user=o.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(n,"error",r),console.error(r);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new vs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new vx;const{data:s,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new vs;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const u={data:s.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(s){if(this._debug(r,"error",s),ut(s)){const o={data:null,error:s};return hw(s)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,n=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(e,t)}catch(d){s.push(d)}});if(await Promise.all(o),s.length>0){for(let u=0;u<s.length;u+=1)console.error(s[u]);throw s[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Er(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await Ef(this.userStorage,this.storageKey+"-user",{user:t.user});const r=Object.assign({},t);delete r.user;const s=$C(r);await Ef(this.storage,this.storageKey,s)}else{const r=$C(t);await Ef(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Er(this.storage,this.storageKey),await Er(this.storage,this.storageKey+"-code-verifier"),await Er(this.storage,this.storageKey+"-user"),this.userStorage&&await Er(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&kr()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Sf);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((n.expires_at*1e3-e)/Sf);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${Sf}ms, refresh threshold is ${XE} ticks`),r<=XE&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof _A)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!kr()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const r=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&r.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&r.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[s,o]=await uf(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(u.toString())}if(n!=null&&n.queryParams){const s=new URLSearchParams(n.queryParams);r.push(s.toString())}return n!=null&&n.skipBrowserRedirect&&r.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:r,error:s}=t;return s?this._returnResult({data:null,error:s}):await pt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(ut(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,r;const{data:s,error:o}=t;if(o)return this._returnResult({data:null,error:o});const u=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:d,error:f}=await pt(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return f?this._returnResult({data:null,error:f}):(e.factorType==="totp"&&d.type==="totp"&&(!((r=d==null?void 0:d.totp)===null||r===void 0)&&r.qr_code)&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),this._returnResult({data:d,error:null}))})}catch(t){if(ut(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:s}=t;if(s)return this._returnResult({data:null,error:s});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?jL(e.webauthn.credential_response):ML(e.webauthn.credential_response)})}:{code:e.code}),{data:u,error:d}=await pt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return d?this._returnResult({data:null,error:d}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:d}))})}catch(t){if(ut(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:s}=t;if(s)return this._returnResult({data:null,error:s});const o=await pt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});if(o.error)return o;const{data:u}=o;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:IL(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:OL(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(ut(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const r={all:[],phone:[],totp:[],webauthn:[]};for(const s of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])r.all.push(s),s.status==="verified"&&r[s.factor_type].push(s);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:n},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=sS(n.access_token);let o=null;s.aal&&(o=s.aal);let u=o;((t=(e=n.user.factors)===null||e===void 0?void 0:e.filter(p=>p.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(u="aal2");const f=s.amr||[];return{data:{currentLevel:o,nextLevel:u,currentAuthenticationMethods:f},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?await pt(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new vs})})}catch(t){if(ut(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!r)return this._returnResult({data:null,error:new vs});const o=await pt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return o.data&&o.data.redirect_url&&kr()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(ut(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!r)return this._returnResult({data:null,error:new vs});const o=await pt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return o.data&&o.data.redirect_url&&kr()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(ut(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;return n?this._returnResult({data:null,error:n}):t?await pt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new vs})})}catch(e){if(ut(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?(await pt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new vs})})}catch(t){if(ut(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(u=>u.kid===e);if(n)return n;const r=Date.now();if(n=this.jwks.keys.find(u=>u.kid===e),n&&this.jwks_cached_at+GD>r)return n;const{data:s,error:o}=await pt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=r,n=s.keys.find(u=>u.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:x,error:S}=await this.getSession();if(S||!x.session)return this._returnResult({data:null,error:S});n=x.session.access_token}const{header:r,payload:s,signature:o,raw:{header:u,payload:d}}=sS(n);t!=null&&t.allowExpired||hL(s.exp);const f=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!f){const{error:x}=await this.getUser(n);if(x)throw x;return{data:{claims:s,header:r,signature:o},error:null}}const p=fL(r.alg),y=await crypto.subtle.importKey("jwk",f,p,!0,["verify"]);if(!await crypto.subtle.verify(p,y,o,ZD(`${u}.${d}`)))throw new Lw("Invalid JWT signature");return{data:{claims:s,header:r,signature:o},error:null}}catch(n){if(ut(n))return this._returnResult({data:null,error:n});throw n}}};SA.nextInstanceID={};const qL=xA,VL=SA,WL=Object.freeze(Object.defineProperty({__proto__:null,AuthAdminApi:qL,AuthApiError:RR,AuthClient:VL,AuthError:ug,AuthImplicitGrantRedirectError:Mm,AuthInvalidCredentialsError:jm,AuthInvalidJwtError:Lw,AuthInvalidTokenResponseError:Wu,AuthPKCEGrantCodeExchangeError:JE,AuthRetryableFetchError:Dw,AuthSessionMissingError:vs,AuthUnknownError:gc,AuthWeakPasswordError:QE,CustomAuthError:Cl,GoTrueAdminApi:xA,GoTrueClient:SA,NavigatorLockAcquireTimeoutError:FR,SIGN_OUT_SCOPES:fw,isAuthApiError:IR,isAuthError:ut,isAuthImplicitGrantRedirectError:jR,isAuthRetryableFetchError:hw,isAuthSessionMissingError:OR,isAuthWeakPasswordError:KD,lockInternals:Ku,navigatorLock:BR,processLock:SL},Symbol.toStringTag,{value:"Module"})),zR=F0(WL);var KC;function GL(){if(KC)return cm;KC=1,Object.defineProperty(cm,"__esModule",{value:!0}),cm.SupabaseAuthClient=void 0;const a=zR;let e=class extends a.AuthClient{constructor(n){super(n)}};return cm.SupabaseAuthClient=e,cm}var XC;function YC(){if(XC)return yb;XC=1,Object.defineProperty(yb,"__esModule",{value:!0});const a=tR,e=aR(),t=gR,n=FD,r=$D(),s=UD(),o=zD(),u=GL();class d{constructor(p,y,v){var x,S,E;this.supabaseUrl=p,this.supabaseKey=y;const T=(0,o.validateSupabaseUrl)(p);if(!y)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",T),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",T),this.storageUrl=new URL("storage/v1",T),this.functionsUrl=new URL("functions/v1",T);const N=`sb-${T.hostname.split(".")[0]}-auth-token`,L={db:r.DEFAULT_DB_OPTIONS,realtime:r.DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},r.DEFAULT_AUTH_OPTIONS),{storageKey:N}),global:r.DEFAULT_GLOBAL_OPTIONS},j=(0,o.applySettingDefaults)(v??{},L);this.storageKey=(x=j.auth.storageKey)!==null&&x!==void 0?x:"",this.headers=(S=j.global.headers)!==null&&S!==void 0?S:{},j.accessToken?(this.accessToken=j.accessToken,this.auth=new Proxy({},{get:(F,B)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(B)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((E=j.auth)!==null&&E!==void 0?E:{},this.headers,j.global.fetch),this.fetch=(0,s.fetchWithAuth)(y,this._getAccessToken.bind(this),j.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},j.realtime)),this.accessToken&&this.accessToken().then(F=>this.realtime.setAuth(F)).catch(F=>console.warn("Failed to set initial Realtime auth token:",F)),this.rest=new e.PostgrestClient(new URL("rest/v1",T).href,{headers:this.headers,schema:j.db.schema,fetch:this.fetch}),this.storage=new n.StorageClient(this.storageUrl.href,this.headers,this.fetch,v==null?void 0:v.storage),j.accessToken||this._listenForAuthEvents()}get functions(){return new a.FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(p){return this.rest.from(p)}schema(p){return this.rest.schema(p)}rpc(p,y={},v={head:!1,get:!1,count:void 0}){return this.rest.rpc(p,y,v)}channel(p,y={config:{}}){return this.realtime.channel(p,y)}getChannels(){return this.realtime.getChannels()}removeChannel(p){return this.realtime.removeChannel(p)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var p,y;if(this.accessToken)return await this.accessToken();const{data:v}=await this.auth.getSession();return(y=(p=v.session)===null||p===void 0?void 0:p.access_token)!==null&&y!==void 0?y:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:p,persistSession:y,detectSessionInUrl:v,storage:x,userStorage:S,storageKey:E,flowType:T,lock:N,debug:L,throwOnError:j},F,B){const $={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new u.SupabaseAuthClient({url:this.authUrl.href,headers:Object.assign(Object.assign({},$),F),storageKey:E,autoRefreshToken:p,persistSession:y,detectSessionInUrl:v,storage:x,userStorage:S,flowType:T,lock:N,debug:L,throwOnError:j,fetch:B,hasCustomAuthorizationHeader:Object.keys(this.headers).some(H=>H.toLowerCase()==="authorization")})}_initRealtimeClient(p){return new t.RealtimeClient(this.realtimeUrl.href,Object.assign(Object.assign({},p),{params:Object.assign({apikey:this.supabaseKey},p==null?void 0:p.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((y,v)=>{this._handleTokenChanged(y,"CLIENT",v==null?void 0:v.access_token)})}_handleTokenChanged(p,y,v){(p==="TOKEN_REFRESHED"||p==="SIGNED_IN")&&this.changedAccessToken!==v?(this.changedAccessToken=v,this.realtime.setAuth(v)):p==="SIGNED_OUT"&&(this.realtime.setAuth(),y=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}return yb.default=d,yb}var JC;function KL(){return JC||(JC=1,(function(a){var e=Ra&&Ra.__createBinding||(Object.create?(function(p,y,v,x){x===void 0&&(x=v);var S=Object.getOwnPropertyDescriptor(y,v);(!S||("get"in S?!y.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return y[v]}}),Object.defineProperty(p,x,S)}):(function(p,y,v,x){x===void 0&&(x=v),p[x]=y[v]})),t=Ra&&Ra.__exportStar||function(p,y){for(var v in p)v!=="default"&&!Object.prototype.hasOwnProperty.call(y,v)&&e(y,p,v)},n=Ra&&Ra.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(a,"__esModule",{value:!0}),a.createClient=a.SupabaseClient=a.FunctionRegion=a.FunctionsError=a.FunctionsRelayError=a.FunctionsFetchError=a.FunctionsHttpError=a.PostgrestError=void 0;const r=n(YC());t(zR,a);var s=aR();Object.defineProperty(a,"PostgrestError",{enumerable:!0,get:function(){return s.PostgrestError}});var o=tR;Object.defineProperty(a,"FunctionsHttpError",{enumerable:!0,get:function(){return o.FunctionsHttpError}}),Object.defineProperty(a,"FunctionsFetchError",{enumerable:!0,get:function(){return o.FunctionsFetchError}}),Object.defineProperty(a,"FunctionsRelayError",{enumerable:!0,get:function(){return o.FunctionsRelayError}}),Object.defineProperty(a,"FunctionsError",{enumerable:!0,get:function(){return o.FunctionsError}}),Object.defineProperty(a,"FunctionRegion",{enumerable:!0,get:function(){return o.FunctionRegion}}),t(gR,a);var u=YC();Object.defineProperty(a,"SupabaseClient",{enumerable:!0,get:function(){return n(u).default}});const d=(p,y,v)=>new r.default(p,y,v);a.createClient=d;function f(){if(typeof window<"u"||typeof process>"u")return!1;const p=process.version;if(p==null)return!1;const y=p.match(/^v(\d+)\./);return y?parseInt(y[1],10)<=18:!1}f()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217")})(Ra)),Ra}var HR=KL();const qR=tA(HR),XL=YI({__proto__:null,default:qR},[HR]),{PostgrestError:QB,FunctionsHttpError:ZB,FunctionsFetchError:e3,FunctionsRelayError:t3,FunctionsError:n3,FunctionRegion:r3,SupabaseClient:s3,createClient:YL,GoTrueAdminApi:i3,GoTrueClient:o3,AuthAdminApi:a3,AuthClient:l3,navigatorLock:c3,NavigatorLockAcquireTimeoutError:u3,lockInternals:d3,processLock:h3,SIGN_OUT_SCOPES:f3,AuthError:p3,AuthApiError:g3,AuthUnknownError:m3,CustomAuthError:y3,AuthSessionMissingError:v3,AuthInvalidTokenResponseError:b3,AuthInvalidCredentialsError:w3,AuthImplicitGrantRedirectError:x3,AuthPKCEGrantCodeExchangeError:_3,AuthRetryableFetchError:S3,AuthWeakPasswordError:E3,AuthInvalidJwtError:A3,isAuthError:k3,isAuthApiError:C3,isAuthSessionMissingError:T3,isAuthImplicitGrantRedirectError:N3,isAuthRetryableFetchError:P3,isAuthWeakPasswordError:R3,RealtimePresence:I3,RealtimeChannel:O3,RealtimeClient:j3,REALTIME_LISTEN_TYPES:M3,REALTIME_POSTGRES_CHANGES_LISTEN_EVENT:D3,REALTIME_PRESENCE_LISTEN_EVENTS:L3,REALTIME_SUBSCRIBE_STATES:F3,REALTIME_CHANNEL_STATES:B3}=qR||XL,JL="https://vhwhpiooxioycreboavd.supabase.co",QL="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZod2hwaW9veGlveWNyZWJvYXZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MDcyMTcsImV4cCI6MjA4MTM4MzIxN30.DfFVO1418JzeFpaElTecys7j0vpCU5y2649AwADrySM",Ai=YL(JL,QL),ZL=a=>{const e=()=>a(!0),t=()=>a(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}};async function QC(a){if(!Ai)throw new Error("Supabase ");try{const t=`submissions/${`${a}.webp`}`;console.log(`  Supabase : ${t}`);const{data:n,error:r}=await Ai.storage.from("homework-images").download(t);if(r)throw new Error(`: ${r.message}`);if(!n)throw new Error("");return console.log(` : ${(n.size/1024).toFixed(2)} KB`),n}catch(e){throw console.error(" :",e),e}}function eF({assignmentId:a,onBack:e}){var z,K,Se,Pe,Ve,We;const[t,n]=ue.useState(null),[r,s]=ue.useState(null),[o,u]=ue.useState([]),[d,f]=ue.useState(new Map),[p,y]=ue.useState(!0),[v,x]=ue.useState(!1),[S,E]=ue.useState(!1),[T,N]=ue.useState(!1),[L,j]=ue.useState({current:0,total:0}),[F,B]=ue.useState({current:0,total:0}),[$,H]=ue.useState(null),[W,ae]=ue.useState(null),[me,ne]=ue.useState(null),[re,xe]=ue.useState(!1),ve=ue.useCallback(async()=>{y(!0),H(null);try{const be=await ze.assignments.get(a);if(!be)throw new Error("");n(be);const Te=await ze.classrooms.get(be.classroomId);if(!Te)throw new Error("");s(Te);const Ee=await ze.students.where("classroomId").equals(be.classroomId).sortBy("seatNumber");u(Ee),console.log(" ..."),console.log(`    assignmentId: ${a}`);const at=await ze.submissions.where("assignmentId").equals(a).toArray();if(console.log(`  ${at.length} `),at.length>0)console.log("   :"),at.forEach(tt=>{console.log(`   - studentId: ${tt.studentId}, status: ${tt.status}, id: ${tt.id}`)});else{const tt=await ze.submissions.toArray();console.log(`  ${tt.length} `),tt.length>0&&(console.log("    assignmentId:"),new Set(tt.map(Le=>Le.assignmentId)).forEach(Le=>{const Ke=tt.filter(Mt=>Mt.assignmentId===Le).length;console.log(`   - ${Le}: ${Ke} `)}))}const bt=new Map;at.forEach(tt=>{bt.set(tt.studentId,tt)}),f(bt)}catch(be){console.error(" :",be),H(be instanceof Error?be.message:"")}finally{y(!1)}},[a]);ue.useEffect(()=>{ve()},[ve]),ue.useEffect(()=>{var be;if(W!=null&&W.submission){const Te=((be=W.submission.gradingResult)==null?void 0:be.totalScore)??W.submission.score??null;ne(Te)}else ne(null)},[W]);const _e=ue.useCallback(async()=>{x(!0),await ve(),x(!1)},[ve]),pe=async be=>{if(!be.imageBlob)try{const Te=await QC(be.id);be.imageBlob=Te,await ze.submissions.update(be.id,{imageBlob:Te})}catch{alert("");return}E(!0);try{const Te=await mT(be.imageBlob,null,t==null?void 0:t.answerKey);await ze.submissions.update(be.id,{status:"graded",score:Te.totalScore,feedback:"",gradingResult:Te,gradedAt:Date.now()});const Ee=await ze.submissions.get(be.id);if(Ee&&(f(at=>new Map(at).set(Ee.studentId,Ee)),(W==null?void 0:W.submission.id)===be.id)){const at=o.find(bt=>bt.id===be.studentId);ae({submission:Ee,student:at})}}catch(Te){console.error(Te),alert("")}finally{E(!1)}},fe=async()=>{const be=Array.from(d.values());let Te=be.filter(Ee=>Ee.status==="scanned"||Ee.status==="synced");if(Te.length===0){const Ee=be.filter(at=>at.status==="graded");if(Ee.length>0)if(window.confirm(`

 ${Ee.length} 
`))Te=Ee;else return;else{alert("");return}}else if(!window.confirm(` ${Te.length} `))return;E(!0),H(null);try{const Ee=Te.filter(Ht=>!Ht.imageBlob&&(Ht.status==="synced"||Ht.status==="graded"));if(Ee.length>0){N(!0);for(let Ht=0;Ht<Ee.length;Ht++){const Le=Ee[Ht];B({current:Ht+1,total:Ee.length});try{const Ke=await QC(Le.id);await ze.submissions.update(Le.id,{imageBlob:Ke}),Le.imageBlob=Ke}catch(Ke){console.error(` ${Le.id}:`,Ke)}}N(!1)}const at=Te.filter(Ht=>Ht.imageBlob);if(at.length===0){alert(""),E(!1);return}const bt=await BO(at,null,(Ht,Le)=>{j({current:Ht,total:Le})},t==null?void 0:t.answerKey);let tt=0;bt&&typeof bt=="object"&&"successCount"in bt&&(tt=bt.successCount),await ve(),alert(` ${tt} `)}catch(Ee){console.error(":",Ee),H(Ee instanceof Error?Ee.message:"")}finally{E(!1),N(!1),j({current:0,total:0}),B({current:0,total:0})}},Z=async()=>{if(!(!W||me==null||Number.isNaN(me)))try{xe(!0);const be=W.submission.id,Te=await ze.submissions.get(be);if(!Te)return;const Ee=Te.gradingResult?{...Te.gradingResult,totalScore:me}:void 0;await ze.submissions.update(be,{score:me,gradingResult:Ee});const at=await ze.submissions.get(be);if(at){f(tt=>new Map(tt).set(at.studentId,at));const bt=o.find(tt=>tt.id===at.studentId);bt&&ae({submission:at,student:bt})}}finally{xe(!1)}},ke=be=>{const Te=be||"",Ee=at=>at.some(bt=>Te.includes(bt));return Ee(["","","","A~E","",""])?"":Ee(["","","","",""])?"":""},Q=be=>{var Ee;const Te=(Ee=be.gradingResult)==null?void 0:Ee.mistakes;if(Te&&Te.length>0){const at=new Set;return Te.forEach(bt=>{at.add(ke(bt.reason))}),Array.from(at)}return typeof be.feedback=="string"?be.feedback.split("; ").filter(at=>at.trim()!==""):Array.isArray(be.feedback)?be.feedback:[]};return p?w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx(ri,{className:"w-12 h-12 text-purple-600 mx-auto mb-4 animate-spin"}),w.jsx("p",{className:"text-gray-600",children:"..."})]})}):$?w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items justify-center p-4",children:w.jsxs("div",{className:"bg rounded-2xl shadow-xl p-8 max-w-md",children:[w.jsx(Ck,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),w.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:""}),w.jsx("p",{className:"text-gray-600 text-center mb-6",children:$}),e&&w.jsx("button",{onClick:e,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors",children:""})]})}):w.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[w.jsxs("div",{className:"max-w-7xl mx-auto pt-8",children:[e&&w.jsxs("button",{onClick:e,className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[w.jsx(kl,{className:"w-5 h-5"}),""]}),w.jsx("div",{className:"bg rounded-2xl shadow-xl p-6 mb-6",children:w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{children:[w.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:t==null?void 0:t.title}),w.jsxs("p",{className:"text-gray-600",children:[r==null?void 0:r.name,"  ",o.length," "]})]}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("button",{onClick:_e,disabled:v,className:"flex items-center gap-2 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all font-medium",children:w.jsx(cT,{className:`w-5 h-5 ${v?"animate-spin":""}`})}),w.jsx("button",{onClick:fe,disabled:S||T||!1,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl font-medium",children:T?w.jsxs(w.Fragment,{children:[w.jsx(gw,{className:"w-5 h-5 animate-bounce"})," ",F.current,"/",F.total]}):S?w.jsxs(w.Fragment,{children:[w.jsx(jf,{className:"w-5 h-5 animate-spin"}),"AI  ",L.current,"/",L.total]}):w.jsxs(w.Fragment,{children:[w.jsx(jf,{className:"w-5 h-5"}),"AI "]})})]})]})}),w.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:o.map(be=>{const Te=d.get(be.id),Ee=(Te==null?void 0:Te.status)??"missing",at=Te?Q(Te):[],bt=Te==null?void 0:Te.gradingResult;return w.jsxs("div",{className:"bg rounded-xl shadow-md hover:shadow-lg transition-shadow cursor-pointer group flex flex-col",onClick:()=>{Te&&ae({submission:Te,student:be})},children:[w.jsx("div",{className:"relative",children:w.jsxs("div",{className:"aspect-[4/3] bg-gray-100 rounded-t-xl overflow-hidden flex items-center justify-center relative",children:[Te!=null&&Te.imageBlob?w.jsx("img",{src:URL.createObjectURL(Te.imageBlob),alt:"",className:"w-full h-full object-cover"}):(Te==null?void 0:Te.status)==="synced"?w.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500",children:[w.jsx(Tk,{className:"w-10 h-10 text-blue-500"}),w.jsx("p",{className:"text-xs text-gray-500",children:""})]}):w.jsx(Tk,{className:"w-12 h-12 text-gray-400"}),Ee==="graded"&&bt&&w.jsxs("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-bold shadow ${bt.totalScore>=60?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[bt.totalScore," "]}),Ee==="scanned"&&w.jsx("div",{className:"absolute top-2 right-2 px-2 py-1 bg-blue-500 text-white rounded-full text-xs font-semibold shadow",children:""}),Ee==="synced"&&w.jsx("div",{className:"absolute top-2 right-2 px-2 py-1 bg-purple-500 text-white rounded-full text-xs font-semibold shadow",children:""}),(Ee==="graded"||Ee==="synced"||Ee==="scanned")&&Te&&w.jsx("button",{onClick:tt=>{tt.stopPropagation(),pe(Te)},className:"absolute top-2 left-2 p-1.5 bg-white/90 text-gray-700 rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-opacity hover:bg-blue-50 hover:text-blue-600 z-10",title:" AI ",disabled:S,children:w.jsx(z_,{className:"w-4 h-4"})})]})}),w.jsxs("div",{className:"p-3 flex-1 flex flex-col",children:[w.jsxs("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:[be.seatNumber,"   ",be.name]}),Ee==="graded"&&at.length>0&&w.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:at.slice(0,2).map((tt,Ht)=>w.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-xs",children:tt},Ht))}),Ee==="missing"&&w.jsx("p",{className:"text-xs text-gray-500",children:""})]})]},be.id)})}),w.jsxs("div",{className:"mt-6 bg rounded-xl shadow-md p-6",children:[w.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:""}),w.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[w.jsxs("div",{className:"text-center",children:[w.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Array.from(d.values()).filter(be=>be.status==="graded").length}),w.jsx("p",{className:"text-sm text-gray-600",children:""})]}),w.jsxs("div",{className:"text-center",children:[w.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Array.from(d.values()).filter(be=>be.status==="scanned"||be.status==="synced").length}),w.jsx("p",{className:"text-sm text-gray-600",children:""})]}),w.jsxs("div",{className:"text-center",children:[w.jsx("p",{className:"text-2xl font-bold text-gray-400",children:o.length-d.size}),w.jsx("p",{className:"text-sm text-gray-600",children:""})]}),w.jsxs("div",{className:"text-center",children:[w.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[d.size>0?Math.round(Array.from(d.values()).filter(be=>be.status==="graded").length/d.size*100):0,"%"]}),w.jsx("p",{className:"text-sm text-gray-600",children:""})]})]})]})]}),W&&w.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",onClick:()=>ae(null),children:w.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-6xl h-[90vh] flex overflow-hidden shadow-2xl",onClick:be=>be.stopPropagation(),children:[w.jsx("div",{className:"flex-1 bg-gray-100 relative overflow-auto flex items-center justify-center p-4",children:W.submission.imageBlob&&w.jsx("img",{src:URL.createObjectURL(W.submission.imageBlob),alt:"",className:"max-w-none shadow-lg",style:{maxHeight:"none",maxWidth:"100%"}})}),w.jsxs("div",{className:"w-full max-w-md border-l border-gray-200 flex flex-col bg-white",children:[w.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100 bg-gray-50",children:[w.jsxs("div",{children:[w.jsxs("h2",{className:"text-base font-semibold text-gray-900",children:[W.student.seatNumber,"  "," ",W.student.name]}),w.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[r==null?void 0:r.name,"  ",t==null?void 0:t.title]})]}),w.jsx("button",{onClick:()=>ae(null),className:"p-1 rounded-full hover:bg-gray-100 text-gray-500",children:w.jsx(Bm,{className:"w-4 h-4"})})]}),w.jsxs("div",{className:"flex-1 overflow-auto px-5 py-4 space-y-4",children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsxs("div",{className:"flex flex-col gap-1",children:[w.jsxs("div",{className:"flex items-baseline gap-2",children:[w.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:""}),w.jsx("span",{className:"text-2xl font-bold text-gray-900",children:((z=W.submission.gradingResult)==null?void 0:z.totalScore)??W.submission.score??"-"})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("input",{type:"number",className:"w-20 px-2 py-1 border border-gray-300 rounded text-xs",value:me??"",onChange:be=>{const Te=be.target.value;ne(Te===""?null:Number.parseInt(Te,10))}}),w.jsx("button",{type:"button",onClick:Z,disabled:me==null||re,className:"px-3 py-1 rounded bg-blue-600 text text-xs hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:re?"...":""})]})]}),W.submission.status==="graded"&&w.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-50 text-green-700 border border-green-200 font-semibold",children:""})]}),Array.isArray((K=W.submission.gradingResult)==null?void 0:K.details)&&W.submission.gradingResult.details.length>0&&w.jsxs("div",{children:[w.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm uppercase tracking-wide",children:[w.jsx(N2,{className:"w-4 h-4 text-blue-500"})," "]}),w.jsx("div",{className:"space-y-3",children:W.submission.gradingResult.details.map((be,Te)=>w.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50 text-xs",children:[w.jsxs("div",{className:"flex justify-between mb-1",children:[w.jsxs("span",{className:"font-semibold text-gray-800",children:[" ",be.questionId]}),w.jsxs("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-semibold ${be.isCorrect?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[be.isCorrect?"":"","  ",be.score,"/",be.maxScore]})]}),be.studentAnswer&&w.jsxs("p",{className:"text-gray-700 mb-1",children:["",be.studentAnswer]}),be.reason&&w.jsxs("p",{className:"text-gray-500",children:["",be.reason]})]},Te))})]}),(Se=W.submission.gradingResult)!=null&&Se.mistakes&&W.submission.gradingResult.mistakes.length>0?w.jsxs("div",{children:[w.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm uppercase tracking-wide",children:[w.jsx(Ck,{className:"w-4 h-4 text-red-500"})," "]}),w.jsx("div",{className:"space-y-3",children:W.submission.gradingResult.mistakes.map((be,Te)=>w.jsxs("div",{className:"bg-red-50/50 rounded-lg p-3 border border-red-100 text-sm",children:[w.jsx("div",{className:"flex justify-between font-semibold text-gray-800 mb-1",children:w.jsxs("span",{children:[" ",be.id," "]})}),w.jsx("div",{className:"text-gray-600 text-xs mb-1.5 line-clamp-1",children:be.question}),w.jsxs("div",{className:"text-red-700 font-medium bg px-2 py-1 rounded border border-red-100 inline-block text-xs",children:["",be.reason]})]},Te))})]}):w.jsx("div",{className:"bg-green-50 p-4 rounded-xl border border-green-100 text-center",children:w.jsx("p",{className:"text-green-700 font-bold",children:""})}),((Pe=W.submission.gradingResult)==null?void 0:Pe.weaknesses)&&W.submission.gradingResult.weaknesses.length>0&&w.jsxs("div",{children:[w.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm uppercase tracking-wide",children:[w.jsx(jf,{className:"w-4 h-4 text-orange-500"})," "]}),w.jsx("div",{className:"flex flex-wrap gap-2",children:W.submission.gradingResult.weaknesses.map((be,Te)=>w.jsx("span",{className:"px-3 py-1.5 bg-orange-50 text-orange-700 border border-orange-100 rounded-md text-sm font-medium",children:be},Te))})]}),((Ve=W.submission.gradingResult)==null?void 0:Ve.suggestions)&&W.submission.gradingResult.suggestions.length>0&&w.jsxs("div",{children:[w.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm uppercase tracking-wide",children:[w.jsx(z_,{className:"w-4 h-4 text-blue-500"})," "]}),w.jsx("ul",{className:"space-y-2",children:W.submission.gradingResult.suggestions.map((be,Te)=>w.jsxs("li",{className:"flex gap-3 text-sm text-gray-600 bg-blue-50/50 p-3 rounded-lg",children:[w.jsx("span",{className:"text-blue-500 font-bold mt-0.5",children:""}),w.jsx("span",{className:"leading-relaxed",children:be})]},Te))})]}),!((We=W.submission.gradingResult)!=null&&We.mistakes)&&W.submission.feedback&&w.jsx("div",{className:"text-gray-400 text-sm text-center italic py-4",children:" AI "})]}),w.jsx("div",{className:"p-4 border-t border-gray-100 bg-gray-50",children:w.jsxs("button",{onClick:()=>pe(W.submission),disabled:S,className:"w-full flex items-center justify gap-2 py-3 bg border border-gray-300 shadow-sm rounded-lg hover:bg-blue-600 hover:text hover:border-blue-600 font-medium text-gray-700 transition-all",children:[w.jsx(z_,{className:`w-4 h-4 ${S?"animate-spin":""}`}),S?"AI ...":" AI "]})})]})]})})]})}function tF({assignmentId:a,onBack:e}){const[t,n]=ue.useState(null),[r,s]=ue.useState(null),[o,u]=ue.useState([]),[d,f]=ue.useState(!0),[p,y]=ue.useState(null),[v,x]=ue.useState(""),[S,E]=ue.useState([]),[T,N]=ue.useState(!1),[L,j]=ue.useState(2),[F,B]=ue.useState(1),[$,H]=ue.useState(""),[W,ae]=ue.useState([]),[me,ne]=ue.useState(0),[re,xe]=ue.useState(!1);ue.useEffect(()=>{(async()=>{f(!0),y(null);try{const z=await ze.assignments.get(a);if(!z)throw new Error("");n(z);const K=await ze.classrooms.get(z.classroomId);if(!K)throw new Error("");s(K);const Se=await ze.students.where("classroomId").equals(z.classroomId).sortBy("seatNumber");u(Se)}catch(z){console.error(z),y(z instanceof Error?z.message:"")}finally{f(!1)}})()},[a]);const ve=ue.useMemo(()=>new Set($.split(/[,\s]+/).map(Q=>Q.trim()).filter(Q=>Q.length>0&&/^\d+$/.test(Q)).map(Q=>Number.parseInt(Q,10))),[$]),_e=W[me]??null,pe=ue.useMemo(()=>_e?S.filter(Q=>Q.index>=_e.fromIndex&&Q.index<=_e.toIndex):[],[S,_e]),fe=ue.useMemo(()=>{const Q=new Set;return W.forEach(z=>{for(let K=z.fromIndex;K<=z.toIndex;K+=1)Q.add(K)}),S.filter(z=>!Q.has(z.index))},[S,W]),Z=async Q=>{const z=Q.target.files;if(!(!z||z.length===0)){y(null),N(!0),E([]),ae([]),ne(0);try{const K=z[0];x(K.name);const Se=pA(K);let Pe=[];if(Se==="pdf")Pe=await FM(K,{scale:2,format:"image/webp",quality:.8});else if(Se==="image"){const We=[];for(const be of Array.from(z)){const Te=await TP(be);We.push(Te)}Pe=We}else throw new Error(" PDF ");const Ve=Pe.map((We,be)=>({index:be,blob:We,url:URL.createObjectURL(We)}));E(Ve)}catch(K){console.error(K),y(K instanceof Error?K.message:"")}finally{N(!1)}}},ke=()=>{if(S.length===0){y(" PDF ");return}if(!o.length){y("");return}y(null);const Q=o.filter(Se=>Se.seatNumber>=F&&!ve.has(Se.seatNumber)).sort((Se,Pe)=>Se.seatNumber-Pe.seatNumber),z=[];let K=0;for(const Se of Q){if(K>=S.length)break;const Pe=K,Ve=Math.min(K+L-1,S.length-1);z.push({fromIndex:Pe,toIndex:Ve,seatNumber:Se.seatNumber,studentId:Se.id,name:Se.name}),K+=L}ae(z),ne(0)};return d?w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx(ri,{className:"w-12 h-12 text-purple-600 mx-auto mb-4 animate-spin"}),w.jsx("p",{className:"text-gray-600",children:"..."})]})}):w.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[w.jsxs("div",{className:"max-w-6xl mx-auto pt-6",children:[e&&w.jsxs("button",{onClick:e,className:"mb-4 inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 text-sm",children:[w.jsx(kl,{className:"w-4 h-4"}),""]}),w.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-5 mb-4 flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"p-3 rounded-xl bg-indigo-100",children:w.jsx(Fm,{className:"w-7 h-7 text-indigo-600"})}),w.jsxs("div",{children:[w.jsxs("h1",{className:"text-xl font-bold text-gray-900",children:[" - ",t==null?void 0:t.title]}),w.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["",r==null?void 0:r.name,"  ",o.length]})]})]}),w.jsxs("div",{className:"hidden md:flex flex-col items-end text-xs text-gray-500",children:[w.jsxs("div",{className:"flex items-center gap-1",children:[w.jsx(nA,{className:"w-4 h-4"}),w.jsx("span",{children:""})]}),!(t!=null&&t.answerKey)&&w.jsx("p",{className:"mt-1 text-red-500 font-semibold",children:" AI "})]})]}),p&&w.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-sm text-red-700 rounded-xl",children:p}),w.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 mb-4 space-y-4",children:w.jsxs("div",{className:"grid md:grid-cols-3 gap-4 text-sm",children:[w.jsxs("div",{className:"md:col-span-1",children:[w.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:" PDF "}),w.jsx("input",{type:"file",accept:"application/pdf,image/*",multiple:!0,onChange:Z,disabled:T,className:`block w-full text-xs text-gray-700
                  file:mr-2 file:px-3 file:py-2 file:border-0
                  file:text-xs file:font-semibold
                  file:bg-indigo-50 file:text-indigo-700
                  hover:file:bg-indigo-100`}),v&&w.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["",v]}),S.length>0&&w.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[" ",S.length," "]})]}),w.jsxs("div",{children:[w.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[w.jsx(V2,{className:"w-4 h-4 text-gray-600"}),w.jsx("span",{className:"text-xs font-semibold text-gray-700",children:""})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-[11px] font-medium text-gray-600 mb-1",children:""}),w.jsx("input",{type:"number",min:1,max:4,value:L,onChange:Q=>j(Number.isNaN(Number.parseInt(Q.target.value,10))?1:Number.parseInt(Q.target.value,10)),className:"w-full px-2 py-1 border border-gray-300 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),w.jsxs("div",{children:[w.jsx("label",{className:"block text-[11px] font-medium text-gray-600 mb-1",children:""}),w.jsx("input",{type:"number",min:1,max:200,value:F,onChange:Q=>B(Number.isNaN(Number.parseInt(Q.target.value,10))?1:Number.parseInt(Q.target.value,10)),className:"w-full px-2 py-1 border border-gray-300 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),w.jsxs("div",{className:"mt-2",children:[w.jsx("label",{className:"block text-[11px] font-medium text-gray-600 mb-1",children:""}),w.jsx("input",{type:"text",value:$,onChange:Q=>H(Q.target.value),placeholder:"3, 5, 12",className:"w-full px-2 py-1 border border-gray-300 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"}),w.jsx("p",{className:"mt-1 text-[11px] text-gray-500",children:""})]})]}),w.jsxs("div",{className:"flex flex-col justify-between text-xs text-gray-500",children:[w.jsxs("div",{className:"mb-2 space-y-1",children:[w.jsx("p",{children:" "}),fe.length>0&&w.jsxs("p",{className:"text-amber-600",children:[" ",fe.length," "]})]}),w.jsx("button",{type:"button",onClick:ke,disabled:S.length===0||T,className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-indigo-600 text-white text-xs font-medium hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:T?w.jsxs(w.Fragment,{children:[w.jsx(ri,{className:"w-4 h-4 animate-spin"}),"..."]}):w.jsxs(w.Fragment,{children:[w.jsx(jf,{className:"w-4 h-4"}),""]})})]})]})}),w.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 mb-6",children:[w.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-4 flex flex-col gap-3 min-h-[320px]",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("h2",{className:"text-sm font-semibold text-gray-700",children:""}),_e&&w.jsxs("p",{className:"text-xs text-gray-500",children:[" ",_e.fromIndex+1,_e.toIndex===_e.fromIndex?"":`${_e.toIndex+1}`,""]})]}),w.jsx("div",{className:`flex-1 border border-dashed border-gray-200 rounded-xl flex items-center justify-center bg-slate-50 ${_e?"cursor-pointer":"cursor-default"}`,onClick:()=>{_e&&xe(!0)},children:_e&&pe.length>0?w.jsx("div",{className:"flex gap-3",children:pe.map(Q=>w.jsx("img",{src:Q.url,alt:` ${Q.index+1} `,className:"w-32 h-44 rounded-lg shadow-md object-contain bg-white border border-gray-200"},Q.index))}):w.jsxs("div",{className:"text-xs text-gray-400 flex flex-col items-center gap-1",children:[w.jsx(Fm,{className:"w-5 h-5"}),w.jsx("span",{children:""})]})}),S.length>0&&w.jsxs("div",{className:"mt-2",children:[w.jsx("p",{className:"text-xs text-gray-500 mb-1",children:""}),w.jsx("div",{className:"flex gap-1 overflow-x-auto pb-1",children:S.map(Q=>w.jsx("div",{className:"w-10 h-14 rounded-md flex items-center justify-center text-[10px] text-gray-700 border border-gray-200 bg-gray-50",children:Q.index+1},Q.index))})]})]}),w.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-4 min-h-[320px]",children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsx("h2",{className:"text-sm font-semibold text-gray-700",children:""}),fe.length>0&&w.jsxs("p",{className:"text-xs text-amber-600",children:[" ",fe.length," "]})]}),W.length===0?w.jsx("p",{className:"text-xs text-gray-500",children:""}):w.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden text-xs",children:[w.jsxs("div",{className:"grid grid-cols-4 bg-gray-50 px-3 py-2 font-semibold text-gray-700",children:[w.jsx("div",{children:""}),w.jsx("div",{children:""}),w.jsx("div",{children:""}),w.jsx("div",{children:""})]}),w.jsx("div",{className:"max-h-60 overflow-auto",children:W.map((Q,z)=>w.jsxs("button",{type:"button",onClick:()=>ne(z),className:`grid grid-cols-4 w-full px-3 py-2 text-left border-t border-gray-100 ${z===me?"bg-indigo-50 text-indigo-800":"bg-white hover:bg-gray-50 text-gray-700"}`,children:[w.jsxs("div",{children:[" ",Q.fromIndex+1,Q.toIndex===Q.fromIndex?"":`${Q.toIndex+1}`," "]}),w.jsx("div",{children:Q.seatNumber}),w.jsx("div",{children:Q.name}),w.jsx("div",{className:"text-right",children:z===me?" ":""})]},`${Q.fromIndex}-${Q.seatNumber}`))})]})]})]})]}),re&&w.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:w.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[w.jsxs("div",{className:"flex items-start justify-between px-4 py-3 border-b border-gray-200",children:[w.jsxs("div",{children:[w.jsx("p",{className:"text-xs text-gray-500",children:""}),_e?w.jsxs(w.Fragment,{children:[w.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[_e.seatNumber,"   ",_e.name]}),w.jsxs("p",{className:"text-xs text-gray-500",children:[" ",_e.fromIndex+1,_e.toIndex===_e.fromIndex?"":`${_e.toIndex+1}`,""]})]}):w.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:""})]}),w.jsx("button",{type:"button",onClick:()=>xe(!1),className:"p-2 rounded-full hover:bg-gray-100 text-gray-500","aria-label":"",children:w.jsx(Bm,{className:"w-5 h-5"})})]}),w.jsx("div",{className:"p-4 bg-gray-50 overflow-y-auto max-h-[85vh]",children:S.length===0?w.jsx("p",{className:"text-sm text-gray-500",children:""}):w.jsx("div",{className:"grid sm:grid-cols-2 gap-3",children:S.map(Q=>{const z=_e&&Q.index>=_e.fromIndex&&Q.index<=_e.toIndex;return w.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[w.jsxs("div",{className:"flex items-center justify-between px-3 py-2 text-xs text-gray-600 bg-gray-50 border-b border-gray-100",children:[w.jsxs("span",{children:[" ",Q.index+1," "]}),z&&w.jsx("span",{className:"text-indigo-600 font-semibold",children:""})]}),w.jsx("div",{className:"bg-white flex items-center justify-center",children:w.jsx("img",{src:Q.url,alt:` ${Q.index+1} `,className:"max-h-[70vh] w-full object-contain bg-white"})})]},Q.index)})})})]})})]})}function nF({onBack:a,onSelectScanImport:e,onSelectBatchImport:t}){const[n,r]=ue.useState([]),[s,o]=ue.useState(!0);return ue.useEffect(()=>{(async()=>{o(!0);try{const d=await ze.assignments.toArray(),f=await Promise.all(d.map(async p=>{const y=await ze.classrooms.get(p.classroomId);return{...p,classroom:y||void 0}}));r(f)}finally{o(!1)}})()},[]),s?w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx(ri,{className:"w-12 h-12 text-indigo-600 mx-auto mb-4 animate-spin"}),w.jsx("p",{className:"text-gray-600",children:""})]})}):w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:w.jsxs("div",{className:"max-w-2xl mx-auto pt-8",children:[a&&w.jsxs("button",{onClick:a,className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[w.jsx(kl,{className:"w-5 h-5"}),""]}),w.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6",children:w.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[w.jsx("div",{className:"p-3 bg-indigo-100 rounded-xl",children:w.jsx(Fm,{className:"w-7 h-7 text-indigo-600"})}),w.jsxs("div",{children:[w.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:""}),w.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"PDF"})]})]})}),n.length===0?w.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[w.jsx(wl,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:""}),w.jsx("p",{className:"text-gray-600 mb-4",children:""})]}):w.jsx("div",{className:"space-y-3",children:n.map(u=>{var d;return w.jsx("div",{className:"w-full bg-white rounded-xl shadow-md p-5 text-left hover:shadow-lg transition-all group",children:w.jsxs("div",{className:"flex items-center justify-between gap-4",children:[w.jsxs("div",{className:"flex-1",children:[w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 group-hover:text-indigo-600 transition-colors",children:u.title}),w.jsxs("p",{className:"text-sm text-gray-600",children:[((d=u.classroom)==null?void 0:d.name)||"","  "," ",u.totalPages," "]}),!u.answerKey&&w.jsx("p",{className:"text-xs text-red-500 mt-1",children:"AI "})]}),w.jsxs("div",{className:"flex flex-col gap-2 items-end",children:[w.jsxs("button",{type:"button",onClick:()=>e==null?void 0:e(u.id),className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-[11px] bg-purple-50 text-purple-700 border border-purple-200 hover:bg-purple-100",children:[w.jsx(lT,{className:"w-3 h-3"}),""]}),w.jsxs("button",{type:"button",onClick:()=>t==null?void 0:t(u.id),className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-[11px] bg-indigo-50 text-indigo-700 border border-indigo-200 hover:bg-indigo-100",children:[w.jsx(Fm,{className:"w-3 h-3"}),"PDF"]})]})]})},u.id)})})]})})}var pw={exports:{}},rF=pw.exports,ZC;function sF(){return ZC||(ZC=1,(function(a,e){(function(n,r){a.exports=r(ax())})(rF,function(t){return(function(n){var r={};function s(o){if(r[o])return r[o].exports;var u=r[o]={i:o,l:!1,exports:{}};return n[o].call(u.exports,u,u.exports,s),u.l=!0,u.exports}return s.m=n,s.c=r,s.d=function(o,u,d){s.o(o,u)||Object.defineProperty(o,u,{enumerable:!0,get:d})},s.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s.t=function(o,u){if(u&1&&(o=s(o)),u&8||u&4&&typeof o=="object"&&o&&o.__esModule)return o;var d=Object.create(null);if(s.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:o}),u&2&&typeof o!="string")for(var f in o)s.d(d,f,(function(p){return o[p]}).bind(null,f));return d},s.n=function(o){var u=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(u,"a",u),u},s.o=function(o,u){return Object.prototype.hasOwnProperty.call(o,u)},s.p="",s(s.s="./src/react-webcam.tsx")})({"./src/react-webcam.tsx":(function(n,r,s){s.r(r);var o=s("react"),u=(function(){var v=function(x,S){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,T){E.__proto__=T}||function(E,T){for(var N in T)T.hasOwnProperty(N)&&(E[N]=T[N])},v(x,S)};return function(x,S){v(x,S);function E(){this.constructor=x}x.prototype=S===null?Object.create(S):(E.prototype=S.prototype,new E)}})(),d=function(){return d=Object.assign||function(v){for(var x,S=1,E=arguments.length;S<E;S++){x=arguments[S];for(var T in x)Object.prototype.hasOwnProperty.call(x,T)&&(v[T]=x[T])}return v},d.apply(this,arguments)},f=function(v,x){var S={};for(var E in v)Object.prototype.hasOwnProperty.call(v,E)&&x.indexOf(E)<0&&(S[E]=v[E]);if(v!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,E=Object.getOwnPropertySymbols(v);T<E.length;T++)x.indexOf(E[T])<0&&Object.prototype.propertyIsEnumerable.call(v,E[T])&&(S[E[T]]=v[E[T]]);return S};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(x){var S=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return S?new Promise(function(E,T){S.call(navigator,x,E,T)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function p(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var y=(function(v){u(x,v);function x(S){var E=v.call(this,S)||this;return E.canvas=null,E.ctx=null,E.requestUserMediaId=0,E.unmounted=!1,E.state={hasUserMedia:!1},E}return x.prototype.componentDidMount=function(){var S=this,E=S.state,T=S.props;if(this.unmounted=!1,!p()){T.onUserMediaError("getUserMedia not supported");return}E.hasUserMedia||this.requestUserMedia(),T.children&&typeof T.children!="function"&&console.warn("children must be a function")},x.prototype.componentDidUpdate=function(S){var E=this.props;if(!p()){E.onUserMediaError("getUserMedia not supported");return}var T=JSON.stringify(S.audioConstraints)!==JSON.stringify(E.audioConstraints),N=JSON.stringify(S.videoConstraints)!==JSON.stringify(E.videoConstraints),L=S.minScreenshotWidth!==E.minScreenshotWidth,j=S.minScreenshotHeight!==E.minScreenshotHeight;(N||L||j)&&(this.canvas=null,this.ctx=null),(T||N)&&(this.stopAndCleanup(),this.requestUserMedia())},x.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},x.stopMediaStream=function(S){S&&(S.getVideoTracks&&S.getAudioTracks?(S.getVideoTracks().map(function(E){S.removeTrack(E),E.stop()}),S.getAudioTracks().map(function(E){S.removeTrack(E),E.stop()})):S.stop())},x.prototype.stopAndCleanup=function(){var S=this.state;S.hasUserMedia&&(x.stopMediaStream(this.stream),S.src&&window.URL.revokeObjectURL(S.src))},x.prototype.getScreenshot=function(S){var E=this,T=E.state,N=E.props;if(!T.hasUserMedia)return null;var L=this.getCanvas(S);return L&&L.toDataURL(N.screenshotFormat,N.screenshotQuality)},x.prototype.getCanvas=function(S){var E=this,T=E.state,N=E.props;if(!this.video||!T.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var L=this.video.videoWidth,j=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var F=L/j;L=N.minScreenshotWidth||this.video.clientWidth,j=L/F,N.minScreenshotHeight&&j<N.minScreenshotHeight&&(j=N.minScreenshotHeight,L=j*F)}this.canvas=document.createElement("canvas"),this.canvas.width=(S==null?void 0:S.width)||L,this.canvas.height=(S==null?void 0:S.height)||j,this.ctx=this.canvas.getContext("2d")}var B=this,$=B.ctx,H=B.canvas;return $&&H&&(H.width=(S==null?void 0:S.width)||H.width,H.height=(S==null?void 0:S.height)||H.height,N.mirrored&&($.translate(H.width,0),$.scale(-1,1)),$.imageSmoothingEnabled=N.imageSmoothing,$.drawImage(this.video,0,0,(S==null?void 0:S.width)||H.width,(S==null?void 0:S.height)||H.height),N.mirrored&&($.scale(-1,1),$.translate(-H.width,0))),H},x.prototype.requestUserMedia=function(){var S=this,E=this.props,T=function(j,F){var B={video:typeof F<"u"?F:!0};E.audio&&(B.audio=typeof j<"u"?j:!0),S.requestUserMediaId++;var $=S.requestUserMediaId;navigator.mediaDevices.getUserMedia(B).then(function(H){S.unmounted||$!==S.requestUserMediaId?x.stopMediaStream(H):S.handleUserMedia(null,H)}).catch(function(H){S.handleUserMedia(H)})};if("mediaDevices"in navigator)T(E.audioConstraints,E.videoConstraints);else{var N=function(j){return{optional:[{sourceId:j}]}},L=function(j){var F=j.deviceId;return typeof F=="string"?F:Array.isArray(F)&&F.length>0?F[0]:typeof F=="object"&&F.ideal?F.ideal:null};MediaStreamTrack.getSources(function(j){var F=null,B=null;j.forEach(function(W){W.kind==="audio"?F=W.id:W.kind==="video"&&(B=W.id)});var $=L(E.audioConstraints);$&&(F=$);var H=L(E.videoConstraints);H&&(B=H),T(N(F),N(B))})}},x.prototype.handleUserMedia=function(S,E){var T=this.props;if(S||!E){this.setState({hasUserMedia:!1}),T.onUserMediaError(S);return}this.stream=E;try{this.video&&(this.video.srcObject=E),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(E)})}T.onUserMedia(E)},x.prototype.render=function(){var S=this,E=this,T=E.state,N=E.props,L=N.audio;N.forceScreenshotSourceSize;var j=N.disablePictureInPicture;N.onUserMedia,N.onUserMediaError,N.screenshotFormat,N.screenshotQuality,N.minScreenshotWidth,N.minScreenshotHeight,N.audioConstraints,N.videoConstraints,N.imageSmoothing;var F=N.mirrored,B=N.style,$=B===void 0?{}:B,H=N.children,W=f(N,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),ae=F?d(d({},$),{transform:($.transform||"")+" scaleX(-1)"}):$,me={getScreenshot:this.getScreenshot.bind(this)};return o.createElement(o.Fragment,null,o.createElement("video",d({autoPlay:!0,disablePictureInPicture:j,src:T.src,muted:!L,playsInline:!0,ref:function(ne){S.video=ne},style:ae},W)),H&&H(me))},x.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},x})(o.Component);r.default=y}),react:(function(n,r){n.exports=t})}).default})})(pw)),pw.exports}var iF=sF();const oF=tA(iF);function aF({maxSeat:a,autoStart:e=!1,onSeatChange:t}){const[n,r]=ue.useState(1),[s,o]=ue.useState(!1),[u,d]=ue.useState(null),f=ue.useRef(null),p=ue.useRef(!1),y=ue.useRef(!1),v=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window),x=ue.useCallback(()=>{r(B=>{const $=Math.min(B+1,a);return t==null||t($),$})},[a,t]),S=ue.useCallback(B=>{if(B<1||B>a){console.warn(` ${B}  (1-${a})`);return}r(B),t==null||t(B)},[a,t]),E=ue.useCallback(()=>{r(1),t==null||t(1)},[t]),T=ue.useCallback(B=>{const $={:0,:1,:2,:3,:4,:5,:6,:7,:8,:9,:10,:100,:1,:2,:3,:4,:5,:6,:7,:8,:9,:10};if(B.length===1&&B in $)return $[B];if(B.startsWith("")&&B.length===2){const H=$[B[1]];return H!==void 0?10+H:null}if(B.endsWith("")&&B.length===2){const H=$[B[0]];return H!==void 0?H*10:null}if(B.length===3&&B[1]===""){const H=$[B[0]],W=$[B[2]];if(H!==void 0&&W!==void 0)return H*10+W}return null},[]),N=ue.useCallback(B=>{const $=B.replace(/\s+/g,""),H=$.match(/\d+/);if(H)return parseInt(H[0],10);const W=$.match(/[]+/);return W?T(W[0]):null},[T]),L=ue.useCallback(()=>{if(!v)return d(""),null;try{const B=window.SpeechRecognition||window.webkitSpeechRecognition,$=new B;return $.continuous=!0,$.interimResults=!1,$.lang="zh-TW",$.maxAlternatives=1,$.onresult=H=>{const W=H.results.length-1,ae=H.results[W][0].transcript.trim();console.log(" :",ae);const me=N(ae);me!==null?(console.log(" :",me),S(me)):console.log(" :",ae)},$.onerror=H=>{if(console.error(":",H.error),H.error==="no-speech"){console.log(" ...");return}if(H.error==="aborted"){console.log(" ");return}switch(H.error){case"audio-capture":d("");break;case"not-allowed":d("");break;case"network":d("");break;default:d(`: ${H.error}`)}p.current=!1,o(!1)},$.onstart=()=>{console.log(" ..."),o(!0),d(null),y.current=!1},$.onend=()=>{console.log(" "),!y.current&&p.current?(console.log(" ..."),setTimeout(()=>{if(p.current&&f.current)try{f.current.start()}catch(H){console.error(":",H),p.current=!1,o(!1)}},100)):o(!1)},$}catch(B){return console.error(":",B),d(""),null}},[v,N,S]),j=ue.useCallback(()=>{if(!v){d(" Chrome");return}if(f.current||(f.current=L()),f.current&&!s)try{p.current=!0,y.current=!1,f.current.start(),console.log(" ")}catch(B){console.error(":",B),d("")}},[v,s,L]),F=ue.useCallback(()=>{if(console.log(" "),p.current=!1,y.current=!0,o(!1),f.current)try{f.current.stop()}catch(B){console.error(":",B)}},[]);return ue.useEffect(()=>(e&&v&&j(),()=>{if(console.log(" "),p.current=!1,y.current=!0,f.current)try{f.current.stop(),f.current=null}catch(B){console.error(":",B)}}),[]),{currentSeat:n,nextSeat:x,jumpToSeat:S,resetSeat:E,isListening:s,startListening:j,stopListening:F,isSupported:v,error:u}}async function eT(a,e={}){const{maxWidth:t=1024,quality:n=.8,format:r="image/webp"}=e;return new Promise((s,o)=>{const u=new Image;u.onload=()=>{const d=document.createElement("canvas"),f=d.getContext("2d");if(!f){o(new Error(" Canvas context"));return}let p=u.width,y=u.height;if(p>t){const v=t/p;p=t,y=y*v}d.width=p,d.height=y,f.drawImage(u,0,0,p,y),d.toBlob(v=>{v?(console.log(` : ${(v.size/1024).toFixed(2)} KB`),s(v)):o(new Error(""))},r,n)},u.onerror=()=>{o(new Error(""))},u.src=a})}function lF({classroomId:a,assignmentId:e,maxSeat:t}){const n=ue.useRef(null),r=ue.useRef(null),[s,o]=ue.useState(null),[u,d]=ue.useState([]),[f,p]=ue.useState(!1),[y,v]=ue.useState(!1),[x,S]=ue.useState(null),[E,T]=ue.useState(null),[N,L]=ue.useState(new Map),[j,F]=ue.useState(!1),[B,$]=ue.useState(!1);ue.useEffect(()=>{console.log(" ScannerPage :"),console.log(`   classroomId: ${a}`),console.log(`   assignmentId: ${e}`),console.log(`   maxSeat: ${t}`)},[a,e,t]);const{currentSeat:H,nextSeat:W,isListening:ae,startListening:me,stopListening:ne,isSupported:re}=aF({maxSeat:t,onSeatChange:async Q=>{console.log(":",Q),await xe(Q)}}),xe=ue.useCallback(async Q=>{try{const z=await ze.students.where("classroomId").equals(a).and(K=>K.seatNumber===Q).first();z?(o(z),S(null)):(o(null),S(` ${Q} `))}catch(z){console.error(":",z),S(""),o(null)}},[a]),ve=ue.useCallback(async Q=>{if(!s)throw new Error("");const z=URL.createObjectURL(Q);L(K=>{const Se=new Map(K),Pe=K.get(s.id);return Pe&&URL.revokeObjectURL(Pe.url),Se.set(s.id,{blob:Q,url:z}),Se}),T(z),console.log(`  ${s.name} `),v(!0),setTimeout(()=>{W(),v(!1)},500)},[s,W]),_e=ue.useCallback(async()=>{if(!n.current||!s){S("");return}p(!0),S(null);try{const Q=n.current.getScreenshot();if(!Q)throw new Error("");console.log(" "),console.log(" ...");const z=await eT(Q,{maxWidth:1024,quality:.8,format:"image/webp"});console.log(` : ${(z.size/1024).toFixed(2)} KB`),await ve(z)}catch(Q){console.error(":",Q),S(Q instanceof Error?Q.message:"")}finally{p(!1)}},[s,ve]),pe=ue.useCallback(async Q=>{if(!s){S("");return}p(!0),S(null);try{const z=pA(Q);console.log(` : ${z}, : ${Q.name}`);let K;if(z==="image"){console.log(" ...");const Se=new FileReader,Pe=await new Promise((Ve,We)=>{Se.onload=be=>{var Te;(Te=be.target)!=null&&Te.result&&typeof be.target.result=="string"?Ve(be.target.result):We(new Error(""))},Se.onerror=We,Se.readAsDataURL(Q)});K=await eT(Pe,{maxWidth:1024,quality:.8,format:"image/webp"}),console.log(` : ${(K.size/1024).toFixed(2)} KB`)}else if(z==="pdf")console.log("  PDF ..."),K=await CP(Q,{scale:2,format:"image/webp",quality:.8}),console.log(` PDF : ${(K.size/1024).toFixed(2)} KB`);else throw new Error(" PDF ");await ve(K)}catch(z){console.error(":",z),S(z instanceof Error?z.message:"")}finally{p(!1)}},[s,ve]),fe=ue.useCallback(async()=>{if(N.size===0){S("");return}$(!0),S(null);try{let Q=0;console.log(" ..."),console.log(`    ID: ${e}`),console.log(`   : ${N.size}`);for(const[K,Se]of N.entries()){const Pe=await ze.submissions.where("assignmentId").equals(e).and(We=>We.studentId===K).toArray();if(Pe.length>0){console.log(`  ${K}  ${Pe.length} `);for(const We of Pe)await ze.submissions.delete(We.id)}const Ve={id:Dm(),assignmentId:e,studentId:K,status:"scanned",imageBlob:Se.blob,createdAt:iO()};console.log(` : studentId=${K}, assignmentId=${e}, submissionId=${Ve.id}`),await ze.submissions.add(Ve),Q++}console.log(`  ${Q} `);const z=await ze.submissions.where("assignmentId").equals(e).toArray();console.log(` :  ${z.length} `),N.forEach(K=>{URL.revokeObjectURL(K.url)}),L(new Map),F(!1),T(null),alert(` ${Q} `)}catch(Q){console.error(" :",Q),S(Q instanceof Error?Q.message:"")}finally{$(!1)}},[N,e]),Z=ue.useCallback(()=>{var Q;(Q=r.current)==null||Q.click()},[]),ke=ue.useCallback(Q=>{var K;const z=(K=Q.target.files)==null?void 0:K[0];z&&(pe(z),Q.target.value="")},[pe]);return ue.useEffect(()=>{(async()=>{try{const z=await ze.students.where("classroomId").equals(a).toArray();d(z)}catch(z){console.error(":",z)}})()},[a]),ue.useEffect(()=>{xe(H)},[H,xe]),ue.useEffect(()=>{const Q=z=>{z.code==="Space"&&!f&&(z.preventDefault(),_e())};return window.addEventListener("keydown",Q),()=>window.removeEventListener("keydown",Q)},[_e,f]),j?w.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50",children:w.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-6xl max-h-[90vh] overflow-y-auto p-6",children:[w.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:""}),w.jsxs("p",{className:"text-gray-600 mb-6",children:[" ",N.size," "]}),w.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4 mb-6",children:Array.from(N.entries()).map(([Q,z])=>{const K=u.find(Se=>Se.id===Q);return w.jsxs("div",{className:"bg-gray-100 rounded-lg overflow-hidden",children:[w.jsx("div",{className:"aspect-square relative",children:w.jsx("img",{src:z.url,alt:`${K==null?void 0:K.name} `,className:"w-full h-full object-cover"})}),w.jsx("div",{className:"p-2 text-center",children:w.jsxs("p",{className:"text-xs font-semibold text-gray-900",children:[K==null?void 0:K.seatNumber," ",K==null?void 0:K.name]})})]},Q)})}),x&&w.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm",children:x}),w.jsxs("div",{className:"flex gap-4",children:[w.jsx("button",{onClick:()=>F(!1),disabled:B,className:"flex-1 py-4 bg-gray-600 text-white rounded-xl font-bold text-lg hover:bg-gray-700 disabled:opacity-50",children:""}),w.jsx("button",{onClick:fe,disabled:B,className:"flex-1 py-4 bg-green-600 text-white rounded-xl font-bold text-lg hover:bg-green-700 disabled:opacity-50",children:B?"...":""})]})]})}):w.jsxs("div",{className:"fixed inset-0 bg-black flex flex-col",children:[w.jsx("input",{ref:r,type:"file",accept:"image/*,application/pdf",onChange:ke,className:"hidden"}),w.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[w.jsx(oF,{ref:n,audio:!1,screenshotFormat:"image/jpeg",videoConstraints:{facingMode:"environment",width:1920,height:1080},className:"absolute inset-0 w-full h-full object-cover"}),y&&w.jsx("div",{className:"absolute inset-0 bg-green-500 bg-opacity-30 flex items-center justify-center animate-pulse z-10",children:w.jsx("div",{className:"bg-white rounded-full p-6",children:w.jsx(If,{className:"w-16 h-16 text-green-600"})})}),w.jsx("div",{className:"absolute top-0 left-0 right-0 bg-gradient-to-b from-black/70 to-transparent p-4",children:w.jsxs("div",{className:"flex items-center justify-between text-white",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),w.jsx("span",{className:"text-sm font-medium",children:""})]}),re&&w.jsx("button",{onClick:ae?ne:me,className:`p-2 rounded-full transition-colors ${ae?"bg-red-500 hover:bg-red-600":"bg-white/20 hover:bg-white/30"}`,children:ae?w.jsx(L2,{className:"w-5 h-5"}):w.jsx(B2,{className:"w-5 h-5"})})]})})]}),w.jsxs("div",{className:"bg-gradient-to-t from-black via-black/95 to-black/70 text-white p-6 pb-8",children:[x&&w.jsxs("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg flex items-center gap-2",children:[w.jsx(lx,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),w.jsx("span",{className:"text-sm text-red-200",children:x})]}),w.jsx("div",{className:"mb-6",children:w.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[w.jsx(Q2,{className:"w-6 h-6 text-blue-400"}),w.jsxs("div",{className:"flex-1",children:[w.jsx("div",{className:"text-sm text-gray-400",children:""}),w.jsx("div",{className:"text-2xl font-bold",children:s?s.name:"..."})]}),E&&w.jsxs("div",{className:"flex-shrink-0",children:[w.jsx("div",{className:"text-xs text-gray-400 mb-1 text-center",children:""}),w.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden border-2 border-green-400 shadow-lg",children:w.jsx("img",{src:E,alt:"",className:"w-full h-full object-cover"})})]})]})}),N.size>0&&w.jsx("div",{className:"mb-4 p-3 bg-blue-500/20 border border-blue-500/50 rounded-lg",children:w.jsxs("div",{className:"text-sm text-blue-200",children:[" ",w.jsx("span",{className:"font-bold text-xl",children:N.size})," / ",t," "]})}),w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs("div",{className:"flex-shrink-0 bg-blue-600 rounded-xl px-6 py-4 text-center min-w-[100px]",children:[w.jsx("div",{className:"text-sm text-blue-200 mb-1",children:""}),w.jsx("div",{className:"text-4xl font-bold",children:H})]}),w.jsxs("button",{onClick:Z,disabled:f||!s,className:`flex-shrink-0 flex items-center justify-center gap-2 px-4 py-6 rounded-xl font-bold text-base transition-all ${f?"bg-gray-600 cursor-not-allowed":s?"bg-purple-600 hover:bg-purple-700 active:scale-95":"bg-gray-600 cursor-not-allowed"}`,children:[w.jsx(Y2,{className:"w-5 h-5"}),""]}),w.jsxs("button",{onClick:_e,disabled:f||!s,className:`flex-1 flex items-center justify-center gap-3 py-6 rounded-xl font-bold text-lg transition-all ${f?"bg-gray-600 cursor-not-allowed":s?"bg-green-600 hover:bg-green-700 active:scale-95":"bg-gray-600 cursor-not-allowed"}`,children:[w.jsx(lT,{className:"w-6 h-6"}),f?"...":""]})]}),N.size>0&&w.jsxs("button",{onClick:()=>F(!0),className:"w-full flex items-center justify-center gap-2 py-4 rounded-xl font-bold text-lg transition-all bg-orange-600 hover:bg-orange-700 active:scale-95",children:[w.jsx(If,{className:"w-6 h-6"})," (",N.size," )"]})]}),ae&&w.jsx("div",{className:"mt-4 text-center",children:w.jsxs("div",{className:"inline-flex items-center gap-2 bg-red-500/20 border border-red-500/50 px-4 py-2 rounded-full text-sm",children:[w.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),"..."]})}),w.jsxs("div",{className:"mt-4 text-center text-sm text-gray-400",children:[" () | /PDF | ",re?"":""]})]})]})}function cF({assignmentId:a,onBack:e}){const[t,n]=ue.useState(null),[r,s]=ue.useState(null),[o,u]=ue.useState(30),[d,f]=ue.useState(!0),[p,y]=ue.useState(null);return ue.useEffect(()=>{(async()=>{f(!0),y(null);try{const x=await ze.assignments.get(a);if(!x){y("");return}n(x);const S=await ze.classrooms.get(x.classroomId);if(!S){y("");return}s(S);const E=await ze.students.where("classroomId").equals(x.classroomId).count();u(E||30)}catch(x){console.error(x),y("")}finally{f(!1)}})()},[a]),!d&&t&&r&&!p?w.jsxs("div",{children:[e&&w.jsx("button",{onClick:e,className:"fixed top-4 left-4 z-50 px-4 py-2 bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow text-sm font-medium text-gray-700",children:""}),w.jsx(lF,{classroomId:t.classroomId,assignmentId:t.id,maxSeat:o})]}):w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx(ri,{className:"w-12 h-12 text-purple-600 mx-auto mb-4 animate-spin"}),w.jsx("p",{className:"text-gray-600",children:p?"":""}),p&&w.jsxs("div",{className:"mt-3 flex items-start gap-2 text-sm text-red-600 bg-red-50 border border-red-200 rounded-xl px-3 py-2",children:[w.jsx(lx,{className:"w-4 h-4 mt-0.5"}),w.jsx("span",{children:p})]})]})})}function uF({onBack:a,onSelectAssignment:e}){const[t,n]=ue.useState([]),[r,s]=ue.useState(!0);return ue.useEffect(()=>{(async()=>{s(!0);try{const u=await ze.assignments.toArray(),d=await Promise.all(u.map(async f=>{const p=await ze.classrooms.get(f.classroomId);return{...f,classroom:p||void 0}}));n(d)}finally{s(!1)}})()},[]),r?w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx(ri,{className:"w-12 h-12 text-indigo-600 mx-auto mb-4 animate-spin"}),w.jsx("p",{className:"text-gray-600",children:""})]})}):w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:w.jsxs("div",{className:"max-w-2xl mx-auto pt-8",children:[a&&w.jsxs("button",{onClick:a,className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[w.jsx(kl,{className:"w-5 h-5"}),""]}),w.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6",children:w.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[w.jsx("div",{className:"p-3 bg-orange-100 rounded-xl",children:w.jsx(wl,{className:"w-7 h-7 text-orange-600"})}),w.jsxs("div",{children:[w.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:""}),w.jsx("p",{className:"text-sm text-gray-600",children:""})]})]})}),t.length===0?w.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[w.jsx(wl,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:""}),w.jsx("p",{className:"text-gray-600",children:""})]}):w.jsx("div",{className:"space-y-3",children:t.map(o=>{var u;return w.jsx("button",{type:"button",onClick:()=>e==null?void 0:e(o.id),className:"w-full bg-white rounded-xl shadow-md p-5 text-left hover:shadow-lg transition-all group",children:w.jsxs("div",{className:"flex items-center justify-between gap-4",children:[w.jsxs("div",{className:"flex-1",children:[w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1 group-hover:text-orange-600 transition-colors",children:o.title}),w.jsxs("p",{className:"text-sm text-gray-600",children:[((u=o.classroom)==null?void 0:u.name)||"","   ",o.totalPages," "]}),!o.answerKey&&w.jsx("p",{className:"text-xs text-red-500 mt-1",children:"AI "})]}),w.jsx("div",{className:"text-xs text-orange-700 bg-orange-50 border border-orange-200 px-3 py-1 rounded-full",children:""})]})},o.id)})})]})})}const ff=a=>(a||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),um=a=>(a||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function dF(a){return a>=6?"border-l-4 border-red-500 bg-red-50":a>=4?"border-l-4 border-red-400 bg-red-50":a>=2?"border-l-4 border-amber-400 bg-amber-50":a>=1?"border-l-4 border-amber-200 bg-amber-50":"border-l-4 border-gray-200 bg-white"}function hF({assignmentId:a,onBack:e}){const[t,n]=ue.useState(null),[r,s]=ue.useState(null),[o,u]=ue.useState([]),[d,f]=ue.useState(!0),[p,y]=ue.useState(!0),[v,x]=ue.useState(!1),[S,E]=ue.useState(null);ue.useEffect(()=>((async()=>{f(!0),E(null);try{const me=await ze.assignments.get(a);if(!me)throw new Error("");n(me);const ne=await ze.classrooms.get(me.classroomId);if(!ne)throw new Error("");s(ne);const re=await ze.students.where("classroomId").equals(me.classroomId).toArray(),ve=(await ze.submissions.where("assignmentId").equals(a).toArray()).reduce((_e,pe)=>{var z;const fe=((z=pe.gradingResult)==null?void 0:z.mistakes)||[];if(!fe.length)return _e;const Z=re.find(K=>K.id===pe.studentId),ke=pe.imageBlob?URL.createObjectURL(pe.imageBlob):void 0,Q=fe.map(K=>({id:K.id,question:K.question,reason:K.reason,done:!1}));return _e.push({submissionId:pe.id,studentId:pe.studentId,studentName:(Z==null?void 0:Z.name)||"",seatNumber:(Z==null?void 0:Z.seatNumber)??null,correctionCount:pe.correctionCount??0,mistakes:Q,imageUrl:ke}),_e},[]);ve.sort((_e,pe)=>{const fe=_e.seatNumber??99999,Z=pe.seatNumber??99999;return fe!==Z?fe-Z:_e.studentName.localeCompare(pe.studentName)}),u(ve)}catch(me){console.error(me),E(me instanceof Error?me.message:"")}finally{f(!1)}})(),()=>{u(me=>(me.forEach(ne=>{ne.imageUrl&&URL.revokeObjectURL(ne.imageUrl)}),me))}),[a]);const T=ue.useMemo(()=>o.filter(ae=>ae.mistakes.some(me=>!me.done)).sort((ae,me)=>{const ne=ae.seatNumber??99999,re=me.seatNumber??99999;return ne!==re?ne-re:ae.studentName.localeCompare(me.studentName)}),[o]),N=ue.useMemo(()=>v?o:T,[v,o,T]),L=(ae,me)=>{u(ne=>ne.map(re=>{if(re.submissionId!==ae)return re;const xe=re.mistakes.map(ve=>ve.id===me?{...ve,done:!ve.done}:ve);return{...re,mistakes:xe}}))},j=async(ae,me)=>{const ne=Math.max(0,me);u(re=>re.map(xe=>xe.submissionId===ae?{...xe,correctionCount:ne}:xe));try{await ze.submissions.update(ae,{correctionCount:ne})}catch(re){console.error("",re)}},F=async ae=>{var ne;const me=((ne=o.find(re=>re.submissionId===ae))==null?void 0:ne.correctionCount)||0;await j(ae,me+1)},B=async ae=>{await j(ae,0)},$=()=>{const ae=v?o:T,re=`<?xml version="1.0"?>
    <?mso-application progid="Excel.Sheet"?>
    <Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"
      xmlns:o="urn:schemas-microsoft-com:office:office"
      xmlns:x="urn:schemas-microsoft-com:office:excel"
      xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">
      <Styles>
        <Style ss:ID="base">
          <Font ss:FontName="" />
          <Alignment ss:Vertical="Top" ss:WrapText="1"/>
        </Style>
        <Style ss:ID="card">
          <Font ss:FontName="" ss:Bold="1" />
          <Alignment ss:Vertical="Top" ss:WrapText="1"/>
          <Borders>
            <Border ss:Position="Top" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#000000"/>
            <Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#000000"/>
            <Border ss:Position="Left" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#000000"/>
            <Border ss:Position="Right" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#000000"/>
          </Borders>
        </Style>
        <Style ss:ID="header" ss:Parent="card">
          <Font ss:FontName="" ss:Bold="1" />
          <Alignment ss:Vertical="Center" ss:WrapText="1"/>
        </Style>
        <Style ss:ID="cell" ss:Parent="base">
          <Borders>
            <Border ss:Position="Top" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#000000"/>
            <Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#000000"/>
            <Border ss:Position="Left" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#000000"/>
            <Border ss:Position="Right" ss:LineStyle="Continuous" ss:Weight="1" ss:Color="#000000"/>
          </Borders>
        </Style>
      </Styles>
      ${(ae.length>0?ae:o).map((pe,fe)=>{const Z=pe.seatNumber!=null?pe.seatNumber.toString():"",ke=pe.studentName||`${fe+1}`,Q=`${Z?`${Z}-`:""}${ke}`.slice(0,25),z=ff(Q||`sheet${fe+1}`),K=`${(t==null?void 0:t.title)||""}`,Se=`${Z||""}    ${ke}`,Pe="-----------------------------------------",Ve=pe.mistakes.filter(We=>!We.done).map(We=>`<Row>
              <Cell ss:StyleID="cell"><Data ss:Type="String"></Data></Cell>
              <Cell ss:StyleID="cell"><Data ss:Type="String">${ff(We.question)}</Data></Cell>
              <Cell ss:StyleID="cell"><Data ss:Type="String">${ff(We.reason)}</Data></Cell>
            </Row>`).join("");return`
        <Worksheet ss:Name="${z}">
          <Table>
            <Column ss:AutoFitWidth="1" ss:Width="40"/>
            <Column ss:AutoFitWidth="1" ss:Width="200"/>
            <Column ss:AutoFitWidth="1" ss:Width="220"/>
            <Row>
              <Cell ss:MergeAcross="2" ss:StyleID="card"><Data ss:Type="String">${ff(K)}</Data></Cell>
            </Row>
            <Row>
              <Cell ss:MergeAcross="2" ss:StyleID="card"><Data ss:Type="String">${ff(Se)}</Data></Cell>
            </Row>
            <Row>
              <Cell ss:MergeAcross="2" ss:StyleID="card"><Data ss:Type="String">${ff(Pe)}</Data></Cell>
            </Row>
            <Row>
              <Cell ss:StyleID="header"><Data ss:Type="String"></Data></Cell>
              <Cell ss:StyleID="header"><Data ss:Type="String"></Data></Cell>
              <Cell ss:StyleID="header"><Data ss:Type="String"></Data></Cell>
            </Row>
            ${Ve||`<Row>
                <Cell ss:StyleID="cell"><Data ss:Type="String"></Data></Cell>
                <Cell ss:StyleID="cell"><Data ss:Type="String"></Data></Cell>
                <Cell ss:StyleID="cell"><Data ss:Type="String"></Data></Cell>
              </Row>`}
          </Table>
        </Worksheet>`}).join(`
`)}
    </Workbook>`,xe=new Blob([`\uFEFF${re}`],{type:"application/vnd.ms-excel;charset=utf-8;"}),ve=URL.createObjectURL(xe),_e=document.createElement("a");_e.href=ve,_e.download=".xls",_e.click(),URL.revokeObjectURL(ve)},H=async()=>{const ae=window,me=ne=>new Promise((re,xe)=>{const ve=document.createElement("script");ve.src=ne,ve.onload=()=>re(),ve.onerror=()=>xe(new Error(`: ${ne}`)),document.body.appendChild(ve)});ae.html2canvas||await me("https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"),ae.jspdf||await me("https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js")},W=async()=>{try{await H();const ae=window,me=T.length>0?T:o;if(me.length===0)return;const ne=document.createElement("div");ne.style.position="fixed",ne.style.left="-9999px",ne.style.top="0",ne.style.width="800px",ne.style.fontFamily='DFKai-SB, PMingLiU, "Microsoft JhengHei", serif',me.forEach(Q=>{const z=Q.seatNumber!=null?Q.seatNumber.toString():"",K=Q.studentName,Se=document.createElement("div");Se.style.border="1px solid #000",Se.style.padding="16px",Se.style.marginBottom="12px",Se.style.width="760px",Se.style.boxSizing="border-box",Se.style.backgroundColor="#fff",Se.innerHTML=`
          <div style="font-weight:bold;margin-bottom:6px;">${um((t==null?void 0:t.title)||"")}</div>
          <div style="font-weight:bold;margin-bottom:6px;">${um(z)}${um(K)}</div>
          <div style="margin-bottom:8px;">-----------------------------------------</div>
          <table style="width:100%; border-collapse:collapse; table-layout:fixed;">
            <colgroup>
              <col style="width:50px;" />
              <col style="width:200px;" />
              <col style="width:260px;" />
            </colgroup>
            <thead>
              <tr>
                <th style="border:1px solid #000; padding:6px; text-align:center;"></th>
                <th style="border:1px solid #000; padding:6px; text-align:center;"></th>
                <th style="border:1px solid #000; padding:6px; text-align:center;"></th>
              </tr>
            </thead>
            <tbody>
              ${Q.mistakes.filter(Pe=>!Pe.done).length===0?`<tr>
                      <td style="border:1px solid #000; padding:6px; text-align:center; vertical-align:top;"></td>
                      <td style="border:1px solid #000; padding:6px; word-break:break-word;"></td>
                      <td style="border:1px solid #000; padding:6px; word-break:break-word;"></td>
                    </tr>`:Q.mistakes.filter(Pe=>!Pe.done).map(Pe=>`<tr>
                          <td style="border:1px solid #000; padding:6px; text-align:center; vertical-align:top;"></td>
                          <td style="border:1px solid #000; padding:6px; word-break:break-word;">${um(Pe.question)}</td>
                          <td style="border:1px solid #000; padding:6px; word-break:break-word;">${um(Pe.reason)}</td>
                        </tr>`).join("")}
            </tbody>
          </table>
        `,ne.appendChild(Se)}),document.body.appendChild(ne);const re=await Promise.all(Array.from(ne.children).map(Q=>ae.html2canvas(Q,{scale:2}))),{jsPDF:xe}=ae.jspdf,ve=new xe({unit:"pt",format:"a4"}),_e=ve.internal.pageSize.getWidth(),pe=ve.internal.pageSize.getHeight(),fe=24,Z=pe-fe*2;let ke=fe;re.forEach(Q=>{const z=Q.toDataURL("image/jpeg",.95),K=Math.min((_e-fe*2)/Q.width,Z/Q.height),Se=Q.width*K,Pe=Q.height*K;ke+Pe>fe+Z&&(ve.addPage(),ke=fe);const Ve=(_e-Se)/2;ve.addImage(z,"JPEG",Ve,ke,Se,Pe),ke+=Pe+12}),ve.save(".pdf"),document.body.removeChild(ne)}catch(ae){console.error(" PDF ",ae),alert(" PDF ")}};return d?w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx(ri,{className:"w-12 h-12 text-orange-500 mx-auto mb-4 animate-spin"}),w.jsx("p",{className:"text-gray-600",children:""})]})}):w.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-red-50 p-4",children:[w.jsx("style",{children:`
          @page {
            size: A4;
            margin: 12mm;
          }
          @media print {
            .print-hidden { display: none !important; }
            .print-block { display: block !important; }
            .print-card { break-inside: avoid; page-break-inside: avoid; }
          }
        `}),w.jsxs("div",{className:"max-w-7xl mx-auto pt-8",children:[e&&w.jsxs("button",{onClick:e,className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors print-hidden",children:[w.jsx(kl,{className:"w-5 h-5"}),""]}),w.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-4",children:w.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[w.jsxs("div",{children:[w.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"  "}),w.jsxs("p",{className:"text-sm text-gray-600",children:["",(r==null?void 0:r.name)||"","  ",(t==null?void 0:t.title)||""]}),w.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["",T.length," "]})]}),w.jsxs("div",{className:"flex flex-wrap gap-2 print-hidden",children:[w.jsxs("button",{type:"button",onClick:W,className:"inline-flex items-center gap-1 px-3 py-2 bg-white text-gray-700 rounded-lg hover:bg-gray-100 border border-gray-200 text-sm",children:[w.jsx(gw,{className:"w-4 h-4"}),"PDF()"]}),w.jsxs("button",{type:"button",onClick:$,className:"inline-flex items-center gap-1 px-3 py-2 bg-white text-gray-700 rounded-lg hover:bg-gray-100 border border-gray-200 text-sm",children:[w.jsx(gw,{className:"w-4 h-4"}),"Excel()"]}),w.jsxs("button",{type:"button",onClick:()=>y(ae=>!ae),className:"inline-flex items-center gap-1 px-3 py-2 rounded-lg border text-sm bg-white text-gray-700 hover:bg-gray-100 border-gray-200 transition-colors",children:[w.jsx(A2,{className:"w-4 h-4"}),p?"":""]}),w.jsxs("button",{type:"button",onClick:()=>x(ae=>!ae),className:`inline-flex items-center gap-1 px-3 py-2 rounded-lg border text-sm transition-colors ${v?"bg-green-50 text-green-700 border-green-200 hover:bg-green-100":"bg-white text-gray-700 border-gray-200 hover:bg-gray-100"}`,children:[w.jsx(If,{className:"w-4 h-4"}),v?"":""]})]})]})}),S&&w.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-xl p-4 mb-4 print-hidden",children:w.jsx("p",{children:S})}),w.jsx("div",{className:`grid ${p?"gap-3":"gap-4"} print-hidden`,style:p?{gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"}:void 0,children:N.length===0?w.jsx("div",{className:"sm:col-span-2 xl:col-span-3 2xl:col-span-4 bg-white rounded-xl shadow p-6 text-center text-gray-500",children:v?"":""}):N.map(ae=>w.jsxs("div",{className:`rounded-xl shadow ${p?"p-3":"p-4"} border border-gray-100 ${dF(ae.correctionCount||0)}`,children:[w.jsxs("div",{className:"flex items-start justify-between mb-2",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-gray-900 leading-tight",children:ae.seatNumber!=null?`${ae.seatNumber} ${ae.studentName}`:ae.studentName}),w.jsxs("p",{className:"text-[11px] text-gray-500",children:["",ae.correctionCount||0]})]}),w.jsxs("div",{className:"flex items-center gap-1",children:[w.jsx("button",{type:"button",onClick:()=>void F(ae.submissionId),className:"inline-flex items-center px-2 py-1 rounded-lg bg-white/80 border border-orange-200 text-orange-700 text-xs hover:bg-orange-50",children:"+1"}),w.jsx("button",{type:"button",onClick:()=>void B(ae.submissionId),className:"inline-flex items-center px-2 py-1 rounded-lg bg-white/80 border border-gray-200 text-gray-600 text-xs hover:bg-gray-50",title:" 0",children:"0"})]})]}),w.jsx("div",{className:p?"flex flex-wrap gap-1":"space-y-2",children:ae.mistakes.map(me=>{const ne={key:me.id,type:"button",onClick:()=>L(ae.submissionId,me.id)};return p?w.jsx("button",{...ne,className:`px-2 py-1 rounded border text-left text-xs ${me.done?"bg-green-50 border-green-200 text-green-700 line-through":"bg-white border-gray-200 text-gray-800 hover:bg-gray-50"}`,title:me.reason,children:w.jsxs("div",{className:"flex items-center gap-1",children:[me.done?w.jsx(If,{className:"w-3.5 h-3.5 text-green-600"}):w.jsx("span",{className:"w-3.5 h-3.5 border border-gray-300 rounded-full inline-flex"}),w.jsx("span",{className:"font-medium truncate max-w-[140px]",children:me.question})]})}):w.jsxs("button",{...ne,className:`w-full text-left px-3 py-2 rounded-lg border ${me.done?"bg-green-50 border-green-200 text-green-700 line-through":"bg-white border-gray-200 text-gray-800 hover:bg-gray-50"}`,children:[w.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[me.done?w.jsx(If,{className:"w-4 h-4 text-green-600"}):w.jsx("span",{className:"w-4 h-4 border border-gray-300 rounded-full inline-flex"}),w.jsx("span",{className:"font-medium truncate",children:me.question})]}),w.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:me.reason})]})})})]},ae.submissionId))})]})]})}function fF({onBack:a}){const[e,t]=ue.useState([]),[n,r]=ue.useState(""),[s,o]=ue.useState([]),[u,d]=ue.useState([]),[f,p]=ue.useState([]),[y,v]=ue.useState({}),[x,S]=ue.useState(!0),[E,T]=ue.useState(null);ue.useEffect(()=>{(async()=>{const re=await ze.classrooms.toArray();t(re),re.length>0&&r(xe=>xe||re[0].id)})()},[]),ue.useEffect(()=>{(async()=>{if(n){S(!0),T(null);try{const[re,xe]=await Promise.all([ze.assignments.where("classroomId").equals(n).toArray(),ze.students.where("classroomId").equals(n).toArray()]),ve=[...re].sort((pe,fe)=>pe.title.localeCompare(fe.title)),_e=[...xe].sort((pe,fe)=>(pe.seatNumber??99999)-(fe.seatNumber??99999));if(o(ve),d(_e),ve.length>0){const pe=await ze.submissions.where("assignmentId").anyOf(ve.map(fe=>fe.id)).toArray();p(pe)}else p([]);v(pe=>{const fe={...pe};return ve.forEach(Z=>{fe[Z.id]==null&&(fe[Z.id]=1)}),fe})}catch(re){console.error(re),T(re instanceof Error?re.message:"")}finally{S(!1)}}})()},[n]);const N=ue.useMemo(()=>{const ne=new Map;return f.forEach(re=>{ne.set(`${re.assignmentId}-${re.studentId}`,re)}),ne},[f]),L=ue.useMemo(()=>s.reduce((ne,re)=>ne+(y[re.id]??0),0),[s,y]),j=ue.useMemo(()=>u.map(ne=>{const re=s.map(ve=>{const _e=N.get(`${ve.id}-${ne.id}`);return(_e==null?void 0:_e.score)??null}),xe=L>0?s.reduce((ve,_e,pe)=>{const fe=re[pe],Z=y[_e.id]??0;return ve+(fe!=null?fe*Z:0)},0):null;return{student:ne,scores:re,weightedTotal:xe}}),[u,s,N,y,L]),F=ne=>{const re=ne.filter(pe=>pe!=null);if(re.length===0)return{average:null,median:null};const xe=[...re].sort((pe,fe)=>pe-fe),ve=xe.reduce((pe,fe)=>pe+fe,0)/xe.length,_e=xe.length%2===1?xe[(xe.length-1)/2]:(xe[xe.length/2-1]+xe[xe.length/2])/2;return{average:ve,median:_e}},B=(ne,re)=>{if(ne.length===0)return null;const xe=[...ne].sort((Z,ke)=>Z-ke),ve=(xe.length-1)*re,_e=Math.floor(ve),pe=Math.ceil(ve);if(_e===pe)return xe[_e];const fe=ve-_e;return xe[_e]*(1-fe)+xe[pe]*fe},$=ue.useMemo(()=>{const ne={};return s.forEach((re,xe)=>{const ve=j.map(_e=>_e.scores[xe]);ne[re.id]=F(ve)}),ne},[s,j]),H=ue.useMemo(()=>{const ne=j.map(re=>re.weightedTotal).filter(re=>re!=null);return{...F(ne),q1:B(ne,.25)}},[j]),W=ne=>ne==null?"":Number.isInteger(ne)?ne.toString():ne.toFixed(1),ae=(ne,re)=>{v(xe=>({...xe,[ne]:Math.max(0,re)}))},me=()=>{const ne=["","",...s.map(fe=>fe.title),""],re=j.map(fe=>[fe.student.seatNumber??"",fe.student.name,...fe.scores.map(ke=>ke==null?"":ke.toString()),fe.weightedTotal==null?"":fe.weightedTotal.toFixed(1)].map(ke=>`"${String(ke).replace(/"/g,'""')}"`).join(",")),xe=[ne.join(","),...re].join(`
`),ve=new Blob([`\uFEFF${xe}`],{type:"text/csv;charset=utf-8;"}),_e=URL.createObjectURL(ve),pe=document.createElement("a");pe.href=_e,pe.download=".csv",pe.click(),URL.revokeObjectURL(_e)};return x?w.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-amber-50 to-orange-100",children:w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-orange-400 border-t-transparent rounded-full mx-auto mb-3"}),w.jsx("p",{className:"text-gray-600",children:"..."})]})}):w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-4",children:w.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[a?w.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 text-gray-700 hover:text-gray-900",children:[w.jsx(kl,{className:"w-5 h-5"}),""]}):w.jsx("div",{}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("select",{value:n,onChange:ne=>r(ne.target.value),className:"rounded-lg border border-gray-300 px-3 py-2 text-sm bg-white shadow-sm",children:e.map(ne=>w.jsx("option",{value:ne.id,children:ne.name},ne.id))}),w.jsxs("button",{type:"button",onClick:me,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 text-sm",children:[w.jsx(gw,{className:"w-4 h-4"})," CSV"]})]})]}),E&&w.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:E}),w.jsxs("div",{className:"bg-white rounded-2xl shadow p-4 space-y-4",children:[w.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[w.jsxs("div",{children:[w.jsx("h1",{className:"text-xl font-bold text-gray-900",children:""}),w.jsx("p",{className:"text-sm text-gray-600",children:" CSV"})]}),w.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2 bg-gray-50 px-3 py-2 rounded-lg",children:[w.jsx(I2,{className:"w-4 h-4 text-gray-400"})," = (  )"]})]}),w.jsx("div",{className:"overflow-x-auto",children:w.jsxs("table",{className:"min-w-full text-sm",children:[w.jsx("thead",{children:w.jsxs("tr",{className:"bg-gray-50 text-gray-700",children:[w.jsx("th",{className:"px-3 py-2 text-left w-16",children:""}),w.jsx("th",{className:"px-3 py-2 text-left w-32",children:""}),s.map(ne=>{var re,xe;return w.jsxs("th",{className:"px-3 py-2 text-center min-w-[140px]",children:[w.jsx("div",{className:"font-semibold text-gray-900",children:ne.title}),w.jsxs("div",{className:"text-xs text-gray-500 flex items-center justify-center gap-1 mt-1",children:["",w.jsx("input",{type:"number",step:"0.1",min:0,value:y[ne.id]??1,onChange:ve=>ae(ne.id,Number(ve.target.value)),className:"w-16 px-2 py-1 border border-gray-300 rounded text-xs text-gray-700"})]}),w.jsxs("div",{className:"text-[11px] text-gray-500 mt-1",children:[" ",W((re=$[ne.id])==null?void 0:re.average),"  "," ",W((xe=$[ne.id])==null?void 0:xe.median)]})]},ne.id)}),w.jsxs("th",{className:"px-3 py-2 text-center min-w-[120px]",children:[w.jsx("div",{className:"font-semibold text-gray-900",children:"()"}),w.jsxs("div",{className:"text-[11px] text-gray-500 mt-1",children:[" ",W(H.average),"   ",W(H.median)]})]})]})}),w.jsxs("tbody",{className:"divide-y divide-gray-100",children:[j.map(ne=>{const re=H.q1!=null&&ne.weightedTotal!=null&&ne.weightedTotal<=H.q1;return w.jsxs("tr",{className:`hover:bg-gray-50 ${re?"bg-rose-50/80":""}`,children:[w.jsx("td",{className:"px-3 py-2 text-gray-900 font-medium",children:ne.student.seatNumber??""}),w.jsx("td",{className:"px-3 py-2 text-gray-800",children:ne.student.name}),ne.scores.map((xe,ve)=>w.jsx("td",{className:"px-3 py-2 text-center text-gray-900",children:xe??""},s[ve].id)),w.jsx("td",{className:"px-3 py-2 text-center font-semibold",children:w.jsxs("span",{className:`inline-flex items-center justify-center gap-1 ${re?"px-2 py-1 rounded-lg bg-rose-100 text-rose-800 ring-1 ring-rose-200":"text-gray-900"}`,children:[re&&w.jsx(Nk,{className:"w-4 h-4 text-rose-600","aria-label":""}),ne.weightedTotal==null?"":ne.weightedTotal.toFixed(1)]})})]},ne.student.id)}),j.length===0&&w.jsx("tr",{children:w.jsx("td",{colSpan:s.length+3,className:"px-3 py-6 text-center text-gray-500",children:""})})]})]})}),w.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[w.jsx(Nk,{className:"w-4 h-4 text-rose-500"}),"Q1"]})]})]})})}function VR(a){var e,t,n="";if(typeof a=="string"||typeof a=="number")n+=a;else if(typeof a=="object")if(Array.isArray(a)){var r=a.length;for(e=0;e<r;e++)a[e]&&(t=VR(a[e]))&&(n&&(n+=" "),n+=t)}else for(t in a)a[t]&&(n&&(n+=" "),n+=t);return n}function pF(){for(var a,e,t=0,n="",r=arguments.length;t<r;t++)(a=arguments[t])&&(e=VR(a))&&(n&&(n+=" "),n+=e);return n}const gF=(a,e)=>{const t=new Array(a.length+e.length);for(let n=0;n<a.length;n++)t[n]=a[n];for(let n=0;n<e.length;n++)t[a.length+n]=e[n];return t},mF=(a,e)=>({classGroupId:a,validator:e}),WR=(a=new Map,e=null,t)=>({nextPart:a,validators:e,classGroupId:t}),Uw="-",tT=[],yF="arbitrary..",vF=a=>{const e=wF(a),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=a;return{getClassGroupId:o=>{if(o.startsWith("[")&&o.endsWith("]"))return bF(o);const u=o.split(Uw),d=u[0]===""&&u.length>1?1:0;return GR(u,d,e)},getConflictingClassGroupIds:(o,u)=>{if(u){const d=n[o],f=t[o];return d?f?gF(f,d):d:f||tT}return t[o]||tT}}},GR=(a,e,t)=>{if(a.length-e===0)return t.classGroupId;const r=a[e],s=t.nextPart.get(r);if(s){const f=GR(a,e+1,s);if(f)return f}const o=t.validators;if(o===null)return;const u=e===0?a.join(Uw):a.slice(e).join(Uw),d=o.length;for(let f=0;f<d;f++){const p=o[f];if(p.validator(u))return p.classGroupId}},bF=a=>a.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=a.slice(1,-1),t=e.indexOf(":"),n=e.slice(0,t);return n?yF+n:void 0})(),wF=a=>{const{theme:e,classGroups:t}=a;return xF(t,e)},xF=(a,e)=>{const t=WR();for(const n in a){const r=a[n];EA(r,t,n,e)}return t},EA=(a,e,t,n)=>{const r=a.length;for(let s=0;s<r;s++){const o=a[s];_F(o,e,t,n)}},_F=(a,e,t,n)=>{if(typeof a=="string"){SF(a,e,t);return}if(typeof a=="function"){EF(a,e,t,n);return}AF(a,e,t,n)},SF=(a,e,t)=>{const n=a===""?e:KR(e,a);n.classGroupId=t},EF=(a,e,t,n)=>{if(kF(a)){EA(a(n),e,t,n);return}e.validators===null&&(e.validators=[]),e.validators.push(mF(t,a))},AF=(a,e,t,n)=>{const r=Object.entries(a),s=r.length;for(let o=0;o<s;o++){const[u,d]=r[o];EA(d,KR(e,u),t,n)}},KR=(a,e)=>{let t=a;const n=e.split(Uw),r=n.length;for(let s=0;s<r;s++){const o=n[s];let u=t.nextPart.get(o);u||(u=WR(),t.nextPart.set(o,u)),t=u}return t},kF=a=>"isThemeGetter"in a&&a.isThemeGetter===!0,CF=a=>{if(a<1)return{get:()=>{},set:()=>{}};let e=0,t=Object.create(null),n=Object.create(null);const r=(s,o)=>{t[s]=o,e++,e>a&&(e=0,n=t,t=Object.create(null))};return{get(s){let o=t[s];if(o!==void 0)return o;if((o=n[s])!==void 0)return r(s,o),o},set(s,o){s in t?t[s]=o:r(s,o)}}},eA="!",nT=":",TF=[],rT=(a,e,t,n,r)=>({modifiers:a,hasImportantModifier:e,baseClassName:t,maybePostfixModifierPosition:n,isExternal:r}),NF=a=>{const{prefix:e,experimentalParseClassName:t}=a;let n=r=>{const s=[];let o=0,u=0,d=0,f;const p=r.length;for(let E=0;E<p;E++){const T=r[E];if(o===0&&u===0){if(T===nT){s.push(r.slice(d,E)),d=E+1;continue}if(T==="/"){f=E;continue}}T==="["?o++:T==="]"?o--:T==="("?u++:T===")"&&u--}const y=s.length===0?r:r.slice(d);let v=y,x=!1;y.endsWith(eA)?(v=y.slice(0,-1),x=!0):y.startsWith(eA)&&(v=y.slice(1),x=!0);const S=f&&f>d?f-d:void 0;return rT(s,x,v,S)};if(e){const r=e+nT,s=n;n=o=>o.startsWith(r)?s(o.slice(r.length)):rT(TF,!1,o,void 0,!0)}if(t){const r=n;n=s=>t({className:s,parseClassName:r})}return n},PF=a=>{const e=new Map;return a.orderSensitiveModifiers.forEach((t,n)=>{e.set(t,1e6+n)}),t=>{const n=[];let r=[];for(let s=0;s<t.length;s++){const o=t[s],u=o[0]==="[",d=e.has(o);u||d?(r.length>0&&(r.sort(),n.push(...r),r=[]),n.push(o)):r.push(o)}return r.length>0&&(r.sort(),n.push(...r)),n}},RF=a=>({cache:CF(a.cacheSize),parseClassName:NF(a),sortModifiers:PF(a),...vF(a)}),IF=/\s+/,OF=(a,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:r,sortModifiers:s}=e,o=[],u=a.trim().split(IF);let d="";for(let f=u.length-1;f>=0;f-=1){const p=u[f],{isExternal:y,modifiers:v,hasImportantModifier:x,baseClassName:S,maybePostfixModifierPosition:E}=t(p);if(y){d=p+(d.length>0?" "+d:d);continue}let T=!!E,N=n(T?S.substring(0,E):S);if(!N){if(!T){d=p+(d.length>0?" "+d:d);continue}if(N=n(S),!N){d=p+(d.length>0?" "+d:d);continue}T=!1}const L=v.length===0?"":v.length===1?v[0]:s(v).join(":"),j=x?L+eA:L,F=j+N;if(o.indexOf(F)>-1)continue;o.push(F);const B=r(N,T);for(let $=0;$<B.length;++$){const H=B[$];o.push(j+H)}d=p+(d.length>0?" "+d:d)}return d},jF=(...a)=>{let e=0,t,n,r="";for(;e<a.length;)(t=a[e++])&&(n=XR(t))&&(r&&(r+=" "),r+=n);return r},XR=a=>{if(typeof a=="string")return a;let e,t="";for(let n=0;n<a.length;n++)a[n]&&(e=XR(a[n]))&&(t&&(t+=" "),t+=e);return t},MF=(a,...e)=>{let t,n,r,s;const o=d=>{const f=e.reduce((p,y)=>y(p),a());return t=RF(f),n=t.cache.get,r=t.cache.set,s=u,u(d)},u=d=>{const f=n(d);if(f)return f;const p=OF(d,t);return r(d,p),p};return s=o,(...d)=>s(jF(...d))},DF=[],tr=a=>{const e=t=>t[a]||DF;return e.isThemeGetter=!0,e},YR=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,JR=/^\((?:(\w[\w-]*):)?(.+)\)$/i,LF=/^\d+\/\d+$/,FF=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,BF=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,$F=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,UF=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,zF=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,pf=a=>LF.test(a),Pt=a=>!!a&&!Number.isNaN(Number(a)),dc=a=>!!a&&Number.isInteger(Number(a)),oS=a=>a.endsWith("%")&&Pt(a.slice(0,-1)),Oa=a=>FF.test(a),HF=()=>!0,qF=a=>BF.test(a)&&!$F.test(a),QR=()=>!1,VF=a=>UF.test(a),WF=a=>zF.test(a),GF=a=>!rt(a)&&!st(a),KF=a=>fg(a,tI,QR),rt=a=>YR.test(a),zu=a=>fg(a,nI,qF),aS=a=>fg(a,ZF,Pt),sT=a=>fg(a,ZR,QR),XF=a=>fg(a,eI,WF),kb=a=>fg(a,rI,VF),st=a=>JR.test(a),dm=a=>pg(a,nI),YF=a=>pg(a,eB),iT=a=>pg(a,ZR),JF=a=>pg(a,tI),QF=a=>pg(a,eI),Cb=a=>pg(a,rI,!0),fg=(a,e,t)=>{const n=YR.exec(a);return n?n[1]?e(n[1]):t(n[2]):!1},pg=(a,e,t=!1)=>{const n=JR.exec(a);return n?n[1]?e(n[1]):t:!1},ZR=a=>a==="position"||a==="percentage",eI=a=>a==="image"||a==="url",tI=a=>a==="length"||a==="size"||a==="bg-size",nI=a=>a==="length",ZF=a=>a==="number",eB=a=>a==="family-name",rI=a=>a==="shadow",tB=()=>{const a=tr("color"),e=tr("font"),t=tr("text"),n=tr("font-weight"),r=tr("tracking"),s=tr("leading"),o=tr("breakpoint"),u=tr("container"),d=tr("spacing"),f=tr("radius"),p=tr("shadow"),y=tr("inset-shadow"),v=tr("text-shadow"),x=tr("drop-shadow"),S=tr("blur"),E=tr("perspective"),T=tr("aspect"),N=tr("ease"),L=tr("animate"),j=()=>["auto","avoid","all","avoid-page","page","left","right","column"],F=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],B=()=>[...F(),st,rt],$=()=>["auto","hidden","clip","visible","scroll"],H=()=>["auto","contain","none"],W=()=>[st,rt,d],ae=()=>[pf,"full","auto",...W()],me=()=>[dc,"none","subgrid",st,rt],ne=()=>["auto",{span:["full",dc,st,rt]},dc,st,rt],re=()=>[dc,"auto",st,rt],xe=()=>["auto","min","max","fr",st,rt],ve=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],_e=()=>["start","end","center","stretch","center-safe","end-safe"],pe=()=>["auto",...W()],fe=()=>[pf,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...W()],Z=()=>[a,st,rt],ke=()=>[...F(),iT,sT,{position:[st,rt]}],Q=()=>["no-repeat",{repeat:["","x","y","space","round"]}],z=()=>["auto","cover","contain",JF,KF,{size:[st,rt]}],K=()=>[oS,dm,zu],Se=()=>["","none","full",f,st,rt],Pe=()=>["",Pt,dm,zu],Ve=()=>["solid","dashed","dotted","double"],We=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],be=()=>[Pt,oS,iT,sT],Te=()=>["","none",S,st,rt],Ee=()=>["none",Pt,st,rt],at=()=>["none",Pt,st,rt],bt=()=>[Pt,st,rt],tt=()=>[pf,"full",...W()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Oa],breakpoint:[Oa],color:[HF],container:[Oa],"drop-shadow":[Oa],ease:["in","out","in-out"],font:[GF],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Oa],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Oa],shadow:[Oa],spacing:["px",Pt],text:[Oa],"text-shadow":[Oa],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",pf,rt,st,T]}],container:["container"],columns:[{columns:[Pt,rt,st,u]}],"break-after":[{"break-after":j()}],"break-before":[{"break-before":j()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:B()}],overflow:[{overflow:$()}],"overflow-x":[{"overflow-x":$()}],"overflow-y":[{"overflow-y":$()}],overscroll:[{overscroll:H()}],"overscroll-x":[{"overscroll-x":H()}],"overscroll-y":[{"overscroll-y":H()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:ae()}],"inset-x":[{"inset-x":ae()}],"inset-y":[{"inset-y":ae()}],start:[{start:ae()}],end:[{end:ae()}],top:[{top:ae()}],right:[{right:ae()}],bottom:[{bottom:ae()}],left:[{left:ae()}],visibility:["visible","invisible","collapse"],z:[{z:[dc,"auto",st,rt]}],basis:[{basis:[pf,"full","auto",u,...W()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Pt,pf,"auto","initial","none",rt]}],grow:[{grow:["",Pt,st,rt]}],shrink:[{shrink:["",Pt,st,rt]}],order:[{order:[dc,"first","last","none",st,rt]}],"grid-cols":[{"grid-cols":me()}],"col-start-end":[{col:ne()}],"col-start":[{"col-start":re()}],"col-end":[{"col-end":re()}],"grid-rows":[{"grid-rows":me()}],"row-start-end":[{row:ne()}],"row-start":[{"row-start":re()}],"row-end":[{"row-end":re()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":xe()}],"auto-rows":[{"auto-rows":xe()}],gap:[{gap:W()}],"gap-x":[{"gap-x":W()}],"gap-y":[{"gap-y":W()}],"justify-content":[{justify:[...ve(),"normal"]}],"justify-items":[{"justify-items":[..._e(),"normal"]}],"justify-self":[{"justify-self":["auto",..._e()]}],"align-content":[{content:["normal",...ve()]}],"align-items":[{items:[..._e(),{baseline:["","last"]}]}],"align-self":[{self:["auto",..._e(),{baseline:["","last"]}]}],"place-content":[{"place-content":ve()}],"place-items":[{"place-items":[..._e(),"baseline"]}],"place-self":[{"place-self":["auto",..._e()]}],p:[{p:W()}],px:[{px:W()}],py:[{py:W()}],ps:[{ps:W()}],pe:[{pe:W()}],pt:[{pt:W()}],pr:[{pr:W()}],pb:[{pb:W()}],pl:[{pl:W()}],m:[{m:pe()}],mx:[{mx:pe()}],my:[{my:pe()}],ms:[{ms:pe()}],me:[{me:pe()}],mt:[{mt:pe()}],mr:[{mr:pe()}],mb:[{mb:pe()}],ml:[{ml:pe()}],"space-x":[{"space-x":W()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":W()}],"space-y-reverse":["space-y-reverse"],size:[{size:fe()}],w:[{w:[u,"screen",...fe()]}],"min-w":[{"min-w":[u,"screen","none",...fe()]}],"max-w":[{"max-w":[u,"screen","none","prose",{screen:[o]},...fe()]}],h:[{h:["screen","lh",...fe()]}],"min-h":[{"min-h":["screen","lh","none",...fe()]}],"max-h":[{"max-h":["screen","lh",...fe()]}],"font-size":[{text:["base",t,dm,zu]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,st,aS]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",oS,rt]}],"font-family":[{font:[YF,rt,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[r,st,rt]}],"line-clamp":[{"line-clamp":[Pt,"none",st,aS]}],leading:[{leading:[s,...W()]}],"list-image":[{"list-image":["none",st,rt]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",st,rt]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Z()}],"text-color":[{text:Z()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ve(),"wavy"]}],"text-decoration-thickness":[{decoration:[Pt,"from-font","auto",st,zu]}],"text-decoration-color":[{decoration:Z()}],"underline-offset":[{"underline-offset":[Pt,"auto",st,rt]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:W()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",st,rt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",st,rt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:ke()}],"bg-repeat":[{bg:Q()}],"bg-size":[{bg:z()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},dc,st,rt],radial:["",st,rt],conic:[dc,st,rt]},QF,XF]}],"bg-color":[{bg:Z()}],"gradient-from-pos":[{from:K()}],"gradient-via-pos":[{via:K()}],"gradient-to-pos":[{to:K()}],"gradient-from":[{from:Z()}],"gradient-via":[{via:Z()}],"gradient-to":[{to:Z()}],rounded:[{rounded:Se()}],"rounded-s":[{"rounded-s":Se()}],"rounded-e":[{"rounded-e":Se()}],"rounded-t":[{"rounded-t":Se()}],"rounded-r":[{"rounded-r":Se()}],"rounded-b":[{"rounded-b":Se()}],"rounded-l":[{"rounded-l":Se()}],"rounded-ss":[{"rounded-ss":Se()}],"rounded-se":[{"rounded-se":Se()}],"rounded-ee":[{"rounded-ee":Se()}],"rounded-es":[{"rounded-es":Se()}],"rounded-tl":[{"rounded-tl":Se()}],"rounded-tr":[{"rounded-tr":Se()}],"rounded-br":[{"rounded-br":Se()}],"rounded-bl":[{"rounded-bl":Se()}],"border-w":[{border:Pe()}],"border-w-x":[{"border-x":Pe()}],"border-w-y":[{"border-y":Pe()}],"border-w-s":[{"border-s":Pe()}],"border-w-e":[{"border-e":Pe()}],"border-w-t":[{"border-t":Pe()}],"border-w-r":[{"border-r":Pe()}],"border-w-b":[{"border-b":Pe()}],"border-w-l":[{"border-l":Pe()}],"divide-x":[{"divide-x":Pe()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Pe()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Ve(),"hidden","none"]}],"divide-style":[{divide:[...Ve(),"hidden","none"]}],"border-color":[{border:Z()}],"border-color-x":[{"border-x":Z()}],"border-color-y":[{"border-y":Z()}],"border-color-s":[{"border-s":Z()}],"border-color-e":[{"border-e":Z()}],"border-color-t":[{"border-t":Z()}],"border-color-r":[{"border-r":Z()}],"border-color-b":[{"border-b":Z()}],"border-color-l":[{"border-l":Z()}],"divide-color":[{divide:Z()}],"outline-style":[{outline:[...Ve(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Pt,st,rt]}],"outline-w":[{outline:["",Pt,dm,zu]}],"outline-color":[{outline:Z()}],shadow:[{shadow:["","none",p,Cb,kb]}],"shadow-color":[{shadow:Z()}],"inset-shadow":[{"inset-shadow":["none",y,Cb,kb]}],"inset-shadow-color":[{"inset-shadow":Z()}],"ring-w":[{ring:Pe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Z()}],"ring-offset-w":[{"ring-offset":[Pt,zu]}],"ring-offset-color":[{"ring-offset":Z()}],"inset-ring-w":[{"inset-ring":Pe()}],"inset-ring-color":[{"inset-ring":Z()}],"text-shadow":[{"text-shadow":["none",v,Cb,kb]}],"text-shadow-color":[{"text-shadow":Z()}],opacity:[{opacity:[Pt,st,rt]}],"mix-blend":[{"mix-blend":[...We(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":We()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Pt]}],"mask-image-linear-from-pos":[{"mask-linear-from":be()}],"mask-image-linear-to-pos":[{"mask-linear-to":be()}],"mask-image-linear-from-color":[{"mask-linear-from":Z()}],"mask-image-linear-to-color":[{"mask-linear-to":Z()}],"mask-image-t-from-pos":[{"mask-t-from":be()}],"mask-image-t-to-pos":[{"mask-t-to":be()}],"mask-image-t-from-color":[{"mask-t-from":Z()}],"mask-image-t-to-color":[{"mask-t-to":Z()}],"mask-image-r-from-pos":[{"mask-r-from":be()}],"mask-image-r-to-pos":[{"mask-r-to":be()}],"mask-image-r-from-color":[{"mask-r-from":Z()}],"mask-image-r-to-color":[{"mask-r-to":Z()}],"mask-image-b-from-pos":[{"mask-b-from":be()}],"mask-image-b-to-pos":[{"mask-b-to":be()}],"mask-image-b-from-color":[{"mask-b-from":Z()}],"mask-image-b-to-color":[{"mask-b-to":Z()}],"mask-image-l-from-pos":[{"mask-l-from":be()}],"mask-image-l-to-pos":[{"mask-l-to":be()}],"mask-image-l-from-color":[{"mask-l-from":Z()}],"mask-image-l-to-color":[{"mask-l-to":Z()}],"mask-image-x-from-pos":[{"mask-x-from":be()}],"mask-image-x-to-pos":[{"mask-x-to":be()}],"mask-image-x-from-color":[{"mask-x-from":Z()}],"mask-image-x-to-color":[{"mask-x-to":Z()}],"mask-image-y-from-pos":[{"mask-y-from":be()}],"mask-image-y-to-pos":[{"mask-y-to":be()}],"mask-image-y-from-color":[{"mask-y-from":Z()}],"mask-image-y-to-color":[{"mask-y-to":Z()}],"mask-image-radial":[{"mask-radial":[st,rt]}],"mask-image-radial-from-pos":[{"mask-radial-from":be()}],"mask-image-radial-to-pos":[{"mask-radial-to":be()}],"mask-image-radial-from-color":[{"mask-radial-from":Z()}],"mask-image-radial-to-color":[{"mask-radial-to":Z()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":F()}],"mask-image-conic-pos":[{"mask-conic":[Pt]}],"mask-image-conic-from-pos":[{"mask-conic-from":be()}],"mask-image-conic-to-pos":[{"mask-conic-to":be()}],"mask-image-conic-from-color":[{"mask-conic-from":Z()}],"mask-image-conic-to-color":[{"mask-conic-to":Z()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:ke()}],"mask-repeat":[{mask:Q()}],"mask-size":[{mask:z()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",st,rt]}],filter:[{filter:["","none",st,rt]}],blur:[{blur:Te()}],brightness:[{brightness:[Pt,st,rt]}],contrast:[{contrast:[Pt,st,rt]}],"drop-shadow":[{"drop-shadow":["","none",x,Cb,kb]}],"drop-shadow-color":[{"drop-shadow":Z()}],grayscale:[{grayscale:["",Pt,st,rt]}],"hue-rotate":[{"hue-rotate":[Pt,st,rt]}],invert:[{invert:["",Pt,st,rt]}],saturate:[{saturate:[Pt,st,rt]}],sepia:[{sepia:["",Pt,st,rt]}],"backdrop-filter":[{"backdrop-filter":["","none",st,rt]}],"backdrop-blur":[{"backdrop-blur":Te()}],"backdrop-brightness":[{"backdrop-brightness":[Pt,st,rt]}],"backdrop-contrast":[{"backdrop-contrast":[Pt,st,rt]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Pt,st,rt]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Pt,st,rt]}],"backdrop-invert":[{"backdrop-invert":["",Pt,st,rt]}],"backdrop-opacity":[{"backdrop-opacity":[Pt,st,rt]}],"backdrop-saturate":[{"backdrop-saturate":[Pt,st,rt]}],"backdrop-sepia":[{"backdrop-sepia":["",Pt,st,rt]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":W()}],"border-spacing-x":[{"border-spacing-x":W()}],"border-spacing-y":[{"border-spacing-y":W()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",st,rt]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Pt,"initial",st,rt]}],ease:[{ease:["linear","initial",N,st,rt]}],delay:[{delay:[Pt,st,rt]}],animate:[{animate:["none",L,st,rt]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[E,st,rt]}],"perspective-origin":[{"perspective-origin":B()}],rotate:[{rotate:Ee()}],"rotate-x":[{"rotate-x":Ee()}],"rotate-y":[{"rotate-y":Ee()}],"rotate-z":[{"rotate-z":Ee()}],scale:[{scale:at()}],"scale-x":[{"scale-x":at()}],"scale-y":[{"scale-y":at()}],"scale-z":[{"scale-z":at()}],"scale-3d":["scale-3d"],skew:[{skew:bt()}],"skew-x":[{"skew-x":bt()}],"skew-y":[{"skew-y":bt()}],transform:[{transform:[st,rt,"","none","gpu","cpu"]}],"transform-origin":[{origin:B()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:tt()}],"translate-x":[{"translate-x":tt()}],"translate-y":[{"translate-y":tt()}],"translate-z":[{"translate-z":tt()}],"translate-none":["translate-none"],accent:[{accent:Z()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Z()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",st,rt]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":W()}],"scroll-mx":[{"scroll-mx":W()}],"scroll-my":[{"scroll-my":W()}],"scroll-ms":[{"scroll-ms":W()}],"scroll-me":[{"scroll-me":W()}],"scroll-mt":[{"scroll-mt":W()}],"scroll-mr":[{"scroll-mr":W()}],"scroll-mb":[{"scroll-mb":W()}],"scroll-ml":[{"scroll-ml":W()}],"scroll-p":[{"scroll-p":W()}],"scroll-px":[{"scroll-px":W()}],"scroll-py":[{"scroll-py":W()}],"scroll-ps":[{"scroll-ps":W()}],"scroll-pe":[{"scroll-pe":W()}],"scroll-pt":[{"scroll-pt":W()}],"scroll-pr":[{"scroll-pr":W()}],"scroll-pb":[{"scroll-pb":W()}],"scroll-pl":[{"scroll-pl":W()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",st,rt]}],fill:[{fill:["none",...Z()]}],"stroke-w":[{stroke:[Pt,dm,zu,aS]}],stroke:[{stroke:["none",...Z()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},nB=MF(tB);function rB(...a){return nB(pF(a))}const sB=ue.forwardRef(({className:a,variant:e="primary",size:t="md",children:n,...r},s)=>w.jsx("button",{ref:s,className:rB("inline-flex items-center justify-center rounded-lg font-medium transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50",{"bg-blue-600 text-white hover:bg-blue-700 focus-visible:ring-blue-600":e==="primary","bg-gray-600 text-white hover:bg-gray-700 focus-visible:ring-gray-600":e==="secondary","border border-gray-300 bg-white hover:bg-gray-50 focus-visible:ring-gray-600":e==="outline","hover:bg-gray-100 focus-visible:ring-gray-600":e==="ghost","px-3 py-1.5 text-sm":t==="sm","px-4 py-2 text-base":t==="md","px-6 py-3 text-lg":t==="lg"},a),...r,children:n}));sB.displayName="Button";function sI(){const[a,e]=ue.useState(navigator.onLine);return ue.useEffect(()=>ZL(n=>{e(n)}),[]),a}function iB(a={}){const{autoSync:e=!0,syncInterval:t=3e4}=a,n=sI(),[r,s]=ue.useState({isSyncing:!1,lastSyncTime:null,pendingCount:0,error:null}),o=ue.useRef(null),u=async(x,S)=>{if(!Ai)throw new Error("Supabase ");const T=`submissions/${`${S}.webp`}`,{error:N}=await Ai.storage.from("homework-images").upload(T,x,{contentType:"image/webp",upsert:!0});if(N)throw new Error(`: ${N.message}`);const{data:{publicUrl:L}}=Ai.storage.from("homework-images").getPublicUrl(T);return L},d=async(x,S,E,T,N)=>{if(!Ai)throw new Error("Supabase ");const{error:L}=await Ai.from("submissions").upsert({id:x,assignment_id:S,student_id:E,image_url:T,status:"synced",created_at:new Date(N).toISOString()},{onConflict:"assignment_id,student_id",ignoreDuplicates:!1});if(L)throw new Error(`: ${L.message}`)},f=async x=>{try{if(console.log(`  ${x.id}`),!x.imageBlob)throw new Error("");const S=await u(x.imageBlob,x.id);return console.log(` : ${S}`),await d(x.id,x.assignmentId,x.studentId,S,x.createdAt),console.log(" "),await ze.submissions.update(x.id,{status:"synced",imageBlob:void 0}),console.log(" Blob "),!0}catch(S){throw console.error(`  ${x.id}:`,S),S}},p=ue.useCallback(async()=>{if(!n){console.log(" ");return}if(!Ai){console.log(" Supabase ");return}if(r.isSyncing){console.log(" ");return}try{s(N=>({...N,isSyncing:!0,error:null}));const x=await ze.submissions.where("status").equals("scanned").toArray();if(console.log(`  ${x.length} `),x.length===0){s(N=>({...N,isSyncing:!1,lastSyncTime:Date.now(),pendingCount:0}));return}let S=0,E=0;for(const N of x)try{await f(N),S++}catch(L){E++,console.error(":",L)}console.log(`  ${S}  ${E} `);const T=await ze.submissions.where("status").equals("scanned").count();s(N=>({...N,isSyncing:!1,lastSyncTime:Date.now(),pendingCount:T,error:E>0?`${E} `:null}))}catch(x){console.error(" :",x),s(S=>({...S,isSyncing:!1,error:x instanceof Error?x.message:""}))}},[n,r.isSyncing]),y=ue.useCallback(()=>{console.log(" "),p()},[p]),v=ue.useCallback(async()=>{const x=await ze.submissions.where("status").equals("scanned").count();s(S=>({...S,pendingCount:x}))},[]);return ue.useEffect(()=>{if(e)return v(),n&&p(),o.current=window.setInterval(()=>{n&&p()},t),()=>{o.current!==null&&clearInterval(o.current)}},[e,n,t,p,v]),ue.useEffect(()=>{n&&e&&(console.log(" "),p())},[n,e,p]),{...r,triggerSync:y,updatePendingCount:v}}function oB({autoSync:a=!0,syncInterval:e=3e4}){const t=sI(),{isSyncing:n,lastSyncTime:r,pendingCount:s,error:o,triggerSync:u}=iB({autoSync:a,syncInterval:e}),d=f=>{if(!f)return"";const y=Date.now()-f;return y<6e4?"":y<36e5?`${Math.floor(y/6e4)} `:y<864e5?`${Math.floor(y/36e5)} `:new Date(f).toLocaleString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return w.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 border border-gray-200",children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[t?w.jsx(S2,{className:"w-5 h-5 text-blue-600"}):w.jsx(x2,{className:"w-5 h-5 text-gray-400"}),w.jsx("span",{className:"font-semibold text-gray-900",children:""})]}),w.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:t?"":""})]}),w.jsxs("div",{className:"space-y-2 mb-4",children:[s>0&&w.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[w.jsx(lx,{className:"w-4 h-4 text-orange-500"}),w.jsxs("span",{className:"text-gray-700",children:[": ",w.jsx("span",{className:"font-semibold text-orange-600",children:s})," "]})]}),s===0&&r&&!n&&w.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[w.jsx(If,{className:"w-4 h-4 text-green-500"}),w.jsx("span",{className:"text-gray-700",children:""})]}),r&&w.jsxs("div",{className:"text-xs text-gray-500",children:[": ",d(r)]}),n&&w.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[w.jsx(ri,{className:"w-4 h-4 animate-spin"}),w.jsx("span",{children:"..."})]}),o&&w.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded text-xs text-red-800",children:o})]}),w.jsxs("button",{onClick:u,disabled:n||!t,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:[w.jsx(cT,{className:`w-4 h-4 ${n?"animate-spin":""}`}),n?"...":""]}),!t&&w.jsx("p",{className:"mt-2 text-xs text-gray-500 text-center",children:""})]})}async function aB(){console.log(" ...");const a=await ze.submissions.where("status").equals("scanned").toArray();return console.log(`  ${a.length} :`),a.forEach((e,t)=>{console.log(`
 ${t+1}:`),console.log("  ID:",e.id),console.log("   ID:",e.assignmentId),console.log("   ID:",e.studentId),console.log("  :",e.status),console.log("  :",!!e.imageBlob),console.log("  :",e.imageBlob?`${(e.imageBlob.size/1024).toFixed(2)} KB`:"N/A"),console.log("  :",new Date(e.createdAt).toLocaleString())}),a}async function lB(){console.log(" ...");const a=await ze.submissions.where("status").equals("synced").toArray();return console.log(`  ${a.length} `),a.forEach((e,t)=>{console.log(`
 ${t+1}:`),console.log("  ID:",e.id),console.log("  :",e.status),console.log("  :",!!e.imageBlob),console.log("  :",new Date(e.createdAt).toLocaleString())}),a}async function cB(a){if(console.log(` : ${a}`),!Ai){console.error(" Supabase ");return}try{const e=await ze.submissions.get(a);if(!e){console.error(" ");return}if(console.log(" :",e),!e.imageBlob){console.error(" ");return}console.log(`  (${(e.imageBlob.size/1024).toFixed(2)} KB)...`);const n=`submissions/${`${e.id}-${Date.now()}.webp`}`,{data:r,error:s}=await Ai.storage.from("homework-images").upload(n,e.imageBlob,{contentType:"image/webp",upsert:!1});if(s)return console.error(" :",s),console.error(":"),console.error("  message:",s.message),console.error("  statusCode:",(s==null?void 0:s.statusCode)??"n/a"),console.error("  name:",s.name),{success:!1,error:s};console.log(" :",r);const{data:{publicUrl:o}}=Ai.storage.from("homework-images").getPublicUrl(n);console.log("  URL:",o),console.log("  Supabase ...");const{error:u}=await Ai.from("submissions").insert({id:e.id,assignment_id:e.assignmentId,student_id:e.studentId,image_url:o,status:"synced",created_at:new Date(e.createdAt).toISOString()});return u?(console.error(" :",u),console.error(":"),console.error("  message:",u.message),console.error("  code:",u.code),console.error("  details:",u.details),console.error("  hint:",u.hint),{success:!1,error:u}):(console.log(" "),await ze.submissions.update(e.id,{status:"synced",imageBlob:void 0}),console.log(" "),console.log(" "),{success:!0,url:o})}catch(e){return console.error(" :",e),{success:!1,error:e}}}async function uB(a){console.log(` : ${a}`);try{await ze.submissions.update(a,{status:"scanned"}),console.log("  scanned")}catch(e){console.error(" :",e)}}async function dB(a){console.log(` : ${a}`);try{await ze.submissions.delete(a),console.log(" ")}catch(e){console.error(" :",e)}}async function hB(){console.log(" ...");const a=await ze.submissions.where("status").equals("scanned").toArray();if(console.log(` ${a.length} `),a.length===0){console.log(" ");return}if(!window.confirm(` ${a.length} `)){console.log(" ");return}for(const t of a)await ze.submissions.delete(t.id);console.log(" ")}async function fB(){console.log(` ...
`);const a=await ze.assignments.toArray();console.log(`  ${a.length} :
`);for(const n of a){const r=await ze.classrooms.get(n.classroomId);console.log(` : ${n.title}`),console.log(`  - ID: ${n.id}`),console.log(`  - : ${(r==null?void 0:r.name)||""}`);const s=await ze.submissions.where("assignmentId").equals(n.id).toArray();console.log(`  - : ${s.length}`),s.length>0&&s.forEach((o,u)=>{console.log(`    ${u+1}. : ${o.status}, : ${!!o.imageBlob}, ID: ${o.id}`)}),console.log("")}const t=(await ze.submissions.toArray()).filter(n=>!a.some(r=>r.id===n.assignmentId));t.length>0&&(console.log(`  ${t.length} :`),t.forEach(n=>{console.log(`  - ID: ${n.id},  ID: ${n.assignmentId}, : ${n.status}`)})),console.log(`
 `)}async function pB(){console.log("=".repeat(60)),console.log(" "),console.log("=".repeat(60)),console.log("");const a=await ze.classrooms.toArray();console.log(`  (${a.length})`),a.forEach((s,o)=>{console.log(`  ${o+1}. ${s.name} (ID: ${s.id})`)}),console.log("");const e=await ze.students.toArray();if(console.log(`  (${e.length})`),e.length>0){const s=e.reduce((o,u)=>(o[u.classroomId]||(o[u.classroomId]=[]),o[u.classroomId].push(u),o),{});Object.entries(s).forEach(([o,u])=>{const d=a.find(f=>f.id===o);console.log(`  - ${(d==null?void 0:d.name)||""}: ${u.length} `)})}console.log("");const t=await ze.assignments.toArray();console.log(`  (${t.length})`),t.forEach((s,o)=>{const u=a.find(d=>d.id===s.classroomId);console.log(`  ${o+1}. ${s.title} (ID: ${s.id})`),console.log(`     : ${(u==null?void 0:u.name)||""}`)}),console.log("");const n=await ze.submissions.toArray();if(console.log(`  (${n.length})`),n.length===0)console.log("   "),console.log("  "),console.log("    1. "),console.log("    2. "),console.log("    3. ");else{const s=n.reduce((o,u)=>(o[u.assignmentId]||(o[u.assignmentId]=[]),o[u.assignmentId].push(u),o),{});Object.entries(s).forEach(([o,u])=>{const d=t.find(f=>f.id===o);console.log(`  - ${(d==null?void 0:d.title)||` (${o})`}: ${u.length} `),u.forEach((f,p)=>{const y=e.find(v=>v.id===f.studentId);console.log(`    ${p+1}. ${(y==null?void 0:y.name)||""} - : ${f.status}, : ${!!f.imageBlob}`)})})}console.log("");const r=await ze.syncQueue.toArray();console.log(`  (${r.length})`),r.length>0&&r.forEach((s,o)=>{console.log(`  ${o+1}. ${s.action} - ${s.tableName} (${s.recordId})`)}),console.log(""),console.log("=".repeat(60)),console.log(" "),console.log("=".repeat(60))}typeof window<"u"&&(window.checkPendingSubmissions=aB,window.checkSyncedSubmissions=lB,window.testSingleUpload=cB,window.resetSubmissionStatus=uB,window.deleteSubmission=dB,window.clearPendingSubmissions=hB,window.checkAssignmentSubmissions=fB,window.checkDatabaseStatus=pB);function gB(){const[a,e]=ue.useState("home"),[t,n]=ue.useState("");return a==="classroom-management"?w.jsx(oO,{onBack:()=>e("home")}):a==="assignment-setup"?w.jsx(BM,{onBack:()=>e("home")}):a==="assignment-import-select"?w.jsx(nF,{onBack:()=>e("home"),onSelectScanImport:r=>{n(r),e("assignment-scan")},onSelectBatchImport:r=>{n(r),e("assignment-import")}}):a==="assignment-scan"&&t?w.jsx(cF,{assignmentId:t,onBack:()=>e("assignment-import-select")}):a==="grading-list"?w.jsx($M,{onBack:()=>e("home"),onSelectAssignment:r=>{n(r),e("grading")}}):a==="gradebook"?w.jsx(fF,{onBack:()=>e("home")}):a==="grading"&&t?w.jsx(eF,{assignmentId:t,onBack:()=>e("grading-list")}):a==="assignment-import"&&t?w.jsx(tF,{assignmentId:t,onBack:()=>e("assignment-import-select")}):a==="correction-select"?w.jsx(uF,{onBack:()=>e("home"),onSelectAssignment:r=>{n(r),e("correction")}}):a==="correction"&&t?w.jsx(hF,{assignmentId:t,onBack:()=>e("correction-select")}):w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:w.jsxs("div",{className:"w-full max-w-5xl bg-white rounded-2xl shadow-xl p-8",children:[w.jsxs("div",{className:"text-center mb-8",children:[w.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"RedPen AI"}),w.jsx("p",{className:"text-gray-600",children:" PWA "})]}),w.jsx("div",{className:"mb-6",children:w.jsx(oB,{autoSync:!1,syncInterval:3e4})}),w.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[w.jsxs("div",{className:"p-6 rounded-2xl border border-gray-200 bg-gray-50/80",children:[w.jsxs("h2",{className:"text-sm font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[w.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500 inline-block"}),""]}),w.jsxs("div",{className:"space-y-3",children:[w.jsxs("button",{onClick:()=>e("classroom-management"),className:"w-full flex items-center justify-between px-4 py-3 bg-white rounded-xl border border-gray-200 hover:border-blue-400 transition-colors",children:[w.jsxs("span",{className:"flex items-center gap-2 text-gray-800 font-medium",children:[w.jsx(nA,{className:"w-5 h-5 text-blue-600"}),""]}),w.jsx("span",{className:"text-xs text-gray-500",children:""})]}),w.jsxs("button",{onClick:()=>e("assignment-setup"),className:"w-full flex items-center justify-between px-4 py-3 bg-white rounded-xl border border-gray-200 hover:border-green-400 transition-colors",children:[w.jsxs("span",{className:"flex items-center gap-2 text-gray-800 font-medium",children:[w.jsx(wl,{className:"w-5 h-5 text-green-600"}),""]}),w.jsx("span",{className:"text-xs text-gray-500",children:""})]}),w.jsxs("button",{onClick:()=>e("assignment-import-select"),className:"w-full flex items-center justify-between px-4 py-3 bg-white rounded-xl border border-gray-200 hover:border-indigo-400 transition-colors",children:[w.jsxs("span",{className:"flex items-center gap-2 text-gray-800 font-medium",children:[w.jsx(Fm,{className:"w-5 h-5 text-indigo-600"}),""]}),w.jsx("span",{className:"text-xs text-gray-500",children:""})]}),w.jsxs("button",{onClick:()=>e("grading-list"),className:"w-full flex items-center justify-between px-4 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:from-purple-700 hover:to-pink-700 transition-colors",children:[w.jsxs("span",{className:"flex items-center gap-2 font-medium",children:[w.jsx(jf,{className:"w-5 h-5"}),"AI "]}),w.jsx("span",{className:"text-xs text-white/80",children:""})]})]})]}),w.jsxs("div",{className:"p-6 rounded-2xl border border-gray-200 bg-gray-50/80",children:[w.jsxs("h2",{className:"text-sm font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[w.jsx("span",{className:"w-2 h-2 rounded-full bg-orange-500 inline-block"}),""]}),w.jsxs("div",{className:"space-y-3",children:[w.jsxs("button",{onClick:()=>e("correction-select"),className:"w-full flex items-center justify-between px-4 py-3 bg-white rounded-xl border border-gray-200 hover:border-orange-400 transition-colors",children:[w.jsxs("span",{className:"flex items-center gap-2 text-gray-800 font-medium",children:[w.jsx(b2,{className:"w-5 h-5 text-orange-600"}),""]}),w.jsx("span",{className:"text-xs text-gray-500",children:" /  / "})]}),w.jsxs("button",{onClick:()=>e("gradebook"),className:"w-full flex items-center justify-between px-4 py-3 bg-white rounded-xl border border-gray-200 hover:border-emerald-400 transition-colors",children:[w.jsxs("span",{className:"flex items-center gap-2 text-gray-800 font-medium",children:[w.jsx(jf,{className:"w-5 h-5 text-emerald-600"}),""]}),w.jsx("span",{className:"text-xs text-gray-500",children:""})]})]})]})]}),w.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600",children:[w.jsx("p",{className:"font-semibold mb-2",children:""}),w.jsxs("ol",{className:"space-y-1 list-decimal list-inside",children:[w.jsx("li",{children:""}),w.jsx("li",{children:""}),w.jsx("li",{children:""}),w.jsx("li",{children:"AI "}),w.jsx("li",{children:""})]})]})]})})}o2.createRoot(document.getElementById("root")).render(w.jsx(ue.StrictMode,{children:w.jsx(gB,{})}));
